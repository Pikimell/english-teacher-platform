{"version":3,"file":"practice-DfYP_Pn8.js","sources":["../../src/api/user.js","../../src/api/homework.js","../../src/features/helpers/share-panel.js","../../src/features/helpers/speaker.js","../../src/features/practice/practice.js"],"sourcesContent":["import axios from './axiosInstance.js';\n\nexport const getUsers = async (page = 1, limit = 1000) => {\n  const res = await axios.get('/user');\n  return res.data;\n  /* \n  items - Ñ†Ðµ Ð¼Ð°ÑÐ¸Ð² Ð· ÑÑ‚ÑƒÐ´ÐµÐ½Ñ‚Ð°Ð¼Ð¸. Ð£ ÐºÐ¾Ð¶Ð½Ð¾Ð³Ð¾ ÑÑ‚ÑƒÐ´ÐµÐ½Ñ‚Ð° Ñ” Ð²Ð»Ð°ÑÑ‚Ð¸Ð²Ñ–ÑÑ‚ÑŒ email\n  */\n};\n","import axios from './axiosInstance.js';\n\nconst cache = {};\n\nfunction isValidCache(key) {}\n\nexport const getUserHomework = async data => {\n  const key = JSON.stringify(data);\n  const previousData = cache[key];\n  if (previousData) return previousData;\n\n  const res = await axios.post('/homework/list', data);\n  cache[key] = res.data;\n  return res.data;\n};\n\nexport const addHomework = async homework => {\n  const res = await axios.post('/homework', homework);\n  return res.data;\n};\n\nfunction newRadioAnswer(userCache, answer) {\n  const task = userCache.items.find(el => el._id === answer.taskId);\n  const items = task.answers;\n  const itemIndex = items.findIndex(el => el.name == answer.name);\n\n  if (itemIndex >= 0) {\n    items[itemIndex] = answer;\n  } else {\n    items.push(answer);\n  }\n\n  const data = {\n    taskId: answer.taskId,\n    answers: items,\n  };\n\n  return updateHomework(data);\n}\n\nfunction newAnswer(userCache, answer) {\n  if (answer.type === 'radio') return newRadioAnswer(userCache, answer);\n\n  const task = userCache.items.find(el => el._id === answer.taskId);\n  const items = task.answers;\n  const itemIndex = items.findIndex(el => el.inputId == answer.inputId);\n\n  const data = {\n    taskId: answer.taskId,\n    answers: items,\n  };\n\n  if (itemIndex >= 0) {\n    items[itemIndex] = answer;\n  } else {\n    items.push(answer);\n  }\n\n  return updateHomework(data);\n}\n\nexport const addAnswer = async answer => {\n  const keys = Object.keys(cache);\n  let userCache = cache[keys[0]];\n\n  if (!userCache) {\n    const data = {\n      taskId: answer.taskId,\n      answers: [answer],\n    };\n    return updateHomework(data);\n  } else {\n    newAnswer(userCache, answer);\n  }\n};\nexport const updateHomework = async ({ taskId, ...homework }) => {\n  const res = await axios.patch(`/homework/${taskId}`, homework);\n\n  return res.data;\n};\n\nexport const getUserHomeworkLessons = async userEmail => {\n  const params = {\n    page: 1,\n    limit: 100,\n    userEmail,\n  };\n\n  const res = await axios.post('/homework/lessons', params);\n  const { data } = res;\n\n  data.items = data.items.reverse();\n  return data.items;\n};\n","import { getUsers } from '@api/user.js';\n\nconst shareState = {\n  users: null,\n  request: null,\n  active: null,\n};\n\nfunction defaultFetchStudents() {\n  if (shareState.users) return Promise.resolve(shareState.users);\n  if (shareState.request) return shareState.request;\n\n  shareState.request = getUsers()\n    .then(data => {\n      const items = Array.isArray(data?.items) ? data.items : [];\n      shareState.users = items;\n      return items;\n    })\n    .catch(error => {\n      console.error('ÐÐµ Ð²Ð´Ð°Ð»Ð¾ÑÑ Ð·Ð°Ð²Ð°Ð½Ñ‚Ð°Ð¶Ð¸Ñ‚Ð¸ ÑÐ¿Ð¸ÑÐ¾Ðº ÑÑ‚ÑƒÐ´ÐµÐ½Ñ‚Ñ–Ð²', error);\n      throw error;\n    })\n    .finally(() => {\n      shareState.request = null;\n    });\n\n  return shareState.request;\n}\n\nfunction defaultFormatStudentName(student) {\n  if (!student || typeof student !== 'object') return 'ÐÐµÐ²Ñ–Ð´Ð¾Ð¼Ð¸Ð¹ ÑÑ‚ÑƒÐ´ÐµÐ½Ñ‚';\n  const possibleFirst =\n    student.firstName || student.firstname || student.nameFirst || '';\n  const possibleLast =\n    student.lastName || student.lastname || student.nameLast || '';\n  const full = [possibleFirst, possibleLast]\n    .map(part => String(part || '').trim())\n    .filter(Boolean)\n    .join(' ');\n  const display =\n    full ||\n    student.displayName ||\n    student.fullName ||\n    student.username ||\n    student.email ||\n    (student.id ? `ID ${student.id}` : '');\n  return display || 'Ð‘ÐµÐ· Ñ–Ð¼ÐµÐ½Ñ–';\n}\n\nexport function closeActiveSharePanel() {\n  if (!shareState.active) return;\n  const { panel, button } = shareState.active;\n  panel.style.display = 'none';\n  panel.dataset.open = 'false';\n  button.setAttribute('aria-expanded', 'false');\n  shareState.active = null;\n}\n\nconst shareControls = new Set();\nlet canShare = false;\n\nfunction applyShareVisibility(control) {\n  const { button, panel } = control;\n  if (!button || !panel) return;\n  if (!button.isConnected && !panel.isConnected) {\n    shareControls.delete(control);\n    return;\n  }\n  if (canShare) {\n    button.hidden = false;\n    return;\n  }\n  button.hidden = true;\n  panel.style.display = 'none';\n  panel.dataset.open = 'false';\n}\n\nfunction registerShareControl(button, panel) {\n  const control = { button, panel };\n  shareControls.add(control);\n  applyShareVisibility(control);\n  return () => {\n    shareControls.delete(control);\n  };\n}\n\nexport function setShareAvailability(isAllowed) {\n  const next = Boolean(isAllowed);\n  if (canShare === next) return;\n  canShare = next;\n  if (!canShare) {\n    closeActiveSharePanel();\n  }\n  shareControls.forEach(control => applyShareVisibility(control));\n}\n\nfunction handleOutsideShareClick(event) {\n  if (!shareState.active) return;\n  const { panel, button } = shareState.active;\n  const target = event.target;\n  if (panel.contains(target) || button.contains(target)) return;\n  closeActiveSharePanel();\n}\n\nfunction handleShareKeydown(event) {\n  if (event.key === 'Escape') {\n    closeActiveSharePanel();\n  }\n}\n\ndocument.addEventListener('click', handleOutsideShareClick);\ndocument.addEventListener('keydown', handleShareKeydown);\n\nfunction el(tag, attrs = {}, ...children) {\n  const node = document.createElement(tag);\n  for (const [key, value] of Object.entries(attrs || {})) {\n    if (key === 'class') node.className = value;\n    else if (key === 'html') node.innerHTML = value;\n    else if (key.startsWith('on') && typeof value === 'function')\n      node.addEventListener(key.slice(2), value);\n    else node.setAttribute(key, value);\n  }\n  for (const child of children) {\n    if (child == null) continue;\n    node.appendChild(\n      typeof child === 'string' ? document.createTextNode(child) : child\n    );\n  }\n  return node;\n}\n\nconst defaultOptions = {\n  triggerLabel: 'ÐÐ°Ð´Ñ–ÑÐ»Ð°Ñ‚Ð¸',\n  triggerClassName: 'practice-share-trigger for-admin js-share-homework-btn',\n  triggerStyle:\n    'border:none;background:#2563eb;color:#fff;padding:4px 10px;border-radius:999px;font-size:12px;line-height:1;cursor:pointer;box-shadow:0 4px 12px rgba(37,99,235,0.24);',\n  panelClassName: 'practice-share-panel',\n  panelStyle:\n    'position:absolute;top:38px;right:0;min-width:240px;max-width:280px;border:1px solid #e2e8f0;border-radius:12px;background:#fff;box-shadow:0 18px 40px rgba(15,23,42,0.18);padding:8px;z-index:30;display:none;',\n  emptyMessage: 'Ð¡Ð¿Ð¸ÑÐ¾Ðº ÑÑ‚ÑƒÐ´ÐµÐ½Ñ‚Ñ–Ð² Ð¿Ð¾Ñ€Ð¾Ð¶Ð½Ñ–Ð¹',\n  loadingMessage: 'Ð—Ð°Ð²Ð°Ð½Ñ‚Ð°Ð¶ÐµÐ½Ð½Ñâ€¦',\n  errorMessage: 'ÐÐµ Ð²Ð´Ð°Ð»Ð¾ÑÑ Ð·Ð°Ð²Ð°Ð½Ñ‚Ð°Ð¶Ð¸Ñ‚Ð¸ ÑÑ‚ÑƒÐ´ÐµÐ½Ñ‚Ñ–Ð². Ð¡Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ Ñ‰Ðµ Ñ€Ð°Ð·.',\n  formatStudentName: defaultFormatStudentName,\n  fetchStudents: defaultFetchStudents,\n  getContext: null,\n  onShare: () => undefined,\n  renderDetails: student =>\n    student?.email\n      ? el(\n          'span',\n          { class: 'muted', style: 'font-size:12px;color:#475569;' },\n          student.email\n        )\n      : null,\n};\n\nfunction resolveShareOptions(options = {}) {\n  const resolved = { ...defaultOptions, ...options };\n  resolved.fetchStudents =\n    typeof options.fetchStudents === 'function'\n      ? options.fetchStudents\n      : defaultOptions.fetchStudents;\n  resolved.formatStudentName =\n    typeof options.formatStudentName === 'function'\n      ? options.formatStudentName\n      : defaultOptions.formatStudentName;\n  resolved.renderDetails =\n    typeof options.renderDetails === 'function'\n      ? options.renderDetails\n      : defaultOptions.renderDetails;\n  resolved.onShare =\n    typeof options.onShare === 'function'\n      ? options.onShare\n      : defaultOptions.onShare;\n\n  resolved.getContext =\n    typeof options.getContext === 'function'\n      ? options.getContext\n      : () => options.context;\n\n  return resolved;\n}\n\nfunction renderStudentOptions(panel, students, options) {\n  panel.innerHTML = '';\n  if (!students.length) {\n    panel.appendChild(\n      el(\n        'div',\n        {\n          class: 'muted',\n          style: 'font-size:13px;text-align:center;padding:12px 8px;',\n        },\n        options.emptyMessage\n      )\n    );\n    return;\n  }\n\n  const list = el('ul', {\n    style: 'list-style:none;margin:0;padding:0;max-height:220px;overflow:auto;',\n  });\n\n  const getContext =\n    typeof options.getContext === 'function'\n      ? options.getContext\n      : defaultOptions.getContext;\n\n  students.forEach(student => {\n    const button = el(\n      'button',\n      {\n        type: 'button',\n        style:\n          'width:100%;background:transparent;border:none;text-align:left;padding:8px 10px;border-radius:8px;cursor:pointer;display:flex;flex-direction:column;gap:2px;',\n        onmouseenter: () => {\n          button.style.backgroundColor = '#f1f5f9';\n        },\n        onmouseleave: () => {\n          button.style.backgroundColor = 'transparent';\n        },\n        onclick: () => {\n          const context =\n            typeof getContext === 'function' ? getContext(student) : undefined;\n          try {\n            const result = options.onShare({ student, context });\n            if (result && typeof result.then === 'function') {\n              button.disabled = true;\n              Promise.resolve(result)\n                .then(value => {\n                  if (value !== false) {\n                    closeActiveSharePanel();\n                  }\n                })\n                .catch(error => {\n                  console.error('ÐŸÐ¾Ð¼Ð¸Ð»ÐºÐ° Ð¿Ñ–Ð´ Ñ‡Ð°Ñ Ð½Ð°Ð´ÑÐ¸Ð»Ð°Ð½Ð½Ñ Ð·Ð°Ð²Ð´Ð°Ð½Ð½Ñ', error);\n                  closeActiveSharePanel();\n                })\n                .finally(() => {\n                  button.disabled = false;\n                });\n              return;\n            }\n            if (result !== false) {\n              closeActiveSharePanel();\n            }\n          } catch (error) {\n            console.error('ÐŸÐ¾Ð¼Ð¸Ð»ÐºÐ° Ð¿Ñ–Ð´ Ñ‡Ð°Ñ Ð½Ð°Ð´ÑÐ¸Ð»Ð°Ð½Ð½Ñ Ð·Ð°Ð²Ð´Ð°Ð½Ð½Ñ', error);\n            closeActiveSharePanel();\n          }\n        },\n      },\n      el(\n        'span',\n        { style: 'font-size:14px;font-weight:600;color:#0f172a;' },\n        options.formatStudentName(student)\n      ),\n      options.renderDetails ? options.renderDetails(student) : null\n    );\n    const item = el('li', { style: 'margin:0;padding:0;' }, button);\n    list.appendChild(item);\n  });\n\n  panel.appendChild(list);\n}\n\nfunction createSharePanelElement(options) {\n  return el('div', {\n    class: options.panelClassName,\n    role: 'dialog',\n    'aria-label': 'ÐÐ°Ð´ÑÐ¸Ð»Ð°Ð½Ð½Ñ Ð·Ð°Ð²Ð´Ð°Ð½Ð½Ñ ÑÑ‚ÑƒÐ´ÐµÐ½Ñ‚Ñƒ',\n    style: options.panelStyle,\n    'data-open': 'false',\n  });\n}\n\nfunction toggleSharePanel(button, panel, options) {\n  const isOpen = panel.dataset.open === 'true';\n  if (isOpen) {\n    closeActiveSharePanel();\n    return;\n  }\n  if (shareState.active && shareState.active.panel !== panel) {\n    closeActiveSharePanel();\n  }\n\n  panel.dataset.open = 'true';\n  panel.style.display = 'block';\n  button.setAttribute('aria-expanded', 'true');\n\n  panel.innerHTML = '';\n  panel.appendChild(\n    el(\n      'div',\n      {\n        class: 'muted',\n        style: 'font-size:13px;padding:12px 8px;text-align:center;',\n      },\n      options.loadingMessage\n    )\n  );\n\n  shareState.active = { panel, button };\n\n  Promise.resolve(options.fetchStudents())\n    .then(students => {\n      renderStudentOptions(\n        panel,\n        Array.isArray(students) ? students : [],\n        options\n      );\n    })\n    .catch(() => {\n      panel.innerHTML = '';\n      panel.appendChild(\n        el(\n          'div',\n          {\n            style:\n              'color:#ef4444;font-size:13px;text-align:center;padding:12px 8px;',\n          },\n          options.errorMessage\n        )\n      );\n    });\n}\n\nfunction createShareTrigger(panel, options) {\n  const button = el(\n    'button',\n    {\n      type: 'button',\n      class: options.triggerClassName,\n      title: 'ÐÐ°Ð´Ñ–ÑÐ»Ð°Ñ‚Ð¸ ÑÑ‚ÑƒÐ´ÐµÐ½Ñ‚Ñƒ',\n      'aria-haspopup': 'dialog',\n      'aria-expanded': 'false',\n      style: options.triggerStyle,\n      onclick: event => {\n        event.preventDefault();\n        toggleSharePanel(button, panel, options);\n      },\n    },\n    options.triggerLabel\n  );\n  return button;\n}\n\nexport function createShareControl(options = {}) {\n  const resolvedOptions = resolveShareOptions(options);\n  const panel = createSharePanelElement(resolvedOptions);\n  const button = createShareTrigger(panel, resolvedOptions);\n  const unregister = registerShareControl(button, panel);\n  return { button, panel, unregister };\n}\n\nexport function isSharePanelActive(panel) {\n  return Boolean(shareState.active && shareState.active.panel === panel);\n}\n","const hasSpeechSynthesis = () =>\n  typeof window !== 'undefined' && 'speechSynthesis' in window;\n\nlet voicesReadyPromise = null;\nfunction getVoicesReady() {\n  if (!hasSpeechSynthesis()) return Promise.resolve([]);\n  if (voicesReadyPromise) return voicesReadyPromise;\n  voicesReadyPromise = new Promise(resolve => {\n    const voices = window.speechSynthesis.getVoices();\n    if (voices.length) {\n      resolve(voices);\n      return;\n    }\n    const handle = () => {\n      const nextVoices = window.speechSynthesis.getVoices();\n      if (nextVoices.length) {\n        window.speechSynthesis.onvoiceschanged = null;\n        resolve(nextVoices);\n      }\n    };\n    window.speechSynthesis.onvoiceschanged = handle;\n  });\n  return voicesReadyPromise;\n}\n\nfunction normalizeLower(value) {\n  return String(value || '')\n    .trim()\n    .toLowerCase();\n}\n\nconst FEMALE_VOICE_HINTS = [\n  'female',\n  'woman',\n  'girl',\n  'samantha',\n  'victoria',\n  'karen',\n  'moira',\n  'serena',\n  'allison',\n  'ava',\n  'amelie',\n  'amelia',\n  'emma',\n  'olivia',\n  'isabella',\n  'mia',\n  'sophia',\n  'sofia',\n  'fiona',\n  'pauline',\n  'paula',\n  'linda',\n  'viola',\n  'nora',\n  'clara',\n  'lucy',\n  'tessa',\n  'zoe',\n];\n\nconst MALE_VOICE_HINTS = [\n  'male',\n  'man',\n  'boy',\n  'alex',\n  'daniel',\n  'fred',\n  'bruce',\n  'oliver',\n  'arthur',\n  'henry',\n  'james',\n  'john',\n  'luke',\n  'mark',\n  'michael',\n  'paul',\n  'peter',\n  'thomas',\n  'victor',\n  'william',\n  'liam',\n  'noah',\n  'sam',\n  'george',\n  'carlos',\n  'diego',\n  'roberto',\n  'sergio',\n  'mateo',\n];\n\nconst matchVoiceHints = (name, uri, hints) =>\n  hints.some(hint => name.includes(hint) || uri.includes(hint));\n\nexport const estimateVoiceGender = voice => {\n  if (!voice) return null;\n  const name = normalizeLower(voice.name);\n  const uri = normalizeLower(voice.voiceURI);\n  if (matchVoiceHints(name, uri, FEMALE_VOICE_HINTS)) return 'female';\n  if (matchVoiceHints(name, uri, MALE_VOICE_HINTS)) return 'male';\n  return null;\n};\n\nfunction pickVoice(voices, options = {}) {\n  if (!Array.isArray(voices) || !voices.length) return null;\n  const {\n    lang = 'en',\n    voiceName,\n    voice,\n    voiceGender,\n    gender,\n  } = options;\n\n  const normalizedLang = normalizeLower(lang) || 'en';\n  const preferredName =\n    voiceName || (voice && /\\s/.test(String(voice)) ? String(voice) : null);\n  const genderHintRaw =\n    gender || voiceGender || (!preferredName && voice) || null;\n  const genderHint = normalizeLower(genderHintRaw);\n\n  let chosen =\n    (preferredName && voices.find(v => v.name === preferredName)) ||\n    (preferredName &&\n      voices.find(v => normalizeLower(v.name) === normalizeLower(preferredName))) ||\n    null;\n\n  const voiceMatchesGender = candidate => {\n    if (!genderHint) return false;\n    const detected = estimateVoiceGender(candidate);\n    if (detected) return detected === genderHint;\n    const name = normalizeLower(candidate.name);\n    const uri = normalizeLower(candidate.voiceURI);\n    return name.includes(genderHint) || uri.includes(genderHint);\n  };\n\n  const voicesForLang = voices.filter(v =>\n    normalizeLower(v.lang).startsWith(normalizedLang)\n  );\n\n  if (!chosen && genderHint) {\n    chosen =\n      voicesForLang.find(voiceMatchesGender) ||\n      voices.find(voiceMatchesGender) ||\n      null;\n  }\n\n  if (!chosen && preferredName && normalizeLower(preferredName)) {\n    const lowered = normalizeLower(preferredName);\n    chosen =\n      voicesForLang.find(v => normalizeLower(v.name).includes(lowered)) ||\n      voices.find(v => normalizeLower(v.name).includes(lowered)) ||\n      null;\n  }\n\n  if (!chosen) {\n    chosen =\n      voicesForLang.find(v => normalizeLower(v.name).includes('female')) ||\n      voicesForLang[0] ||\n      voices.find(v => normalizeLower(v.name).includes('female')) ||\n      voices[0] ||\n      null;\n  }\n\n  return chosen || null;\n}\n\nexport async function speakText(\n  text,\n  {\n    lang = 'en',\n    voiceName,\n    voice,\n    voiceGender,\n    gender,\n    rate = 1,\n    pitch = 1,\n    volume = 1,\n  } = {}\n) {\n  if (!hasSpeechSynthesis()) return null;\n  await getVoicesReady();\n  const utter = new SpeechSynthesisUtterance(text);\n  const availableVoices = window.speechSynthesis.getVoices();\n  const chosen = pickVoice(availableVoices, {\n    lang,\n    voiceName,\n    voice,\n    voiceGender,\n    gender,\n  });\n\n  if (chosen) {\n    utter.voice = chosen;\n    utter.lang = chosen.lang || lang || 'en';\n  } else {\n    utter.lang = lang || 'en';\n  }\n\n  utter.rate = rate;\n  utter.pitch = pitch;\n  utter.volume = volume;\n\n  window.speechSynthesis.cancel();\n  window.speechSynthesis.speak(utter);\n  return utter;\n}\n\nexport function createPlayBtn(text) {\n  const playBtn = document.createElement('span');\n  playBtn.textContent = 'ðŸ”Š';\n  playBtn.addEventListener('click', () => {\n    speakText(text);\n  });\n  playBtn.classList.add('play-speak-btn');\n  return playBtn;\n}\n\nexport async function listAvailableVoices() {\n  if (!hasSpeechSynthesis()) return [];\n  await getVoicesReady();\n  const voices = window.speechSynthesis.getVoices();\n  return Array.isArray(voices) ? voices.slice() : [];\n}\n\nexport { pickVoice };\n","// Lightweight practice renderer for topic pages\n\nimport { addHomework } from '@api/homework.js';\nimport { auth } from '@features/auth/auth.js';\nimport {\n  closeActiveSharePanel,\n  createShareControl,\n  isSharePanelActive,\n  setShareAvailability,\n} from '@features/helpers/share-panel.js';\nimport {\n  speakText,\n  listAvailableVoices,\n  estimateVoiceGender,\n} from '@features/helpers/speaker.js';\n\n// Convention: for page /X/indexN.html â†’ fetch /X/practice/indexN.json\nconst practiceAPI = (function () {\n  const basePath =\n    (typeof import.meta !== 'undefined' &&\n      import.meta.env &&\n      import.meta.env.BASE_URL) ||\n    '/';\n\n  function resolveAssetPath(path) {\n    const normalizedBase = basePath.endsWith('/') ? basePath : `${basePath}/`;\n    const rawPath = String(path || '');\n    if (/^[a-z]+:/i.test(rawPath)) return rawPath;\n    if (rawPath.startsWith(normalizedBase)) return rawPath;\n    return `${normalizedBase}${rawPath.replace(/^\\/+/, '')}`;\n  }\n\n  function derivePracticePath() {\n    try {\n      const url = new URL(window.location.href);\n      const parts = url.pathname.split('/');\n      let file = parts.pop();\n      if (!file || !/\\.html?$/i.test(file)) file = 'index.html';\n      const json = file.replace(/\\.html?$/i, '.json');\n      parts.push('practice', json);\n      return parts.join('/');\n    } catch (e) {\n      return null;\n    }\n  }\n\n  function el(tag, attrs = {}, ...children) {\n    const node = document.createElement(tag);\n    for (const [k, v] of Object.entries(attrs || {})) {\n      if (k === 'class') node.className = v;\n      else if (k === 'html') node.innerHTML = v;\n      else if (k.startsWith('on') && typeof v === 'function')\n        node.addEventListener(k.slice(2), v);\n      else node.setAttribute(k, v);\n    }\n    for (const ch of children) {\n      if (ch == null) continue;\n      node.appendChild(\n        typeof ch === 'string' ? document.createTextNode(ch) : ch\n      );\n    }\n    return node;\n  }\n\n  function shuffle(arr) {\n    const a = arr.slice();\n    for (let i = a.length - 1; i > 0; i--) {\n      const j = Math.floor(Math.random() * (i + 1));\n      [a[i], a[j]] = [a[j], a[i]];\n    }\n    return a;\n  }\n\n  function normalize(s) {\n    return String(s || '')\n      .trim()\n      .toLowerCase()\n      .replace(/\\s+/g, ' ');\n  }\n\n  let inputIdCounter = 0;\n  function uniqueInputId(prefix = 'practice-input') {\n    inputIdCounter += 1;\n    const base =\n      String(prefix || 'practice-input')\n        .trim()\n        .replace(/[^a-z0-9_-]+/gi, '-')\n        .replace(/^-+|-+$/g, '') || 'practice-input';\n    return `${base}-${inputIdCounter}`;\n  }\n\n  auth.subscribe(({ user }) => {\n    setShareAvailability(auth.isAdmin(user));\n  });\n  // Subtle hint toggle: hidden by default, shown on small button click\n  function makeHint(hintText) {\n    const wrap = el('div', { class: 'hint-wrap', style: 'margin-top:6px;' });\n    const btn = el(\n      'button',\n      {\n        type: 'button',\n        class: 'hint-toggle',\n        'aria-label': 'ÐŸÐ¾ÐºÐ°Ð·Ð°Ñ‚Ð¸ Ð¿Ñ–Ð´ÐºÐ°Ð·ÐºÑƒ',\n        title: 'ÐŸÑ–Ð´ÐºÐ°Ð·ÐºÐ°',\n        style:\n          'border:none;background:transparent;color:#94a3b8;cursor:pointer;padding:0;font-size:14px;line-height:1;',\n      },\n      '?'\n    );\n    const box = el(\n      'div',\n      {\n        class: 'hint-box muted',\n        style: 'display:none;margin-top:6px;color:#475569;',\n      },\n      `ÐŸÑ–Ð´ÐºÐ°Ð·ÐºÐ°: ${hintText}`\n    );\n    btn.addEventListener('click', () => {\n      const isHidden = box.style.display === 'none';\n      box.style.display = isHidden ? 'block' : 'none';\n      btn.setAttribute('aria-expanded', isHidden ? 'true' : 'false');\n    });\n    wrap.appendChild(btn);\n    wrap.appendChild(box);\n    return wrap;\n  }\n\n  function renderMCQ(container, task) {\n    renderTaskTitle(container, task, 'Choose the correct option');\n\n    const blocks = [];\n    (task.items || []).forEach((item, idx) => {\n      const name = `${task.id || 'mcq'}-${idx}`;\n      const allowMulti = Array.isArray(item.answer) && item.answer.length > 1;\n      const block = el(\n        'div',\n        {\n          class: 'mcq-item',\n          style:\n            'margin-bottom:10px;padding:10px;border:1px solid #e5e7eb;border-radius:10px;background:#fff;',\n        },\n        el(\n          'div',\n          { class: 'q', style: 'margin-bottom:8px;font-weight:600;' },\n          item.q\n        )\n      );\n      (item.choices || []).forEach((choice, cIdx) => {\n        const id = uniqueInputId(`${name}-${cIdx}`);\n        const lbl = el(\n          'label',\n          {\n            for: id,\n            style: 'display:flex;align-items:center;gap:8px;margin:4px 0;',\n          },\n          el('input', {\n            type: allowMulti ? 'checkbox' : 'radio',\n            name,\n            id,\n            value: String(cIdx),\n          }),\n          el('span', {}, choice)\n        );\n        block.appendChild(lbl);\n      });\n      if (item.explanation) {\n        block.appendChild(\n          el(\n            'div',\n            {\n              class: 'exp muted',\n              style: 'display:none;margin-top:6px;color:#475569;',\n            },\n            item.explanation\n          )\n        );\n      }\n      blocks.push({ block, item, name });\n      container.appendChild(block);\n    });\n    const result = el('div', {\n      class: 'result',\n      style: 'margin-top:8px;font-weight:600;',\n    });\n    const btn = el(\n      'button',\n      { type: 'button', class: 'btn primary', style: 'margin-top:8px;' },\n      'ÐŸÐµÑ€ÐµÐ²Ñ–Ñ€Ð¸Ñ‚Ð¸'\n    );\n    btn.addEventListener('click', () => {\n      let correct = 0;\n      blocks.forEach(({ block, item, name }) => {\n        const answers = Array.isArray(item.answer)\n          ? item.answer.map(String)\n          : [String(item.answer)];\n        const inputs = Array.from(\n          block.querySelectorAll(`input[name='${name}']`)\n        );\n        const picked = inputs\n          .filter(i => i.checked)\n          .map(i => i.value)\n          .sort();\n        const expected = answers.slice().sort();\n        const ok =\n          picked.length === expected.length &&\n          picked.every((v, i) => v === expected[i]);\n        block.style.borderColor = ok ? '#10b981' : '#ef4444';\n        const exp = block.querySelector('.exp');\n        if (exp) exp.style.display = ok ? 'none' : 'block';\n        if (ok) correct++;\n      });\n      result.textContent = `Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚: ${correct}/${blocks.length}`;\n    });\n    container.appendChild(btn);\n    container.appendChild(result);\n  }\n\n  function renderGap(container, task) {\n    renderTaskTitle(container, task, 'Fill the gaps');\n    const items = [];\n    (task.items || []).forEach((it, idx) => {\n      const row = el('div', {\n        style:\n          'margin-bottom:10px;padding:10px;border:1px solid #e5e7eb;border-radius:10px;background:#fff;',\n      });\n      const parts = String(it.q || '').split(/___/);\n      const inputId = uniqueInputId(`${task.id || 'gap'}-${idx}`);\n      const input = el('input', {\n        type: 'text',\n        id: inputId,\n        style: 'padding:6px 8px;border:1px solid #cbd5e1;border-radius:6px;',\n      });\n      if (parts.length > 1) {\n        row.appendChild(el('span', {}, parts[0]));\n        row.appendChild(input);\n        row.appendChild(el('span', {}, parts.slice(1).join('___')));\n      } else {\n        row.appendChild(\n          el('div', { style: 'margin-bottom:6px;font-weight:600;' }, it.q)\n        );\n        row.appendChild(input);\n      }\n      if (it.hint) row.appendChild(makeHint(it.hint));\n      items.push({\n        row,\n        input,\n        answers: (it.answer || []).map(a => normalize(a)),\n      });\n      container.appendChild(row);\n    });\n    const result = el('div', { style: 'margin-top:8px;font-weight:600;' });\n    const btn = el(\n      'button',\n      { type: 'button', class: 'btn primary', style: 'margin-top:8px;' },\n      'ÐŸÐµÑ€ÐµÐ²Ñ–Ñ€Ð¸Ñ‚Ð¸'\n    );\n    btn.addEventListener('click', () => {\n      let correct = 0;\n      items.forEach(({ row, input, answers }) => {\n        const val = normalize(input.value);\n        const ok = answers.includes(val);\n        row.style.borderColor = ok ? '#10b981' : '#ef4444';\n        if (ok) correct++;\n      });\n      result.textContent = `Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚: ${correct}/${items.length}`;\n    });\n    container.appendChild(btn);\n    container.appendChild(result);\n  }\n\n  function renderMatch(container, task) {\n    renderTaskTitle(container, task, 'Match pairs');\n    const pairs = task.pairs || [];\n    const rights = shuffle(pairs.map(p => p.right));\n    const rows = [];\n    pairs.forEach((p, index) => {\n      const selectId = uniqueInputId(`${task.id || 'match'}-${index}`);\n      const select = el(\n        'select',\n        {\n          id: selectId,\n          style: 'padding:6px 8px;border:1px solid #cbd5e1;border-radius:6px;',\n        },\n        el('option', { value: '' }, 'â€” Ð¾Ð±ÐµÑ€Ð¸ â€”'),\n        ...rights.map(r => el('option', { value: r }, r))\n      );\n      const row = el(\n        'div',\n        {\n          style:\n            'display:flex;align-items:center;gap:10px;margin:8px 0;padding:10px;border:1px solid #e5e7eb;border-radius:10px;background:#fff;',\n        },\n        el(\n          'label',\n          { for: selectId, style: 'min-width:160px;font-weight:600;' },\n          p.left\n        ),\n        select\n      );\n      rows.push({ row, select, right: p.right });\n      container.appendChild(row);\n    });\n    const result = el('div', { style: 'margin-top:8px;font-weight:600;' });\n    const btn = el(\n      'button',\n      { type: 'button', class: 'btn primary', style: 'margin-top:8px;' },\n      'ÐŸÐµÑ€ÐµÐ²Ñ–Ñ€Ð¸Ñ‚Ð¸'\n    );\n    btn.addEventListener('click', () => {\n      let correct = 0;\n      rows.forEach(({ row, select, right }) => {\n        const ok = select.value === right;\n        row.style.borderColor = ok ? '#10b981' : '#ef4444';\n        if (ok) correct++;\n      });\n      result.textContent = `Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚: ${correct}/${rows.length}`;\n    });\n    container.appendChild(btn);\n    container.appendChild(result);\n  }\n\n  function renderContext(container, task) {\n    renderTaskTitle(container, task, 'ÐŸÑ€Ð¾Ñ‡Ð¸Ñ‚Ð°Ð¹Ñ‚Ðµ Ñ‚ÐµÐºÑÑ‚ Ñ‚Ð° Ð´Ð°Ð¹Ñ‚Ðµ Ð²Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´Ñ–');\n\n    const context = task.context || {};\n    const format = String(context.format || 'narrative').toLowerCase();\n    const body = Array.isArray(context.body) ? context.body : [];\n    const textWrap = el('div', {\n      style:\n        'margin:12px 0;padding:14px;border:1px solid #cbd5e1;border-radius:10px;background:#f8fafc;',\n    });\n\n    if (context.title) {\n      textWrap.appendChild(\n        el('h4', { style: 'margin:0 0 8px;font-size:18px;' }, context.title)\n      );\n    }\n\n    if (format === 'dialog') {\n      body.forEach(turn => {\n        if (!turn) return;\n        const speaker =\n          typeof turn === 'object' && turn.speaker ? `${turn.speaker}:` : '';\n        const line =\n          typeof turn === 'object' && 'line' in turn\n            ? turn.line\n            : typeof turn === 'string'\n            ? turn\n            : '';\n        textWrap.appendChild(\n          el(\n            'p',\n            {\n              style:\n                'margin:4px 0;display:flex;gap:6px;align-items:flex-start;line-height:1.5;',\n            },\n            speaker ? el('strong', {}, speaker) : null,\n            el('span', {}, line)\n          )\n        );\n      });\n    } else {\n      body.forEach((paragraph, index) => {\n        const text =\n          typeof paragraph === 'string'\n            ? paragraph\n            : paragraph && paragraph.text\n            ? paragraph.text\n            : '';\n        if (!text) return;\n        textWrap.appendChild(\n          el('p', { style: index ? 'margin:8px 0 0;' : 'margin:0;' }, text)\n        );\n      });\n    }\n\n    container.appendChild(textWrap);\n\n    const questions = Array.isArray(task.questions) ? task.questions : [];\n    if (!questions.length) return;\n\n    const blocks = [];\n    questions.forEach((question, idx) => {\n      const prompt = el(\n        'div',\n        { style: 'margin-bottom:8px;font-weight:600;' },\n        question.q || `ÐŸÐ¸Ñ‚Ð°Ð½Ð½Ñ ${idx + 1}`\n      );\n      const block = el(\n        'div',\n        {\n          style:\n            'margin-bottom:12px;padding:12px;border:1px solid #e5e7eb;border-radius:10px;background:#fff;',\n        },\n        prompt\n      );\n\n      const answers = Array.isArray(question.answer)\n        ? question.answer.map(String)\n        : question.answer != null\n        ? [String(question.answer)]\n        : [];\n\n      if (Array.isArray(question.choices) && question.choices.length) {\n        const name = `${task.id || 'context'}-${idx}`;\n        const allowMulti = answers.length > 1;\n        const expectedIsIndex = answers.every(value => /^\\d+$/.test(value));\n        question.choices.forEach((choice, cIdx) => {\n          const id = uniqueInputId(`${name}-${cIdx}`);\n          block.appendChild(\n            el(\n              'label',\n              {\n                for: id,\n                style: 'display:flex;align-items:center;gap:8px;margin:4px 0;',\n              },\n              el('input', {\n                type: allowMulti ? 'checkbox' : 'radio',\n                name,\n                id,\n                value: String(cIdx),\n              }),\n              el('span', {}, choice)\n            )\n          );\n        });\n        blocks.push({\n          block,\n          type: 'choices',\n          allowMulti,\n          getPicked: () => {\n            const inputs = Array.from(\n              block.querySelectorAll(`input[name='${name}']`)\n            );\n            const picked = inputs\n              .filter(input => input.checked)\n              .map(input => input.value);\n            if (!expectedIsIndex) {\n              return picked.map(index =>\n                normalize(question.choices[Number(index)] || '')\n              );\n            }\n            return picked;\n          },\n          expected: expectedIsIndex\n            ? answers\n            : answers.map(answer => normalize(answer)),\n        });\n      } else {\n        const promptId = uniqueInputId(`${task.id || 'context-label'}-${idx}`);\n        prompt.setAttribute('id', promptId);\n        const inputId = uniqueInputId(`${task.id || 'context-text'}-${idx}`);\n        const input = el('textarea', {\n          id: inputId,\n          rows: 2,\n          style:\n            'width:100%;max-width:640px;padding:6px 8px;border:1px solid #cbd5e1;border-radius:6px;',\n        });\n        input.setAttribute('aria-labelledby', promptId);\n        block.appendChild(input);\n        blocks.push({\n          block,\n          type: 'text',\n          input,\n          expected: answers.map(answer => normalize(answer)),\n        });\n      }\n\n      if (question.explanation) {\n        block.appendChild(\n          el(\n            'div',\n            {\n              class: 'muted',\n              style: 'display:none;margin-top:6px;color:#475569;',\n            },\n            question.explanation\n          )\n        );\n      }\n\n      container.appendChild(block);\n    });\n\n    const result = el('div', {\n      style: 'margin-top:8px;font-weight:600;',\n    });\n    const button = el(\n      'button',\n      { type: 'button', class: 'btn primary', style: 'margin-top:8px;' },\n      'ÐŸÐµÑ€ÐµÐ²Ñ–Ñ€Ð¸Ñ‚Ð¸'\n    );\n\n    button.addEventListener('click', () => {\n      let correct = 0;\n      blocks.forEach(entry => {\n        let ok = false;\n        if (entry.type === 'choices') {\n          const picked = entry.getPicked().sort();\n          const expected = entry.expected.slice().sort();\n          ok =\n            picked.length === expected.length &&\n            picked.every((value, index) => value === expected[index]);\n        } else {\n          const value = normalize(entry.input.value);\n          ok = entry.expected.length\n            ? entry.expected.includes(value)\n            : Boolean(value);\n        }\n        entry.block.style.borderColor = ok ? '#10b981' : '#ef4444';\n        const explanation = entry.block.querySelector('.muted');\n        if (explanation) explanation.style.display = ok ? 'none' : 'block';\n        if (ok) correct++;\n      });\n      result.textContent = `Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚: ${correct}/${blocks.length}`;\n    });\n\n    container.appendChild(button);\n    container.appendChild(result);\n  }\n\n  function renderTask(container, task, taskKey, options = {}) {\n    const { showRemove = true } = options;\n    const keyBase =\n      taskKey ||\n      (task && task.id\n        ? String(task.id)\n        : `task-${Math.random().toString(16).slice(2, 8)}`);\n    const box = el('section', {\n      style: 'position:relative;margin:18px 0 26px;',\n      'data-task-id': task && task.id ? String(task.id) : '',\n      'data-task-key': keyBase,\n    });\n    const controls = el('div', {\n      style:\n        'position:absolute;top:6px;right:6px;display:flex;gap:6px;align-items:center;z-index:5;',\n    });\n\n    const {\n      button: shareBtn,\n      panel: sharePanel,\n      unregister: unregisterShareControl,\n    } = createShareControl({\n      context: task,\n      onShare: ({ student, context }) => {\n        const lessonId = window.location.search.slice(8);\n        const heading = document.querySelector('h1');\n        const lessonName = heading ? heading.textContent : '';\n\n        const homework = {\n          lessonId,\n          userEmail: student.email,\n          lessonName,\n          homeworkType: 'task',\n          homeworkData: JSON.stringify(context),\n        };\n\n        return addHomework(homework);\n      },\n    });\n\n    controls.appendChild(shareBtn);\n    // Subtle remove button (top-right), hidden until hover/focus\n    if (showRemove) {\n      const removeBtn = el(\n        'button',\n        {\n          type: 'button',\n          title: 'Ð’Ð¸Ð´Ð°Ð»Ð¸Ñ‚Ð¸ Ð·Ð°Ð²Ð´Ð°Ð½Ð½Ñ',\n          'aria-label': 'Ð’Ð¸Ð´Ð°Ð»Ð¸Ñ‚Ð¸ Ð·Ð°Ð²Ð´Ð°Ð½Ð½Ñ',\n          class: 'for-admin',\n          style:\n            'border:none;background:transparent;color:#94a3b8;cursor:pointer;padding:2px;line-height:1;font-size:14px;opacity:0.6;',\n          onmouseenter: () => (removeBtn.style.opacity = '1'),\n          onmouseleave: () => (removeBtn.style.opacity = '0.6'),\n          onclick: () => {\n            if (isSharePanelActive(sharePanel)) {\n              closeActiveSharePanel();\n            }\n            document.dispatchEvent(\n              new CustomEvent('practice:taskRemoved', {\n                detail: { key: keyBase, task },\n              })\n            );\n            unregisterShareControl();\n            box.remove();\n          },\n        },\n        'âœ•'\n      );\n      controls.appendChild(removeBtn);\n    }\n    box.appendChild(controls);\n    box.appendChild(sharePanel);\n    if (task.title) box.appendChild(el('h3', {}, task.title));\n    const rawType = task && task.type;\n    const normalizedType = String(rawType || '')\n      .trim()\n      .toLowerCase();\n    switch (normalizedType) {\n      case 'mcq':\n        renderMCQ(box, task);\n        break;\n      case 'gap':\n        renderGap(box, task);\n        break;\n      case 'match':\n        renderMatch(box, task);\n        break;\n      case 'context':\n        renderContext(box, task);\n        break;\n      case 'transform':\n        renderTransform(box, task);\n        break;\n      case 'error':\n        renderError(box, task);\n        break;\n      case 'order':\n        renderOrder(box, task);\n        break;\n      case 'short':\n        renderShort(box, task);\n        break;\n      case 'roleplay':\n        renderRoleplay(box, task);\n        break;\n      case 'dialogue-gap':\n        renderDialogueGap(box, task);\n        break;\n      case 'dialogue-order':\n        renderDialogueOrder(box, task);\n        break;\n      case 'truefalse':\n        renderTrueFalse(box, task);\n        break;\n      case 'definition-match': {\n        const matchTask = {\n          ...task,\n          prompt: task.prompt || 'ÐŸÐ¾Ñ”Ð´Ð½Ð°Ð¹ ÑÐ»Ð¾Ð²Ð¾ Ð· Ð²Ð¸Ð·Ð½Ð°Ñ‡ÐµÐ½Ð½ÑÐ¼',\n        };\n        renderMatch(box, matchTask);\n        break;\n      }\n      case 'synonym-clue':\n        renderSynonymClue(box, task);\n        break;\n      case 'scramble':\n        renderScramble(box, task);\n        break;\n      case 'wordpairs': {\n        const pairsTask = {\n          ...task,\n          prompt: task.prompt || 'ÐŸÐ¾Ñ”Ð´Ð½Ð°Ð¹ Ñ„Ð¾Ñ€Ð¼Ñƒ Ð² Ð¾Ð´Ð½Ð¸Ð½Ñ– Ñ‚Ð° Ð¼Ð½Ð¾Ð¶Ð¸Ð½Ñ–',\n        };\n        renderMatch(box, pairsTask);\n        break;\n      }\n      case 'odd-one-out':\n        renderOddOneOut(box, task);\n        break;\n      case 'open':\n        renderOpen(box, task);\n        break;\n      case 'writing':\n        renderWriting(box, task);\n        break;\n      case 'audio':\n        renderAudio(box, task);\n        break;\n      default:\n        box.appendChild(\n          el('div', { class: 'muted' }, `ÐÐµÐ²Ñ–Ð´Ð¾Ð¼Ð¸Ð¹ Ñ‚Ð¸Ð¿ Ð·Ð°Ð²Ð´Ð°Ð½Ð½Ñ: ${rawType}`)\n        );\n    }\n    container.appendChild(box);\n    return box;\n  }\n\n  // Expose minimal public API for dynamic appends\n  function appendTask(task, meta = {}) {\n    const root = ensurePracticeContainer();\n    if (!root || !task) return;\n    const body = root.querySelector('#practice-body') || root;\n    const allowRemove = meta.showRemove !== false;\n    renderTask(body, task, meta.key, { showRemove: allowRemove });\n  }\n\n  function renderTaskList(target, tasks, options = {}) {\n    if (!target) return null;\n    const entries = Array.isArray(tasks) ? tasks.filter(Boolean) : [];\n    const {\n      title,\n      level,\n      description,\n      keyPrefix = 'inline',\n      showEmptyNote = false,\n      showRemove = false,\n    } = options;\n\n    if (!entries.length) {\n      if (showEmptyNote) {\n        const note = el(\n          'p',\n          { class: 'muted practice-inline__empty' },\n          'ÐŸÑ€Ð°ÐºÑ‚Ð¸ÐºÐ° Ð´Ð»Ñ Ñ†Ñ–Ñ”Ñ— Ñ‚ÐµÐ¼Ð¸ Ð¿Ð¾ÐºÐ¸ Ð²Ñ–Ð´ÑÑƒÑ‚Ð½Ñ.'\n        );\n        target.appendChild(note);\n      }\n      return null;\n    }\n\n    const wrapper = el('section', { class: 'practice-inline' });\n\n    if (title || level || description) {\n      const header = el('header', { class: 'practice-inline__header' });\n      if (title) {\n        header.appendChild(\n          el('h3', { class: 'practice-inline__title' }, title)\n        );\n      }\n      if (level) {\n        header.appendChild(\n          el('span', { class: 'practice-inline__badge' }, level)\n        );\n      }\n      if (description) {\n        header.appendChild(\n          el('p', { class: 'practice-inline__description muted' }, description)\n        );\n      }\n      wrapper.appendChild(header);\n    }\n\n    entries.forEach((task, index) => {\n      const key = `${keyPrefix}-${index}`;\n      renderTask(wrapper, task, key, { showRemove });\n    });\n\n    target.appendChild(wrapper);\n    document.dispatchEvent(\n      new CustomEvent('practice:inlineRendered', {\n        detail: {\n          tasks: entries,\n          container: target,\n          options,\n        },\n      })\n    );\n    return wrapper;\n  }\n\n  function createTaskElement(task, meta = {}) {\n    if (!task) return null;\n    const fragment = document.createDocumentFragment();\n    const allowRemove = meta.showRemove !== false;\n    const element = renderTask(fragment, task, meta.key, {\n      showRemove: allowRemove,\n    });\n    return element;\n  }\n\n  async function fetchPracticeCandidate(path) {\n    if (!path) return null;\n    const resolvedPath = resolveAssetPath(path);\n    try {\n      const res = await fetch(resolvedPath, { cache: 'no-store' });\n      if (!res.ok) return null;\n      return await res.json();\n    } catch (error) {\n      return null;\n    }\n  }\n\n  async function loadData() {\n    const inline = document.getElementById('practice-data');\n    if (inline) {\n      try {\n        return JSON.parse(inline.textContent);\n      } catch (error) {\n        return null;\n      }\n    }\n\n    const context = window.lessonContext || {};\n    const candidates = new Set();\n\n    if (context.id) {\n      candidates.add(`data/practice/${context.id}.json`);\n    }\n\n    if (context.htmlPath) {\n      const normalized = String(context.htmlPath)\n        .replace(/^\\.\\/?/, '')\n        .replace(/\\.html?$/i, '');\n      if (normalized) {\n        candidates.add(`data/practice/${normalized}.json`);\n        const segments = normalized.split('/');\n        const last = segments[segments.length - 1];\n        if (last) {\n          candidates.add(`data/practice/${last}.json`);\n        }\n      }\n    }\n\n    for (const candidate of candidates) {\n      const data = await fetchPracticeCandidate(candidate);\n      if (data) return data;\n    }\n\n    const fallbackPath = derivePracticePath();\n    if (!fallbackPath) return null;\n    return await fetchPracticeCandidate(fallbackPath);\n  }\n\n  // ============ Extra renderers (moved inside closure) ============\n  function renderTransform(container, task) {\n    renderTaskTitle(container, task, 'Transform the sentence');\n    const items = [];\n    (task.items || []).forEach((it, idx) => {\n      const row = el('div', {\n        style:\n          'margin-bottom:10px;padding:10px;border:1px solid #e5e7eb;border-radius:10px;background:#fff;',\n      });\n      row.appendChild(\n        el('div', { style: 'margin-bottom:6px;font-weight:600;' }, it.q)\n      );\n      const inputId = uniqueInputId(`${task.id || 'transform'}-${idx}`);\n      const input = el('input', {\n        type: 'text',\n        id: inputId,\n        style:\n          'width:100%;max-width:640px;padding:6px 8px;border:1px solid #cbd5e1;border-radius:6px;',\n      });\n      row.appendChild(input);\n      if (it.hint) row.appendChild(makeHint(it.hint));\n      items.push({\n        row,\n        input,\n        answers: (it.answer || []).map(a => normalize(a)),\n      });\n      container.appendChild(row);\n    });\n    const result = el('div', { style: 'margin-top:8px;font-weight:600;' });\n    const btn = el(\n      'button',\n      { type: 'button', class: 'btn primary', style: 'margin-top:8px;' },\n      'ÐŸÐµÑ€ÐµÐ²Ñ–Ñ€Ð¸Ñ‚Ð¸'\n    );\n    btn.addEventListener('click', () => {\n      let correct = 0;\n      items.forEach(({ row, input, answers }) => {\n        const ok = answers.includes(normalize(input.value));\n        row.style.borderColor = ok ? '#10b981' : '#ef4444';\n        if (ok) correct++;\n      });\n      result.textContent = `Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚: ${correct}/${items.length}`;\n    });\n    container.appendChild(btn);\n    container.appendChild(result);\n  }\n\n  function renderError(container, task) {\n    renderTaskTitle(container, task, 'Find and correct the error');\n    const items = [];\n    (task.items || []).forEach((it, idx) => {\n      const row = el('div', {\n        style:\n          'margin-bottom:10px;padding:10px;border:1px solid #e5e7eb;border-radius:10px;background:#fff;',\n      });\n      row.appendChild(\n        el('div', { style: 'margin-bottom:6px;font-weight:600;' }, it.q)\n      );\n      const inputId = uniqueInputId(`${task.id || 'error'}-${idx}`);\n      const input = el('input', {\n        type: 'text',\n        id: inputId,\n        style:\n          'width:100%;max-width:640px;padding:6px 8px;border:1px solid #cbd5e1;border-radius:6px;',\n      });\n      row.appendChild(input);\n      if (it.hint) row.appendChild(makeHint(it.hint));\n      items.push({\n        row,\n        input,\n        answers: (it.answer || []).map(a => normalize(a)),\n      });\n      container.appendChild(row);\n    });\n    const result = el('div', { style: 'margin-top:8px;font-weight:600;' });\n    const btn = el(\n      'button',\n      { type: 'button', class: 'btn primary', style: 'margin-top:8px;' },\n      'ÐŸÐµÑ€ÐµÐ²Ñ–Ñ€Ð¸Ñ‚Ð¸'\n    );\n    btn.addEventListener('click', () => {\n      let correct = 0;\n      items.forEach(({ row, input, answers }) => {\n        const ok = answers.includes(normalize(input.value));\n        row.style.borderColor = ok ? '#10b981' : '#ef4444';\n        if (ok) correct++;\n      });\n      result.textContent = `Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚: ${correct}/${items.length}`;\n    });\n    container.appendChild(btn);\n    container.appendChild(result);\n  }\n\n  function renderOrder(container, task) {\n    renderTaskTitle(container, task, 'Put the words in order');\n    const blocks = [];\n    (task.items || []).forEach((it, idx) => {\n      const correctStr = normalize(\n        Array.isArray(it.answer) ? it.answer.join(' ') : it.answer\n      );\n      const pool = shuffle((it.tokens || []).slice());\n      const row = el('div', {\n        style:\n          'margin:10px 0;padding:10px;border:1px solid #e5e7eb;border-radius:10px;background:#fff;',\n      });\n      const poolWrap = el('div', {\n        style: 'display:flex;flex-wrap:wrap;gap:6px;margin-bottom:6px;',\n      });\n      const outWrap = el('div', {\n        style:\n          'display:flex;flex-wrap:wrap;gap:6px;min-height:36px;padding:6px;border:1px dashed #cbd5e1;border-radius:8px;background:#f8fafc;',\n      });\n      const used = new Set();\n      function makeBtn(word, i) {\n        const b = el(\n          'button',\n          {\n            type: 'button',\n            style:\n              'padding:4px 8px;border:1px solid #cbd5e1;border-radius:6px;background:#fff;cursor:pointer;',\n          },\n          word\n        );\n        b.addEventListener('click', () => {\n          if (used.has(i)) return;\n          used.add(i);\n          b.style.opacity = 0.5;\n          outWrap.appendChild(\n            el(\n              'span',\n              {\n                class: 'chip',\n                style:\n                  'padding:4px 8px;border:1px solid #cbd5e1;border-radius:6px;background:#fff;',\n              },\n              word\n            )\n          );\n        });\n        return b;\n      }\n      pool.forEach((w, i) => poolWrap.appendChild(makeBtn(w, `${idx}-${i}`)));\n      const actions = el('div', {\n        style: 'margin-top:6px;display:flex;gap:8px;',\n      });\n      const reset = el('button', { type: 'button', class: 'btn' }, 'Ð¡ÐºÐ¸Ð½ÑƒÑ‚Ð¸');\n      reset.addEventListener('click', () => {\n        used.clear();\n        outWrap.innerHTML = '';\n        Array.from(poolWrap.children).forEach(ch => (ch.style.opacity = 1));\n        row.style.borderColor = '#e5e7eb';\n      });\n      actions.appendChild(reset);\n      row.appendChild(\n        el('div', { style: 'margin-bottom:6px;font-weight:600;' }, it.q || '')\n      );\n      row.appendChild(poolWrap);\n      row.appendChild(outWrap);\n      row.appendChild(actions);\n      blocks.push({ row, outWrap, correctStr });\n      container.appendChild(row);\n    });\n    const result = el('div', { style: 'margin-top:8px;font-weight:600;' });\n    const btn = el(\n      'button',\n      { type: 'button', class: 'btn primary', style: 'margin-top:8px;' },\n      'ÐŸÐµÑ€ÐµÐ²Ñ–Ñ€Ð¸Ñ‚Ð¸'\n    );\n    btn.addEventListener('click', () => {\n      let correct = 0;\n      blocks.forEach(({ row, outWrap, correctStr }) => {\n        const built = normalize(\n          Array.from(outWrap.querySelectorAll('.chip'))\n            .map(n => n.textContent)\n            .join(' ')\n        );\n        const ok = built === correctStr;\n        row.style.borderColor = ok ? '#10b981' : '#ef4444';\n        if (ok) correct++;\n      });\n      result.textContent = `Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚: ${correct}/${blocks.length}`;\n    });\n    container.appendChild(btn);\n    container.appendChild(result);\n  }\n\n  function renderShort(container, task) {\n    renderTaskTitle(container, task, 'Short answer');\n    const items = [];\n    (task.items || []).forEach((it, index) => {\n      const row = el('div', {\n        style:\n          'margin-bottom:10px;padding:10px;border:1px solid #e5e7eb;border-radius:10px;background:#fff;',\n      });\n      const prompt = el(\n        'div',\n        { style: 'margin-bottom:6px;font-weight:600;' },\n        it.q\n      );\n      row.appendChild(prompt);\n      const promptId = uniqueInputId(`${task.id || 'short-label'}-${index}`);\n      prompt.setAttribute('id', promptId);\n      const inputId = uniqueInputId(`${task.id || 'short-text'}-${index}`);\n      const input = el('textarea', {\n        id: inputId,\n        rows: 3,\n        style:\n          'width:100%;max-width:720px;padding:6px 8px;border:1px solid #cbd5e1;border-radius:6px;',\n      });\n      input.setAttribute('aria-labelledby', promptId);\n      row.appendChild(input);\n      items.push({\n        row,\n        input,\n        keywords: (it.keywords || []).map(k => normalize(k)),\n      });\n      container.appendChild(row);\n    });\n    const result = el('div', { style: 'margin-top:8px;font-weight:600;' });\n    const btn = el(\n      'button',\n      { type: 'button', class: 'btn primary', style: 'margin-top:8px;' },\n      'ÐŸÐµÑ€ÐµÐ²Ñ–Ñ€Ð¸Ñ‚Ð¸'\n    );\n    btn.addEventListener('click', () => {\n      let sum = 0,\n        total = 0;\n      items.forEach(({ row, input, keywords }) => {\n        const text = normalize(input.value);\n        const matched = keywords.filter(k => text.includes(k)).length;\n        sum += matched;\n        total += keywords.length;\n        row.style.borderColor =\n          matched === keywords.length\n            ? '#10b981'\n            : matched > 0\n            ? '#f59e0b'\n            : '#ef4444';\n        const info =\n          row.querySelector('.short-info') ||\n          el('div', {\n            class: 'short-info',\n            style: 'margin-top:6px;color:#475569;',\n          });\n        info.textContent = `Ð—Ð±Ñ–Ð³Ð¸ ÐºÐ»ÑŽÑ‡Ð¾Ð²Ð¸Ñ… ÑÐ»Ñ–Ð²: ${matched}/${keywords.length}`;\n        if (!row.contains(info)) row.appendChild(info);\n      });\n      result.textContent = `Ð—Ð°Ð³Ð°Ð»ÑŒÐ½Ð¸Ð¹ Ð·Ð±Ñ–Ð³ ÐºÐ»ÑŽÑ‡Ð¾Ð²Ð¸Ñ… ÑÐ»Ñ–Ð²: ${sum}/${total}`;\n    });\n    container.appendChild(btn);\n    container.appendChild(result);\n  }\n\n  function renderOpen(container, task) {\n    renderTaskTitle(container, task, 'Ð’Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´Ñ– Ñƒ Ð²Ñ–Ð»ÑŒÐ½Ñ–Ð¹ Ñ„Ð¾Ñ€Ð¼Ñ–');\n\n    const items = Array.isArray(task && task.items)\n      ? task.items.filter(Boolean)\n      : [];\n    if (items.length) {\n      const list = el('div', {\n        style: 'display:flex;flex-direction:column;gap:12px;margin-top:12px;',\n      });\n      items.forEach((item, index) => {\n        const entry = el('div', {\n          style:\n            'padding:12px;border:1px solid #e5e7eb;border-radius:10px;background:#fff;',\n        });\n        const situation =\n          (item && (item.situation || item.prompt || item.q)) ||\n          `Ð¡Ð¸Ñ‚ÑƒÐ°Ñ†Ñ–Ñ ${index + 1}`;\n        entry.appendChild(\n          el(\n            'div',\n            { style: 'margin:0 0 6px;font-weight:600;color:#0f172a;' },\n            situation\n          )\n        );\n\n        const examples =\n          item && Array.isArray(item.example_answers)\n            ? item.example_answers.filter(Boolean)\n            : [];\n        if (examples.length) {\n          entry.appendChild(\n            el(\n              'div',\n              { class: 'muted', style: 'margin:0 0 6px;color:#64748b;' },\n              'ÐŸÑ€Ð¸ÐºÐ»Ð°Ð´ Ð²Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´Ñ–:'\n            )\n          );\n          const chips = el('div', {\n            style: 'display:flex;flex-wrap:wrap;gap:8px;',\n          });\n          examples.forEach(answer => {\n            chips.appendChild(\n              el(\n                'span',\n                {\n                  style:\n                    'display:inline-flex;align-items:center;padding:4px 10px;border-radius:9999px;background:#e2e8f0;color:#0f172a;font-size:14px;',\n                },\n                answer\n              )\n            );\n          });\n          entry.appendChild(chips);\n        }\n        list.appendChild(entry);\n      });\n      container.appendChild(list);\n    }\n\n    const criteria =\n      task && task.scoring && Array.isArray(task.scoring.criteria)\n        ? task.scoring.criteria.filter(Boolean)\n        : [];\n    if (criteria.length) {\n      const scoringBox = el('div', {\n        style:\n          'margin-top:16px;padding:14px;border:1px dashed #cbd5e1;border-radius:10px;background:#f8fafc;',\n      });\n      scoringBox.appendChild(\n        el(\n          'h4',\n          {\n            style:\n              'margin:0 0 8px;font-size:16px;font-weight:600;color:#0f172a;',\n          },\n          'ÐšÑ€Ð¸Ñ‚ÐµÑ€Ñ–Ñ— Ð¾Ñ†Ñ–Ð½ÑŽÐ²Ð°Ð½Ð½Ñ'\n        )\n      );\n      const list = el('ul', {\n        style: 'margin:0;padding-left:18px;color:#475569;',\n      });\n      criteria.forEach(criterion => {\n        list.appendChild(el('li', { style: 'margin:4px 0;' }, criterion));\n      });\n      scoringBox.appendChild(list);\n      container.appendChild(scoringBox);\n    }\n  }\n\n  function renderRoleplay(container, task) {\n    renderTaskTitle(container, task, 'Role-play scenario');\n\n    const scenario =\n      task && typeof task.scenario === 'object' ? task.scenario : {};\n    const infoBox = el('div', {\n      style:\n        'margin:12px 0;padding:14px;border:1px solid #cbd5e1;border-radius:10px;background:#f8fafc;',\n    });\n    let infoAdded = false;\n\n    if (scenario.setting) {\n      infoBox.appendChild(\n        el(\n          'p',\n          { style: 'margin:0 0 6px;font-weight:600;' },\n          `Ð›Ð¾ÐºÐ°Ñ†Ñ–Ñ: ${scenario.setting}`\n        )\n      );\n      infoAdded = true;\n    }\n\n    if (scenario.summary) {\n      infoBox.appendChild(\n        el('p', { style: 'margin:0;color:#334155;' }, scenario.summary)\n      );\n      infoAdded = true;\n    }\n\n    if (infoAdded) {\n      container.appendChild(infoBox);\n    }\n\n    const roles = Array.isArray(scenario.roles) ? scenario.roles : [];\n    if (roles.length) {\n      const rolesWrap = el('div', {\n        style:\n          'display:grid;gap:12px;margin-top:12px;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));',\n      });\n      roles.forEach((role, index) => {\n        const name = (role && role.name) || `Student ${index + 1}`;\n        const roleBox = el(\n          'div',\n          {\n            style:\n              'padding:14px;border:1px solid #e5e7eb;border-radius:10px;background:#fff;box-shadow:0 1px 0 rgba(148, 163, 184, 0.2);',\n          },\n          el('div', { style: 'font-weight:600;margin-bottom:6px;' }, name)\n        );\n\n        if (role && role.goal) {\n          roleBox.appendChild(\n            el(\n              'p',\n              { style: 'margin:0 0 6px;color:#0f172a;' },\n              `ÐœÐµÑ‚Ð°: ${role.goal}`\n            )\n          );\n        }\n\n        const rawDetails =\n          role && Array.isArray(role.details)\n            ? role.details\n            : typeof role?.details === 'string'\n            ? role.details.split(/[;,\\n]/)\n            : [];\n        const details = rawDetails\n          .map(item => String(item || '').trim())\n          .filter(Boolean);\n        if (details.length === 1) {\n          roleBox.appendChild(\n            el('p', { style: 'margin:0;color:#475569;' }, details[0])\n          );\n        } else if (details.length > 1) {\n          const list = el('ul', {\n            style: 'margin:0;padding-left:18px;color:#475569;',\n          });\n          details.forEach(detail => {\n            list.appendChild(el('li', { style: 'margin:2px 0;' }, detail));\n          });\n          roleBox.appendChild(list);\n        }\n\n        rolesWrap.appendChild(roleBox);\n      });\n      container.appendChild(rolesWrap);\n    }\n\n    const steps = Array.isArray(scenario.steps) ? scenario.steps : [];\n    if (steps.length) {\n      const stepsWrap = el('div', {\n        style:\n          'margin-top:16px;padding:14px;border:1px solid #e5e7eb;border-radius:10px;background:#fff;',\n      });\n      stepsWrap.appendChild(\n        el(\n          'h4',\n          {\n            style:\n              'margin:0 0 6px;font-size:16px;font-weight:600;color:#0f172a;',\n          },\n          'ÐŸÐ¾ÐºÑ€Ð¾ÐºÐ¾Ð²Ð¸Ð¹ Ð¿Ð»Ð°Ð½ Ð´Ñ–Ð°Ð»Ð¾Ð³Ñƒ'\n        )\n      );\n      const list = el('ol', {\n        style: 'margin:0 0 0 18px;padding:0;color:#475569;',\n      });\n      steps.forEach(step => {\n        if (!step) return;\n        list.appendChild(el('li', { style: 'margin:4px 0;' }, step));\n      });\n      stepsWrap.appendChild(list);\n      container.appendChild(stepsWrap);\n    }\n\n    const phrases = Array.isArray(task && task.phrases) ? task.phrases : [];\n    if (phrases.length) {\n      container.appendChild(\n        el(\n          'h4',\n          {\n            style:\n              'margin:18px 0 8px;font-size:16px;font-weight:600;color:#0f172a;',\n          },\n          'ÐšÐ¾Ñ€Ð¸ÑÐ½Ñ– Ñ„Ñ€Ð°Ð·Ð¸ Ð´Ð»Ñ Ð´Ñ–Ð°Ð»Ð¾Ð³Ñƒ'\n        )\n      );\n      const list = el('div', {\n        style: 'display:flex;flex-direction:column;gap:8px;',\n      });\n      phrases.forEach((item, index) => {\n        const phraseText =\n          typeof item === 'string'\n            ? item\n            : item && (item.phrase || item.text || item.value || '');\n        const translation =\n          item && typeof item === 'object'\n            ? item.translation || item.note || item.ua || item.uk || ''\n            : '';\n        if (!phraseText) return;\n        const id = uniqueInputId(`phrase-${index}`);\n        list.appendChild(\n          el(\n            'label',\n            {\n              for: id,\n              style:\n                'display:flex;gap:10px;align-items:flex-start;padding:10px 12px;border:1px solid #e5e7eb;border-radius:10px;background:#fff;',\n            },\n            el('input', { id, type: 'checkbox', style: 'margin-top:4px;' }),\n            el(\n              'div',\n              {},\n              el(\n                'span',\n                { style: 'font-weight:600;color:#0f172a;' },\n                phraseText\n              ),\n              translation\n                ? el(\n                    'span',\n                    {\n                      class: 'muted',\n                      style: 'display:block;margin-top:4px;color:#475569;',\n                    },\n                    translation\n                  )\n                : null\n            )\n          )\n        );\n      });\n      container.appendChild(list);\n    }\n  }\n\n  function renderDialogueGap(container, task) {\n    renderTaskTitle(container, task, 'Ð—Ð°Ð¿Ð¾Ð²Ð½Ñ–Ñ‚ÑŒ Ð¿Ñ€Ð¾Ð¿ÑƒÑÐºÐ¸ Ñƒ Ð´Ñ–Ð°Ð»Ð¾Ð·Ñ–');\n\n    const answers = Array.isArray(task?.answers)\n      ? task.answers.map(item => normalize(item))\n      : [];\n    const blanks = [];\n    let activeBlank = null;\n\n    function setActive(blank) {\n      if (activeBlank && activeBlank !== blank) {\n        activeBlank.style.boxShadow = 'none';\n      }\n      if (blank && activeBlank !== blank) {\n        blank.style.boxShadow = '0 0 0 2px rgba(37, 99, 235, 0.35)';\n        activeBlank = blank;\n      } else {\n        if (blank) blank.style.boxShadow = 'none';\n        activeBlank = null;\n      }\n    }\n\n    function clearBlank(blank) {\n      if (!blank) return;\n      blank.dataset.value = '';\n      blank.textContent = '___';\n      blank.style.borderColor = '#cbd5e1';\n      blank.style.background = '#fff';\n      blank.style.boxShadow = 'none';\n    }\n\n    const bank = el('div', {\n      style:\n        'display:flex;flex-wrap:wrap;gap:8px;margin:12px 0;padding:10px;border:1px solid #e2e8f0;border-radius:10px;background:#f8fafc;',\n    });\n    const words = Array.isArray(task?.words) ? task.words : [];\n    const seenWords = new Set();\n    const uniqueWords = [];\n    words.forEach(word => {\n      const value = String(word || '').trim();\n      if (!value) return;\n      const signature = normalize(value);\n      if (seenWords.has(signature)) return;\n      seenWords.add(signature);\n      uniqueWords.push(value);\n    });\n\n    uniqueWords.forEach(value => {\n      const btn = el(\n        'button',\n        {\n          type: 'button',\n          class: 'btn',\n          style:\n            'padding:6px 10px;border:1px solid #94a3b8;border-radius:999px;background:#fff;color:#0f172a;cursor:pointer;font-size:14px;line-height:1;',\n          onclick: () => {\n            const target =\n              activeBlank || blanks.find(blank => !blank.dataset.value);\n            if (!target) return;\n\n            target.dataset.value = value;\n            target.textContent = value;\n            target.style.borderColor = '#2563eb';\n            target.style.background = '#eef2ff';\n            setActive(null);\n          },\n        },\n        value\n      );\n      btn.dataset.word = value;\n      bank.appendChild(btn);\n    });\n    if (bank.children.length) {\n      container.appendChild(bank);\n    }\n\n    const dialogueWrap = el('div', {\n      style: 'display:flex;flex-direction:column;gap:10px;',\n    });\n    const dialogue = Array.isArray(task?.dialogue) ? task.dialogue : [];\n    let blankIndex = 0;\n    dialogue.forEach(turn => {\n      if (!turn) return;\n      const speaker = turn.speaker || turn.role || '';\n      const line = turn.line || turn.text || '';\n      const row = el(\n        'div',\n        {\n          style:\n            'padding:12px;border:1px solid #e5e7eb;border-radius:10px;background:#fff;display:flex;gap:10px;align-items:flex-start;',\n        },\n        speaker\n          ? el('strong', { style: 'min-width:90px;' }, `${speaker}:`)\n          : null\n      );\n      const textWrap = el('div', {\n        style: 'display:flex;flex-wrap:wrap;gap:6px;align-items:center;',\n      });\n      const parts = String(line || '').split(/___/);\n      parts.forEach((part, idx) => {\n        if (part) {\n          textWrap.appendChild(el('span', {}, part));\n        }\n        if (idx < parts.length - 1) {\n          const expected = answers[blankIndex] || '';\n          const blank = el(\n            'button',\n            {\n              type: 'button',\n              style:\n                'min-width:52px;padding:4px 10px;border:1px solid #cbd5e1;border-radius:8px;background:#fff;color:#0f172a;cursor:pointer;',\n              onclick: () => {\n                if (blank.dataset.value) {\n                  clearBlank(blank);\n                  setActive(blank);\n                  return;\n                }\n                if (activeBlank === blank) {\n                  setActive(null);\n                } else {\n                  setActive(blank);\n                }\n              },\n              ondblclick: () => {\n                clearBlank(blank);\n                setActive(null);\n              },\n            },\n            '___'\n          );\n          blank.dataset.expected = expected;\n          blank.dataset.index = String(blankIndex);\n          blanks.push(blank);\n          blankIndex += 1;\n          textWrap.appendChild(blank);\n        }\n      });\n      row.appendChild(textWrap);\n      dialogueWrap.appendChild(row);\n    });\n\n    container.appendChild(dialogueWrap);\n\n    const actions = el('div', {\n      style:\n        'margin-top:14px;display:flex;gap:10px;flex-wrap:wrap;align-items:center;',\n    });\n    const checkBtn = el(\n      'button',\n      { type: 'button', class: 'btn primary' },\n      'ÐŸÐµÑ€ÐµÐ²Ñ–Ñ€Ð¸Ñ‚Ð¸'\n    );\n    const resetBtn = el('button', { type: 'button', class: 'btn' }, 'Ð¡ÐºÐ¸Ð½ÑƒÑ‚Ð¸');\n    const result = el('div', {\n      style: 'font-weight:600;color:#0f172a;',\n    });\n\n    checkBtn.addEventListener('click', () => {\n      let correct = 0;\n      blanks.forEach(blank => {\n        const expected = blank.dataset.expected || '';\n        const value = normalize(blank.dataset.value || blank.textContent || '');\n        const ok = expected ? value === expected : Boolean(value);\n        blank.style.borderColor = ok ? '#10b981' : '#ef4444';\n        blank.style.background = ok ? '#ecfdf5' : '#fee2e2';\n        if (ok) correct += 1;\n      });\n      if (blanks.length) {\n        result.textContent = `Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚: ${correct}/${blanks.length}`;\n      } else {\n        result.textContent = '';\n      }\n    });\n\n    resetBtn.addEventListener('click', () => {\n      blanks.forEach(blank => clearBlank(blank));\n      result.textContent = '';\n      setActive(null);\n    });\n\n    actions.appendChild(checkBtn);\n    actions.appendChild(resetBtn);\n    actions.appendChild(result);\n    container.appendChild(actions);\n  }\n\n  function renderDialogueOrder(container, task) {\n    renderTaskTitle(container, task, 'Ð£Ð¿Ð¾Ñ€ÑÐ´ÐºÑƒÐ¹Ñ‚Ðµ Ð´Ñ–Ð°Ð»Ð¾Ð³');\n\n    const lines = Array.isArray(task?.lines)\n      ? task.lines.map(line => ({\n          speaker: line?.speaker || line?.role || '',\n          text: line?.line || line?.text || '',\n        }))\n      : [];\n    const solution = Array.isArray(task?.solution)\n      ? task.solution.map(value => Number.parseInt(value, 10))\n      : lines.map((_, index) => index);\n\n    const poolWrap = el('div', {\n      style:\n        'display:flex;flex-direction:column;gap:8px;margin-top:10px;padding:10px;border:1px solid #e2e8f0;border-radius:10px;background:#f8fafc;',\n    });\n    const outWrap = el('div', {\n      style:\n        'margin-top:14px;padding:12px;border:1px dashed #cbd5e1;border-radius:10px;min-height:80px;display:flex;flex-direction:column;gap:8px;',\n    });\n    const used = new Set();\n\n    function makeLabel({ speaker, text }) {\n      const content = speaker ? `${speaker}: ${text}` : text;\n      return content.trim();\n    }\n\n    function removeChip(chip) {\n      if (!chip) return;\n      const index = Number.parseInt(chip.dataset.index || '-1', 10);\n      const sourceId = chip.dataset.buttonId;\n      if (sourceId) {\n        const btn = poolWrap.querySelector(`[data-id=\"${sourceId}\"]`);\n        if (btn) {\n          btn.disabled = false;\n          btn.style.opacity = '1';\n        }\n      }\n      used.delete(index);\n      chip.remove();\n    }\n\n    function appendChip(index, label, sourceId) {\n      const chip = el(\n        'div',\n        {\n          class: 'dialogue-chip',\n          style:\n            'padding:10px;border:1px solid #94a3b8;border-radius:10px;background:#fff;display:flex;justify-content:space-between;align-items:center;gap:12px;cursor:pointer;',\n          onclick: event => {\n            event.stopPropagation();\n            removeChip(chip);\n          },\n        },\n        el('span', {}, label),\n        el('span', { style: 'color:#94a3b8;font-size:12px;' }, 'Ã—')\n      );\n      chip.dataset.index = String(index);\n      chip.dataset.buttonId = sourceId;\n      outWrap.appendChild(chip);\n    }\n\n    const shuffledIndices = shuffle(lines.map((_, index) => index));\n    shuffledIndices.forEach(index => {\n      const line = lines[index];\n      const label = makeLabel(line);\n      const buttonId = `line-${index}-${Math.random()\n        .toString(36)\n        .slice(2, 6)}`;\n      const btn = el(\n        'button',\n        {\n          type: 'button',\n          class: 'btn',\n          style:\n            'text-align:left;padding:10px;border:1px solid #cbd5e1;border-radius:10px;background:#fff;color:#0f172a;cursor:pointer;',\n          onclick: () => {\n            if (used.has(index)) return;\n            used.add(index);\n            btn.disabled = true;\n            btn.style.opacity = '0.5';\n            appendChip(index, label, buttonId);\n          },\n          'data-id': buttonId,\n        },\n        label\n      );\n      poolWrap.appendChild(btn);\n    });\n\n    container.appendChild(poolWrap);\n    container.appendChild(outWrap);\n\n    const actions = el('div', {\n      style:\n        'margin-top:14px;display:flex;gap:10px;flex-wrap:wrap;align-items:center;',\n    });\n    const checkBtn = el(\n      'button',\n      { type: 'button', class: 'btn primary' },\n      'ÐŸÐµÑ€ÐµÐ²Ñ–Ñ€Ð¸Ñ‚Ð¸'\n    );\n    const resetBtn = el('button', { type: 'button', class: 'btn' }, 'Ð¡ÐºÐ¸Ð½ÑƒÑ‚Ð¸');\n    const result = el('div', { style: 'font-weight:600;color:#0f172a;' });\n\n    checkBtn.addEventListener('click', () => {\n      const built = Array.from(outWrap.children).map(chip =>\n        Number.parseInt(chip.dataset.index || '-1', 10)\n      );\n      const expected = solution.slice();\n      const ok =\n        built.length === expected.length &&\n        built.every((value, idx) => value === expected[idx]);\n      outWrap.style.borderColor = ok ? '#10b981' : '#ef4444';\n      result.textContent = ok\n        ? 'Ð”Ñ–Ð°Ð»Ð¾Ð³ Ð²Ð¿Ð¾Ñ€ÑÐ´ÐºÐ¾Ð²Ð°Ð½Ð¾ Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð¾!'\n        : `ÐŸÐ¾Ñ‚Ð¾Ñ‡Ð½Ð¸Ð¹ Ð¿Ð¾Ñ€ÑÐ´Ð¾Ðº: ${built.length}/${expected.length} Ñ€ÐµÐ¿Ð»Ñ–Ðº. ÐŸÐµÑ€ÐµÐ²Ñ–Ñ€Ñ‚Ðµ Ð¿Ð¾ÑÐ»Ñ–Ð´Ð¾Ð²Ð½Ñ–ÑÑ‚ÑŒ.`;\n    });\n\n    resetBtn.addEventListener('click', () => {\n      Array.from(outWrap.children).forEach(chip => removeChip(chip));\n      const buttons = poolWrap.querySelectorAll('button');\n      buttons.forEach(btn => {\n        btn.disabled = false;\n        btn.style.opacity = '1';\n      });\n      used.clear();\n      outWrap.style.borderColor = '#cbd5e1';\n      result.textContent = '';\n    });\n\n    actions.appendChild(checkBtn);\n    actions.appendChild(resetBtn);\n    actions.appendChild(result);\n    container.appendChild(actions);\n  }\n\n  function renderTrueFalse(container, task) {\n    renderTaskTitle(container, task, 'ÐžÐ±ÐµÑ€Ð¸ True Ð°Ð±Ð¾ False');\n\n    const rows = [];\n    const items = Array.isArray(task?.items) ? task.items : [];\n    items.forEach((item, index) => {\n      if (!item || !item.statement) return;\n      const row = el(\n        'div',\n        {\n          style:\n            'margin:8px 0;padding:12px;border:1px solid #e5e7eb;border-radius:10px;background:#fff;',\n        },\n        el('p', { style: 'margin:0 0 8px;font-weight:600;' }, item.statement)\n      );\n      const name = `${task.id || 'tf'}-${index}`;\n      const expected = Boolean(item.answer);\n      const trueId = uniqueInputId(`${name}-true`);\n      const trueLabel = el(\n        'label',\n        {\n          for: trueId,\n          style:\n            'display:inline-flex;align-items:center;gap:6px;margin-right:16px;',\n        },\n        el('input', { type: 'radio', name, value: 'true', id: trueId }),\n        'True'\n      );\n      const falseId = uniqueInputId(`${name}-false`);\n      const falseLabel = el(\n        'label',\n        {\n          for: falseId,\n          style: 'display:inline-flex;align-items:center;gap:6px;',\n        },\n        el('input', { type: 'radio', name, value: 'false', id: falseId }),\n        'False'\n      );\n      const options = el('div', { style: 'display:flex;align-items:center;' });\n      options.appendChild(trueLabel);\n      options.appendChild(falseLabel);\n      row.appendChild(options);\n      rows.push({ row, name, expected });\n      container.appendChild(row);\n    });\n\n    if (!rows.length) return;\n\n    const actions = el('div', {\n      style:\n        'margin-top:14px;display:flex;gap:10px;align-items:center;flex-wrap:wrap;',\n    });\n    const btn = el(\n      'button',\n      { type: 'button', class: 'btn primary' },\n      'ÐŸÐµÑ€ÐµÐ²Ñ–Ñ€Ð¸Ñ‚Ð¸'\n    );\n    const result = el('div', { style: 'font-weight:600;color:#0f172a;' });\n    btn.addEventListener('click', () => {\n      let correct = 0;\n      rows.forEach(({ row, name, expected }) => {\n        const picked = row.querySelector(`input[name=\"${name}\"]:checked`);\n        const ok = picked ? picked.value === String(expected) : false;\n        row.style.borderColor = ok ? '#10b981' : '#ef4444';\n        if (ok) correct += 1;\n      });\n      result.textContent = `Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚: ${correct}/${rows.length}`;\n    });\n    actions.appendChild(btn);\n    actions.appendChild(result);\n    container.appendChild(actions);\n  }\n\n  function renderSynonymClue(container, task) {\n    renderTaskTitle(container, task, 'Ð”Ð¾Ð±ÐµÑ€Ñ–Ñ‚ÑŒ ÑÐ»Ð¾Ð²Ð¾ Ð·Ð° Ð¾Ð¿Ð¸ÑÐ¾Ð¼');\n\n    const wordBank = Array.isArray(task?.wordBank) ? task.wordBank : [];\n    if (wordBank.length) {\n      const bank = el('div', {\n        style:\n          'margin:8px 0 12px;padding:10px;border:1px solid #e2e8f0;border-radius:10px;background:#f8fafc;display:flex;flex-wrap:wrap;gap:8px;',\n      });\n      wordBank.forEach(word => {\n        const value = String(word || '').trim();\n        if (!value) return;\n        bank.appendChild(\n          el(\n            'span',\n            {\n              style:\n                'padding:6px 10px;border:1px solid #94a3b8;border-radius:999px;background:#fff;font-size:14px;',\n            },\n            value\n          )\n        );\n      });\n      container.appendChild(bank);\n    }\n\n    const rows = [];\n    const items = Array.isArray(task?.items) ? task.items : [];\n    items.forEach((item, index) => {\n      if (!item || !item.clue) return;\n      const row = el('div', {\n        style:\n          'margin-bottom:10px;padding:12px;border:1px solid #e5e7eb;border-radius:10px;background:#fff;',\n      });\n      row.appendChild(\n        el('p', { style: 'margin:0 0 6px;font-weight:600;' }, item.clue)\n      );\n      const inputId = uniqueInputId(`${task.id || 'synonym'}-${index}`);\n      const input = el('input', {\n        type: 'text',\n        id: inputId,\n        style:\n          'width:100%;max-width:320px;padding:6px 8px;border:1px solid #cbd5e1;border-radius:6px;',\n      });\n      row.appendChild(input);\n      const answers = Array.isArray(item?.answers)\n        ? item.answers.map(answer => normalize(answer))\n        : Array.isArray(item?.answer)\n        ? item.answer.map(answer => normalize(answer))\n        : item?.answer\n        ? [normalize(item.answer)]\n        : [];\n      rows.push({ row, input, answers });\n      container.appendChild(row);\n    });\n\n    if (!rows.length) return;\n\n    const result = el('div', { style: 'font-weight:600;color:#0f172a;' });\n    const btn = el(\n      'button',\n      { type: 'button', class: 'btn primary' },\n      'ÐŸÐµÑ€ÐµÐ²Ñ–Ñ€Ð¸Ñ‚Ð¸'\n    );\n    btn.addEventListener('click', () => {\n      let correct = 0;\n      rows.forEach(({ row, input, answers }) => {\n        const value = normalize(input.value);\n        const ok = answers.length ? answers.includes(value) : Boolean(value);\n        row.style.borderColor = ok ? '#10b981' : '#ef4444';\n        if (ok) correct += 1;\n      });\n      result.textContent = `Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚: ${correct}/${rows.length}`;\n    });\n    container.appendChild(btn);\n    container.appendChild(result);\n  }\n\n  function renderScramble(container, task) {\n    renderTaskTitle(container, task, 'Ð Ð¾Ð·ÑˆÐ¸Ñ„Ñ€ÑƒÐ¹Ñ‚Ðµ ÑÐ»Ð¾Ð²Ð°');\n\n    const rows = [];\n    const items = Array.isArray(task?.items) ? task.items : [];\n    items.forEach((item, index) => {\n      if (!item || !item.scrambled) return;\n      const row = el('div', {\n        style:\n          'margin-bottom:10px;padding:12px;border:1px solid #e5e7eb;border-radius:10px;background:#fff;',\n      });\n      row.appendChild(\n        el(\n          'div',\n          { style: 'margin-bottom:6px;font-weight:600;' },\n          item.scrambled\n        )\n      );\n      const inputId = uniqueInputId(`${task.id || 'scramble'}-${index}`);\n      const input = el('input', {\n        type: 'text',\n        id: inputId,\n        style:\n          'width:100%;max-width:260px;padding:6px 8px;border:1px solid #cbd5e1;border-radius:6px;',\n      });\n      row.appendChild(input);\n      const answers = Array.isArray(item?.answers)\n        ? item.answers.map(value => normalize(value))\n        : Array.isArray(item?.answer)\n        ? item.answer.map(value => normalize(value))\n        : item?.answer\n        ? [normalize(item.answer)]\n        : [];\n      rows.push({ row, input, answers });\n      container.appendChild(row);\n    });\n\n    if (!rows.length) return;\n\n    const btn = el(\n      'button',\n      { type: 'button', class: 'btn primary' },\n      'ÐŸÐµÑ€ÐµÐ²Ñ–Ñ€Ð¸Ñ‚Ð¸'\n    );\n    const result = el('div', {\n      style: 'margin-top:6px;font-weight:600;color:#0f172a;',\n    });\n    btn.addEventListener('click', () => {\n      let correct = 0;\n      rows.forEach(({ row, input, answers }) => {\n        const value = normalize(input.value);\n        const ok = answers.length ? answers.includes(value) : Boolean(value);\n        row.style.borderColor = ok ? '#10b981' : '#ef4444';\n        if (ok) correct += 1;\n      });\n      result.textContent = `Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚: ${correct}/${rows.length}`;\n    });\n    container.appendChild(btn);\n    container.appendChild(result);\n  }\n\n  function renderOddOneOut(container, task) {\n    renderTaskTitle(container, task, 'Ð—Ð½Ð°Ð¹Ð´Ð¸ Ð·Ð°Ð¹Ð²Ðµ ÑÐ»Ð¾Ð²Ð¾');\n\n    const blocks = [];\n    const items = Array.isArray(task?.items) ? task.items : [];\n    items.forEach((item, index) => {\n      const options = Array.isArray(item?.options) ? item.options : [];\n      if (!options.length) return;\n      const row = el('div', {\n        style:\n          'margin-bottom:10px;padding:12px;border:1px solid #e5e7eb;border-radius:10px;background:#fff;',\n      });\n      row.appendChild(\n        el(\n          'div',\n          { style: 'margin-bottom:6px;font-weight:600;' },\n          `ÐÐ°Ð±Ñ–Ñ€ ${index + 1}`\n        )\n      );\n      const groupName = `${task.id || 'odd'}-${index}`;\n      options.forEach((option, optionIndex) => {\n        const id = uniqueInputId(`${groupName}-${optionIndex}`);\n        row.appendChild(\n          el(\n            'label',\n            {\n              for: id,\n              style: 'display:flex;align-items:center;gap:6px;margin:4px 0;',\n            },\n            el('input', {\n              type: 'radio',\n              name: groupName,\n              value: String(optionIndex),\n              id,\n            }),\n            option\n          )\n        );\n      });\n      const explanation = String(item?.explanation || '').trim();\n      if (explanation) {\n        const note = el('div', {\n          class: 'muted',\n          style: 'display:none;margin-top:6px;color:#475569;',\n        });\n        note.textContent = `ÐŸÐ¾ÑÑÐ½ÐµÐ½Ð½Ñ: ${explanation}`;\n        row.appendChild(note);\n      }\n      const answerIndex = normalize(item?.answer || '');\n      blocks.push({ row, groupName, answerIndex });\n      container.appendChild(row);\n    });\n\n    if (!blocks.length) return;\n\n    const btn = el(\n      'button',\n      { type: 'button', class: 'btn primary' },\n      'ÐŸÐµÑ€ÐµÐ²Ñ–Ñ€Ð¸Ñ‚Ð¸'\n    );\n    const result = el('div', {\n      style: 'margin-top:6px;font-weight:600;color:#0f172a;',\n    });\n    btn.addEventListener('click', () => {\n      let correct = 0;\n      blocks.forEach(({ row, groupName, answerIndex }) => {\n        const picked = row.querySelector(`input[name=\"${groupName}\"]:checked`);\n        const value = normalize(picked ? picked.value : '');\n        const ok = answerIndex ? value === answerIndex : Boolean(value);\n        row.style.borderColor = ok ? '#10b981' : '#ef4444';\n        const note = row.querySelector('.muted');\n        if (note) note.style.display = ok ? 'none' : 'block';\n        if (ok) correct += 1;\n      });\n      result.textContent = `Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚: ${correct}/${blocks.length}`;\n    });\n    container.appendChild(btn);\n    container.appendChild(result);\n  }\n\n  function renderWriting(container, task) {\n    renderTaskTitle(container, task, 'Writing/Speaking prompt');\n    if (task.description)\n      container.appendChild(el('p', { class: 'muted' }, task.description));\n    const list = el('div', { style: 'margin-top:8px;' });\n    (task.checklist || []).forEach((ch, index) => {\n      const id = uniqueInputId(`${task.id || 'check'}-${index}`);\n      const row = el(\n        'label',\n        {\n          for: id,\n          style: 'display:flex;align-items:center;gap:8px;margin:6px 0;',\n        },\n        el('input', { id, type: 'checkbox' }),\n        el('span', {}, ch)\n      );\n      list.appendChild(row);\n    });\n    container.appendChild(list);\n    const btn = el(\n      'button',\n      { type: 'button', class: 'btn primary', style: 'margin-top:8px;' },\n      'ÐŸÐ¾Ð·Ð½Ð°Ñ‡Ð¸Ñ‚Ð¸ ÑÐº Ð¿ÐµÑ€ÐµÐ²Ñ–Ñ€ÐµÐ½Ð¾'\n    );\n    const note = el('div', { class: 'muted', style: 'margin-top:6px;' });\n    btn.addEventListener('click', () => {\n      note.textContent =\n        'Ð“Ð¾Ñ‚Ð¾Ð²Ð¾! ÐŸÐµÑ€ÐµÐ²Ñ–Ñ€ ÑÐ¿Ð¸ÑÐ¾Ðº Ñ– Ð·Ð° Ð±Ð°Ð¶Ð°Ð½Ð½ÑÐ¼ Ð²Ñ–Ð´Ð¿Ñ€Ð°Ð² Ð½Ð°ÑÑ‚Ð°Ð²Ð½Ð¸ÐºÑƒ.';\n    });\n    container.appendChild(btn);\n    container.appendChild(note);\n  }\n\n  function renderAudio(container, task) {\n    renderTaskTitle(container, task, 'Audio task');\n\n    const voiceOptionKeys = [\n      'voice',\n      'voiceName',\n      'voiceGender',\n      'gender',\n      'lang',\n      'rate',\n      'pitch',\n      'volume',\n    ];\n    const hasVoiceOptionKeys = value => {\n      if (!value || typeof value !== 'object' || Array.isArray(value))\n        return false;\n      return voiceOptionKeys.some(key =>\n        Object.prototype.hasOwnProperty.call(value, key)\n      );\n    };\n    const toNumberOrNull = value => {\n      if (typeof value === 'number' && Number.isFinite(value)) return value;\n      if (typeof value === 'string' && value.trim() !== '') {\n        const num = Number(value);\n        return Number.isFinite(num) ? num : null;\n      }\n      return null;\n    };\n    const normalizeVoiceProfile = raw => {\n      if (!raw) return null;\n      if (Array.isArray(raw)) {\n        for (const candidate of raw) {\n          const normalized = normalizeVoiceProfile(candidate);\n          if (normalized) return normalized;\n        }\n        return null;\n      }\n      if (typeof raw === 'string') {\n        const trimmed = raw.trim();\n        if (!trimmed) return null;\n        const lowered = trimmed.toLowerCase();\n        if (lowered === 'male' || lowered === 'female') {\n          return {\n            voice: trimmed,\n            gender: lowered,\n            voiceGender: lowered,\n          };\n        }\n        if (/\\s/.test(trimmed)) return { voiceName: trimmed };\n        return { voice: trimmed };\n      }\n      if (typeof raw !== 'object') return null;\n      const profile = {};\n      if (raw.voice) profile.voice = raw.voice;\n      if (raw.voiceName) profile.voiceName = raw.voiceName;\n      if (raw.voiceGender) profile.voiceGender = raw.voiceGender;\n      if (raw.gender) profile.gender = raw.gender;\n      if (raw.lang) profile.lang = raw.lang;\n      const numericKeys = ['rate', 'pitch', 'volume'];\n      numericKeys.forEach(key => {\n        if (raw[key] != null) {\n          const parsed = toNumberOrNull(raw[key]);\n          if (parsed != null) profile[key] = parsed;\n        }\n      });\n      return Object.keys(profile).length ? profile : null;\n    };\n    const normalizeVoiceSequence = source => {\n      if (!Array.isArray(source)) return null;\n      const list = source\n        .map(normalizeVoiceProfile)\n        .filter(Boolean);\n      return list.length ? list : null;\n    };\n    const normalizeVoiceMap = source => {\n      if (!source || typeof source !== 'object' || Array.isArray(source))\n        return null;\n      const entries = Object.entries(source).reduce((acc, [key, value]) => {\n        const profile = normalizeVoiceProfile(value);\n        if (profile) acc[key] = profile;\n        return acc;\n      }, {});\n      return Object.keys(entries).length ? entries : null;\n    };\n    const assignVoiceProfile = (target, profile) => {\n      if (!profile) return;\n      if (profile.voice && !target.voice) target.voice = profile.voice;\n      if (profile.voiceName && !target.voiceName)\n        target.voiceName = profile.voiceName;\n      if (profile.voiceGender && !target.voiceGender)\n        target.voiceGender = profile.voiceGender;\n      if (profile.gender && !target.gender) target.gender = profile.gender;\n      if (profile.lang && !target.lang) target.lang = profile.lang;\n      if (profile.rate != null && target.rate == null)\n        target.rate = profile.rate;\n      if (profile.pitch != null && target.pitch == null)\n        target.pitch = profile.pitch;\n      if (profile.volume != null && target.volume == null)\n        target.volume = profile.volume;\n    };\n    const createDialogVoiceResolver = taskConfig => {\n      const sequence =\n        normalizeVoiceSequence(taskConfig.voices) ||\n        normalizeVoiceSequence(taskConfig.voiceSequence) ||\n        normalizeVoiceSequence(\n          Array.isArray(taskConfig.voice) ? taskConfig.voice : null\n        ) ||\n        [];\n      const mapSourceCandidates = [\n        taskConfig.voiceMap,\n        taskConfig.voiceBySpeaker,\n        taskConfig.dialogVoices,\n      ];\n      let mapSource =\n        mapSourceCandidates.find(\n          candidate =>\n            candidate && typeof candidate === 'object' && !Array.isArray(candidate)\n        ) || null;\n      if (\n        !mapSource &&\n        taskConfig.voice &&\n        typeof taskConfig.voice === 'object' &&\n        !Array.isArray(taskConfig.voice) &&\n        !hasVoiceOptionKeys(taskConfig.voice)\n      ) {\n        mapSource = taskConfig.voice;\n      }\n      const map = normalizeVoiceMap(mapSource);\n      if (!sequence.length && !map) return null;\n      const fallback = map ? map.default || map['*'] || null : null;\n      return (dialog, index = 0) => {\n        const key =\n          dialog.voiceKey ||\n          dialog.speaker ||\n          dialog.role ||\n          dialog.character ||\n          dialog.actor;\n        if (key && map && map[key]) return map[key];\n        if (sequence.length) return sequence[index % sequence.length];\n        if (fallback) return fallback;\n        return null;\n      };\n    };\n    const dialogVoiceResolver = createDialogVoiceResolver(task);\n\n    let voiceWarningEl = null;\n    let lastVoiceSummary = null;\n    const applyVoiceWarning = summary => {\n      if (summary) lastVoiceSummary = summary;\n      if (!voiceWarningEl) return;\n      const payload = summary || lastVoiceSummary;\n      if (!payload || !payload.stats) {\n        voiceWarningEl.style.display = 'none';\n        return;\n      }\n      const { stats } = payload;\n      if (stats.male && stats.female) {\n        voiceWarningEl.style.display = 'none';\n        voiceWarningEl.textContent = '';\n        return;\n      }\n      let message = '';\n      if (!stats.male && !stats.female) {\n        message =\n          'âš ï¸ Ð‘Ñ€Ð°ÑƒÐ·ÐµÑ€ Ð½Ðµ Ð½Ð°Ð´Ð°Ð² Ð¶Ð¾Ð´Ð½Ð¾Ð³Ð¾ Ð³Ð¾Ð»Ð¾ÑÑƒ Ð´Ð»Ñ ÑÐ¸Ð½Ñ‚ÐµÐ·Ñƒ Ð¼Ð¾Ð²Ð»ÐµÐ½Ð½Ñ. Ð‘ÑƒÐ´Ðµ Ð²Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð°Ð½Ð¾ ÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð½Ð¸Ð¹ Ð³Ð¾Ð»Ð¾Ñ.';\n      } else if (!stats.male) {\n        message =\n          'âš ï¸ Ð£ Ð±Ñ€Ð°ÑƒÐ·ÐµÑ€Ñ– Ð½Ðµ Ð·Ð½Ð°Ð¹Ð´ÐµÐ½Ð¾ Ñ‡Ð¾Ð»Ð¾Ð²Ñ–Ñ‡Ð¸Ñ… Ð³Ð¾Ð»Ð¾ÑÑ–Ð². Ð’ÑÑ– Ñ€ÐµÐ¿Ð»Ñ–ÐºÐ¸ Ð±ÑƒÐ´ÑƒÑ‚ÑŒ Ð²Ñ–Ð´Ñ‚Ð²Ð¾Ñ€ÐµÐ½Ñ– Ð· Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð¸Ð¼Ð¸ Ð³Ð¾Ð»Ð¾ÑÐ°Ð¼Ð¸.';\n      } else if (!stats.female) {\n        message =\n          'âš ï¸ Ð£ Ð±Ñ€Ð°ÑƒÐ·ÐµÑ€Ñ– Ð½Ðµ Ð·Ð½Ð°Ð¹Ð´ÐµÐ½Ð¾ Ð¶Ñ–Ð½Ð¾Ñ‡Ð¸Ñ… Ð³Ð¾Ð»Ð¾ÑÑ–Ð². Ð’ÑÑ– Ñ€ÐµÐ¿Ð»Ñ–ÐºÐ¸ Ð±ÑƒÐ´ÑƒÑ‚ÑŒ Ð²Ñ–Ð´Ñ‚Ð²Ð¾Ñ€ÐµÐ½Ñ– Ð· Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð¸Ð¼Ð¸ Ð³Ð¾Ð»Ð¾ÑÐ°Ð¼Ð¸.';\n      } else if (stats.total < 2) {\n        message =\n          'âš ï¸ Ð”Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð¸Ð¹ Ð»Ð¸ÑˆÐµ Ð¾Ð´Ð¸Ð½ Ð³Ð¾Ð»Ð¾Ñ ÑÐ¸Ð½Ñ‚ÐµÐ·Ñƒ, Ñ‚Ð¾Ð¼Ñƒ Ð´Ñ–Ð°Ð»Ð¾Ð³ Ð·Ð²ÑƒÑ‡Ð°Ñ‚Ð¸Ð¼Ðµ Ð¾Ð´Ð½Ð°ÐºÐ¾Ð²Ð¾.';\n      }\n      if (message) {\n        voiceWarningEl.textContent = message;\n        voiceWarningEl.style.display = 'block';\n      } else {\n        voiceWarningEl.style.display = 'none';\n      }\n    };\n\n    const createVoiceSummary = voices => {\n      const buckets = {\n        male: [],\n        female: [],\n        neutral: [],\n      };\n      voices.forEach(voice => {\n        const detected = estimateVoiceGender(voice);\n        if (detected === 'male') buckets.male.push(voice);\n        else if (detected === 'female') buckets.female.push(voice);\n        else buckets.neutral.push(voice);\n      });\n      const used = new Set();\n      const pickFrom = list => {\n        if (!list.length) return null;\n        const candidate = list.find(v => !used.has(v.name)) || list[0];\n        if (candidate) used.add(candidate.name);\n        return candidate;\n      };\n      const pick = gender => {\n        if (gender === 'male') {\n          return pickFrom(buckets.male) || pickFrom(buckets.neutral);\n        }\n        if (gender === 'female') {\n          return pickFrom(buckets.female) || pickFrom(buckets.neutral);\n        }\n        return (\n          pickFrom(buckets.neutral) ||\n          pickFrom(buckets.male) ||\n          pickFrom(buckets.female)\n        );\n      };\n      return {\n        pick,\n        stats: {\n          male: buckets.male.length,\n          female: buckets.female.length,\n          neutral: buckets.neutral.length,\n          total: voices.length,\n        },\n      };\n    };\n\n    const assignVoicesFromSummary = summary => {\n      if (!summary || typeof summary.pick !== 'function') return;\n      dialogs.forEach(dialog => {\n        if (!dialog || dialog.voiceName) return;\n        const rawVoice = String(dialog.voice || '').trim().toLowerCase();\n        const genderPreference =\n          dialog.gender ||\n          dialog.voiceGender ||\n          (rawVoice === 'male' || rawVoice === 'female' ? rawVoice : null);\n        if (!genderPreference) return;\n        const selected = summary.pick(genderPreference);\n        if (selected) {\n          dialog.voiceName = selected.name;\n          if (!dialog.lang && selected.lang) dialog.lang = selected.lang;\n        }\n      });\n    };\n\n    let voiceSummaryPromise = null;\n    const ensureVoiceSummary = () => {\n      if (!synth) return Promise.resolve(null);\n      if (!voiceSummaryPromise) {\n        voiceSummaryPromise = (async () => {\n          try {\n            const voices = await listAvailableVoices();\n            if (!voices || !voices.length) {\n              applyVoiceWarning({\n                stats: { male: 0, female: 0, neutral: 0, total: 0 },\n              });\n              return null;\n            }\n            const summary = createVoiceSummary(voices);\n            assignVoicesFromSummary(summary);\n            applyVoiceWarning(summary);\n            return summary;\n          } catch {\n            return null;\n          }\n        })();\n      }\n      return voiceSummaryPromise;\n    };\n\n    const audioCandidates = [];\n    const collectAudio = value => {\n      if (!value) return;\n      if (Array.isArray(value)) {\n        value.forEach(collectAudio);\n        return;\n      }\n      const src = String(value).trim();\n      if (src) audioCandidates.push(src);\n    };\n\n    collectAudio(task.audioSrc);\n    collectAudio(task.audioUrl);\n    collectAudio(task.audio);\n    collectAudio(task.source);\n    collectAudio(task.sources);\n\n    const audioSources = Array.from(new Set(audioCandidates));\n    if (audioSources.length) {\n      const audioWrap = el('div', {\n        style:\n          'margin-top:8px;padding:12px;border:1px solid #cbd5e1;border-radius:10px;background:#f1f5f9;',\n      });\n      const player = el('audio', {\n        controls: true,\n        style: 'width:100%;display:block;',\n      });\n      audioSources.forEach(src => {\n        player.appendChild(el('source', { src: resolveAssetPath(src) }));\n      });\n      player.appendChild(\n        document.createTextNode('Ð’Ð°Ñˆ Ð±Ñ€Ð°ÑƒÐ·ÐµÑ€ Ð½Ðµ Ð¿Ñ–Ð´Ñ‚Ñ€Ð¸Ð¼ÑƒÑ” Ð²Ñ–Ð´Ñ‚Ð²Ð¾Ñ€ÐµÐ½Ð½Ñ Ð°ÑƒÐ´Ñ–Ð¾.')\n      );\n      audioWrap.appendChild(player);\n      container.appendChild(audioWrap);\n    }\n\n    const rawDialogs = Array.isArray(task.dialogs) ? task.dialogs : [];\n    const dialogs = [];\n    rawDialogs.forEach(entry => {\n      if (!entry) return;\n      if (typeof entry === 'string') {\n        const text = entry.trim();\n        if (text) {\n          const normalized = { text };\n          if (dialogVoiceResolver) {\n            const resolved = dialogVoiceResolver(\n              normalized,\n              dialogs.length\n            );\n            assignVoiceProfile(normalized, resolved);\n          }\n          dialogs.push(normalized);\n        }\n        return;\n      }\n      if (typeof entry === 'object') {\n        const text = 'text' in entry ? String(entry.text || '').trim() : '';\n        if (!text) return;\n        const normalized = { text };\n        if (entry.voice) normalized.voice = entry.voice;\n        if (entry.voiceName) normalized.voiceName = entry.voiceName;\n        if (entry.gender) normalized.gender = entry.gender;\n        if (entry.lang) normalized.lang = entry.lang;\n        if (entry.rate != null) normalized.rate = entry.rate;\n        if (entry.pitch != null) normalized.pitch = entry.pitch;\n        if (entry.volume != null) normalized.volume = entry.volume;\n        if (entry.speaker) normalized.speaker = entry.speaker;\n        if (entry.role) normalized.role = entry.role;\n        if (entry.character) normalized.character = entry.character;\n        if (entry.actor) normalized.actor = entry.actor;\n        if (entry.voiceKey) normalized.voiceKey = entry.voiceKey;\n        if (entry.ttsOptions && typeof entry.ttsOptions === 'object') {\n          normalized.ttsOptions = { ...entry.ttsOptions };\n        }\n        if (dialogVoiceResolver) {\n          const resolved = dialogVoiceResolver(normalized, dialogs.length);\n          assignVoiceProfile(normalized, resolved);\n        }\n        dialogs.push(normalized);\n      }\n    });\n\n    if (!dialogs.length) {\n      if (Array.isArray(task.text)) {\n        task.text\n          .map(segment => String(segment || '').trim())\n          .filter(Boolean)\n          .forEach(text => {\n            const normalized = { text };\n            if (dialogVoiceResolver) {\n              const resolved = dialogVoiceResolver(\n                normalized,\n                dialogs.length\n              );\n              assignVoiceProfile(normalized, resolved);\n            }\n            dialogs.push(normalized);\n          });\n      } else if (typeof task.text === 'string') {\n        const text = String(task.text || '').trim();\n        if (text) {\n          const normalized = { text };\n          if (dialogVoiceResolver) {\n            const resolved = dialogVoiceResolver(\n              normalized,\n              dialogs.length\n            );\n            assignVoiceProfile(normalized, resolved);\n          }\n          dialogs.push(normalized);\n        }\n      }\n    }\n\n    const synth =\n      typeof window !== 'undefined' && 'speechSynthesis' in window\n        ? window.speechSynthesis\n        : null;\n    const ttsOptions = {};\n    if (task.lang) ttsOptions.lang = task.lang;\n    if (task.voiceName) ttsOptions.voiceName = task.voiceName;\n    if (typeof task.voice === 'string') {\n      ttsOptions.voice = task.voice;\n    } else if (\n      task.voice &&\n      typeof task.voice === 'object' &&\n      !Array.isArray(task.voice) &&\n      hasVoiceOptionKeys(task.voice)\n    ) {\n      assignVoiceProfile(ttsOptions, normalizeVoiceProfile(task.voice));\n    }\n    if (task.gender) ttsOptions.gender = task.gender;\n    if (task.voiceGender && !ttsOptions.voiceGender)\n      ttsOptions.voiceGender = task.voiceGender;\n    if (typeof task.ttsOptions === 'object' && task.ttsOptions)\n      Object.assign(ttsOptions, task.ttsOptions);\n    if (typeof task.voiceOptions === 'object' && task.voiceOptions)\n      Object.assign(ttsOptions, task.voiceOptions);\n    if (typeof task.speechOptions === 'object' && task.speechOptions)\n      Object.assign(ttsOptions, task.speechOptions);\n\n    if (dialogs.length && synth) {\n      const ttsWrap = el('div', {\n        style:\n          'margin-top:8px;display:flex;align-items:center;gap:10px;flex-wrap:wrap;',\n      });\n      const playBtn = el(\n        'button',\n        {\n          type: 'button',\n          class: 'btn primary',\n          style:\n            'padding:8px 14px;border-radius:8px;border:1px solid #0284c7;background:#0ea5e9;color:#fff;cursor:pointer;display:inline-flex;align-items:center;gap:6px;',\n        },\n        'â–¶ Play'\n      );\n      playBtn.setAttribute('aria-pressed', 'false');\n      const transcriptToggleBtn = el(\n        'button',\n        {\n          type: 'button',\n          class: 'btn secondary',\n          style:\n            'padding:8px 14px;border-radius:8px;border:1px solid #cbd5e1;background:#fff;color:#0f172a;cursor:pointer;display:inline-flex;align-items:center;gap:6px;',\n        },\n        'ðŸ‘ ÐŸÐ¾ÐºÐ°Ð·Ð°Ñ‚Ð¸ Ñ‚ÐµÐºÑÑ‚'\n      );\n      transcriptToggleBtn.setAttribute('aria-expanded', 'false');\n      const clampRate = (value, min, max) =>\n        Math.min(max, Math.max(min, value));\n      const rateInputId = uniqueInputId('speech-rate');\n      const minRate = 0.5;\n      const maxRate = 1.5;\n      const parseRate = value => {\n        const num = Number(value);\n        return Number.isFinite(num) ? num : 1;\n      };\n      const initialRate = clampRate(\n        parseRate(ttsOptions.rate != null ? ttsOptions.rate : 1),\n        minRate,\n        maxRate\n      );\n      let rateValue = initialRate;\n      let rateDirty = false;\n      let isSpeaking = false;\n      let currentIndex = 0;\n      let currentUtterance = null;\n      let transcriptVisible = false;\n      const transcriptBox = el('div', {\n        class: 'audio-transcript',\n        style:\n          'display:none;margin-top:12px;padding:12px;border:1px solid #cbd5e1;border-radius:10px;background:#fff;color:#0f172a;',\n      });\n      dialogs.forEach((dialog, idx) => {\n        const speakerLabel =\n          dialog.speaker || dialog.role || dialog.character || dialog.actor;\n        const transcriptLine = speakerLabel\n          ? `${speakerLabel}: ${dialog.text}`\n          : dialog.text;\n        const paragraph = el(\n          'p',\n          {\n            style: idx === 0 ? 'margin:0 0 6px 0;' : 'margin:6px 0 0 0;',\n          },\n          transcriptLine\n        );\n        transcriptBox.appendChild(paragraph);\n      });\n      const rateValueLabel = el(\n        'span',\n        {\n          style:\n            'font-weight:600;min-width:42px;text-align:right;color:#0f172a;',\n        },\n        `${rateValue.toFixed(1)}x`\n      );\n      const rateSlider = el('input', {\n        type: 'range',\n        id: rateInputId,\n        min: String(minRate),\n        max: String(maxRate),\n        step: '0.1',\n        value: String(rateValue),\n        style: 'flex:1;',\n      });\n      rateSlider.addEventListener('input', () => {\n        rateValue = clampRate(\n          parseRate(rateSlider.value),\n          minRate,\n          maxRate\n        );\n        rateDirty = true;\n        rateValueLabel.textContent = `${rateValue.toFixed(1)}x`;\n      });\n      const rateControl = el(\n        'div',\n        {\n          style:\n            'display:flex;align-items:center;gap:8px;padding:6px 10px;border:1px solid #e2e8f0;border-radius:8px;background:#fff;min-width:240px;',\n        },\n        el(\n          'label',\n          {\n            for: rateInputId,\n            style: 'font-size:14px;color:#475569;',\n          },\n          'Ð¨Ð²Ð¸Ð´ÐºÑ–ÑÑ‚ÑŒ'\n        ),\n        rateSlider,\n        rateValueLabel\n      );\n\n      const updateTranscriptState = () => {\n        transcriptBox.style.display = transcriptVisible ? 'block' : 'none';\n        transcriptToggleBtn.textContent = transcriptVisible\n          ? 'ðŸ™ˆ Ð¡Ñ…Ð¾Ð²Ð°Ñ‚Ð¸ Ñ‚ÐµÐºÑÑ‚'\n          : 'ðŸ‘ ÐŸÐ¾ÐºÐ°Ð·Ð°Ñ‚Ð¸ Ñ‚ÐµÐºÑÑ‚';\n        transcriptToggleBtn.setAttribute(\n          'aria-expanded',\n          transcriptVisible ? 'true' : 'false'\n        );\n      };\n\n      const resetState = () => {\n        isSpeaking = false;\n        currentIndex = 0;\n        if (currentUtterance) {\n          currentUtterance.onend = null;\n          currentUtterance.onerror = null;\n          currentUtterance = null;\n        }\n        playBtn.textContent = 'â–¶ Play';\n        playBtn.setAttribute('aria-pressed', 'false');\n      };\n\n      const playNext = async () => {\n        if (!isSpeaking || currentIndex >= dialogs.length) {\n          resetState();\n          return;\n        }\n        await ensureVoiceSummary();\n        const dialog = dialogs[currentIndex];\n        const options = { ...ttsOptions };\n        if (dialog.lang) options.lang = dialog.lang;\n        if (dialog.voiceName) options.voiceName = dialog.voiceName;\n        if (dialog.voice) options.voice = dialog.voice;\n        if (dialog.gender) options.gender = dialog.gender;\n        if (dialog.rate != null) options.rate = dialog.rate;\n        if (dialog.pitch != null) options.pitch = dialog.pitch;\n        if (dialog.volume != null) options.volume = dialog.volume;\n        if (\n          dialog.ttsOptions &&\n          typeof dialog.ttsOptions === 'object' &&\n          dialog.ttsOptions\n        ) {\n          Object.assign(options, dialog.ttsOptions);\n        }\n        if (rateDirty || options.rate == null) {\n          options.rate = clampRate(rateValue, minRate, maxRate);\n        }\n        try {\n          const utterance = await speakText(dialog.text, options);\n          if (!utterance) {\n            currentIndex += 1;\n            playNext();\n            return;\n          }\n          currentUtterance = utterance;\n          utterance.onend = () => {\n            if (!isSpeaking) return;\n            currentUtterance = null;\n            currentIndex += 1;\n            playNext();\n          };\n          utterance.onerror = resetState;\n        } catch (error) {\n          resetState();\n        }\n      };\n\n      playBtn.addEventListener('click', async () => {\n        if (!isSpeaking) {\n          if (!dialogs.length) return;\n          await ensureVoiceSummary();\n          isSpeaking = true;\n          currentIndex = 0;\n          playBtn.textContent = 'â¹ Stop';\n          playBtn.setAttribute('aria-pressed', 'true');\n          playNext();\n        } else {\n          if (synth) synth.cancel();\n          resetState();\n        }\n      });\n      transcriptToggleBtn.addEventListener('click', () => {\n        transcriptVisible = !transcriptVisible;\n        updateTranscriptState();\n      });\n      updateTranscriptState();\n\n      ttsWrap.appendChild(playBtn);\n      ttsWrap.appendChild(transcriptToggleBtn);\n      ttsWrap.appendChild(rateControl);\n      if (!audioSources.length) {\n        ttsWrap.appendChild(\n          el(\n            'span',\n            { class: 'muted', style: 'font-size:14px;' },\n            'ÐŸÑ€Ð¾ÑÐ»ÑƒÑ…Ð°Ð¹Ñ‚Ðµ Ð´Ñ–Ð°Ð»Ð¾Ð³ Ð·Ð° Ð´Ð¾Ð¿Ð¾Ð¼Ð¾Ð³Ð¾ÑŽ ÑÐ¸Ð½Ñ‚ÐµÐ·Ñƒ Ð¼Ð¾Ð²Ð»ÐµÐ½Ð½Ñ.'\n          )\n        );\n      }\n      container.appendChild(ttsWrap);\n      container.appendChild(transcriptBox);\n      voiceWarningEl = el('div', {\n        class: 'muted',\n        style:\n          'display:none;margin-top:6px;font-size:13px;color:#b45309;line-height:1.4;',\n      });\n      applyVoiceWarning(lastVoiceSummary);\n      container.appendChild(voiceWarningEl);\n      ensureVoiceSummary();\n    } else if (!audioSources.length && dialogs.length) {\n      container.appendChild(\n        el(\n          'p',\n          { class: 'muted', style: 'margin-top:8px;' },\n          'Ð’Ð°Ñˆ Ð±Ñ€Ð°ÑƒÐ·ÐµÑ€ Ð½Ðµ Ð¿Ñ–Ð´Ñ‚Ñ€Ð¸Ð¼ÑƒÑ” ÑÐ¸Ð½Ñ‚ÐµÐ· Ð¼Ð¾Ð²Ð»ÐµÐ½Ð½Ñ.'\n        )\n      );\n    }\n\n    const rawQuestions = Array.isArray(task.questions)\n      ? task.questions.filter(Boolean)\n      : [];\n    if (!rawQuestions.length) return;\n\n    const questionsWrap = el('div', { style: 'margin-top:16px;' });\n    const checkableEntries = [];\n\n    rawQuestions.forEach((entry, index) => {\n      const question =\n        typeof entry === 'string'\n          ? { prompt: entry }\n          : entry && typeof entry === 'object'\n          ? entry\n          : { prompt: String(entry) };\n      const promptText =\n        question.prompt || question.q || `Question ${index + 1}`;\n\n      const block = el(\n        'div',\n        {\n          style:\n            'margin-bottom:12px;padding:12px;border:1px solid #e5e7eb;border-radius:10px;background:#fff;',\n        },\n        el('div', { style: 'font-weight:600;margin-bottom:8px;' }, promptText)\n      );\n\n      if (question.hint) {\n        block.appendChild(makeHint(question.hint));\n      }\n\n      if (Array.isArray(question.choices) && question.choices.length) {\n        const expectedRaw = Array.isArray(question.answer)\n          ? question.answer\n          : question.answer != null\n          ? [question.answer]\n          : [];\n        const expected = expectedRaw.map(value => String(value));\n        const allowMulti = expected.length > 1;\n        const expectedIsIndex = expected.every(value => /^\\d+$/.test(value));\n        const name = uniqueInputId(`${task.id || 'audio'}-${index}`);\n        question.choices.forEach((choice, choiceIndex) => {\n          const id = uniqueInputId(`${name}-${choiceIndex}`);\n          block.appendChild(\n            el(\n              'label',\n              {\n                for: id,\n                style: 'display:flex;align-items:center;gap:8px;margin:4px 0;',\n              },\n              el('input', {\n                type: allowMulti ? 'checkbox' : 'radio',\n                name,\n                id,\n                value: String(choiceIndex),\n              }),\n              el('span', {}, choice)\n            )\n          );\n        });\n        if (expected.length) {\n          checkableEntries.push({\n            type: 'choices',\n            block,\n            getPicked: () => {\n              const inputs = Array.from(\n                block.querySelectorAll(`input[name='${name}']`)\n              );\n              const picked = inputs\n                .filter(input => input.checked)\n                .map(input => input.value);\n              if (expectedIsIndex) return picked;\n              return picked.map(idx =>\n                normalize(question.choices[Number(idx)] || '')\n              );\n            },\n            expected: expectedIsIndex\n              ? expected.slice()\n              : expected.map(value => normalize(value)),\n          });\n        }\n      } else {\n        const input = el('textarea', {\n          rows: question.rows || 2,\n          style:\n            'width:100%;max-width:640px;padding:6px 8px;border:1px solid #cbd5e1;border-radius:6px;',\n        });\n        block.appendChild(input);\n        const expectedRaw = Array.isArray(question.answer)\n          ? question.answer\n          : question.answer != null\n          ? [question.answer]\n          : Array.isArray(question.answers)\n          ? question.answers\n          : [];\n        const expected = expectedRaw\n          .map(value => normalize(value))\n          .filter(Boolean);\n        if (expected.length) {\n          checkableEntries.push({\n            type: 'text',\n            block,\n            input,\n            expected,\n          });\n        }\n      }\n\n      questionsWrap.appendChild(block);\n    });\n\n    if (checkableEntries.length) {\n      const result = el('div', {\n        style: 'margin-top:8px;font-weight:600;',\n      });\n      const button = el(\n        'button',\n        {\n          type: 'button',\n          class: 'btn primary',\n          style: 'margin-top:8px;',\n        },\n        'ÐŸÐµÑ€ÐµÐ²Ñ–Ñ€Ð¸Ñ‚Ð¸'\n      );\n      button.addEventListener('click', () => {\n        let correct = 0;\n        checkableEntries.forEach(entry => {\n          if (entry.type === 'choices') {\n            const picked = entry.getPicked().sort();\n            const expected = entry.expected.slice().sort();\n            const ok =\n              picked.length === expected.length &&\n              picked.every((value, idx) => value === expected[idx]);\n            entry.block.style.borderColor = ok ? '#10b981' : '#ef4444';\n            if (ok) correct++;\n          } else if (entry.type === 'text') {\n            const value = normalize(entry.input.value);\n            const ok = entry.expected.includes(value);\n            entry.block.style.borderColor = ok ? '#10b981' : '#ef4444';\n            if (ok) correct++;\n          }\n        });\n        result.textContent = `Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚: ${correct}/${checkableEntries.length}`;\n      });\n      questionsWrap.appendChild(button);\n      questionsWrap.appendChild(result);\n    } else {\n      questionsWrap.appendChild(\n        el(\n          'p',\n          { class: 'muted', style: 'margin-top:4px;' },\n          'Ð—Ð°Ð¿Ð¸ÑˆÑ–Ñ‚ÑŒ Ð²Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´Ñ– â€” Ð²Ð¸ÐºÐ»Ð°Ð´Ð°Ñ‡ Ð¿ÐµÑ€ÐµÐ²Ñ–Ñ€Ð¸Ñ‚ÑŒ Ñ—Ñ… Ð¿Ñ–Ð·Ð½Ñ–ÑˆÐµ.'\n        )\n      );\n    }\n\n    container.appendChild(questionsWrap);\n  }\n\n  function ensurePracticeContainer() {\n    let root = document.getElementById('practice');\n    if (!root && /\\/grammar\\//.test(location.pathname)) {\n      const wrap = el('div', { class: 'container' });\n      wrap.appendChild(el('hr', { class: 'sep' }));\n      root = el('section', { id: 'practice' });\n      wrap.appendChild(root);\n      document.body.appendChild(wrap);\n    }\n    return root;\n  }\n  function createCheckbox() {\n    const elem = el('input', {\n      type: 'checkbox',\n      class: 'check-task-status',\n    });\n    return elem;\n  }\n\n  function renderTaskTitle(container, task, prompt) {\n    container.appendChild(\n      el('h3', {}, createCheckbox(), task.prompt || prompt)\n    );\n  }\n\n  function init() {\n    const root = ensurePracticeContainer();\n    if (!root) return;\n    // Ensure stable inner container so external toolbars are not wiped\n    let body = root.querySelector('#practice-body');\n    if (!body) {\n      body = el('div', { id: 'practice-body' });\n      root.appendChild(body);\n    }\n    const context = window.lessonContext || {};\n    if (context.isCustomLesson) {\n      const placeholder = root.querySelector('[data-practice-placeholder]');\n      if (placeholder) {\n        placeholder.textContent =\n          'ÐŸÑ€Ð°ÐºÑ‚Ð¸ÐºÐ° Ð´Ð»Ñ ÐºÐ¾Ð¶Ð½Ð¾Ñ— Ñ‚ÐµÐ¼Ð¸ Ñ€Ð¾Ð·Ð¼Ñ–Ñ‰ÐµÐ½Ð° Ð¾Ð´Ñ€Ð°Ð·Ñƒ Ð¿Ñ–ÑÐ»Ñ Ñ‚ÐµÐ¾Ñ€Ñ–Ñ—. Ð¢ÑƒÑ‚ Ð¼Ð¾Ð¶ÐµÑ‚Ðµ Ð·Ð³ÐµÐ½ÐµÑ€ÑƒÐ²Ð°Ñ‚Ð¸ Ð´Ð¾Ð´Ð°Ñ‚ÐºÐ¾Ð²Ñ– Ð·Ð°Ð²Ð´Ð°Ð½Ð½Ñ.';\n      }\n      if (body) {\n        body.innerHTML =\n          '<p class=\"muted\">Ð—Ð³ÐµÐ½ÐµÑ€ÑƒÐ¹Ñ‚Ðµ Ð´Ð¾Ð´Ð°Ñ‚ÐºÐ¾Ð²Ñ– Ð²Ð¿Ñ€Ð°Ð²Ð¸ Ð°Ð±Ð¾ Ð´Ð¾Ð´Ð°Ð¹Ñ‚Ðµ Ð²Ð»Ð°ÑÐ½Ñ– Ð·Ð°Ð²Ð´Ð°Ð½Ð½Ñ.</p>';\n      }\n      document.dispatchEvent(\n        new CustomEvent('practice:dataLoaded', { detail: null })\n      );\n      document.dispatchEvent(\n        new CustomEvent('practice:rendered', {\n          detail: { ok: false, reason: 'custom-lesson' },\n        })\n      );\n      return;\n    }\n\n    loadData().then(data => {\n      if (!data) {\n        document.dispatchEvent(\n          new CustomEvent('practice:dataLoaded', { detail: null })\n        );\n        body.innerHTML = '<p class=\"muted\">ÐŸÑ€Ð°ÐºÑ‚Ð¸ÐºÐ° Ð¿Ð¾ÐºÐ¸ Ð²Ñ–Ð´ÑÑƒÑ‚Ð½Ñ.</p>';\n        document.dispatchEvent(\n          new CustomEvent('practice:rendered', { detail: { ok: false } })\n        );\n        return;\n      }\n      body.innerHTML = '';\n      const header = el(\n        'div',\n        {},\n        el(\n          'h2',\n          {},\n          'Practice ',\n          el('span', { class: 'badge' }, data.level || 'B1')\n        ),\n        data.title ? el('p', { class: 'muted' }, data.title) : null\n      );\n      body.appendChild(header);\n\n      const entries = (data.tasks || []).map((task, index) => ({\n        key: task && task.id ? String(task.id) : `base-${index}`,\n        task,\n      }));\n\n      document.dispatchEvent(\n        new CustomEvent('practice:dataLoaded', {\n          detail: {\n            title: data.title,\n            level: data.level,\n            entries,\n          },\n        })\n      );\n\n      entries.forEach(({ task, key }) => renderTask(body, task, key));\n      document.dispatchEvent(\n        new CustomEvent('practice:rendered', { detail: { ok: true } })\n      );\n    });\n  }\n\n  const globalPracticeConfig =\n    (typeof window !== 'undefined' && window.practiceConfig) || {};\n  if (!globalPracticeConfig.disableAutoInit) {\n    document.addEventListener('DOMContentLoaded', init);\n  }\n\n  window.practice = window.practice || {};\n  Object.assign(window.practice, {\n    appendTask,\n    renderTaskList,\n    createTaskElement,\n  });\n\n  return {\n    appendTask,\n    renderTaskList,\n    createTaskElement,\n  };\n})();\n\nexport const createPracticeTaskElement = practiceAPI.createTaskElement;\nexport const appendPracticeTask = practiceAPI.appendTask;\nexport const renderPracticeTaskList = practiceAPI.renderTaskList;\n\ndocument.addEventListener('click', e => {\n  const div = e.target.closest('.text-block');\n  if (div) {\n    const html = div.innerHTML;\n    navigator.clipboard.writeText(`<div class=\"text-block\">${html}</div>`);\n    console.log('Ð¡ÐºÐ¾Ð¿Ñ–Ð¹Ð¾Ð²Ð°Ð½Ð¾');\n  }\n});\n"],"names":["getUsers","page","limit","axios","cache","getUserHomework","data","key","previousData","res","addHomework","homework","newRadioAnswer","userCache","answer","items","el","itemIndex","updateHomework","newAnswer","addAnswer","keys","taskId","getUserHomeworkLessons","userEmail","params","shareState","defaultFetchStudents","error","defaultFormatStudentName","student","possibleFirst","possibleLast","part","closeActiveSharePanel","panel","button","shareControls","canShare","applyShareVisibility","control","registerShareControl","setShareAvailability","isAllowed","next","handleOutsideShareClick","event","target","handleShareKeydown","tag","attrs","children","node","value","child","defaultOptions","resolveShareOptions","options","resolved","renderStudentOptions","students","list","getContext","context","result","item","createSharePanelElement","toggleSharePanel","createShareTrigger","createShareControl","resolvedOptions","unregister","isSharePanelActive","hasSpeechSynthesis","voicesReadyPromise","getVoicesReady","resolve","voices","handle","nextVoices","normalizeLower","FEMALE_VOICE_HINTS","MALE_VOICE_HINTS","matchVoiceHints","name","uri","hints","hint","estimateVoiceGender","voice","pickVoice","lang","voiceName","voiceGender","gender","normalizedLang","preferredName","genderHint","chosen","v","voiceMatchesGender","candidate","detected","voicesForLang","lowered","speakText","text","rate","pitch","volume","utter","availableVoices","createPlayBtn","playBtn","listAvailableVoices","practiceAPI","basePath","__vite_import_meta_env__","resolveAssetPath","path","normalizedBase","rawPath","derivePracticePath","parts","file","json","k","ch","shuffle","arr","a","i","j","normalize","s","inputIdCounter","uniqueInputId","prefix","auth","user","makeHint","hintText","wrap","btn","box","isHidden","renderMCQ","container","task","renderTaskTitle","blocks","idx","allowMulti","block","choice","cIdx","id","lbl","correct","answers","picked","expected","ok","exp","renderGap","it","row","inputId","input","val","renderMatch","pairs","rights","p","rows","index","selectId","select","r","right","renderContext","format","body","textWrap","turn","speaker","line","paragraph","questions","question","prompt","expectedIsIndex","promptId","entry","explanation","renderTask","taskKey","showRemove","keyBase","controls","shareBtn","sharePanel","unregisterShareControl","lessonId","heading","lessonName","removeBtn","rawType","renderTransform","renderError","renderOrder","renderShort","renderRoleplay","renderDialogueGap","renderDialogueOrder","renderTrueFalse","matchTask","renderSynonymClue","renderScramble","pairsTask","renderOddOneOut","renderOpen","renderWriting","renderAudio","appendTask","meta","root","ensurePracticeContainer","allowRemove","renderTaskList","tasks","entries","title","level","description","keyPrefix","showEmptyNote","note","wrapper","header","createTaskElement","fragment","fetchPracticeCandidate","resolvedPath","loadData","inline","candidates","normalized","segments","last","fallbackPath","correctStr","pool","poolWrap","outWrap","used","makeBtn","word","b","w","actions","reset","n","sum","total","keywords","matched","info","situation","examples","chips","criteria","scoringBox","criterion","scenario","infoBox","infoAdded","roles","rolesWrap","role","roleBox","details","detail","steps","stepsWrap","step","phrases","phraseText","translation","blanks","activeBlank","setActive","blank","clearBlank","bank","words","seenWords","uniqueWords","signature","dialogueWrap","dialogue","blankIndex","checkBtn","resetBtn","lines","solution","_","makeLabel","removeChip","chip","sourceId","appendChip","label","buttonId","built","trueId","trueLabel","falseId","falseLabel","wordBank","groupName","option","optionIndex","answerIndex","voiceOptionKeys","hasVoiceOptionKeys","toNumberOrNull","num","normalizeVoiceProfile","raw","trimmed","profile","parsed","normalizeVoiceSequence","source","normalizeVoiceMap","acc","assignVoiceProfile","dialogVoiceResolver","taskConfig","sequence","mapSource","map","fallback","dialog","voiceWarningEl","lastVoiceSummary","applyVoiceWarning","summary","payload","stats","message","createVoiceSummary","buckets","pickFrom","assignVoicesFromSummary","dialogs","rawVoice","genderPreference","selected","voiceSummaryPromise","ensureVoiceSummary","synth","audioCandidates","collectAudio","src","audioSources","audioWrap","player","rawDialogs","segment","ttsOptions","ttsWrap","transcriptToggleBtn","clampRate","min","max","rateInputId","minRate","maxRate","parseRate","rateValue","rateDirty","isSpeaking","currentIndex","currentUtterance","transcriptVisible","transcriptBox","speakerLabel","transcriptLine","rateValueLabel","rateSlider","rateControl","updateTranscriptState","resetState","playNext","utterance","rawQuestions","questionsWrap","checkableEntries","promptText","choiceIndex","createCheckbox","init","placeholder","createPracticeTaskElement","renderPracticeTaskList","e","div","html"],"mappings":"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"}