import{s as F,l as g,b as K,a as z}from"./custom-lessons-store-BKMVZjuV.js";import{c as U}from"./custom-lesson-presets-BlE7b2P4.js";import{a as Q}from"./vendor-CWxt7QI6.js";const W=Q.create({baseURL:"http://localhost:3003"}),X=async({name:e,givenName:t,familyName:n,email:a,picture:r})=>{const o={name:e,givenName:t,familyName:n,email:a,picture:r};return(await W.post("/user",o)).data},i={headerActions:{createBtn:document.querySelector(".js-create-lesson-btn"),homework:document.querySelector(".js-homework-btn")}},S="english-teacher.google-user",N="english-teacher.google-auth-state";document.querySelector("[data-auth-root]");const k=document.querySelector("[data-auth-signin]"),E=document.querySelector("[data-auth-profile]"),h=document.querySelector("[data-user-name]"),y=document.querySelector("[data-user-email]"),c=document.querySelector("[data-user-avatar]"),d=document.querySelector("[data-auth-signout]");let l=null,w=!1;const b=new Set;function Z(e){try{if(!e||typeof e!="string")return null;const t=e.split(".");if(!t[1])return null;const n=t[1].replace(/-/g,"+").replace(/_/g,"/"),a=n.padEnd(n.length+(4-n.length%4)%4,"="),r=atob(a).split("").map(o=>`%${`00${o.charCodeAt(0).toString(16)}`.slice(-2)}`).join("");return JSON.parse(decodeURIComponent(r))}catch(t){return console.warn("[auth] Unable to decode Google credential payload",t),null}}function T(e){return{name:e.name||"",givenName:e.givenName||"",familyName:e.familyName||"",email:e.email||"",picture:e.picture||"",credential:e.credential||"",expiresAt:e.expiresAt??null}}function ee(){try{const e=window.localStorage.getItem(S);return e?JSON.parse(e):null}catch(e){return console.warn("[auth] Unable to access localStorage",e),null}}function j(e,t){const n=JSON.stringify(t);window.localStorage.getItem(e)!==n&&window.localStorage.setItem(e,n)}function te(e){try{const t=T(e);j(S,t)}catch(t){console.warn("[auth] Unable to persist user in localStorage",t)}}function R(){try{window.localStorage.removeItem(S)}catch(e){console.warn("[auth] Unable to remove user from localStorage",e)}}function O(e){try{j(N,e)}catch(t){console.warn("[auth] Unable to persist auth state",t)}}function ne(e){if(!e||typeof e!="object")return!1;const t=!!e.email||!!e.name||!!e.givenName,n=typeof e.credential=="string"&&e.credential.length>0;return t&&n}function _(e){return e?{...e}:null}function re(e,t){if(e===t)return!0;if(!e||!t)return!1;const n=Object.keys(e),a=Object.keys(t);return n.length!==a.length?!1:n.every(r=>e[r]===t[r])}function x(){return{isSignedIn:!!l,user:_(l)}}function ae(e){const t=x();b.forEach(n=>{try{n(t,e)}catch(a){console.warn("[auth] Subscriber error",a)}})}function G(e,t){const n=_(e);re(l,n)||(l=n,ae(t))}function M(e){E&&(E.hidden=!e),k&&(k.hidden=e),d&&(d.hidden=!e)}function D(e,t={}){const{persist:n=!0,reason:a="signed-in"}=t,r=T(e);if(M(!0),h&&(h.textContent=r.name||r.givenName||""),y&&(y.textContent=r.email||""),c)if(r.picture){c.src=r.picture,c.hidden=!1;const o=r.name||r.givenName||"Користувач Google";c.alt=`${o} — аватар профілю`}else c.removeAttribute("src"),c.hidden=!0,c.alt="Google profile avatar";G(r,a),n&&O({status:"signed-in",user:r,updatedAt:Date.now()})}function P(e={}){const{persist:t=!0,reason:n="signed-out"}=e;M(!1),h&&(h.textContent=""),y&&(y.textContent=""),c&&(c.removeAttribute("src"),c.hidden=!0,c.alt="Google profile avatar"),G(null,n),t&&O({status:"signed-out",updatedAt:Date.now()})}function oe(e){const t=e==null?void 0:e.credential,n=Z(t);if(!n)return;const a={name:n.name||n.given_name||"",givenName:n.given_name||"",familyName:n.family_name||"",email:n.email||"",picture:n.picture||"",credential:t,expiresAt:n.exp?n.exp*1e3:null};X(a),te(a),D(a)}function J(e="signed-out"){var t,n,a;R(),P({reason:e});try{(a=(n=(t=window.google)==null?void 0:t.accounts)==null?void 0:n.id)==null||a.disableAutoSelect()}catch(r){console.warn("[auth] Unable to disable Google auto-select",r)}}function $(e={}){const{persist:t=!1}=e,n=ee(),a=ne(n)?n:null,r=a!=null&&a.expiresAt?a.expiresAt<=Date.now():!1;a&&!r?D(a,{persist:t,reason:"synced"}):((r||n)&&R(),P({persist:t,reason:"synced"}))}function se(e){e.storageArea===window.localStorage&&(e.key===S||e.key===N||e.key===null)&&$({persist:!1})}function ce(){w||(w=!0,window.handleGoogleCredential=oe,d&&!d.dataset.authInitialised&&(d.addEventListener("click",()=>J()),d.dataset.authInitialised="true"),$({persist:!1}),window.addEventListener("storage",se))}function le(e){return typeof e!="function"?()=>{}:(b.add(e),e(x(),l?"signed-in":"signed-out"),()=>{b.delete(e)})}function ie(){$({persist:!1})}const I={init:ce,isInitialised:()=>w,isSignedIn:()=>!!l,getUser:()=>_(l),getCredential:()=>(l==null?void 0:l.credential)??null,signOut:()=>J(),subscribe:le,refresh:ie,getSnapshot:x,isAdmin:e=>{const t=e||l;return["volodkaposhta@gmail.com","nreznik451@gmail.com"].includes(t==null?void 0:t.email)}};I.subscribe(({isSignedIn:e,user:t})=>{if(!e){i.headerActions.createBtn.hidden=!0,i.headerActions.homework.hidden=!0;return}I.isAdmin(t)?(i.headerActions.createBtn.hidden=!1,i.headerActions.homework.hidden=!0):(i.headerActions.createBtn.hidden=!0,i.headerActions.homework.hidden=!1)});const s={search:"",category:"all",level:"all"},q=document.querySelector('[data-filter="search"]'),B=document.querySelector('[data-filter="level"]'),Y=Array.from(document.querySelectorAll("[data-category]")),p=document.querySelector("[data-lessons-section]"),v=document.querySelector("[data-lessons-grid]"),A=document.querySelector("[data-lessons-empty]"),u={total:document.querySelector("[data-stat-total]"),grammar:document.querySelector("[data-stat-grammar]"),lexical:document.querySelector("[data-stat-lexical]")};I.init();function L(e){return e.trim().toLowerCase()}function C(e){return String(e??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function H(){Y.forEach(e=>{const t=e.dataset.category===s.category,a=e.dataset.category==="all"?s.category==="all":t;e.classList.toggle("chip--filled",a),e.setAttribute("aria-pressed",String(a))})}function ue(e){var r;const t=((r=K[e.category])==null?void 0:r.label)??e.category,n=`lesson.html?topic=${encodeURIComponent(e.id)}&category=${encodeURIComponent(e.category)}&level=${encodeURIComponent(e.level)}&title=${encodeURIComponent(e.title)}&file=${encodeURIComponent(e.htmlPath)}`,a=Array.isArray(e.tags)?e.tags:[];return`
    <article class="lesson-card" data-lesson-id="${e.id}" data-category="${e.category}" data-level="${e.level}">
      <a class="lesson-card__link" href="${n}">
        <div class="lesson-card__meta">
          <span class="lesson-card__category">${t}</span>
          <span class="lesson-card__level" aria-label="Рівень">${e.level}</span>
        </div>
        <h3 class="lesson-card__title">${e.title}</h3>
        <p class="lesson-card__description">${e.description}</p>
        ${a.length?`<ul class="lesson-card__tags">${a.map(o=>`<li>${o}</li>`).join("")}</ul>`:""}
        <span class="lesson-card__cta">Перейти до матеріалу</span>
      </a>
    </article>
  `}function V(e){const t=(e.topicIds||[]).map(o=>g.find(f=>f.id===o)).filter(Boolean),n=Array.from(new Set(t.map(o=>o.level))).sort(),a=t.filter(o=>o.category==="grammar").length,r=t.filter(o=>o.category==="lexical").length;return{topics:t,levels:n,grammarCount:a,lexicalCount:r}}function de(e,t=V(e)){const n=e.description||t.topics.map(o=>o.title).slice(0,3).join(", "),a=e.level||(t.levels.length?t.levels.join(", "):"мікси рівнів"),r=[];return a&&r.push(`Рівні: ${C(a)}`),t.grammarCount&&r.push(`Граматика: ${t.grammarCount}`),t.lexicalCount&&r.push(`Лексика: ${t.lexicalCount}`),`
    <article class="lesson-card lesson-card--custom" data-custom-lesson-id="${e.id}" data-custom-source="${e.source||"local"}">
      <a class="lesson-card__link" href="lesson.html?custom=${encodeURIComponent(e.id)}">
        
       <h3 class="lesson-card__title">${C(e.title)}</h3>
        ${r.length?`<p class="lesson-card__meta">${r.join(" · ")}</p>`:""}
        <p class="lesson-card__description">${C(n||"Урок містить кілька тем.")}</p>
        
        <span class="lesson-card__cta">Відкрити комбінований урок</span>
      </a>
    </article>
  `}function fe(){return Array.isArray(U)?U.filter(e=>e&&typeof e=="object"&&e.id).map((e,t)=>({...e,topicIds:Array.isArray(e.topicIds)?[...e.topicIds]:[],source:"preset",sortIndex:t})):[]}function ge(){return z().filter(e=>e&&typeof e=="object"&&e.id).map((e,t)=>({...e,topicIds:Array.isArray(e.topicIds)?[...e.topicIds]:[],source:"local",sortIndex:1e3+t}))}function me(){const e=new Map;return fe().forEach(t=>{e.has(t.id)||e.set(t.id,t)}),ge().forEach(t=>{e.set(t.id,t)}),Array.from(e.values())}function pe(){const e=r=>{const o=r?new Date(r).getTime():0;return Number.isFinite(o)?o:0},n=me().slice().sort((r,o)=>{const f=e(o.createdAt)-e(r.createdAt);return f!==0?f:(r.sortIndex||0)-(o.sortIndex||0)}).map(r=>{const o=V(r);return{type:"custom",lesson:r,meta:o}}),a=g.map(r=>({type:"catalog",lesson:r}));return[...n,...a]}function he(e){return s.category==="all"?!0:e.type==="catalog"?e.lesson.category===s.category:!1}function ye(e){var a;if(s.level==="all")return!0;if(e.type==="catalog")return e.lesson.level===s.level;const t=e.lesson.level;return t?t===s.level:(((a=e.meta)==null?void 0:a.levels)??[]).includes(s.level)}function Se(e,t){const a=((t==null?void 0:t.topics)??[]).flatMap(r=>[r.title,r.description,...r.tags||[]].filter(Boolean));return[e.title,e.description,...e.tags||[],e.level,...a].filter(Boolean).map(r=>L(String(r)))}function ve(e,t){return t?e.type==="catalog"?[e.lesson.title,e.lesson.description,...e.lesson.tags??[]].filter(Boolean).map(r=>L(String(r))).some(r=>r.includes(t)):Se(e.lesson,e.meta).some(a=>a.includes(t)):!0}function Ae(){const e=pe(),t=L(s.search);return e.filter(n=>!he(n)||!ye(n)?!1:ve(n,t))}function m(){if(!v||!A)return;const e=Ae();if(!e.length){v.innerHTML="",A.hidden=!1,p&&(p.dataset.hasResults="false");return}const t=e.map(n=>n.type==="custom"?de(n.lesson,n.meta):ue(n.lesson)).join("");v.innerHTML=t,A.hidden=!0,p&&(p.dataset.hasResults="true")}function Ce(){u.total&&(u.total.textContent=String(g.length)),u.grammar&&(u.grammar.textContent=String(g.filter(e=>e.category==="grammar").length)),u.lexical&&(u.lexical.textContent=String(g.filter(e=>e.category==="lexical").length))}function we(e){s.search=e.target.value,m()}function be(e){s.level=e.target.value,m()}function Ie(e){const t=e.currentTarget.dataset.category;t&&(s.category=t,H(),m())}function _e(){const e=document.querySelector('[data-component="copyright-year"]');e&&(e.textContent=String(new Date().getFullYear()))}function xe(){Ce(),H(),m(),_e(),q&&q.addEventListener("input",we),B&&B.addEventListener("change",be),Y.forEach(e=>{e.addEventListener("click",Ie)}),F(()=>{m()})}xe();
//# sourceMappingURL=main-DJMe9782.js.map
