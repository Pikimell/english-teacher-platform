import{i as ue,a as Oe}from"./auth-CUcfS-ao.js";const rt=async(a=1,f=1e3)=>(await ue.get("/user")).data,ve={},Lt=async a=>{const f=JSON.stringify(a),C=ve[f];if(C)return C;const e=await ue.post("/homework/list",a);return ve[f]=e.data,e.data},ot=async a=>(await ue.post("/homework",a)).data;function it(a,f){const e=a.items.find(z=>z._id===f.taskId).answers,k=e.findIndex(z=>z.name==f.name);k>=0?e[k]=f:e.push(f);const E={taskId:f.taskId,answers:e};return Ee(E)}function st(a,f){if(f.type==="radio")return it(a,f);const e=a.items.find(z=>z._id===f.taskId).answers,k=e.findIndex(z=>z.inputId==f.inputId),E={taskId:f.taskId,answers:e};return k>=0?e[k]=f:e.push(f),Ee(E)}const kt=async a=>{const f=Object.keys(ve);let C=ve[f[0]];if(C)st(C,a);else{const e={taskId:a.taskId,answers:[a]};return Ee(e)}},Ee=async({taskId:a,...f})=>(await ue.patch(`/homework/${a}`,f)).data,Nt=async a=>{const f={page:1,limit:100,userEmail:a},C=await ue.post("/homework/lessons",f),{data:e}=C;return e.items=e.items.reverse(),e.items},D={users:null,request:null,active:null};function at(){return D.users?Promise.resolve(D.users):(D.request||(D.request=rt().then(a=>{const f=Array.isArray(a==null?void 0:a.items)?a.items:[];return D.users=f,f}).catch(a=>{throw console.error("–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Å–ø–∏—Å–æ–∫ —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤",a),a}).finally(()=>{D.request=null})),D.request)}function lt(a){if(!a||typeof a!="object")return"–ù–µ–≤—ñ–¥–æ–º–∏–π —Å—Ç—É–¥–µ–Ω—Ç";const f=a.firstName||a.firstname||a.nameFirst||"",C=a.lastName||a.lastname||a.nameLast||"";return[f,C].map(E=>String(E||"").trim()).filter(Boolean).join(" ")||a.displayName||a.fullName||a.username||a.email||(a.id?`ID ${a.id}`:"")||"–ë–µ–∑ —ñ–º–µ–Ω—ñ"}function ne(){if(!D.active)return;const{panel:a,button:f}=D.active;a.style.display="none",a.dataset.open="false",f.setAttribute("aria-expanded","false"),D.active=null}const Ce=new Set;let be=!1;function je(a){const{button:f,panel:C}=a;if(!(!f||!C)){if(!f.isConnected&&!C.isConnected){Ce.delete(a);return}if(be){f.hidden=!1;return}f.hidden=!0,C.style.display="none",C.dataset.open="false"}}function ct(a,f){const C={button:a,panel:f};return Ce.add(C),je(C),()=>{Ce.delete(C)}}function dt(a){const f=!!a;be!==f&&(be=f,be||ne(),Ce.forEach(C=>je(C)))}function pt(a){if(!D.active)return;const{panel:f,button:C}=D.active,e=a.target;f.contains(e)||C.contains(e)||ne()}function ut(a){a.key==="Escape"&&ne()}document.addEventListener("click",pt);document.addEventListener("keydown",ut);function te(a,f={},...C){const e=document.createElement(a);for(const[k,E]of Object.entries(f||{}))k==="class"?e.className=E:k==="html"?e.innerHTML=E:k.startsWith("on")&&typeof E=="function"?e.addEventListener(k.slice(2),E):e.setAttribute(k,E);for(const k of C)k!=null&&e.appendChild(typeof k=="string"?document.createTextNode(k):k);return e}const de={triggerLabel:"–ù–∞–¥—ñ—Å–ª–∞—Ç–∏",triggerClassName:"practice-share-trigger for-admin js-share-homework-btn",triggerStyle:"border:none;background:#2563eb;color:#fff;padding:4px 10px;border-radius:999px;font-size:12px;line-height:1;cursor:pointer;box-shadow:0 4px 12px rgba(37,99,235,0.24);",panelClassName:"practice-share-panel",panelStyle:"position:absolute;top:38px;right:0;min-width:240px;max-width:280px;border:1px solid #e2e8f0;border-radius:12px;background:#fff;box-shadow:0 18px 40px rgba(15,23,42,0.18);padding:8px;z-index:30;display:none;",emptyMessage:"–°–ø–∏—Å–æ–∫ —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤ –ø–æ—Ä–æ–∂–Ω—ñ–π",loadingMessage:"–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è‚Ä¶",errorMessage:"–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤. –°–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑.",formatStudentName:lt,fetchStudents:at,getContext:null,onShare:()=>{},renderDetails:a=>a!=null&&a.email?te("span",{class:"muted",style:"font-size:12px;color:#475569;"},a.email):null};function ft(a={}){const f={...de,...a};return f.fetchStudents=typeof a.fetchStudents=="function"?a.fetchStudents:de.fetchStudents,f.formatStudentName=typeof a.formatStudentName=="function"?a.formatStudentName:de.formatStudentName,f.renderDetails=typeof a.renderDetails=="function"?a.renderDetails:de.renderDetails,f.onShare=typeof a.onShare=="function"?a.onShare:de.onShare,f.getContext=typeof a.getContext=="function"?a.getContext:()=>a.context,f}function ht(a,f,C){if(a.innerHTML="",!f.length){a.appendChild(te("div",{class:"muted",style:"font-size:13px;text-align:center;padding:12px 8px;"},C.emptyMessage));return}const e=te("ul",{style:"list-style:none;margin:0;padding:0;max-height:220px;overflow:auto;"}),k=typeof C.getContext=="function"?C.getContext:de.getContext;f.forEach(E=>{const z=te("button",{type:"button",style:"width:100%;background:transparent;border:none;text-align:left;padding:8px 10px;border-radius:8px;cursor:pointer;display:flex;flex-direction:column;gap:2px;",onmouseenter:()=>{z.style.backgroundColor="#f1f5f9"},onmouseleave:()=>{z.style.backgroundColor="transparent"},onclick:()=>{const W=typeof k=="function"?k(E):void 0;try{const R=C.onShare({student:E,context:W});if(R&&typeof R.then=="function"){z.disabled=!0,Promise.resolve(R).then(J=>{J!==!1&&ne()}).catch(J=>{console.error("–ü–æ–º–∏–ª–∫–∞ –ø—ñ–¥ —á–∞—Å –Ω–∞–¥—Å–∏–ª–∞–Ω–Ω—è –∑–∞–≤–¥–∞–Ω–Ω—è",J),ne()}).finally(()=>{z.disabled=!1});return}R!==!1&&ne()}catch(R){console.error("–ü–æ–º–∏–ª–∫–∞ –ø—ñ–¥ —á–∞—Å –Ω–∞–¥—Å–∏–ª–∞–Ω–Ω—è –∑–∞–≤–¥–∞–Ω–Ω—è",R),ne()}}},te("span",{style:"font-size:14px;font-weight:600;color:#0f172a;"},C.formatStudentName(E)),C.renderDetails?C.renderDetails(E):null),_=te("li",{style:"margin:0;padding:0;"},z);e.appendChild(_)}),a.appendChild(e)}function gt(a){return te("div",{class:a.panelClassName,role:"dialog","aria-label":"–ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –∑–∞–≤–¥–∞–Ω–Ω—è —Å—Ç—É–¥–µ–Ω—Ç—É",style:a.panelStyle,"data-open":"false"})}function xt(a,f,C){if(f.dataset.open==="true"){ne();return}D.active&&D.active.panel!==f&&ne(),f.dataset.open="true",f.style.display="block",a.setAttribute("aria-expanded","true"),f.innerHTML="",f.appendChild(te("div",{class:"muted",style:"font-size:13px;padding:12px 8px;text-align:center;"},C.loadingMessage)),D.active={panel:f,button:a},Promise.resolve(C.fetchStudents()).then(k=>{ht(f,Array.isArray(k)?k:[],C)}).catch(()=>{f.innerHTML="",f.appendChild(te("div",{style:"color:#ef4444;font-size:13px;text-align:center;padding:12px 8px;"},C.errorMessage))})}function mt(a,f){const C=te("button",{type:"button",class:f.triggerClassName,title:"–ù–∞–¥—ñ—Å–ª–∞—Ç–∏ —Å—Ç—É–¥–µ–Ω—Ç—É","aria-haspopup":"dialog","aria-expanded":"false",style:f.triggerStyle,onclick:e=>{e.preventDefault(),xt(C,a,f)}},f.triggerLabel);return C}function yt(a={}){const f=ft(a),C=gt(f),e=mt(C,f),k=ct(e,C);return{button:e,panel:C,unregister:k}}function bt(a){return!!(D.active&&D.active.panel===a)}const $e=()=>typeof window<"u"&&"speechSynthesis"in window;let ye=null;function Be(){return $e()?ye||(ye=new Promise(a=>{const f=window.speechSynthesis.getVoices();if(f.length){a(f);return}const C=()=>{const e=window.speechSynthesis.getVoices();e.length&&(window.speechSynthesis.onvoiceschanged=null,a(e))};window.speechSynthesis.onvoiceschanged=C}),ye):Promise.resolve([])}function K(a){return String(a||"").trim().toLowerCase()}const vt=["female","woman","girl","samantha","victoria","karen","moira","serena","allison","ava","amelie","amelia","emma","olivia","isabella","mia","sophia","sofia","fiona","pauline","paula","linda","viola","nora","clara","lucy","tessa","zoe"],Ct=["male","man","boy","alex","daniel","fred","bruce","oliver","arthur","henry","james","john","luke","mark","michael","paul","peter","thomas","victor","william","liam","noah","sam","george","carlos","diego","roberto","sergio","mateo"],Ie=(a,f,C)=>C.some(e=>a.includes(e)||f.includes(e)),Pe=a=>{if(!a)return null;const f=K(a.name),C=K(a.voiceURI);return Ie(f,C,vt)?"female":Ie(f,C,Ct)?"male":null};function wt(a,f={}){if(!Array.isArray(a)||!a.length)return null;const{lang:C="en",voiceName:e,voice:k,voiceGender:E,gender:z}=f,_=K(C)||"en",W=e||(k&&/\s/.test(String(k))?String(k):null),J=K(z||E||!W&&k||null);let G=W&&a.find(q=>q.name===W)||W&&a.find(q=>K(q.name)===K(W))||null;const fe=q=>{if(!J)return!1;const oe=Pe(q);if(oe)return oe===J;const he=K(q.name),ge=K(q.voiceURI);return he.includes(J)||ge.includes(J)},re=a.filter(q=>K(q.lang).startsWith(_));if(!G&&J&&(G=re.find(fe)||a.find(fe)||null),!G&&W&&K(W)){const q=K(W);G=re.find(oe=>K(oe.name).includes(q))||a.find(oe=>K(oe.name).includes(q))||null}return G||(G=re.find(q=>K(q.name).includes("female"))||re[0]||a.find(q=>K(q.name).includes("female"))||a[0]||null),G||null}async function _e(a,{lang:f="en",voiceName:C,voice:e,voiceGender:k,gender:E,rate:z=1,pitch:_=1,volume:W=1}={}){if(!$e())return null;await Be();const R=new SpeechSynthesisUtterance(a),J=window.speechSynthesis.getVoices(),G=wt(J,{lang:f,voiceName:C,voice:e,voiceGender:k,gender:E});return G?(R.voice=G,R.lang=G.lang||f||"en"):R.lang=f||"en",R.rate=z,R.pitch=_,R.volume=W,window.speechSynthesis.cancel(),window.speechSynthesis.speak(R),R}function Ot(a){const f=document.createElement("span");return f.textContent="üîä",f.addEventListener("click",()=>{_e(a)}),f.classList.add("play-speak-btn"),f}async function St(){if(!$e())return[];await Be();const a=window.speechSynthesis.getVoices();return Array.isArray(a)?a.slice():[]}const At={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1},Te=function(){const a=typeof import.meta<"u"&&At&&"/"||"/";function f(r){const t=a.endsWith("/")?a:`${a}/`,c=String(r||"");return/^[a-z]+:/i.test(c)||c.startsWith(t)?c:`${t}${c.replace(/^\/+/,"")}`}function C(){try{const t=new URL(window.location.href).pathname.split("/");let c=t.pop();(!c||!/\.html?$/i.test(c))&&(c="index.html");const g=c.replace(/\.html?$/i,".json");return t.push("practice",g),t.join("/")}catch{return null}}function e(r,t={},...c){const g=document.createElement(r);for(const[h,s]of Object.entries(t||{}))h==="class"?g.className=s:h==="html"?g.innerHTML=s:h.startsWith("on")&&typeof s=="function"?g.addEventListener(h.slice(2),s):g.setAttribute(h,s);for(const h of c)h!=null&&g.appendChild(typeof h=="string"?document.createTextNode(h):h);return g}function k(r){const t=r.slice();for(let c=t.length-1;c>0;c--){const g=Math.floor(Math.random()*(c+1));[t[c],t[g]]=[t[g],t[c]]}return t}function E(r){return String(r||"").trim().toLowerCase().replace(/\s+/g," ")}let z=0;function _(r="practice-input"){return z+=1,`${String(r||"practice-input").trim().replace(/[^a-z0-9_-]+/gi,"-").replace(/^-+|-+$/g,"")||"practice-input"}-${z}`}Oe.subscribe(({user:r})=>{dt(Oe.isAdmin(r))});function W(r){const t=e("div",{class:"hint-wrap",style:"margin-top:6px;"}),c=e("button",{type:"button",class:"hint-toggle","aria-label":"–ü–æ–∫–∞–∑–∞—Ç–∏ –ø—ñ–¥–∫–∞–∑–∫—É",title:"–ü—ñ–¥–∫–∞–∑–∫–∞",style:"border:none;background:transparent;color:#94a3b8;cursor:pointer;padding:0;font-size:14px;line-height:1;"},"?"),g=e("div",{class:"hint-box muted",style:"display:none;margin-top:6px;color:#475569;"},`–ü—ñ–¥–∫–∞–∑–∫–∞: ${r}`);return c.addEventListener("click",()=>{const h=g.style.display==="none";g.style.display=h?"block":"none",c.setAttribute("aria-expanded",h?"true":"false")}),t.appendChild(c),t.appendChild(g),t}function R(r,t){M(r,t,"Choose the correct option");const c=[];(t.items||[]).forEach((s,o)=>{const i=`${t.id||"mcq"}-${o}`,x=Array.isArray(s.answer)&&s.answer.length>1,l=e("div",{class:"mcq-item",style:"margin-bottom:10px;padding:10px;border:1px solid #e5e7eb;border-radius:10px;background:#fff;"},e("div",{class:"q",style:"margin-bottom:8px;font-weight:600;"},s.q));(s.choices||[]).forEach((d,u)=>{const y=_(`${i}-${u}`),w=e("label",{for:y,style:"display:flex;align-items:center;gap:8px;margin:4px 0;"},e("input",{type:x?"checkbox":"radio",name:i,id:y,value:String(u)}),e("span",{},d));l.appendChild(w)}),s.explanation&&l.appendChild(e("div",{class:"exp muted",style:"display:none;margin-top:6px;color:#475569;"},s.explanation)),c.push({block:l,item:s,name:i}),r.appendChild(l)});const g=e("div",{class:"result",style:"margin-top:8px;font-weight:600;"}),h=e("button",{type:"button",class:"btn primary",style:"margin-top:8px;"},"–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏");h.addEventListener("click",()=>{let s=0;c.forEach(({block:o,item:i,name:x})=>{const l=Array.isArray(i.answer)?i.answer.map(String):[String(i.answer)],u=Array.from(o.querySelectorAll(`input[name='${x}']`)).filter(b=>b.checked).map(b=>b.value).sort(),y=l.slice().sort(),w=u.length===y.length&&u.every((b,A)=>b===y[A]);o.style.borderColor=w?"#10b981":"#ef4444";const L=o.querySelector(".exp");L&&(L.style.display=w?"none":"block"),w&&s++}),g.textContent=`–†–µ–∑—É–ª—å—Ç–∞—Ç: ${s}/${c.length}`}),r.appendChild(h),r.appendChild(g)}function J(r,t){M(r,t,"Fill the gaps");const c=[];(t.items||[]).forEach((s,o)=>{const i=e("div",{style:"margin-bottom:10px;padding:10px;border:1px solid #e5e7eb;border-radius:10px;background:#fff;"}),x=String(s.q||"").split(/___/),l=_(`${t.id||"gap"}-${o}`),d=e("input",{type:"text",id:l,style:"padding:6px 8px;border:1px solid #cbd5e1;border-radius:6px;"});x.length>1?(i.appendChild(e("span",{},x[0])),i.appendChild(d),i.appendChild(e("span",{},x.slice(1).join("___")))):(i.appendChild(e("div",{style:"margin-bottom:6px;font-weight:600;"},s.q)),i.appendChild(d)),s.hint&&i.appendChild(W(s.hint)),c.push({row:i,input:d,answers:(s.answer||[]).map(u=>E(u))}),r.appendChild(i)});const g=e("div",{style:"margin-top:8px;font-weight:600;"}),h=e("button",{type:"button",class:"btn primary",style:"margin-top:8px;"},"–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏");h.addEventListener("click",()=>{let s=0;c.forEach(({row:o,input:i,answers:x})=>{const l=E(i.value),d=x.includes(l);o.style.borderColor=d?"#10b981":"#ef4444",d&&s++}),g.textContent=`–†–µ–∑—É–ª—å—Ç–∞—Ç: ${s}/${c.length}`}),r.appendChild(h),r.appendChild(g)}function G(r,t){M(r,t,"Match pairs");const c=t.pairs||[],g=k(c.map(i=>i.right)),h=[];c.forEach((i,x)=>{const l=_(`${t.id||"match"}-${x}`),d=e("select",{id:l,style:"padding:6px 8px;border:1px solid #cbd5e1;border-radius:6px;"},e("option",{value:""},"‚Äî –æ–±–µ—Ä–∏ ‚Äî"),...g.map(y=>e("option",{value:y},y))),u=e("div",{style:"display:flex;align-items:center;gap:10px;margin:8px 0;padding:10px;border:1px solid #e5e7eb;border-radius:10px;background:#fff;"},e("label",{for:l,style:"min-width:160px;font-weight:600;"},i.left),d);h.push({row:u,select:d,right:i.right}),r.appendChild(u)});const s=e("div",{style:"margin-top:8px;font-weight:600;"}),o=e("button",{type:"button",class:"btn primary",style:"margin-top:8px;"},"–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏");o.addEventListener("click",()=>{let i=0;h.forEach(({row:x,select:l,right:d})=>{const u=l.value===d;x.style.borderColor=u?"#10b981":"#ef4444",u&&i++}),s.textContent=`–†–µ–∑—É–ª—å—Ç–∞—Ç: ${i}/${h.length}`}),r.appendChild(o),r.appendChild(s)}function fe(r,t){M(r,t,"–ü—Ä–æ—á–∏—Ç–∞–π—Ç–µ —Ç–µ–∫—Å—Ç —Ç–∞ –¥–∞–π—Ç–µ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ");const c=t.context||{},g=String(c.format||"narrative").toLowerCase(),h=Array.isArray(c.body)?c.body:[],s=e("div",{style:"margin:12px 0;padding:14px;border:1px solid #cbd5e1;border-radius:10px;background:#f8fafc;"});c.title&&s.appendChild(e("h4",{style:"margin:0 0 8px;font-size:18px;"},c.title)),g==="dialog"?h.forEach(d=>{if(!d)return;const u=typeof d=="object"&&d.speaker?`${d.speaker}:`:"",y=typeof d=="object"&&"line"in d?d.line:typeof d=="string"?d:"";s.appendChild(e("p",{style:"margin:4px 0;display:flex;gap:6px;align-items:flex-start;line-height:1.5;"},u?e("strong",{},u):null,e("span",{},y)))}):h.forEach((d,u)=>{const y=typeof d=="string"?d:d&&d.text?d.text:"";y&&s.appendChild(e("p",{style:u?"margin:8px 0 0;":"margin:0;"},y))}),r.appendChild(s);const o=Array.isArray(t.questions)?t.questions:[];if(!o.length)return;const i=[];o.forEach((d,u)=>{const y=e("div",{style:"margin-bottom:8px;font-weight:600;"},d.q||`–ü–∏—Ç–∞–Ω–Ω—è ${u+1}`),w=e("div",{style:"margin-bottom:12px;padding:12px;border:1px solid #e5e7eb;border-radius:10px;background:#fff;"},y),L=Array.isArray(d.answer)?d.answer.map(String):d.answer!=null?[String(d.answer)]:[];if(Array.isArray(d.choices)&&d.choices.length){const b=`${t.id||"context"}-${u}`,A=L.length>1,N=L.every(v=>/^\d+$/.test(v));d.choices.forEach((v,O)=>{const P=_(`${b}-${O}`);w.appendChild(e("label",{for:P,style:"display:flex;align-items:center;gap:8px;margin:4px 0;"},e("input",{type:A?"checkbox":"radio",name:b,id:P,value:String(O)}),e("span",{},v)))}),i.push({block:w,type:"choices",allowMulti:A,getPicked:()=>{const O=Array.from(w.querySelectorAll(`input[name='${b}']`)).filter(P=>P.checked).map(P=>P.value);return N?O:O.map(P=>E(d.choices[Number(P)]||""))},expected:N?L:L.map(v=>E(v))})}else{const b=_(`${t.id||"context-label"}-${u}`);y.setAttribute("id",b);const A=_(`${t.id||"context-text"}-${u}`),N=e("textarea",{id:A,rows:2,style:"width:100%;max-width:640px;padding:6px 8px;border:1px solid #cbd5e1;border-radius:6px;"});N.setAttribute("aria-labelledby",b),w.appendChild(N),i.push({block:w,type:"text",input:N,expected:L.map(v=>E(v))})}d.explanation&&w.appendChild(e("div",{class:"muted",style:"display:none;margin-top:6px;color:#475569;"},d.explanation)),r.appendChild(w)});const x=e("div",{style:"margin-top:8px;font-weight:600;"}),l=e("button",{type:"button",class:"btn primary",style:"margin-top:8px;"},"–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏");l.addEventListener("click",()=>{let d=0;i.forEach(u=>{let y=!1;if(u.type==="choices"){const L=u.getPicked().sort(),b=u.expected.slice().sort();y=L.length===b.length&&L.every((A,N)=>A===b[N])}else{const L=E(u.input.value);y=u.expected.length?u.expected.includes(L):!!L}u.block.style.borderColor=y?"#10b981":"#ef4444";const w=u.block.querySelector(".muted");w&&(w.style.display=y?"none":"block"),y&&d++}),x.textContent=`–†–µ–∑—É–ª—å—Ç–∞—Ç: ${d}/${i.length}`}),r.appendChild(l),r.appendChild(x)}function re(r,t,c,g={}){const{showRemove:h=!0}=g,s=c||(t&&t.id?String(t.id):`task-${Math.random().toString(16).slice(2,8)}`),o=e("section",{style:"position:relative;margin:18px 0 26px;","data-task-id":t&&t.id?String(t.id):"","data-task-key":s}),i=e("div",{style:"position:absolute;top:6px;right:6px;display:flex;gap:6px;align-items:center;z-index:5;"}),{button:x,panel:l,unregister:d}=yt({context:t,onShare:({student:w,context:L})=>{const b=window.location.search.slice(8),A=document.querySelector("h1"),N=A?A.textContent:"",v={lessonId:b,userEmail:w.email,lessonName:N,homeworkType:"task",homeworkData:JSON.stringify(L)};return ot(v)}});if(i.appendChild(x),h){const w=e("button",{type:"button",title:"–í–∏–¥–∞–ª–∏—Ç–∏ –∑–∞–≤–¥–∞–Ω–Ω—è","aria-label":"–í–∏–¥–∞–ª–∏—Ç–∏ –∑–∞–≤–¥–∞–Ω–Ω—è",class:"for-admin",style:"border:none;background:transparent;color:#94a3b8;cursor:pointer;padding:2px;line-height:1;font-size:14px;opacity:0.6;",onmouseenter:()=>w.style.opacity="1",onmouseleave:()=>w.style.opacity="0.6",onclick:()=>{bt(l)&&ne(),document.dispatchEvent(new CustomEvent("practice:taskRemoved",{detail:{key:s,task:t}})),d(),o.remove()}},"‚úï");i.appendChild(w)}o.appendChild(i),o.appendChild(l),t.title&&o.appendChild(e("h3",{},t.title));const u=t&&t.type;switch(String(u||"").trim().toLowerCase()){case"mcq":R(o,t);break;case"gap":J(o,t);break;case"match":G(o,t);break;case"context":fe(o,t);break;case"transform":qe(o,t);break;case"error":Re(o,t);break;case"order":Me(o,t);break;case"short":Ve(o,t);break;case"roleplay":We(o,t);break;case"dialogue-gap":He(o,t);break;case"dialogue-order":Fe(o,t);break;case"truefalse":Ge(o,t);break;case"definition-match":{const w={...t,prompt:t.prompt||"–ü–æ—î–¥–Ω–∞–π —Å–ª–æ–≤–æ –∑ –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è–º"};G(o,w);break}case"synonym-clue":Ue(o,t);break;case"scramble":Ke(o,t);break;case"wordpairs":{const w={...t,prompt:t.prompt||"–ü–æ—î–¥–Ω–∞–π —Ñ–æ—Ä–º—É –≤ –æ–¥–Ω–∏–Ω—ñ —Ç–∞ –º–Ω–æ–∂–∏–Ω—ñ"};G(o,w);break}case"odd-one-out":Je(o,t);break;case"open":De(o,t);break;case"writing":Qe(o,t);break;case"audio":Xe(o,t);break;default:o.appendChild(e("div",{class:"muted"},`–ù–µ–≤—ñ–¥–æ–º–∏–π —Ç–∏–ø –∑–∞–≤–¥–∞–Ω–Ω—è: ${u}`))}return r.appendChild(o),o}function q(r,t={}){const c=Le();if(!c||!r)return;const g=c.querySelector("#practice-body")||c,h=t.showRemove!==!1;re(g,r,t.key,{showRemove:h})}function oe(r,t,c={}){if(!r)return null;const g=Array.isArray(t)?t.filter(Boolean):[],{title:h,level:s,description:o,keyPrefix:i="inline",showEmptyNote:x=!1,showRemove:l=!1}=c;if(!g.length){if(x){const u=e("p",{class:"muted practice-inline__empty"},"–ü—Ä–∞–∫—Ç–∏–∫–∞ –¥–ª—è —Ü—ñ—î—ó —Ç–µ–º–∏ –ø–æ–∫–∏ –≤—ñ–¥—Å—É—Ç–Ω—è.");r.appendChild(u)}return null}const d=e("section",{class:"practice-inline"});if(h||s||o){const u=e("header",{class:"practice-inline__header"});h&&u.appendChild(e("h3",{class:"practice-inline__title"},h)),s&&u.appendChild(e("span",{class:"practice-inline__badge"},s)),o&&u.appendChild(e("p",{class:"practice-inline__description muted"},o)),d.appendChild(u)}return g.forEach((u,y)=>{const w=`${i}-${y}`;re(d,u,w,{showRemove:l})}),r.appendChild(d),document.dispatchEvent(new CustomEvent("practice:inlineRendered",{detail:{tasks:g,container:r,options:c}})),d}function he(r,t={}){if(!r)return null;const c=document.createDocumentFragment(),g=t.showRemove!==!1;return re(c,r,t.key,{showRemove:g})}async function ge(r){if(!r)return null;const t=f(r);try{const c=await fetch(t,{cache:"no-store"});return c.ok?await c.json():null}catch{return null}}async function ze(){const r=document.getElementById("practice-data");if(r)try{return JSON.parse(r.textContent)}catch{return null}const t=window.lessonContext||{},c=new Set;if(t.id&&c.add(`data/practice/${t.id}.json`),t.htmlPath){const h=String(t.htmlPath).replace(/^\.\/?/,"").replace(/\.html?$/i,"");if(h){c.add(`data/practice/${h}.json`);const s=h.split("/"),o=s[s.length-1];o&&c.add(`data/practice/${o}.json`)}}for(const h of c){const s=await ge(h);if(s)return s}const g=C();return g?await ge(g):null}function qe(r,t){M(r,t,"Transform the sentence");const c=[];(t.items||[]).forEach((s,o)=>{const i=e("div",{style:"margin-bottom:10px;padding:10px;border:1px solid #e5e7eb;border-radius:10px;background:#fff;"});i.appendChild(e("div",{style:"margin-bottom:6px;font-weight:600;"},s.q));const x=_(`${t.id||"transform"}-${o}`),l=e("input",{type:"text",id:x,style:"width:100%;max-width:640px;padding:6px 8px;border:1px solid #cbd5e1;border-radius:6px;"});i.appendChild(l),s.hint&&i.appendChild(W(s.hint)),c.push({row:i,input:l,answers:(s.answer||[]).map(d=>E(d))}),r.appendChild(i)});const g=e("div",{style:"margin-top:8px;font-weight:600;"}),h=e("button",{type:"button",class:"btn primary",style:"margin-top:8px;"},"–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏");h.addEventListener("click",()=>{let s=0;c.forEach(({row:o,input:i,answers:x})=>{const l=x.includes(E(i.value));o.style.borderColor=l?"#10b981":"#ef4444",l&&s++}),g.textContent=`–†–µ–∑—É–ª—å—Ç–∞—Ç: ${s}/${c.length}`}),r.appendChild(h),r.appendChild(g)}function Re(r,t){M(r,t,"Find and correct the error");const c=[];(t.items||[]).forEach((s,o)=>{const i=e("div",{style:"margin-bottom:10px;padding:10px;border:1px solid #e5e7eb;border-radius:10px;background:#fff;"});i.appendChild(e("div",{style:"margin-bottom:6px;font-weight:600;"},s.q));const x=_(`${t.id||"error"}-${o}`),l=e("input",{type:"text",id:x,style:"width:100%;max-width:640px;padding:6px 8px;border:1px solid #cbd5e1;border-radius:6px;"});i.appendChild(l),s.hint&&i.appendChild(W(s.hint)),c.push({row:i,input:l,answers:(s.answer||[]).map(d=>E(d))}),r.appendChild(i)});const g=e("div",{style:"margin-top:8px;font-weight:600;"}),h=e("button",{type:"button",class:"btn primary",style:"margin-top:8px;"},"–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏");h.addEventListener("click",()=>{let s=0;c.forEach(({row:o,input:i,answers:x})=>{const l=x.includes(E(i.value));o.style.borderColor=l?"#10b981":"#ef4444",l&&s++}),g.textContent=`–†–µ–∑—É–ª—å—Ç–∞—Ç: ${s}/${c.length}`}),r.appendChild(h),r.appendChild(g)}function Me(r,t){M(r,t,"Put the words in order");const c=[];(t.items||[]).forEach((s,o)=>{const i=E(Array.isArray(s.answer)?s.answer.join(" "):s.answer),x=k((s.tokens||[]).slice()),l=e("div",{style:"margin:10px 0;padding:10px;border:1px solid #e5e7eb;border-radius:10px;background:#fff;"}),d=e("div",{style:"display:flex;flex-wrap:wrap;gap:6px;margin-bottom:6px;"}),u=e("div",{style:"display:flex;flex-wrap:wrap;gap:6px;min-height:36px;padding:6px;border:1px dashed #cbd5e1;border-radius:8px;background:#f8fafc;"}),y=new Set;function w(A,N){const v=e("button",{type:"button",style:"padding:4px 8px;border:1px solid #cbd5e1;border-radius:6px;background:#fff;cursor:pointer;"},A);return v.addEventListener("click",()=>{y.has(N)||(y.add(N),v.style.opacity=.5,u.appendChild(e("span",{class:"chip",style:"padding:4px 8px;border:1px solid #cbd5e1;border-radius:6px;background:#fff;"},A)))}),v}x.forEach((A,N)=>d.appendChild(w(A,`${o}-${N}`)));const L=e("div",{style:"margin-top:6px;display:flex;gap:8px;"}),b=e("button",{type:"button",class:"btn"},"–°–∫–∏–Ω—É—Ç–∏");b.addEventListener("click",()=>{y.clear(),u.innerHTML="",Array.from(d.children).forEach(A=>A.style.opacity=1),l.style.borderColor="#e5e7eb"}),L.appendChild(b),l.appendChild(e("div",{style:"margin-bottom:6px;font-weight:600;"},s.q||"")),l.appendChild(d),l.appendChild(u),l.appendChild(L),c.push({row:l,outWrap:u,correctStr:i}),r.appendChild(l)});const g=e("div",{style:"margin-top:8px;font-weight:600;"}),h=e("button",{type:"button",class:"btn primary",style:"margin-top:8px;"},"–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏");h.addEventListener("click",()=>{let s=0;c.forEach(({row:o,outWrap:i,correctStr:x})=>{const d=E(Array.from(i.querySelectorAll(".chip")).map(u=>u.textContent).join(" "))===x;o.style.borderColor=d?"#10b981":"#ef4444",d&&s++}),g.textContent=`–†–µ–∑—É–ª—å—Ç–∞—Ç: ${s}/${c.length}`}),r.appendChild(h),r.appendChild(g)}function Ve(r,t){M(r,t,"Short answer");const c=[];(t.items||[]).forEach((s,o)=>{const i=e("div",{style:"margin-bottom:10px;padding:10px;border:1px solid #e5e7eb;border-radius:10px;background:#fff;"}),x=e("div",{style:"margin-bottom:6px;font-weight:600;"},s.q);i.appendChild(x);const l=_(`${t.id||"short-label"}-${o}`);x.setAttribute("id",l);const d=_(`${t.id||"short-text"}-${o}`),u=e("textarea",{id:d,rows:3,style:"width:100%;max-width:720px;padding:6px 8px;border:1px solid #cbd5e1;border-radius:6px;"});u.setAttribute("aria-labelledby",l),i.appendChild(u),c.push({row:i,input:u,keywords:(s.keywords||[]).map(y=>E(y))}),r.appendChild(i)});const g=e("div",{style:"margin-top:8px;font-weight:600;"}),h=e("button",{type:"button",class:"btn primary",style:"margin-top:8px;"},"–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏");h.addEventListener("click",()=>{let s=0,o=0;c.forEach(({row:i,input:x,keywords:l})=>{const d=E(x.value),u=l.filter(w=>d.includes(w)).length;s+=u,o+=l.length,i.style.borderColor=u===l.length?"#10b981":u>0?"#f59e0b":"#ef4444";const y=i.querySelector(".short-info")||e("div",{class:"short-info",style:"margin-top:6px;color:#475569;"});y.textContent=`–ó–±—ñ–≥–∏ –∫–ª—é—á–æ–≤–∏—Ö —Å–ª—ñ–≤: ${u}/${l.length}`,i.contains(y)||i.appendChild(y)}),g.textContent=`–ó–∞–≥–∞–ª—å–Ω–∏–π –∑–±—ñ–≥ –∫–ª—é—á–æ–≤–∏—Ö —Å–ª—ñ–≤: ${s}/${o}`}),r.appendChild(h),r.appendChild(g)}function De(r,t){M(r,t,"–í—ñ–¥–ø–æ–≤—ñ–¥—ñ —É –≤—ñ–ª—å–Ω—ñ–π —Ñ–æ—Ä–º—ñ");const c=Array.isArray(t&&t.items)?t.items.filter(Boolean):[];if(c.length){const h=e("div",{style:"display:flex;flex-direction:column;gap:12px;margin-top:12px;"});c.forEach((s,o)=>{const i=e("div",{style:"padding:12px;border:1px solid #e5e7eb;border-radius:10px;background:#fff;"}),x=s&&(s.situation||s.prompt||s.q)||`–°–∏—Ç—É–∞—Ü—ñ—è ${o+1}`;i.appendChild(e("div",{style:"margin:0 0 6px;font-weight:600;color:#0f172a;"},x));const l=s&&Array.isArray(s.example_answers)?s.example_answers.filter(Boolean):[];if(l.length){i.appendChild(e("div",{class:"muted",style:"margin:0 0 6px;color:#64748b;"},"–ü—Ä–∏–∫–ª–∞–¥ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ:"));const d=e("div",{style:"display:flex;flex-wrap:wrap;gap:8px;"});l.forEach(u=>{d.appendChild(e("span",{style:"display:inline-flex;align-items:center;padding:4px 10px;border-radius:9999px;background:#e2e8f0;color:#0f172a;font-size:14px;"},u))}),i.appendChild(d)}h.appendChild(i)}),r.appendChild(h)}const g=t&&t.scoring&&Array.isArray(t.scoring.criteria)?t.scoring.criteria.filter(Boolean):[];if(g.length){const h=e("div",{style:"margin-top:16px;padding:14px;border:1px dashed #cbd5e1;border-radius:10px;background:#f8fafc;"});h.appendChild(e("h4",{style:"margin:0 0 8px;font-size:16px;font-weight:600;color:#0f172a;"},"–ö—Ä–∏—Ç–µ—Ä—ñ—ó –æ—Ü—ñ–Ω—é–≤–∞–Ω–Ω—è"));const s=e("ul",{style:"margin:0;padding-left:18px;color:#475569;"});g.forEach(o=>{s.appendChild(e("li",{style:"margin:4px 0;"},o))}),h.appendChild(s),r.appendChild(h)}}function We(r,t){M(r,t,"Role-play scenario");const c=t&&typeof t.scenario=="object"?t.scenario:{},g=e("div",{style:"margin:12px 0;padding:14px;border:1px solid #cbd5e1;border-radius:10px;background:#f8fafc;"});let h=!1;c.setting&&(g.appendChild(e("p",{style:"margin:0 0 6px;font-weight:600;"},`–õ–æ–∫–∞—Ü—ñ—è: ${c.setting}`)),h=!0),c.summary&&(g.appendChild(e("p",{style:"margin:0;color:#334155;"},c.summary)),h=!0),h&&r.appendChild(g);const s=Array.isArray(c.roles)?c.roles:[];if(s.length){const x=e("div",{style:"display:grid;gap:12px;margin-top:12px;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));"});s.forEach((l,d)=>{const u=l&&l.name||`Student ${d+1}`,y=e("div",{style:"padding:14px;border:1px solid #e5e7eb;border-radius:10px;background:#fff;box-shadow:0 1px 0 rgba(148, 163, 184, 0.2);"},e("div",{style:"font-weight:600;margin-bottom:6px;"},u));l&&l.goal&&y.appendChild(e("p",{style:"margin:0 0 6px;color:#0f172a;"},`–ú–µ—Ç–∞: ${l.goal}`));const L=(l&&Array.isArray(l.details)?l.details:typeof(l==null?void 0:l.details)=="string"?l.details.split(/[;,\n]/):[]).map(b=>String(b||"").trim()).filter(Boolean);if(L.length===1)y.appendChild(e("p",{style:"margin:0;color:#475569;"},L[0]));else if(L.length>1){const b=e("ul",{style:"margin:0;padding-left:18px;color:#475569;"});L.forEach(A=>{b.appendChild(e("li",{style:"margin:2px 0;"},A))}),y.appendChild(b)}x.appendChild(y)}),r.appendChild(x)}const o=Array.isArray(c.steps)?c.steps:[];if(o.length){const x=e("div",{style:"margin-top:16px;padding:14px;border:1px solid #e5e7eb;border-radius:10px;background:#fff;"});x.appendChild(e("h4",{style:"margin:0 0 6px;font-size:16px;font-weight:600;color:#0f172a;"},"–ü–æ–∫—Ä–æ–∫–æ–≤–∏–π –ø–ª–∞–Ω –¥—ñ–∞–ª–æ–≥—É"));const l=e("ol",{style:"margin:0 0 0 18px;padding:0;color:#475569;"});o.forEach(d=>{d&&l.appendChild(e("li",{style:"margin:4px 0;"},d))}),x.appendChild(l),r.appendChild(x)}const i=Array.isArray(t&&t.phrases)?t.phrases:[];if(i.length){r.appendChild(e("h4",{style:"margin:18px 0 8px;font-size:16px;font-weight:600;color:#0f172a;"},"–ö–æ—Ä–∏—Å–Ω—ñ —Ñ—Ä–∞–∑–∏ –¥–ª—è –¥—ñ–∞–ª–æ–≥—É"));const x=e("div",{style:"display:flex;flex-direction:column;gap:8px;"});i.forEach((l,d)=>{const u=typeof l=="string"?l:l&&(l.phrase||l.text||l.value||""),y=l&&typeof l=="object"&&(l.translation||l.note||l.ua||l.uk)||"";if(!u)return;const w=_(`phrase-${d}`);x.appendChild(e("label",{for:w,style:"display:flex;gap:10px;align-items:flex-start;padding:10px 12px;border:1px solid #e5e7eb;border-radius:10px;background:#fff;"},e("input",{id:w,type:"checkbox",style:"margin-top:4px;"}),e("div",{},e("span",{style:"font-weight:600;color:#0f172a;"},u),y?e("span",{class:"muted",style:"display:block;margin-top:4px;color:#475569;"},y):null)))}),r.appendChild(x)}}function He(r,t){M(r,t,"–ó–∞–ø–æ–≤–Ω—ñ—Ç—å –ø—Ä–æ–ø—É—Å–∫–∏ —É –¥—ñ–∞–ª–æ–∑—ñ");const c=Array.isArray(t==null?void 0:t.answers)?t.answers.map(v=>E(v)):[],g=[];let h=null;function s(v){h&&h!==v&&(h.style.boxShadow="none"),v&&h!==v?(v.style.boxShadow="0 0 0 2px rgba(37, 99, 235, 0.35)",h=v):(v&&(v.style.boxShadow="none"),h=null)}function o(v){v&&(v.dataset.value="",v.textContent="___",v.style.borderColor="#cbd5e1",v.style.background="#fff",v.style.boxShadow="none")}const i=e("div",{style:"display:flex;flex-wrap:wrap;gap:8px;margin:12px 0;padding:10px;border:1px solid #e2e8f0;border-radius:10px;background:#f8fafc;"}),x=Array.isArray(t==null?void 0:t.words)?t.words:[],l=new Set,d=[];x.forEach(v=>{const O=String(v||"").trim();if(!O)return;const P=E(O);l.has(P)||(l.add(P),d.push(O))}),d.forEach(v=>{const O=e("button",{type:"button",class:"btn",style:"padding:6px 10px;border:1px solid #94a3b8;border-radius:999px;background:#fff;color:#0f172a;cursor:pointer;font-size:14px;line-height:1;",onclick:()=>{const P=h||g.find(ie=>!ie.dataset.value);P&&(P.dataset.value=v,P.textContent=v,P.style.borderColor="#2563eb",P.style.background="#eef2ff",s(null))}},v);O.dataset.word=v,i.appendChild(O)}),i.children.length&&r.appendChild(i);const u=e("div",{style:"display:flex;flex-direction:column;gap:10px;"}),y=Array.isArray(t==null?void 0:t.dialogue)?t.dialogue:[];let w=0;y.forEach(v=>{if(!v)return;const O=v.speaker||v.role||"",P=v.line||v.text||"",ie=e("div",{style:"padding:12px;border:1px solid #e5e7eb;border-radius:10px;background:#fff;display:flex;gap:10px;align-items:flex-start;"},O?e("strong",{style:"min-width:90px;"},`${O}:`):null),T=e("div",{style:"display:flex;flex-wrap:wrap;gap:6px;align-items:center;"}),ae=String(P||"").split(/___/);ae.forEach((H,xe)=>{if(H&&T.appendChild(e("span",{},H)),xe<ae.length-1){const le=c[w]||"",F=e("button",{type:"button",style:"min-width:52px;padding:4px 10px;border:1px solid #cbd5e1;border-radius:8px;background:#fff;color:#0f172a;cursor:pointer;",onclick:()=>{if(F.dataset.value){o(F),s(F);return}s(h===F?null:F)},ondblclick:()=>{o(F),s(null)}},"___");F.dataset.expected=le,F.dataset.index=String(w),g.push(F),w+=1,T.appendChild(F)}}),ie.appendChild(T),u.appendChild(ie)}),r.appendChild(u);const L=e("div",{style:"margin-top:14px;display:flex;gap:10px;flex-wrap:wrap;align-items:center;"}),b=e("button",{type:"button",class:"btn primary"},"–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏"),A=e("button",{type:"button",class:"btn"},"–°–∫–∏–Ω—É—Ç–∏"),N=e("div",{style:"font-weight:600;color:#0f172a;"});b.addEventListener("click",()=>{let v=0;g.forEach(O=>{const P=O.dataset.expected||"",ie=E(O.dataset.value||O.textContent||""),T=P?ie===P:!!ie;O.style.borderColor=T?"#10b981":"#ef4444",O.style.background=T?"#ecfdf5":"#fee2e2",T&&(v+=1)}),g.length?N.textContent=`–†–µ–∑—É–ª—å—Ç–∞—Ç: ${v}/${g.length}`:N.textContent=""}),A.addEventListener("click",()=>{g.forEach(v=>o(v)),N.textContent="",s(null)}),L.appendChild(b),L.appendChild(A),L.appendChild(N),r.appendChild(L)}function Fe(r,t){M(r,t,"–£–ø–æ—Ä—è–¥–∫—É–π—Ç–µ –¥—ñ–∞–ª–æ–≥");const c=Array.isArray(t==null?void 0:t.lines)?t.lines.map(b=>({speaker:(b==null?void 0:b.speaker)||(b==null?void 0:b.role)||"",text:(b==null?void 0:b.line)||(b==null?void 0:b.text)||""})):[],g=Array.isArray(t==null?void 0:t.solution)?t.solution.map(b=>Number.parseInt(b,10)):c.map((b,A)=>A),h=e("div",{style:"display:flex;flex-direction:column;gap:8px;margin-top:10px;padding:10px;border:1px solid #e2e8f0;border-radius:10px;background:#f8fafc;"}),s=e("div",{style:"margin-top:14px;padding:12px;border:1px dashed #cbd5e1;border-radius:10px;min-height:80px;display:flex;flex-direction:column;gap:8px;"}),o=new Set;function i({speaker:b,text:A}){return(b?`${b}: ${A}`:A).trim()}function x(b){if(!b)return;const A=Number.parseInt(b.dataset.index||"-1",10),N=b.dataset.buttonId;if(N){const v=h.querySelector(`[data-id="${N}"]`);v&&(v.disabled=!1,v.style.opacity="1")}o.delete(A),b.remove()}function l(b,A,N){const v=e("div",{class:"dialogue-chip",style:"padding:10px;border:1px solid #94a3b8;border-radius:10px;background:#fff;display:flex;justify-content:space-between;align-items:center;gap:12px;cursor:pointer;",onclick:O=>{O.stopPropagation(),x(v)}},e("span",{},A),e("span",{style:"color:#94a3b8;font-size:12px;"},"√ó"));v.dataset.index=String(b),v.dataset.buttonId=N,s.appendChild(v)}k(c.map((b,A)=>A)).forEach(b=>{const A=c[b],N=i(A),v=`line-${b}-${Math.random().toString(36).slice(2,6)}`,O=e("button",{type:"button",class:"btn",style:"text-align:left;padding:10px;border:1px solid #cbd5e1;border-radius:10px;background:#fff;color:#0f172a;cursor:pointer;",onclick:()=>{o.has(b)||(o.add(b),O.disabled=!0,O.style.opacity="0.5",l(b,N,v))},"data-id":v},N);h.appendChild(O)}),r.appendChild(h),r.appendChild(s);const u=e("div",{style:"margin-top:14px;display:flex;gap:10px;flex-wrap:wrap;align-items:center;"}),y=e("button",{type:"button",class:"btn primary"},"–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏"),w=e("button",{type:"button",class:"btn"},"–°–∫–∏–Ω—É—Ç–∏"),L=e("div",{style:"font-weight:600;color:#0f172a;"});y.addEventListener("click",()=>{const b=Array.from(s.children).map(v=>Number.parseInt(v.dataset.index||"-1",10)),A=g.slice(),N=b.length===A.length&&b.every((v,O)=>v===A[O]);s.style.borderColor=N?"#10b981":"#ef4444",L.textContent=N?"–î—ñ–∞–ª–æ–≥ –≤–ø–æ—Ä—è–¥–∫–æ–≤–∞–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ!":`–ü–æ—Ç–æ—á–Ω–∏–π –ø–æ—Ä—è–¥–æ–∫: ${b.length}/${A.length} —Ä–µ–ø–ª—ñ–∫. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ø–æ—Å–ª—ñ–¥–æ–≤–Ω—ñ—Å—Ç—å.`}),w.addEventListener("click",()=>{Array.from(s.children).forEach(A=>x(A)),h.querySelectorAll("button").forEach(A=>{A.disabled=!1,A.style.opacity="1"}),o.clear(),s.style.borderColor="#cbd5e1",L.textContent=""}),u.appendChild(y),u.appendChild(w),u.appendChild(L),r.appendChild(u)}function Ge(r,t){M(r,t,"–û–±–µ—Ä–∏ True –∞–±–æ False");const c=[];if((Array.isArray(t==null?void 0:t.items)?t.items:[]).forEach((i,x)=>{if(!i||!i.statement)return;const l=e("div",{style:"margin:8px 0;padding:12px;border:1px solid #e5e7eb;border-radius:10px;background:#fff;"},e("p",{style:"margin:0 0 8px;font-weight:600;"},i.statement)),d=`${t.id||"tf"}-${x}`,u=!!i.answer,y=_(`${d}-true`),w=e("label",{for:y,style:"display:inline-flex;align-items:center;gap:6px;margin-right:16px;"},e("input",{type:"radio",name:d,value:"true",id:y}),"True"),L=_(`${d}-false`),b=e("label",{for:L,style:"display:inline-flex;align-items:center;gap:6px;"},e("input",{type:"radio",name:d,value:"false",id:L}),"False"),A=e("div",{style:"display:flex;align-items:center;"});A.appendChild(w),A.appendChild(b),l.appendChild(A),c.push({row:l,name:d,expected:u}),r.appendChild(l)}),!c.length)return;const h=e("div",{style:"margin-top:14px;display:flex;gap:10px;align-items:center;flex-wrap:wrap;"}),s=e("button",{type:"button",class:"btn primary"},"–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏"),o=e("div",{style:"font-weight:600;color:#0f172a;"});s.addEventListener("click",()=>{let i=0;c.forEach(({row:x,name:l,expected:d})=>{const u=x.querySelector(`input[name="${l}"]:checked`),y=u?u.value===String(d):!1;x.style.borderColor=y?"#10b981":"#ef4444",y&&(i+=1)}),o.textContent=`–†–µ–∑—É–ª—å—Ç–∞—Ç: ${i}/${c.length}`}),h.appendChild(s),h.appendChild(o),r.appendChild(h)}function Ue(r,t){M(r,t,"–î–æ–±–µ—Ä—ñ—Ç—å —Å–ª–æ–≤–æ –∑–∞ –æ–ø–∏—Å–æ–º");const c=Array.isArray(t==null?void 0:t.wordBank)?t.wordBank:[];if(c.length){const i=e("div",{style:"margin:8px 0 12px;padding:10px;border:1px solid #e2e8f0;border-radius:10px;background:#f8fafc;display:flex;flex-wrap:wrap;gap:8px;"});c.forEach(x=>{const l=String(x||"").trim();l&&i.appendChild(e("span",{style:"padding:6px 10px;border:1px solid #94a3b8;border-radius:999px;background:#fff;font-size:14px;"},l))}),r.appendChild(i)}const g=[];if((Array.isArray(t==null?void 0:t.items)?t.items:[]).forEach((i,x)=>{if(!i||!i.clue)return;const l=e("div",{style:"margin-bottom:10px;padding:12px;border:1px solid #e5e7eb;border-radius:10px;background:#fff;"});l.appendChild(e("p",{style:"margin:0 0 6px;font-weight:600;"},i.clue));const d=_(`${t.id||"synonym"}-${x}`),u=e("input",{type:"text",id:d,style:"width:100%;max-width:320px;padding:6px 8px;border:1px solid #cbd5e1;border-radius:6px;"});l.appendChild(u);const y=Array.isArray(i==null?void 0:i.answers)?i.answers.map(w=>E(w)):Array.isArray(i==null?void 0:i.answer)?i.answer.map(w=>E(w)):i!=null&&i.answer?[E(i.answer)]:[];g.push({row:l,input:u,answers:y}),r.appendChild(l)}),!g.length)return;const s=e("div",{style:"font-weight:600;color:#0f172a;"}),o=e("button",{type:"button",class:"btn primary"},"–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏");o.addEventListener("click",()=>{let i=0;g.forEach(({row:x,input:l,answers:d})=>{const u=E(l.value),y=d.length?d.includes(u):!!u;x.style.borderColor=y?"#10b981":"#ef4444",y&&(i+=1)}),s.textContent=`–†–µ–∑—É–ª—å—Ç–∞—Ç: ${i}/${g.length}`}),r.appendChild(o),r.appendChild(s)}function Ke(r,t){M(r,t,"–†–æ–∑—à–∏—Ñ—Ä—É–π—Ç–µ —Å–ª–æ–≤–∞");const c=[];if((Array.isArray(t==null?void 0:t.items)?t.items:[]).forEach((o,i)=>{if(!o||!o.scrambled)return;const x=e("div",{style:"margin-bottom:10px;padding:12px;border:1px solid #e5e7eb;border-radius:10px;background:#fff;"});x.appendChild(e("div",{style:"margin-bottom:6px;font-weight:600;"},o.scrambled));const l=_(`${t.id||"scramble"}-${i}`),d=e("input",{type:"text",id:l,style:"width:100%;max-width:260px;padding:6px 8px;border:1px solid #cbd5e1;border-radius:6px;"});x.appendChild(d);const u=Array.isArray(o==null?void 0:o.answers)?o.answers.map(y=>E(y)):Array.isArray(o==null?void 0:o.answer)?o.answer.map(y=>E(y)):o!=null&&o.answer?[E(o.answer)]:[];c.push({row:x,input:d,answers:u}),r.appendChild(x)}),!c.length)return;const h=e("button",{type:"button",class:"btn primary"},"–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏"),s=e("div",{style:"margin-top:6px;font-weight:600;color:#0f172a;"});h.addEventListener("click",()=>{let o=0;c.forEach(({row:i,input:x,answers:l})=>{const d=E(x.value),u=l.length?l.includes(d):!!d;i.style.borderColor=u?"#10b981":"#ef4444",u&&(o+=1)}),s.textContent=`–†–µ–∑—É–ª—å—Ç–∞—Ç: ${o}/${c.length}`}),r.appendChild(h),r.appendChild(s)}function Je(r,t){M(r,t,"–ó–Ω–∞–π–¥–∏ –∑–∞–π–≤–µ —Å–ª–æ–≤–æ");const c=[];if((Array.isArray(t==null?void 0:t.items)?t.items:[]).forEach((o,i)=>{const x=Array.isArray(o==null?void 0:o.options)?o.options:[];if(!x.length)return;const l=e("div",{style:"margin-bottom:10px;padding:12px;border:1px solid #e5e7eb;border-radius:10px;background:#fff;"});l.appendChild(e("div",{style:"margin-bottom:6px;font-weight:600;"},`–ù–∞–±—ñ—Ä ${i+1}`));const d=`${t.id||"odd"}-${i}`;x.forEach((w,L)=>{const b=_(`${d}-${L}`);l.appendChild(e("label",{for:b,style:"display:flex;align-items:center;gap:6px;margin:4px 0;"},e("input",{type:"radio",name:d,value:String(L),id:b}),w))});const u=String((o==null?void 0:o.explanation)||"").trim();if(u){const w=e("div",{class:"muted",style:"display:none;margin-top:6px;color:#475569;"});w.textContent=`–ü–æ—è—Å–Ω–µ–Ω–Ω—è: ${u}`,l.appendChild(w)}const y=E((o==null?void 0:o.answer)||"");c.push({row:l,groupName:d,answerIndex:y}),r.appendChild(l)}),!c.length)return;const h=e("button",{type:"button",class:"btn primary"},"–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏"),s=e("div",{style:"margin-top:6px;font-weight:600;color:#0f172a;"});h.addEventListener("click",()=>{let o=0;c.forEach(({row:i,groupName:x,answerIndex:l})=>{const d=i.querySelector(`input[name="${x}"]:checked`),u=E(d?d.value:""),y=l?u===l:!!u;i.style.borderColor=y?"#10b981":"#ef4444";const w=i.querySelector(".muted");w&&(w.style.display=y?"none":"block"),y&&(o+=1)}),s.textContent=`–†–µ–∑—É–ª—å—Ç–∞—Ç: ${o}/${c.length}`}),r.appendChild(h),r.appendChild(s)}function Qe(r,t){M(r,t,"Writing/Speaking prompt"),t.description&&r.appendChild(e("p",{class:"muted"},t.description));const c=e("div",{style:"margin-top:8px;"});(t.checklist||[]).forEach((s,o)=>{const i=_(`${t.id||"check"}-${o}`),x=e("label",{for:i,style:"display:flex;align-items:center;gap:8px;margin:6px 0;"},e("input",{id:i,type:"checkbox"}),e("span",{},s));c.appendChild(x)}),r.appendChild(c);const g=e("button",{type:"button",class:"btn primary",style:"margin-top:8px;"},"–ü–æ–∑–Ω–∞—á–∏—Ç–∏ —è–∫ –ø–µ—Ä–µ–≤—ñ—Ä–µ–Ω–æ"),h=e("div",{class:"muted",style:"margin-top:6px;"});g.addEventListener("click",()=>{h.textContent="–ì–æ—Ç–æ–≤–æ! –ü–µ—Ä–µ–≤—ñ—Ä —Å–ø–∏—Å–æ–∫ —ñ –∑–∞ –±–∞–∂–∞–Ω–Ω—è–º –≤—ñ–¥–ø—Ä–∞–≤ –Ω–∞—Å—Ç–∞–≤–Ω–∏–∫—É."}),r.appendChild(g),r.appendChild(h)}function Xe(r,t){M(r,t,"Audio task");const c=["voice","voiceName","voiceGender","gender","lang","rate","pitch","volume"],g=n=>!n||typeof n!="object"||Array.isArray(n)?!1:c.some(p=>Object.prototype.hasOwnProperty.call(n,p)),h=n=>{if(typeof n=="number"&&Number.isFinite(n))return n;if(typeof n=="string"&&n.trim()!==""){const p=Number(n);return Number.isFinite(p)?p:null}return null},s=n=>{if(!n)return null;if(Array.isArray(n)){for(const S of n){const $=s(S);if($)return $}return null}if(typeof n=="string"){const S=n.trim();if(!S)return null;const $=S.toLowerCase();return $==="male"||$==="female"?{voice:S,gender:$,voiceGender:$}:/\s/.test(S)?{voiceName:S}:{voice:S}}if(typeof n!="object")return null;const p={};return n.voice&&(p.voice=n.voice),n.voiceName&&(p.voiceName=n.voiceName),n.voiceGender&&(p.voiceGender=n.voiceGender),n.gender&&(p.gender=n.gender),n.lang&&(p.lang=n.lang),["rate","pitch","volume"].forEach(S=>{if(n[S]!=null){const $=h(n[S]);$!=null&&(p[S]=$)}}),Object.keys(p).length?p:null},o=n=>{if(!Array.isArray(n))return null;const p=n.map(s).filter(Boolean);return p.length?p:null},i=n=>{if(!n||typeof n!="object"||Array.isArray(n))return null;const p=Object.entries(n).reduce((m,[S,$])=>{const I=s($);return I&&(m[S]=I),m},{});return Object.keys(p).length?p:null},x=(n,p)=>{p&&(p.voice&&!n.voice&&(n.voice=p.voice),p.voiceName&&!n.voiceName&&(n.voiceName=p.voiceName),p.voiceGender&&!n.voiceGender&&(n.voiceGender=p.voiceGender),p.gender&&!n.gender&&(n.gender=p.gender),p.lang&&!n.lang&&(n.lang=p.lang),p.rate!=null&&n.rate==null&&(n.rate=p.rate),p.pitch!=null&&n.pitch==null&&(n.pitch=p.pitch),p.volume!=null&&n.volume==null&&(n.volume=p.volume))},d=(n=>{const p=o(n.voices)||o(n.voiceSequence)||o(Array.isArray(n.voice)?n.voice:null)||[];let S=[n.voiceMap,n.voiceBySpeaker,n.dialogVoices].find(j=>j&&typeof j=="object"&&!Array.isArray(j))||null;!S&&n.voice&&typeof n.voice=="object"&&!Array.isArray(n.voice)&&!g(n.voice)&&(S=n.voice);const $=i(S);if(!p.length&&!$)return null;const I=$&&($.default||$["*"])||null;return(j,Q=0)=>{const X=j.voiceKey||j.speaker||j.role||j.character||j.actor;return X&&$&&$[X]?$[X]:p.length?p[Q%p.length]:I||null}})(t);let u=null,y=null;const w=n=>{if(n&&(y=n),!u)return;const p=n||y;if(!p||!p.stats){u.style.display="none";return}const{stats:m}=p;if(m.male&&m.female){u.style.display="none",u.textContent="";return}let S="";!m.male&&!m.female?S="‚ö†Ô∏è –ë—Ä–∞—É–∑–µ—Ä –Ω–µ –Ω–∞–¥–∞–≤ –∂–æ–¥–Ω–æ–≥–æ –≥–æ–ª–æ—Å—É –¥–ª—è —Å–∏–Ω—Ç–µ–∑—É –º–æ–≤–ª–µ–Ω–Ω—è. –ë—É–¥–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π –≥–æ–ª–æ—Å.":m.male?m.female?m.total<2&&(S="‚ö†Ô∏è –î–æ—Å—Ç—É–ø–Ω–∏–π –ª–∏—à–µ –æ–¥–∏–Ω –≥–æ–ª–æ—Å —Å–∏–Ω—Ç–µ–∑—É, —Ç–æ–º—É –¥—ñ–∞–ª–æ–≥ –∑–≤—É—á–∞—Ç–∏–º–µ –æ–¥–Ω–∞–∫–æ–≤–æ."):S="‚ö†Ô∏è –£ –±—Ä–∞—É–∑–µ—Ä—ñ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ –∂—ñ–Ω–æ—á–∏—Ö –≥–æ–ª–æ—Å—ñ–≤. –í—Å—ñ —Ä–µ–ø–ª—ñ–∫–∏ –±—É–¥—É—Ç—å –≤—ñ–¥—Ç–≤–æ—Ä–µ–Ω—ñ –∑ –¥–æ—Å—Ç—É–ø–Ω–∏–º–∏ –≥–æ–ª–æ—Å–∞–º–∏.":S="‚ö†Ô∏è –£ –±—Ä–∞—É–∑–µ—Ä—ñ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ —á–æ–ª–æ–≤—ñ—á–∏—Ö –≥–æ–ª–æ—Å—ñ–≤. –í—Å—ñ —Ä–µ–ø–ª—ñ–∫–∏ –±—É–¥—É—Ç—å –≤—ñ–¥—Ç–≤–æ—Ä–µ–Ω—ñ –∑ –¥–æ—Å—Ç—É–ø–Ω–∏–º–∏ –≥–æ–ª–æ—Å–∞–º–∏.",S?(u.textContent=S,u.style.display="block"):u.style.display="none"},L=n=>{const p={male:[],female:[],neutral:[]};n.forEach(I=>{const j=Pe(I);j==="male"?p.male.push(I):j==="female"?p.female.push(I):p.neutral.push(I)});const m=new Set,S=I=>{if(!I.length)return null;const j=I.find(Q=>!m.has(Q.name))||I[0];return j&&m.add(j.name),j};return{pick:I=>I==="male"?S(p.male)||S(p.neutral):I==="female"?S(p.female)||S(p.neutral):S(p.neutral)||S(p.male)||S(p.female),stats:{male:p.male.length,female:p.female.length,neutral:p.neutral.length,total:n.length}}},b=n=>{!n||typeof n.pick!="function"||T.forEach(p=>{if(!p||p.voiceName)return;const m=String(p.voice||"").trim().toLowerCase(),S=p.gender||p.voiceGender||(m==="male"||m==="female"?m:null);if(!S)return;const $=n.pick(S);$&&(p.voiceName=$.name,!p.lang&&$.lang&&(p.lang=$.lang))})};let A=null;const N=()=>ae?(A||(A=(async()=>{try{const n=await St();if(!n||!n.length)return w({stats:{male:0,female:0,neutral:0,total:0}}),null;const p=L(n);return b(p),w(p),p}catch{return null}})()),A):Promise.resolve(null),v=[],O=n=>{if(!n)return;if(Array.isArray(n)){n.forEach(O);return}const p=String(n).trim();p&&v.push(p)};O(t.audioSrc),O(t.audioUrl),O(t.audio),O(t.source),O(t.sources);const P=Array.from(new Set(v));if(P.length){const n=e("div",{style:"margin-top:8px;padding:12px;border:1px solid #cbd5e1;border-radius:10px;background:#f1f5f9;"}),p=e("audio",{controls:!0,style:"width:100%;display:block;"});P.forEach(m=>{p.appendChild(e("source",{src:f(m)}))}),p.appendChild(document.createTextNode("–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î –≤—ñ–¥—Ç–≤–æ—Ä–µ–Ω–Ω—è –∞—É–¥—ñ–æ.")),n.appendChild(p),r.appendChild(n)}const ie=Array.isArray(t.dialogs)?t.dialogs:[],T=[];if(ie.forEach(n=>{if(n){if(typeof n=="string"){const p=n.trim();if(p){const m={text:p};if(d){const S=d(m,T.length);x(m,S)}T.push(m)}return}if(typeof n=="object"){const p="text"in n?String(n.text||"").trim():"";if(!p)return;const m={text:p};if(n.voice&&(m.voice=n.voice),n.voiceName&&(m.voiceName=n.voiceName),n.gender&&(m.gender=n.gender),n.lang&&(m.lang=n.lang),n.rate!=null&&(m.rate=n.rate),n.pitch!=null&&(m.pitch=n.pitch),n.volume!=null&&(m.volume=n.volume),n.speaker&&(m.speaker=n.speaker),n.role&&(m.role=n.role),n.character&&(m.character=n.character),n.actor&&(m.actor=n.actor),n.voiceKey&&(m.voiceKey=n.voiceKey),n.ttsOptions&&typeof n.ttsOptions=="object"&&(m.ttsOptions={...n.ttsOptions}),d){const S=d(m,T.length);x(m,S)}T.push(m)}}}),!T.length){if(Array.isArray(t.text))t.text.map(n=>String(n||"").trim()).filter(Boolean).forEach(n=>{const p={text:n};if(d){const m=d(p,T.length);x(p,m)}T.push(p)});else if(typeof t.text=="string"){const n=String(t.text||"").trim();if(n){const p={text:n};if(d){const m=d(p,T.length);x(p,m)}T.push(p)}}}const ae=typeof window<"u"&&"speechSynthesis"in window?window.speechSynthesis:null,H={};if(t.lang&&(H.lang=t.lang),t.voiceName&&(H.voiceName=t.voiceName),typeof t.voice=="string"?H.voice=t.voice:t.voice&&typeof t.voice=="object"&&!Array.isArray(t.voice)&&g(t.voice)&&x(H,s(t.voice)),t.gender&&(H.gender=t.gender),t.voiceGender&&!H.voiceGender&&(H.voiceGender=t.voiceGender),typeof t.ttsOptions=="object"&&t.ttsOptions&&Object.assign(H,t.ttsOptions),typeof t.voiceOptions=="object"&&t.voiceOptions&&Object.assign(H,t.voiceOptions),typeof t.speechOptions=="object"&&t.speechOptions&&Object.assign(H,t.speechOptions),T.length&&ae){const n=e("div",{style:"margin-top:8px;display:flex;align-items:center;gap:10px;flex-wrap:wrap;"}),p=e("button",{type:"button",class:"btn primary",style:"padding:8px 14px;border-radius:8px;border:1px solid #0284c7;background:#0ea5e9;color:#fff;cursor:pointer;display:inline-flex;align-items:center;gap:6px;"},"‚ñ∂ Play");p.setAttribute("aria-pressed","false");const m=e("button",{type:"button",class:"btn secondary",style:"padding:8px 14px;border-radius:8px;border:1px solid #cbd5e1;background:#fff;color:#0f172a;cursor:pointer;display:inline-flex;align-items:center;gap:6px;"},"üëÅ –ü–æ–∫–∞–∑–∞—Ç–∏ —Ç–µ–∫—Å—Ç");m.setAttribute("aria-expanded","false");const S=(B,V,ee)=>Math.min(ee,Math.max(V,B)),$=_("speech-rate"),I=.5,j=1.5,Q=B=>{const V=Number(B);return Number.isFinite(V)?V:1};let se=S(Q(H.rate!=null?H.rate:1),I,j),Y=!1,Z=!1,U=0,ce=null,pe=!1;const we=e("div",{class:"audio-transcript",style:"display:none;margin-top:12px;padding:12px;border:1px solid #cbd5e1;border-radius:10px;background:#fff;color:#0f172a;"});T.forEach((B,V)=>{const ee=B.speaker||B.role||B.character||B.actor,tt=ee?`${ee}: ${B.text}`:B.text,nt=e("p",{style:V===0?"margin:0 0 6px 0;":"margin:6px 0 0 0;"},tt);we.appendChild(nt)});const ke=e("span",{style:"font-weight:600;min-width:42px;text-align:right;color:#0f172a;"},`${se.toFixed(1)}x`),Se=e("input",{type:"range",id:$,min:String(I),max:String(j),step:"0.1",value:String(se),style:"flex:1;"});Se.addEventListener("input",()=>{se=S(Q(Se.value),I,j),Y=!0,ke.textContent=`${se.toFixed(1)}x`});const et=e("div",{style:"display:flex;align-items:center;gap:8px;padding:6px 10px;border:1px solid #e2e8f0;border-radius:8px;background:#fff;min-width:240px;"},e("label",{for:$,style:"font-size:14px;color:#475569;"},"–®–≤–∏–¥–∫—ñ—Å—Ç—å"),Se,ke),Ne=()=>{we.style.display=pe?"block":"none",m.textContent=pe?"üôà –°—Ö–æ–≤–∞—Ç–∏ —Ç–µ–∫—Å—Ç":"üëÅ –ü–æ–∫–∞–∑–∞—Ç–∏ —Ç–µ–∫—Å—Ç",m.setAttribute("aria-expanded",pe?"true":"false")},me=()=>{Z=!1,U=0,ce&&(ce.onend=null,ce.onerror=null,ce=null),p.textContent="‚ñ∂ Play",p.setAttribute("aria-pressed","false")},Ae=async()=>{if(!Z||U>=T.length){me();return}await N();const B=T[U],V={...H};B.lang&&(V.lang=B.lang),B.voiceName&&(V.voiceName=B.voiceName),B.voice&&(V.voice=B.voice),B.gender&&(V.gender=B.gender),B.rate!=null&&(V.rate=B.rate),B.pitch!=null&&(V.pitch=B.pitch),B.volume!=null&&(V.volume=B.volume),B.ttsOptions&&typeof B.ttsOptions=="object"&&B.ttsOptions&&Object.assign(V,B.ttsOptions),(Y||V.rate==null)&&(V.rate=S(se,I,j));try{const ee=await _e(B.text,V);if(!ee){U+=1,Ae();return}ce=ee,ee.onend=()=>{Z&&(ce=null,U+=1,Ae())},ee.onerror=me}catch{me()}};p.addEventListener("click",async()=>{if(Z)ae&&ae.cancel(),me();else{if(!T.length)return;await N(),Z=!0,U=0,p.textContent="‚èπ Stop",p.setAttribute("aria-pressed","true"),Ae()}}),m.addEventListener("click",()=>{pe=!pe,Ne()}),Ne(),n.appendChild(p),n.appendChild(m),n.appendChild(et),P.length||n.appendChild(e("span",{class:"muted",style:"font-size:14px;"},"–ü—Ä–æ—Å–ª—É—Ö–∞–π—Ç–µ –¥—ñ–∞–ª–æ–≥ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —Å–∏–Ω—Ç–µ–∑—É –º–æ–≤–ª–µ–Ω–Ω—è.")),r.appendChild(n),r.appendChild(we),u=e("div",{class:"muted",style:"display:none;margin-top:6px;font-size:13px;color:#b45309;line-height:1.4;"}),w(y),r.appendChild(u),N()}else!P.length&&T.length&&r.appendChild(e("p",{class:"muted",style:"margin-top:8px;"},"–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î —Å–∏–Ω—Ç–µ–∑ –º–æ–≤–ª–µ–Ω–Ω—è."));const xe=Array.isArray(t.questions)?t.questions.filter(Boolean):[];if(!xe.length)return;const le=e("div",{style:"margin-top:16px;"}),F=[];if(xe.forEach((n,p)=>{const m=typeof n=="string"?{prompt:n}:n&&typeof n=="object"?n:{prompt:String(n)},S=m.prompt||m.q||`Question ${p+1}`,$=e("div",{style:"margin-bottom:12px;padding:12px;border:1px solid #e5e7eb;border-radius:10px;background:#fff;"},e("div",{style:"font-weight:600;margin-bottom:8px;"},S));if(m.hint&&$.appendChild(W(m.hint)),Array.isArray(m.choices)&&m.choices.length){const j=(Array.isArray(m.answer)?m.answer:m.answer!=null?[m.answer]:[]).map(Y=>String(Y)),Q=j.length>1,X=j.every(Y=>/^\d+$/.test(Y)),se=_(`${t.id||"audio"}-${p}`);m.choices.forEach((Y,Z)=>{const U=_(`${se}-${Z}`);$.appendChild(e("label",{for:U,style:"display:flex;align-items:center;gap:8px;margin:4px 0;"},e("input",{type:Q?"checkbox":"radio",name:se,id:U,value:String(Z)}),e("span",{},Y)))}),j.length&&F.push({type:"choices",block:$,getPicked:()=>{const Z=Array.from($.querySelectorAll(`input[name='${se}']`)).filter(U=>U.checked).map(U=>U.value);return X?Z:Z.map(U=>E(m.choices[Number(U)]||""))},expected:X?j.slice():j.map(Y=>E(Y))})}else{const I=e("textarea",{rows:m.rows||2,style:"width:100%;max-width:640px;padding:6px 8px;border:1px solid #cbd5e1;border-radius:6px;"});$.appendChild(I);const Q=(Array.isArray(m.answer)?m.answer:m.answer!=null?[m.answer]:Array.isArray(m.answers)?m.answers:[]).map(X=>E(X)).filter(Boolean);Q.length&&F.push({type:"text",block:$,input:I,expected:Q})}le.appendChild($)}),F.length){const n=e("div",{style:"margin-top:8px;font-weight:600;"}),p=e("button",{type:"button",class:"btn primary",style:"margin-top:8px;"},"–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏");p.addEventListener("click",()=>{let m=0;F.forEach(S=>{if(S.type==="choices"){const $=S.getPicked().sort(),I=S.expected.slice().sort(),j=$.length===I.length&&$.every((Q,X)=>Q===I[X]);S.block.style.borderColor=j?"#10b981":"#ef4444",j&&m++}else if(S.type==="text"){const $=E(S.input.value),I=S.expected.includes($);S.block.style.borderColor=I?"#10b981":"#ef4444",I&&m++}}),n.textContent=`–†–µ–∑—É–ª—å—Ç–∞—Ç: ${m}/${F.length}`}),le.appendChild(p),le.appendChild(n)}else le.appendChild(e("p",{class:"muted",style:"margin-top:4px;"},"–ó–∞–ø–∏—à—ñ—Ç—å –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ ‚Äî –≤–∏–∫–ª–∞–¥–∞—á –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç—å —ó—Ö –ø—ñ–∑–Ω—ñ—à–µ."));r.appendChild(le)}function Le(){let r=document.getElementById("practice");if(!r&&/\/grammar\//.test(location.pathname)){const t=e("div",{class:"container"});t.appendChild(e("hr",{class:"sep"})),r=e("section",{id:"practice"}),t.appendChild(r),document.body.appendChild(t)}return r}function Ye(){return e("input",{type:"checkbox",class:"check-task-status"})}function M(r,t,c){r.appendChild(e("h3",{},Ye(),t.prompt||c))}function Ze(){const r=Le();if(!r)return;let t=r.querySelector("#practice-body");if(t||(t=e("div",{id:"practice-body"}),r.appendChild(t)),(window.lessonContext||{}).isCustomLesson){const g=r.querySelector("[data-practice-placeholder]");g&&(g.textContent="–ü—Ä–∞–∫—Ç–∏–∫–∞ –¥–ª—è –∫–æ–∂–Ω–æ—ó —Ç–µ–º–∏ —Ä–æ–∑–º—ñ—â–µ–Ω–∞ –æ–¥—Ä–∞–∑—É –ø—ñ—Å–ª—è —Ç–µ–æ—Ä—ñ—ó. –¢—É—Ç –º–æ–∂–µ—Ç–µ –∑–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ –¥–æ–¥–∞—Ç–∫–æ–≤—ñ –∑–∞–≤–¥–∞–Ω–Ω—è."),t&&(t.innerHTML='<p class="muted">–ó–≥–µ–Ω–µ—Ä—É–π—Ç–µ –¥–æ–¥–∞—Ç–∫–æ–≤—ñ –≤–ø—Ä–∞–≤–∏ –∞–±–æ –¥–æ–¥–∞–π—Ç–µ –≤–ª–∞—Å–Ω—ñ –∑–∞–≤–¥–∞–Ω–Ω—è.</p>'),document.dispatchEvent(new CustomEvent("practice:dataLoaded",{detail:null})),document.dispatchEvent(new CustomEvent("practice:rendered",{detail:{ok:!1,reason:"custom-lesson"}}));return}ze().then(g=>{if(!g){document.dispatchEvent(new CustomEvent("practice:dataLoaded",{detail:null})),t.innerHTML='<p class="muted">–ü—Ä–∞–∫—Ç–∏–∫–∞ –ø–æ–∫–∏ –≤—ñ–¥—Å—É—Ç–Ω—è.</p>',document.dispatchEvent(new CustomEvent("practice:rendered",{detail:{ok:!1}}));return}t.innerHTML="";const h=e("div",{},e("h2",{},"Practice ",e("span",{class:"badge"},g.level||"B1")),g.title?e("p",{class:"muted"},g.title):null);t.appendChild(h);const s=(g.tasks||[]).map((o,i)=>({key:o&&o.id?String(o.id):`base-${i}`,task:o}));document.dispatchEvent(new CustomEvent("practice:dataLoaded",{detail:{title:g.title,level:g.level,entries:s}})),s.forEach(({task:o,key:i})=>re(t,o,i)),document.dispatchEvent(new CustomEvent("practice:rendered",{detail:{ok:!0}}))})}return(typeof window<"u"&&window.practiceConfig||{}).disableAutoInit||document.addEventListener("DOMContentLoaded",Ze),window.practice=window.practice||{},Object.assign(window.practice,{appendTask:q,renderTaskList:oe,createTaskElement:he}),{appendTask:q,renderTaskList:oe,createTaskElement:he}}(),It=Te.createTaskElement,jt=Te.renderTaskList;document.addEventListener("click",a=>{const f=a.target.closest(".text-block");if(f){const C=f.innerHTML;navigator.clipboard.writeText(`<div class="text-block">${C}</div>`),console.log("–°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ")}});export{Nt as a,Lt as b,It as c,yt as d,ot as e,ne as f,rt as g,Ot as h,bt as i,kt as j,jt as r,dt as s};
//# sourceMappingURL=practice-DfYP_Pn8.js.map
