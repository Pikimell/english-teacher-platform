import{s as $,l,b as L,a as I}from"./custom-lessons-store-ClPKfKWc.js";import{a as A,c as y}from"./auth-Y9Je3ray.js";const n={search:"",category:"all",level:"all"},h=document.querySelector('[data-filter="search"]'),v=document.querySelector('[data-filter="level"]'),C=Array.from(document.querySelectorAll("[data-category]")),d=document.querySelector("[data-lessons-section]"),p=document.querySelector("[data-lessons-grid]"),f=document.querySelector("[data-lessons-empty]"),c={total:document.querySelector("[data-stat-total]"),grammar:document.querySelector("[data-stat-grammar]"),lexical:document.querySelector("[data-stat-lexical]")};A.init();function m(e){return e.trim().toLowerCase()}function g(e){return String(e??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function S(){C.forEach(e=>{const t=e.dataset.category===n.category,r=e.dataset.category==="all"?n.category==="all":t;e.classList.toggle("chip--filled",r),e.setAttribute("aria-pressed",String(r))})}function x(e){var s;const t=((s=L[e.category])==null?void 0:s.label)??e.category,a=`lesson.html?topic=${encodeURIComponent(e.id)}&category=${encodeURIComponent(e.category)}&level=${encodeURIComponent(e.level)}&title=${encodeURIComponent(e.title)}&file=${encodeURIComponent(e.htmlPath)}`,r=Array.isArray(e.tags)?e.tags:[];return`
    <article class="lesson-card" data-lesson-id="${e.id}" data-category="${e.category}" data-level="${e.level}">
      <a class="lesson-card__link" href="${a}">
        <div class="lesson-card__meta">
          <span class="lesson-card__category">${t}</span>
          <span class="lesson-card__level" aria-label="Рівень">${e.level}</span>
        </div>
        <h3 class="lesson-card__title">${e.title}</h3>
        <p class="lesson-card__description">${e.description}</p>
        ${r.length?`<ul class="lesson-card__tags">${r.map(o=>`<li>${o}</li>`).join("")}</ul>`:""}
        <span class="lesson-card__cta">Перейти до матеріалу</span>
      </a>
    </article>
  `}function _(e){const t=(e.topicIds||[]).map(o=>l.find(u=>u.id===o)).filter(Boolean),a=Array.from(new Set(t.map(o=>o.level))).sort(),r=t.filter(o=>o.category==="grammar").length,s=t.filter(o=>o.category==="lexical").length;return{topics:t,levels:a,grammarCount:r,lexicalCount:s}}function k(e,t=_(e)){const a=e.description||t.topics.map(o=>o.title).slice(0,3).join(", "),r=e.level||(t.levels.length?t.levels.join(", "):"мікси рівнів"),s=[];return r&&s.push(`Рівні: ${g(r)}`),t.grammarCount&&s.push(`Граматика: ${t.grammarCount}`),t.lexicalCount&&s.push(`Лексика: ${t.lexicalCount}`),`
    <article class="lesson-card lesson-card--custom" data-custom-lesson-id="${e.id}" data-custom-source="${e.source||"local"}">
      <a class="lesson-card__link" href="lesson.html?custom=${encodeURIComponent(e.id)}">
        
       <h3 class="lesson-card__title">${g(e.title)}</h3>
        ${s.length?`<p class="lesson-card__meta">${s.join(" · ")}</p>`:""}
        <p class="lesson-card__description">${g(a||"Урок містить кілька тем.")}</p>
        
        <span class="lesson-card__cta">Відкрити комбінований урок</span>
      </a>
    </article>
  `}function q(){return Array.isArray(y)?y.filter(e=>e&&typeof e=="object"&&e.id).map((e,t)=>({...e,topicIds:Array.isArray(e.topicIds)?[...e.topicIds]:[],source:"preset",sortIndex:t})):[]}function T(){return I().filter(e=>e&&typeof e=="object"&&e.id).map((e,t)=>({...e,topicIds:Array.isArray(e.topicIds)?[...e.topicIds]:[],source:"local",sortIndex:1e3+t}))}function b(){const e=new Map;return q().forEach(t=>{e.has(t.id)||e.set(t.id,t)}),T().forEach(t=>{e.set(t.id,t)}),Array.from(e.values())}function E(){const e=s=>{const o=s?new Date(s).getTime():0;return Number.isFinite(o)?o:0},a=b().slice().sort((s,o)=>{const u=e(o.createdAt)-e(s.createdAt);return u!==0?u:(s.sortIndex||0)-(o.sortIndex||0)}).map(s=>{const o=_(s);return{type:"custom",lesson:s,meta:o}}),r=l.map(s=>({type:"catalog",lesson:s}));return[...a,...r]}function R(e){return n.category==="all"?!0:e.type==="catalog"?e.lesson.category===n.category:!1}function j(e){var r;if(n.level==="all")return!0;if(e.type==="catalog")return e.lesson.level===n.level;const t=e.lesson.level;return t?t===n.level:(((r=e.meta)==null?void 0:r.levels)??[]).includes(n.level)}function M(e,t){const r=((t==null?void 0:t.topics)??[]).flatMap(s=>[s.title,s.description,...s.tags||[]].filter(Boolean));return[e.title,e.description,...e.tags||[],e.level,...r].filter(Boolean).map(s=>m(String(s)))}function B(e,t){return t?e.type==="catalog"?[e.lesson.title,e.lesson.description,...e.lesson.tags??[]].filter(Boolean).map(s=>m(String(s))).some(s=>s.includes(t)):M(e.lesson,e.meta).some(r=>r.includes(t)):!0}function U(){const e=E(),t=m(n.search);return e.filter(a=>!R(a)||!j(a)?!1:B(a,t))}function i(){if(!p||!f)return;const e=U();if(!e.length){p.innerHTML="",f.hidden=!1,d&&(d.dataset.hasResults="false");return}const t=e.map(a=>a.type==="custom"?k(a.lesson,a.meta):x(a.lesson)).join("");p.innerHTML=t,f.hidden=!0,d&&(d.dataset.hasResults="true")}function w(){c.total&&(c.total.textContent=String(l.length)),c.grammar&&(c.grammar.textContent=String(l.filter(e=>e.category==="grammar").length)),c.lexical&&(c.lexical.textContent=String(l.filter(e=>e.category==="lexical").length))}function P(e){n.search=e.target.value,i()}function D(e){n.level=e.target.value,i()}function H(e){const t=e.currentTarget.dataset.category;t&&(n.category=t,S(),i())}function Y(){const e=document.querySelector('[data-component="copyright-year"]');e&&(e.textContent=String(new Date().getFullYear()))}function F(){w(),S(),i(),Y(),h&&h.addEventListener("input",P),v&&v.addEventListener("change",D),C.forEach(e=>{e.addEventListener("click",H)}),$(()=>{i()})}F();
//# sourceMappingURL=catalog-B3s8-Oce.js.map
