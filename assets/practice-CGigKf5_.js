import{i as G,a as te}from"./auth-CUcfS-ao.js";const Se=async(l=1,h=1e3)=>(await G.get("/user")).data,K={},Ue=async l=>{const h=JSON.stringify(l),w=K[h];if(w)return w;const e=await G.post("/homework/list",l);return K[h]=e.data,e.data},Ae=async l=>(await G.post("/homework",l)).data;function Ee(l,h){const e=l.items.find(k=>k._id===h.taskId).answers,$=e.findIndex(k=>k.name==h.name);$>=0?e[$]=h:e.push(h);const S={taskId:h.taskId,answers:e};return Y(S)}function $e(l,h){if(h.type==="radio")return Ee(l,h);const e=l.items.find(k=>k._id===h.taskId).answers,$=e.findIndex(k=>k.inputId==h.inputId),S={taskId:h.taskId,answers:e};return $>=0?e[$]=h:e.push(h),Y(S)}const Ve=async l=>{const h=Object.keys(K);let w=K[h[0]];if(w)$e(w,l);else{const e={taskId:l.taskId,answers:[l]};return Y(e)}},Y=async({taskId:l,...h})=>(await G.patch(`/homework/${l}`,h)).data,Ge=async l=>{const h={page:1,limit:100,userEmail:l},w=await G.post("/homework/lessons",h),{data:e}=w;return e.items=e.items.reverse(),e.items},N={users:null,request:null,active:null};function Le(){return N.users?Promise.resolve(N.users):(N.request||(N.request=Se().then(l=>{const h=Array.isArray(l==null?void 0:l.items)?l.items:[];return N.users=h,h}).catch(l=>{throw console.error("Не вдалося завантажити список студентів",l),l}).finally(()=>{N.request=null})),N.request)}function ke(l){if(!l||typeof l!="object")return"Невідомий студент";const h=l.firstName||l.firstname||l.nameFirst||"",w=l.lastName||l.lastname||l.nameLast||"";return[h,w].map(S=>String(S||"").trim()).filter(Boolean).join(" ")||l.displayName||l.fullName||l.username||l.email||(l.id?`ID ${l.id}`:"")||"Без імені"}function W(){if(!N.active)return;const{panel:l,button:h}=N.active;l.style.display="none",l.dataset.open="false",h.setAttribute("aria-expanded","false"),N.active=null}const X=new Set;let Q=!1;function ne(l){const{button:h,panel:w}=l;if(!(!h||!w)){if(!h.isConnected&&!w.isConnected){X.delete(l);return}if(Q){h.hidden=!1;return}h.hidden=!0,w.style.display="none",w.dataset.open="false"}}function Ie(l,h){const w={button:l,panel:h};return X.add(w),ne(w),()=>{X.delete(w)}}function Oe(l){const h=!!l;Q!==h&&(Q=h,Q||W(),X.forEach(w=>ne(w)))}function Ne(l){if(!N.active)return;const{panel:h,button:w}=N.active,e=l.target;h.contains(e)||w.contains(e)||W()}function Be(l){l.key==="Escape"&&W()}document.addEventListener("click",Ne);document.addEventListener("keydown",Be);function D(l,h={},...w){const e=document.createElement(l);for(const[$,S]of Object.entries(h||{}))$==="class"?e.className=S:$==="html"?e.innerHTML=S:$.startsWith("on")&&typeof S=="function"?e.addEventListener($.slice(2),S):e.setAttribute($,S);for(const $ of w)$!=null&&e.appendChild(typeof $=="string"?document.createTextNode($):$);return e}const V={triggerLabel:"Надіслати",triggerClassName:"practice-share-trigger for-admin js-share-homework-btn",triggerStyle:"border:none;background:#2563eb;color:#fff;padding:4px 10px;border-radius:999px;font-size:12px;line-height:1;cursor:pointer;box-shadow:0 4px 12px rgba(37,99,235,0.24);",panelClassName:"practice-share-panel",panelStyle:"position:absolute;top:38px;right:0;min-width:240px;max-width:280px;border:1px solid #e2e8f0;border-radius:12px;background:#fff;box-shadow:0 18px 40px rgba(15,23,42,0.18);padding:8px;z-index:30;display:none;",emptyMessage:"Список студентів порожній",loadingMessage:"Завантаження…",errorMessage:"Не вдалося завантажити студентів. Спробуйте ще раз.",formatStudentName:ke,fetchStudents:Le,getContext:null,onShare:()=>{},renderDetails:l=>l!=null&&l.email?D("span",{class:"muted",style:"font-size:12px;color:#475569;"},l.email):null};function _e(l={}){const h={...V,...l};return h.fetchStudents=typeof l.fetchStudents=="function"?l.fetchStudents:V.fetchStudents,h.formatStudentName=typeof l.formatStudentName=="function"?l.formatStudentName:V.formatStudentName,h.renderDetails=typeof l.renderDetails=="function"?l.renderDetails:V.renderDetails,h.onShare=typeof l.onShare=="function"?l.onShare:V.onShare,h.getContext=typeof l.getContext=="function"?l.getContext:()=>l.context,h}function Pe(l,h,w){if(l.innerHTML="",!h.length){l.appendChild(D("div",{class:"muted",style:"font-size:13px;text-align:center;padding:12px 8px;"},w.emptyMessage));return}const e=D("ul",{style:"list-style:none;margin:0;padding:0;max-height:220px;overflow:auto;"}),$=typeof w.getContext=="function"?w.getContext:V.getContext;h.forEach(S=>{const k=D("button",{type:"button",style:"width:100%;background:transparent;border:none;text-align:left;padding:8px 10px;border-radius:8px;cursor:pointer;display:flex;flex-direction:column;gap:2px;",onmouseenter:()=>{k.style.backgroundColor="#f1f5f9"},onmouseleave:()=>{k.style.backgroundColor="transparent"},onclick:()=>{const B=typeof $=="function"?$(S):void 0;try{const I=w.onShare({student:S,context:B});if(I&&typeof I.then=="function"){k.disabled=!0,Promise.resolve(I).then(j=>{j!==!1&&W()}).catch(j=>{console.error("Помилка під час надсилання завдання",j),W()}).finally(()=>{k.disabled=!1});return}I!==!1&&W()}catch(I){console.error("Помилка під час надсилання завдання",I),W()}}},D("span",{style:"font-size:14px;font-weight:600;color:#0f172a;"},w.formatStudentName(S)),w.renderDetails?w.renderDetails(S):null),L=D("li",{style:"margin:0;padding:0;"},k);e.appendChild(L)}),l.appendChild(e)}function Te(l){return D("div",{class:l.panelClassName,role:"dialog","aria-label":"Надсилання завдання студенту",style:l.panelStyle,"data-open":"false"})}function je(l,h,w){if(h.dataset.open==="true"){W();return}N.active&&N.active.panel!==h&&W(),h.dataset.open="true",h.style.display="block",l.setAttribute("aria-expanded","true"),h.innerHTML="",h.appendChild(D("div",{class:"muted",style:"font-size:13px;padding:12px 8px;text-align:center;"},w.loadingMessage)),N.active={panel:h,button:l},Promise.resolve(w.fetchStudents()).then($=>{Pe(h,Array.isArray($)?$:[],w)}).catch(()=>{h.innerHTML="",h.appendChild(D("div",{style:"color:#ef4444;font-size:13px;text-align:center;padding:12px 8px;"},w.errorMessage))})}function qe(l,h){const w=D("button",{type:"button",class:h.triggerClassName,title:"Надіслати студенту","aria-haspopup":"dialog","aria-expanded":"false",style:h.triggerStyle,onclick:e=>{e.preventDefault(),je(w,l,h)}},h.triggerLabel);return w}function ze(l={}){const h=_e(l),w=Te(h),e=qe(w,h),$=Ie(e,w);return{button:e,panel:w,unregister:$}}function Me(l){return!!(N.active&&N.active.panel===l)}function Re(){return new Promise(l=>{const h=speechSynthesis.getVoices();if(h.length)return l(h);speechSynthesis.onvoiceschanged=()=>l(speechSynthesis.getVoices())})}function z(l){return String(l||"").trim().toLowerCase()}function De(l,h={}){if(!Array.isArray(l)||!l.length)return null;const{lang:w="en",voiceName:e,voice:$,voiceGender:S,gender:k}=h,L=z(w)||"en",B=e||($&&/\s/.test(String($))?String($):null),j=z(k||S||!B&&$||null);let T=B&&l.find(O=>O.name===B)||B&&l.find(O=>z(O.name)===z(B))||null;const J=O=>{if(!j)return!1;const q=z(O.name),U=z(O.voiceURI);return j==="male"?q.includes("male")||U.includes("male")||/\bmale\b|\bman\b|\bboy\b|m\d/.test(q):j==="female"?q.includes("female")||U.includes("female")||q.includes("woman")||q.includes("girl"):q.includes(j)||U.includes(j)},H=l.filter(O=>z(O.lang).startsWith(L));if(!T&&j&&(T=H.find(J)||l.find(J)||null),!T&&B&&z(B)){const O=z(B);T=H.find(q=>z(q.name).includes(O))||l.find(q=>z(q.name).includes(O))||null}return T||(T=H.find(O=>z(O.name).includes("female"))||H[0]||l.find(O=>z(O.name).includes("female"))||l[0]||null),T||null}async function re(l,{lang:h="en",voiceName:w,voice:e,voiceGender:$,gender:S,rate:k=1,pitch:L=1,volume:B=1}={}){await Re();const I=new SpeechSynthesisUtterance(l),j=speechSynthesis.getVoices(),T=De(j,{lang:h,voiceName:w,voice:e,voiceGender:$,gender:S});return T?(I.voice=T,I.lang=T.lang||h||"en"):I.lang=h||"en",I.rate=k,I.pitch=L,I.volume=B,speechSynthesis.cancel(),speechSynthesis.speak(I),I}function Je(l){const h=document.createElement("span");return h.textContent="🔊",h.addEventListener("click",()=>{re(l)}),h.classList.add("play-speak-btn"),h}const We={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1},oe=function(){const l=typeof import.meta<"u"&&We&&"/"||"/";function h(r){const t=l.endsWith("/")?l:`${l}/`,d=String(r||"");return/^[a-z]+:/i.test(d)||d.startsWith(t)?d:`${t}${d.replace(/^\/+/,"")}`}function w(){try{const t=new URL(window.location.href).pathname.split("/");let d=t.pop();(!d||!/\.html?$/i.test(d))&&(d="index.html");const u=d.replace(/\.html?$/i,".json");return t.push("practice",u),t.join("/")}catch{return null}}function e(r,t={},...d){const u=document.createElement(r);for(const[f,i]of Object.entries(t||{}))f==="class"?u.className=i:f==="html"?u.innerHTML=i:f.startsWith("on")&&typeof i=="function"?u.addEventListener(f.slice(2),i):u.setAttribute(f,i);for(const f of d)f!=null&&u.appendChild(typeof f=="string"?document.createTextNode(f):f);return u}function $(r){const t=r.slice();for(let d=t.length-1;d>0;d--){const u=Math.floor(Math.random()*(d+1));[t[d],t[u]]=[t[u],t[d]]}return t}function S(r){return String(r||"").trim().toLowerCase().replace(/\s+/g," ")}let k=0;function L(r="practice-input"){return k+=1,`${String(r||"practice-input").trim().replace(/[^a-z0-9_-]+/gi,"-").replace(/^-+|-+$/g,"")||"practice-input"}-${k}`}te.subscribe(({user:r})=>{Oe(te.isAdmin(r))});function B(r){const t=e("div",{class:"hint-wrap",style:"margin-top:6px;"}),d=e("button",{type:"button",class:"hint-toggle","aria-label":"Показати підказку",title:"Підказка",style:"border:none;background:transparent;color:#94a3b8;cursor:pointer;padding:0;font-size:14px;line-height:1;"},"?"),u=e("div",{class:"hint-box muted",style:"display:none;margin-top:6px;color:#475569;"},`Підказка: ${r}`);return d.addEventListener("click",()=>{const f=u.style.display==="none";u.style.display=f?"block":"none",d.setAttribute("aria-expanded",f?"true":"false")}),t.appendChild(d),t.appendChild(u),t}function I(r,t){r.appendChild(e("h3",{},t.prompt||"Choose the correct option"));const d=[];(t.items||[]).forEach((i,n)=>{const o=`${t.id||"mcq"}-${n}`,x=Array.isArray(i.answer)&&i.answer.length>1,s=e("div",{class:"mcq-item",style:"margin-bottom:10px;padding:10px;border:1px solid #e5e7eb;border-radius:10px;background:#fff;"},e("div",{class:"q",style:"margin-bottom:8px;font-weight:600;"},i.q));(i.choices||[]).forEach((p,c)=>{const a=L(`${o}-${c}`),y=e("label",{for:a,style:"display:flex;align-items:center;gap:8px;margin:4px 0;"},e("input",{type:x?"checkbox":"radio",name:o,id:a,value:String(c)}),e("span",{},p));s.appendChild(y)}),i.explanation&&s.appendChild(e("div",{class:"exp muted",style:"display:none;margin-top:6px;color:#475569;"},i.explanation)),d.push({block:s,item:i,name:o}),r.appendChild(s)});const u=e("div",{class:"result",style:"margin-top:8px;font-weight:600;"}),f=e("button",{type:"button",class:"btn primary",style:"margin-top:8px;"},"Перевірити");f.addEventListener("click",()=>{let i=0;d.forEach(({block:n,item:o,name:x})=>{const s=Array.isArray(o.answer)?o.answer.map(String):[String(o.answer)],c=Array.from(n.querySelectorAll(`input[name='${x}']`)).filter(g=>g.checked).map(g=>g.value).sort(),a=s.slice().sort(),y=c.length===a.length&&c.every((g,C)=>g===a[C]);n.style.borderColor=y?"#10b981":"#ef4444";const b=n.querySelector(".exp");b&&(b.style.display=y?"none":"block"),y&&i++}),u.textContent=`Результат: ${i}/${d.length}`}),r.appendChild(f),r.appendChild(u)}function j(r,t){r.appendChild(e("h3",{},t.prompt||"Fill the gaps"));const d=[];(t.items||[]).forEach((i,n)=>{const o=e("div",{style:"margin-bottom:10px;padding:10px;border:1px solid #e5e7eb;border-radius:10px;background:#fff;"}),x=String(i.q||"").split(/___/),s=L(`${t.id||"gap"}-${n}`),p=e("input",{type:"text",id:s,style:"padding:6px 8px;border:1px solid #cbd5e1;border-radius:6px;"});x.length>1?(o.appendChild(e("span",{},x[0])),o.appendChild(p),o.appendChild(e("span",{},x.slice(1).join("___")))):(o.appendChild(e("div",{style:"margin-bottom:6px;font-weight:600;"},i.q)),o.appendChild(p)),i.hint&&o.appendChild(B(i.hint)),d.push({row:o,input:p,answers:(i.answer||[]).map(c=>S(c))}),r.appendChild(o)});const u=e("div",{style:"margin-top:8px;font-weight:600;"}),f=e("button",{type:"button",class:"btn primary",style:"margin-top:8px;"},"Перевірити");f.addEventListener("click",()=>{let i=0;d.forEach(({row:n,input:o,answers:x})=>{const s=S(o.value),p=x.includes(s);n.style.borderColor=p?"#10b981":"#ef4444",p&&i++}),u.textContent=`Результат: ${i}/${d.length}`}),r.appendChild(f),r.appendChild(u)}function T(r,t){r.appendChild(e("h3",{},t.prompt||"Match pairs"));const d=t.pairs||[],u=$(d.map(o=>o.right)),f=[];d.forEach((o,x)=>{const s=L(`${t.id||"match"}-${x}`),p=e("select",{id:s,style:"padding:6px 8px;border:1px solid #cbd5e1;border-radius:6px;"},e("option",{value:""},"— обери —"),...u.map(a=>e("option",{value:a},a))),c=e("div",{style:"display:flex;align-items:center;gap:10px;margin:8px 0;padding:10px;border:1px solid #e5e7eb;border-radius:10px;background:#fff;"},e("label",{for:s,style:"min-width:160px;font-weight:600;"},o.left),p);f.push({row:c,select:p,right:o.right}),r.appendChild(c)});const i=e("div",{style:"margin-top:8px;font-weight:600;"}),n=e("button",{type:"button",class:"btn primary",style:"margin-top:8px;"},"Перевірити");n.addEventListener("click",()=>{let o=0;f.forEach(({row:x,select:s,right:p})=>{const c=s.value===p;x.style.borderColor=c?"#10b981":"#ef4444",c&&o++}),i.textContent=`Результат: ${o}/${f.length}`}),r.appendChild(n),r.appendChild(i)}function J(r,t){r.appendChild(e("h3",{},t.prompt||"Прочитайте текст та дайте відповіді"));const d=t.context||{},u=String(d.format||"narrative").toLowerCase(),f=Array.isArray(d.body)?d.body:[],i=e("div",{style:"margin:12px 0;padding:14px;border:1px solid #cbd5e1;border-radius:10px;background:#f8fafc;"});d.title&&i.appendChild(e("h4",{style:"margin:0 0 8px;font-size:18px;"},d.title)),u==="dialog"?f.forEach(p=>{if(!p)return;const c=typeof p=="object"&&p.speaker?`${p.speaker}:`:"",a=typeof p=="object"&&"line"in p?p.line:typeof p=="string"?p:"";i.appendChild(e("p",{style:"margin:4px 0;display:flex;gap:6px;align-items:flex-start;line-height:1.5;"},c?e("strong",{},c):null,e("span",{},a)))}):f.forEach((p,c)=>{const a=typeof p=="string"?p:p&&p.text?p.text:"";a&&i.appendChild(e("p",{style:c?"margin:8px 0 0;":"margin:0;"},a))}),r.appendChild(i);const n=Array.isArray(t.questions)?t.questions:[];if(!n.length)return;const o=[];n.forEach((p,c)=>{const a=e("div",{style:"margin-bottom:8px;font-weight:600;"},p.q||`Питання ${c+1}`),y=e("div",{style:"margin-bottom:12px;padding:12px;border:1px solid #e5e7eb;border-radius:10px;background:#fff;"},a),b=Array.isArray(p.answer)?p.answer.map(String):p.answer!=null?[String(p.answer)]:[];if(Array.isArray(p.choices)&&p.choices.length){const g=`${t.id||"context"}-${c}`,C=b.length>1,A=b.every(m=>/^\d+$/.test(m));p.choices.forEach((m,v)=>{const E=L(`${g}-${v}`);y.appendChild(e("label",{for:E,style:"display:flex;align-items:center;gap:8px;margin:4px 0;"},e("input",{type:C?"checkbox":"radio",name:g,id:E,value:String(v)}),e("span",{},m)))}),o.push({block:y,type:"choices",allowMulti:C,getPicked:()=>{const v=Array.from(y.querySelectorAll(`input[name='${g}']`)).filter(E=>E.checked).map(E=>E.value);return A?v:v.map(E=>S(p.choices[Number(E)]||""))},expected:A?b:b.map(m=>S(m))})}else{const g=L(`${t.id||"context-label"}-${c}`);a.setAttribute("id",g);const C=L(`${t.id||"context-text"}-${c}`),A=e("textarea",{id:C,rows:2,style:"width:100%;max-width:640px;padding:6px 8px;border:1px solid #cbd5e1;border-radius:6px;"});A.setAttribute("aria-labelledby",g),y.appendChild(A),o.push({block:y,type:"text",input:A,expected:b.map(m=>S(m))})}p.explanation&&y.appendChild(e("div",{class:"muted",style:"display:none;margin-top:6px;color:#475569;"},p.explanation)),r.appendChild(y)});const x=e("div",{style:"margin-top:8px;font-weight:600;"}),s=e("button",{type:"button",class:"btn primary",style:"margin-top:8px;"},"Перевірити");s.addEventListener("click",()=>{let p=0;o.forEach(c=>{let a=!1;if(c.type==="choices"){const b=c.getPicked().sort(),g=c.expected.slice().sort();a=b.length===g.length&&b.every((C,A)=>C===g[A])}else{const b=S(c.input.value);a=c.expected.length?c.expected.includes(b):!!b}c.block.style.borderColor=a?"#10b981":"#ef4444";const y=c.block.querySelector(".muted");y&&(y.style.display=a?"none":"block"),a&&p++}),x.textContent=`Результат: ${p}/${o.length}`}),r.appendChild(s),r.appendChild(x)}function H(r,t,d,u={}){const{showRemove:f=!0}=u,i=d||(t&&t.id?String(t.id):`task-${Math.random().toString(16).slice(2,8)}`),n=e("section",{style:"position:relative;margin:18px 0 26px;","data-task-id":t&&t.id?String(t.id):"","data-task-key":i}),o=e("div",{style:"position:absolute;top:6px;right:6px;display:flex;gap:6px;align-items:center;z-index:5;"}),{button:x,panel:s,unregister:p}=ze({context:t,onShare:({student:y,context:b})=>{const g=window.location.search.slice(8),C=document.querySelector("h1"),A=C?C.textContent:"",m={lessonId:g,userEmail:y.email,lessonName:A,homeworkType:"task",homeworkData:JSON.stringify(b)};return Ae(m)}});if(o.appendChild(x),f){const y=e("button",{type:"button",title:"Видалити завдання","aria-label":"Видалити завдання",class:"for-admin",style:"border:none;background:transparent;color:#94a3b8;cursor:pointer;padding:2px;line-height:1;font-size:14px;opacity:0.6;",onmouseenter:()=>y.style.opacity="1",onmouseleave:()=>y.style.opacity="0.6",onclick:()=>{Me(s)&&W(),document.dispatchEvent(new CustomEvent("practice:taskRemoved",{detail:{key:i,task:t}})),p(),n.remove()}},"✕");o.appendChild(y)}n.appendChild(o),n.appendChild(s),t.title&&n.appendChild(e("h3",{},t.title));const c=t&&t.type;switch(String(c||"").trim().toLowerCase()){case"mcq":I(n,t);break;case"gap":j(n,t);break;case"match":T(n,t);break;case"context":J(n,t);break;case"transform":se(n,t);break;case"error":ae(n,t);break;case"order":de(n,t);break;case"short":le(n,t);break;case"roleplay":ce(n,t);break;case"dialogue-gap":fe(n,t);break;case"dialogue-order":ue(n,t);break;case"truefalse":he(n,t);break;case"definition-match":{const y={...t,prompt:t.prompt||"Поєднай слово з визначенням"};T(n,y);break}case"synonym-clue":ge(n,t);break;case"scramble":xe(n,t);break;case"wordpairs":{const y={...t,prompt:t.prompt||"Поєднай форму в однині та множині"};T(n,y);break}case"odd-one-out":ye(n,t);break;case"open":pe(n,t);break;case"writing":be(n,t);break;case"audio":me(n,t);break;default:n.appendChild(e("div",{class:"muted"},`Невідомий тип завдання: ${c}`))}return r.appendChild(n),n}function O(r,t={}){const d=ee();if(!d||!r)return;const u=d.querySelector("#practice-body")||d,f=t.showRemove!==!1;H(u,r,t.key,{showRemove:f})}function q(r,t,d={}){if(!r)return null;const u=Array.isArray(t)?t.filter(Boolean):[],{title:f,level:i,description:n,keyPrefix:o="inline",showEmptyNote:x=!1,showRemove:s=!1}=d;if(!u.length){if(x){const c=e("p",{class:"muted practice-inline__empty"},"Практика для цієї теми поки відсутня.");r.appendChild(c)}return null}const p=e("section",{class:"practice-inline"});if(f||i||n){const c=e("header",{class:"practice-inline__header"});f&&c.appendChild(e("h3",{class:"practice-inline__title"},f)),i&&c.appendChild(e("span",{class:"practice-inline__badge"},i)),n&&c.appendChild(e("p",{class:"practice-inline__description muted"},n)),p.appendChild(c)}return u.forEach((c,a)=>{const y=`${o}-${a}`;H(p,c,y,{showRemove:s})}),r.appendChild(p),document.dispatchEvent(new CustomEvent("practice:inlineRendered",{detail:{tasks:u,container:r,options:d}})),p}function U(r,t={}){if(!r)return null;const d=document.createDocumentFragment(),u=t.showRemove!==!1;return H(d,r,t.key,{showRemove:u})}async function Z(r){if(!r)return null;const t=h(r);try{const d=await fetch(t,{cache:"no-store"});return d.ok?await d.json():null}catch{return null}}async function ie(){const r=document.getElementById("practice-data");if(r)try{return JSON.parse(r.textContent)}catch{return null}const t=window.lessonContext||{},d=new Set;if(t.id&&d.add(`data/practice/${t.id}.json`),t.htmlPath){const f=String(t.htmlPath).replace(/^\.\/?/,"").replace(/\.html?$/i,"");if(f){d.add(`data/practice/${f}.json`);const i=f.split("/"),n=i[i.length-1];n&&d.add(`data/practice/${n}.json`)}}for(const f of d){const i=await Z(f);if(i)return i}const u=w();return u?await Z(u):null}function se(r,t){r.appendChild(e("h3",{},t.prompt||"Transform the sentence"));const d=[];(t.items||[]).forEach((i,n)=>{const o=e("div",{style:"margin-bottom:10px;padding:10px;border:1px solid #e5e7eb;border-radius:10px;background:#fff;"});o.appendChild(e("div",{style:"margin-bottom:6px;font-weight:600;"},i.q));const x=L(`${t.id||"transform"}-${n}`),s=e("input",{type:"text",id:x,style:"width:100%;max-width:640px;padding:6px 8px;border:1px solid #cbd5e1;border-radius:6px;"});o.appendChild(s),i.hint&&o.appendChild(B(i.hint)),d.push({row:o,input:s,answers:(i.answer||[]).map(p=>S(p))}),r.appendChild(o)});const u=e("div",{style:"margin-top:8px;font-weight:600;"}),f=e("button",{type:"button",class:"btn primary",style:"margin-top:8px;"},"Перевірити");f.addEventListener("click",()=>{let i=0;d.forEach(({row:n,input:o,answers:x})=>{const s=x.includes(S(o.value));n.style.borderColor=s?"#10b981":"#ef4444",s&&i++}),u.textContent=`Результат: ${i}/${d.length}`}),r.appendChild(f),r.appendChild(u)}function ae(r,t){r.appendChild(e("h3",{},t.prompt||"Find and correct the error"));const d=[];(t.items||[]).forEach((i,n)=>{const o=e("div",{style:"margin-bottom:10px;padding:10px;border:1px solid #e5e7eb;border-radius:10px;background:#fff;"});o.appendChild(e("div",{style:"margin-bottom:6px;font-weight:600;"},i.q));const x=L(`${t.id||"error"}-${n}`),s=e("input",{type:"text",id:x,style:"width:100%;max-width:640px;padding:6px 8px;border:1px solid #cbd5e1;border-radius:6px;"});o.appendChild(s),i.hint&&o.appendChild(B(i.hint)),d.push({row:o,input:s,answers:(i.answer||[]).map(p=>S(p))}),r.appendChild(o)});const u=e("div",{style:"margin-top:8px;font-weight:600;"}),f=e("button",{type:"button",class:"btn primary",style:"margin-top:8px;"},"Перевірити");f.addEventListener("click",()=>{let i=0;d.forEach(({row:n,input:o,answers:x})=>{const s=x.includes(S(o.value));n.style.borderColor=s?"#10b981":"#ef4444",s&&i++}),u.textContent=`Результат: ${i}/${d.length}`}),r.appendChild(f),r.appendChild(u)}function de(r,t){r.appendChild(e("h3",{},t.prompt||"Put the words in order"));const d=[];(t.items||[]).forEach((i,n)=>{const o=S(Array.isArray(i.answer)?i.answer.join(" "):i.answer),x=$((i.tokens||[]).slice()),s=e("div",{style:"margin:10px 0;padding:10px;border:1px solid #e5e7eb;border-radius:10px;background:#fff;"}),p=e("div",{style:"display:flex;flex-wrap:wrap;gap:6px;margin-bottom:6px;"}),c=e("div",{style:"display:flex;flex-wrap:wrap;gap:6px;min-height:36px;padding:6px;border:1px dashed #cbd5e1;border-radius:8px;background:#f8fafc;"}),a=new Set;function y(C,A){const m=e("button",{type:"button",style:"padding:4px 8px;border:1px solid #cbd5e1;border-radius:6px;background:#fff;cursor:pointer;"},C);return m.addEventListener("click",()=>{a.has(A)||(a.add(A),m.style.opacity=.5,c.appendChild(e("span",{class:"chip",style:"padding:4px 8px;border:1px solid #cbd5e1;border-radius:6px;background:#fff;"},C)))}),m}x.forEach((C,A)=>p.appendChild(y(C,`${n}-${A}`)));const b=e("div",{style:"margin-top:6px;display:flex;gap:8px;"}),g=e("button",{type:"button",class:"btn"},"Скинути");g.addEventListener("click",()=>{a.clear(),c.innerHTML="",Array.from(p.children).forEach(C=>C.style.opacity=1),s.style.borderColor="#e5e7eb"}),b.appendChild(g),s.appendChild(e("div",{style:"margin-bottom:6px;font-weight:600;"},i.q||"")),s.appendChild(p),s.appendChild(c),s.appendChild(b),d.push({row:s,outWrap:c,correctStr:o}),r.appendChild(s)});const u=e("div",{style:"margin-top:8px;font-weight:600;"}),f=e("button",{type:"button",class:"btn primary",style:"margin-top:8px;"},"Перевірити");f.addEventListener("click",()=>{let i=0;d.forEach(({row:n,outWrap:o,correctStr:x})=>{const p=S(Array.from(o.querySelectorAll(".chip")).map(c=>c.textContent).join(" "))===x;n.style.borderColor=p?"#10b981":"#ef4444",p&&i++}),u.textContent=`Результат: ${i}/${d.length}`}),r.appendChild(f),r.appendChild(u)}function le(r,t){r.appendChild(e("h3",{},t.prompt||"Short answer"));const d=[];(t.items||[]).forEach((i,n)=>{const o=e("div",{style:"margin-bottom:10px;padding:10px;border:1px solid #e5e7eb;border-radius:10px;background:#fff;"}),x=e("div",{style:"margin-bottom:6px;font-weight:600;"},i.q);o.appendChild(x);const s=L(`${t.id||"short-label"}-${n}`);x.setAttribute("id",s);const p=L(`${t.id||"short-text"}-${n}`),c=e("textarea",{id:p,rows:3,style:"width:100%;max-width:720px;padding:6px 8px;border:1px solid #cbd5e1;border-radius:6px;"});c.setAttribute("aria-labelledby",s),o.appendChild(c),d.push({row:o,input:c,keywords:(i.keywords||[]).map(a=>S(a))}),r.appendChild(o)});const u=e("div",{style:"margin-top:8px;font-weight:600;"}),f=e("button",{type:"button",class:"btn primary",style:"margin-top:8px;"},"Перевірити");f.addEventListener("click",()=>{let i=0,n=0;d.forEach(({row:o,input:x,keywords:s})=>{const p=S(x.value),c=s.filter(y=>p.includes(y)).length;i+=c,n+=s.length,o.style.borderColor=c===s.length?"#10b981":c>0?"#f59e0b":"#ef4444";const a=o.querySelector(".short-info")||e("div",{class:"short-info",style:"margin-top:6px;color:#475569;"});a.textContent=`Збіги ключових слів: ${c}/${s.length}`,o.contains(a)||o.appendChild(a)}),u.textContent=`Загальний збіг ключових слів: ${i}/${n}`}),r.appendChild(f),r.appendChild(u)}function pe(r,t){r.appendChild(e("h3",{},t.prompt||"Відповіді у вільній формі"));const d=Array.isArray(t&&t.items)?t.items.filter(Boolean):[];if(d.length){const f=e("div",{style:"display:flex;flex-direction:column;gap:12px;margin-top:12px;"});d.forEach((i,n)=>{const o=e("div",{style:"padding:12px;border:1px solid #e5e7eb;border-radius:10px;background:#fff;"}),x=i&&(i.situation||i.prompt||i.q)||`Ситуація ${n+1}`;o.appendChild(e("div",{style:"margin:0 0 6px;font-weight:600;color:#0f172a;"},x));const s=i&&Array.isArray(i.example_answers)?i.example_answers.filter(Boolean):[];if(s.length){o.appendChild(e("div",{class:"muted",style:"margin:0 0 6px;color:#64748b;"},"Приклад відповіді:"));const p=e("div",{style:"display:flex;flex-wrap:wrap;gap:8px;"});s.forEach(c=>{p.appendChild(e("span",{style:"display:inline-flex;align-items:center;padding:4px 10px;border-radius:9999px;background:#e2e8f0;color:#0f172a;font-size:14px;"},c))}),o.appendChild(p)}f.appendChild(o)}),r.appendChild(f)}const u=t&&t.scoring&&Array.isArray(t.scoring.criteria)?t.scoring.criteria.filter(Boolean):[];if(u.length){const f=e("div",{style:"margin-top:16px;padding:14px;border:1px dashed #cbd5e1;border-radius:10px;background:#f8fafc;"});f.appendChild(e("h4",{style:"margin:0 0 8px;font-size:16px;font-weight:600;color:#0f172a;"},"Критерії оцінювання"));const i=e("ul",{style:"margin:0;padding-left:18px;color:#475569;"});u.forEach(n=>{i.appendChild(e("li",{style:"margin:4px 0;"},n))}),f.appendChild(i),r.appendChild(f)}}function ce(r,t){r.appendChild(e("h3",{},t.prompt||"Role-play scenario"));const d=t&&typeof t.scenario=="object"?t.scenario:{},u=e("div",{style:"margin:12px 0;padding:14px;border:1px solid #cbd5e1;border-radius:10px;background:#f8fafc;"});let f=!1;d.setting&&(u.appendChild(e("p",{style:"margin:0 0 6px;font-weight:600;"},`Локація: ${d.setting}`)),f=!0),d.summary&&(u.appendChild(e("p",{style:"margin:0;color:#334155;"},d.summary)),f=!0),f&&r.appendChild(u);const i=Array.isArray(d.roles)?d.roles:[];if(i.length){const x=e("div",{style:"display:grid;gap:12px;margin-top:12px;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));"});i.forEach((s,p)=>{const c=s&&s.name||`Student ${p+1}`,a=e("div",{style:"padding:14px;border:1px solid #e5e7eb;border-radius:10px;background:#fff;box-shadow:0 1px 0 rgba(148, 163, 184, 0.2);"},e("div",{style:"font-weight:600;margin-bottom:6px;"},c));s&&s.goal&&a.appendChild(e("p",{style:"margin:0 0 6px;color:#0f172a;"},`Мета: ${s.goal}`));const b=(s&&Array.isArray(s.details)?s.details:typeof(s==null?void 0:s.details)=="string"?s.details.split(/[;,\n]/):[]).map(g=>String(g||"").trim()).filter(Boolean);if(b.length===1)a.appendChild(e("p",{style:"margin:0;color:#475569;"},b[0]));else if(b.length>1){const g=e("ul",{style:"margin:0;padding-left:18px;color:#475569;"});b.forEach(C=>{g.appendChild(e("li",{style:"margin:2px 0;"},C))}),a.appendChild(g)}x.appendChild(a)}),r.appendChild(x)}const n=Array.isArray(d.steps)?d.steps:[];if(n.length){const x=e("div",{style:"margin-top:16px;padding:14px;border:1px solid #e5e7eb;border-radius:10px;background:#fff;"});x.appendChild(e("h4",{style:"margin:0 0 6px;font-size:16px;font-weight:600;color:#0f172a;"},"Покроковий план діалогу"));const s=e("ol",{style:"margin:0 0 0 18px;padding:0;color:#475569;"});n.forEach(p=>{p&&s.appendChild(e("li",{style:"margin:4px 0;"},p))}),x.appendChild(s),r.appendChild(x)}const o=Array.isArray(t&&t.phrases)?t.phrases:[];if(o.length){r.appendChild(e("h4",{style:"margin:18px 0 8px;font-size:16px;font-weight:600;color:#0f172a;"},"Корисні фрази для діалогу"));const x=e("div",{style:"display:flex;flex-direction:column;gap:8px;"});o.forEach((s,p)=>{const c=typeof s=="string"?s:s&&(s.phrase||s.text||s.value||""),a=s&&typeof s=="object"&&(s.translation||s.note||s.ua||s.uk)||"";if(!c)return;const y=L(`phrase-${p}`);x.appendChild(e("label",{for:y,style:"display:flex;gap:10px;align-items:flex-start;padding:10px 12px;border:1px solid #e5e7eb;border-radius:10px;background:#fff;"},e("input",{id:y,type:"checkbox",style:"margin-top:4px;"}),e("div",{},e("span",{style:"font-weight:600;color:#0f172a;"},c),a?e("span",{class:"muted",style:"display:block;margin-top:4px;color:#475569;"},a):null)))}),r.appendChild(x)}}function fe(r,t){r.appendChild(e("h3",{},t.prompt||"Заповніть пропуски у діалозі"));const d=Array.isArray(t==null?void 0:t.answers)?t.answers.map(m=>S(m)):[],u=[];let f=null;function i(m){f&&f!==m&&(f.style.boxShadow="none"),m&&f!==m?(m.style.boxShadow="0 0 0 2px rgba(37, 99, 235, 0.35)",f=m):(m&&(m.style.boxShadow="none"),f=null)}function n(m){m&&(m.dataset.value="",m.textContent="___",m.style.borderColor="#cbd5e1",m.style.background="#fff",m.style.boxShadow="none")}const o=e("div",{style:"display:flex;flex-wrap:wrap;gap:8px;margin:12px 0;padding:10px;border:1px solid #e2e8f0;border-radius:10px;background:#f8fafc;"}),x=Array.isArray(t==null?void 0:t.words)?t.words:[],s=new Set,p=[];x.forEach(m=>{const v=String(m||"").trim();if(!v)return;const E=S(v);s.has(E)||(s.add(E),p.push(v))}),p.forEach(m=>{const v=e("button",{type:"button",class:"btn",style:"padding:6px 10px;border:1px solid #94a3b8;border-radius:999px;background:#fff;color:#0f172a;cursor:pointer;font-size:14px;line-height:1;",onclick:()=>{const E=f||u.find(_=>!_.dataset.value);E&&(E.dataset.value=m,E.textContent=m,E.style.borderColor="#2563eb",E.style.background="#eef2ff",i(null))}},m);v.dataset.word=m,o.appendChild(v)}),o.children.length&&r.appendChild(o);const c=e("div",{style:"display:flex;flex-direction:column;gap:10px;"}),a=Array.isArray(t==null?void 0:t.dialogue)?t.dialogue:[];let y=0;a.forEach(m=>{if(!m)return;const v=m.speaker||m.role||"",E=m.line||m.text||"",_=e("div",{style:"padding:12px;border:1px solid #e5e7eb;border-radius:10px;background:#fff;display:flex;gap:10px;align-items:flex-start;"},v?e("strong",{style:"min-width:90px;"},`${v}:`):null),P=e("div",{style:"display:flex;flex-wrap:wrap;gap:6px;align-items:center;"}),F=String(E||"").split(/___/);F.forEach((M,we)=>{if(M&&P.appendChild(e("span",{},M)),we<F.length-1){const ve=d[y]||"",R=e("button",{type:"button",style:"min-width:52px;padding:4px 10px;border:1px solid #cbd5e1;border-radius:8px;background:#fff;color:#0f172a;cursor:pointer;",onclick:()=>{if(R.dataset.value){n(R),i(R);return}i(f===R?null:R)},ondblclick:()=>{n(R),i(null)}},"___");R.dataset.expected=ve,R.dataset.index=String(y),u.push(R),y+=1,P.appendChild(R)}}),_.appendChild(P),c.appendChild(_)}),r.appendChild(c);const b=e("div",{style:"margin-top:14px;display:flex;gap:10px;flex-wrap:wrap;align-items:center;"}),g=e("button",{type:"button",class:"btn primary"},"Перевірити"),C=e("button",{type:"button",class:"btn"},"Скинути"),A=e("div",{style:"font-weight:600;color:#0f172a;"});g.addEventListener("click",()=>{let m=0;u.forEach(v=>{const E=v.dataset.expected||"",_=S(v.dataset.value||v.textContent||""),P=E?_===E:!!_;v.style.borderColor=P?"#10b981":"#ef4444",v.style.background=P?"#ecfdf5":"#fee2e2",P&&(m+=1)}),u.length?A.textContent=`Результат: ${m}/${u.length}`:A.textContent=""}),C.addEventListener("click",()=>{u.forEach(m=>n(m)),A.textContent="",i(null)}),b.appendChild(g),b.appendChild(C),b.appendChild(A),r.appendChild(b)}function ue(r,t){r.appendChild(e("h3",{},t.prompt||"Упорядкуйте діалог"));const d=Array.isArray(t==null?void 0:t.lines)?t.lines.map(g=>({speaker:(g==null?void 0:g.speaker)||(g==null?void 0:g.role)||"",text:(g==null?void 0:g.line)||(g==null?void 0:g.text)||""})):[],u=Array.isArray(t==null?void 0:t.solution)?t.solution.map(g=>Number.parseInt(g,10)):d.map((g,C)=>C),f=e("div",{style:"display:flex;flex-direction:column;gap:8px;margin-top:10px;padding:10px;border:1px solid #e2e8f0;border-radius:10px;background:#f8fafc;"}),i=e("div",{style:"margin-top:14px;padding:12px;border:1px dashed #cbd5e1;border-radius:10px;min-height:80px;display:flex;flex-direction:column;gap:8px;"}),n=new Set;function o({speaker:g,text:C}){return(g?`${g}: ${C}`:C).trim()}function x(g){if(!g)return;const C=Number.parseInt(g.dataset.index||"-1",10),A=g.dataset.buttonId;if(A){const m=f.querySelector(`[data-id="${A}"]`);m&&(m.disabled=!1,m.style.opacity="1")}n.delete(C),g.remove()}function s(g,C,A){const m=e("div",{class:"dialogue-chip",style:"padding:10px;border:1px solid #94a3b8;border-radius:10px;background:#fff;display:flex;justify-content:space-between;align-items:center;gap:12px;cursor:pointer;",onclick:v=>{v.stopPropagation(),x(m)}},e("span",{},C),e("span",{style:"color:#94a3b8;font-size:12px;"},"×"));m.dataset.index=String(g),m.dataset.buttonId=A,i.appendChild(m)}$(d.map((g,C)=>C)).forEach(g=>{const C=d[g],A=o(C),m=`line-${g}-${Math.random().toString(36).slice(2,6)}`,v=e("button",{type:"button",class:"btn",style:"text-align:left;padding:10px;border:1px solid #cbd5e1;border-radius:10px;background:#fff;color:#0f172a;cursor:pointer;",onclick:()=>{n.has(g)||(n.add(g),v.disabled=!0,v.style.opacity="0.5",s(g,A,m))},"data-id":m},A);f.appendChild(v)}),r.appendChild(f),r.appendChild(i);const c=e("div",{style:"margin-top:14px;display:flex;gap:10px;flex-wrap:wrap;align-items:center;"}),a=e("button",{type:"button",class:"btn primary"},"Перевірити"),y=e("button",{type:"button",class:"btn"},"Скинути"),b=e("div",{style:"font-weight:600;color:#0f172a;"});a.addEventListener("click",()=>{const g=Array.from(i.children).map(m=>Number.parseInt(m.dataset.index||"-1",10)),C=u.slice(),A=g.length===C.length&&g.every((m,v)=>m===C[v]);i.style.borderColor=A?"#10b981":"#ef4444",b.textContent=A?"Діалог впорядковано правильно!":`Поточний порядок: ${g.length}/${C.length} реплік. Перевірте послідовність.`}),y.addEventListener("click",()=>{Array.from(i.children).forEach(C=>x(C)),f.querySelectorAll("button").forEach(C=>{C.disabled=!1,C.style.opacity="1"}),n.clear(),i.style.borderColor="#cbd5e1",b.textContent=""}),c.appendChild(a),c.appendChild(y),c.appendChild(b),r.appendChild(c)}function he(r,t){r.appendChild(e("h3",{},t.prompt||"Обери True або False"));const d=[];if((Array.isArray(t==null?void 0:t.items)?t.items:[]).forEach((o,x)=>{if(!o||!o.statement)return;const s=e("div",{style:"margin:8px 0;padding:12px;border:1px solid #e5e7eb;border-radius:10px;background:#fff;"},e("p",{style:"margin:0 0 8px;font-weight:600;"},o.statement)),p=`${t.id||"tf"}-${x}`,c=!!o.answer,a=L(`${p}-true`),y=e("label",{for:a,style:"display:inline-flex;align-items:center;gap:6px;margin-right:16px;"},e("input",{type:"radio",name:p,value:"true",id:a}),"True"),b=L(`${p}-false`),g=e("label",{for:b,style:"display:inline-flex;align-items:center;gap:6px;"},e("input",{type:"radio",name:p,value:"false",id:b}),"False"),C=e("div",{style:"display:flex;align-items:center;"});C.appendChild(y),C.appendChild(g),s.appendChild(C),d.push({row:s,name:p,expected:c}),r.appendChild(s)}),!d.length)return;const f=e("div",{style:"margin-top:14px;display:flex;gap:10px;align-items:center;flex-wrap:wrap;"}),i=e("button",{type:"button",class:"btn primary"},"Перевірити"),n=e("div",{style:"font-weight:600;color:#0f172a;"});i.addEventListener("click",()=>{let o=0;d.forEach(({row:x,name:s,expected:p})=>{const c=x.querySelector(`input[name="${s}"]:checked`),a=c?c.value===String(p):!1;x.style.borderColor=a?"#10b981":"#ef4444",a&&(o+=1)}),n.textContent=`Результат: ${o}/${d.length}`}),f.appendChild(i),f.appendChild(n),r.appendChild(f)}function ge(r,t){r.appendChild(e("h3",{},t.prompt||"Доберіть слово за описом"));const d=Array.isArray(t==null?void 0:t.wordBank)?t.wordBank:[];if(d.length){const o=e("div",{style:"margin:8px 0 12px;padding:10px;border:1px solid #e2e8f0;border-radius:10px;background:#f8fafc;display:flex;flex-wrap:wrap;gap:8px;"});d.forEach(x=>{const s=String(x||"").trim();s&&o.appendChild(e("span",{style:"padding:6px 10px;border:1px solid #94a3b8;border-radius:999px;background:#fff;font-size:14px;"},s))}),r.appendChild(o)}const u=[];if((Array.isArray(t==null?void 0:t.items)?t.items:[]).forEach((o,x)=>{if(!o||!o.clue)return;const s=e("div",{style:"margin-bottom:10px;padding:12px;border:1px solid #e5e7eb;border-radius:10px;background:#fff;"});s.appendChild(e("p",{style:"margin:0 0 6px;font-weight:600;"},o.clue));const p=L(`${t.id||"synonym"}-${x}`),c=e("input",{type:"text",id:p,style:"width:100%;max-width:320px;padding:6px 8px;border:1px solid #cbd5e1;border-radius:6px;"});s.appendChild(c);const a=Array.isArray(o==null?void 0:o.answers)?o.answers.map(y=>S(y)):Array.isArray(o==null?void 0:o.answer)?o.answer.map(y=>S(y)):o!=null&&o.answer?[S(o.answer)]:[];u.push({row:s,input:c,answers:a}),r.appendChild(s)}),!u.length)return;const i=e("div",{style:"font-weight:600;color:#0f172a;"}),n=e("button",{type:"button",class:"btn primary"},"Перевірити");n.addEventListener("click",()=>{let o=0;u.forEach(({row:x,input:s,answers:p})=>{const c=S(s.value),a=p.length?p.includes(c):!!c;x.style.borderColor=a?"#10b981":"#ef4444",a&&(o+=1)}),i.textContent=`Результат: ${o}/${u.length}`}),r.appendChild(n),r.appendChild(i)}function xe(r,t){r.appendChild(e("h3",{},t.prompt||"Розшифруйте слова"));const d=[];if((Array.isArray(t==null?void 0:t.items)?t.items:[]).forEach((n,o)=>{if(!n||!n.scrambled)return;const x=e("div",{style:"margin-bottom:10px;padding:12px;border:1px solid #e5e7eb;border-radius:10px;background:#fff;"});x.appendChild(e("div",{style:"margin-bottom:6px;font-weight:600;"},n.scrambled));const s=L(`${t.id||"scramble"}-${o}`),p=e("input",{type:"text",id:s,style:"width:100%;max-width:260px;padding:6px 8px;border:1px solid #cbd5e1;border-radius:6px;"});x.appendChild(p);const c=Array.isArray(n==null?void 0:n.answers)?n.answers.map(a=>S(a)):Array.isArray(n==null?void 0:n.answer)?n.answer.map(a=>S(a)):n!=null&&n.answer?[S(n.answer)]:[];d.push({row:x,input:p,answers:c}),r.appendChild(x)}),!d.length)return;const f=e("button",{type:"button",class:"btn primary"},"Перевірити"),i=e("div",{style:"margin-top:6px;font-weight:600;color:#0f172a;"});f.addEventListener("click",()=>{let n=0;d.forEach(({row:o,input:x,answers:s})=>{const p=S(x.value),c=s.length?s.includes(p):!!p;o.style.borderColor=c?"#10b981":"#ef4444",c&&(n+=1)}),i.textContent=`Результат: ${n}/${d.length}`}),r.appendChild(f),r.appendChild(i)}function ye(r,t){r.appendChild(e("h3",{},t.prompt||"Знайди зайве слово"));const d=[];if((Array.isArray(t==null?void 0:t.items)?t.items:[]).forEach((n,o)=>{const x=Array.isArray(n==null?void 0:n.options)?n.options:[];if(!x.length)return;const s=e("div",{style:"margin-bottom:10px;padding:12px;border:1px solid #e5e7eb;border-radius:10px;background:#fff;"});s.appendChild(e("div",{style:"margin-bottom:6px;font-weight:600;"},`Набір ${o+1}`));const p=`${t.id||"odd"}-${o}`;x.forEach((y,b)=>{const g=L(`${p}-${b}`);s.appendChild(e("label",{for:g,style:"display:flex;align-items:center;gap:6px;margin:4px 0;"},e("input",{type:"radio",name:p,value:String(b),id:g}),y))});const c=String((n==null?void 0:n.explanation)||"").trim();if(c){const y=e("div",{class:"muted",style:"display:none;margin-top:6px;color:#475569;"});y.textContent=`Пояснення: ${c}`,s.appendChild(y)}const a=S((n==null?void 0:n.answer)||"");d.push({row:s,groupName:p,answerIndex:a}),r.appendChild(s)}),!d.length)return;const f=e("button",{type:"button",class:"btn primary"},"Перевірити"),i=e("div",{style:"margin-top:6px;font-weight:600;color:#0f172a;"});f.addEventListener("click",()=>{let n=0;d.forEach(({row:o,groupName:x,answerIndex:s})=>{const p=o.querySelector(`input[name="${x}"]:checked`),c=S(p?p.value:""),a=s?c===s:!!c;o.style.borderColor=a?"#10b981":"#ef4444";const y=o.querySelector(".muted");y&&(y.style.display=a?"none":"block"),a&&(n+=1)}),i.textContent=`Результат: ${n}/${d.length}`}),r.appendChild(f),r.appendChild(i)}function be(r,t){r.appendChild(e("h3",{},t.prompt||"Writing/Speaking prompt")),t.description&&r.appendChild(e("p",{class:"muted"},t.description));const d=e("div",{style:"margin-top:8px;"});(t.checklist||[]).forEach((i,n)=>{const o=L(`${t.id||"check"}-${n}`),x=e("label",{for:o,style:"display:flex;align-items:center;gap:8px;margin:6px 0;"},e("input",{id:o,type:"checkbox"}),e("span",{},i));d.appendChild(x)}),r.appendChild(d);const u=e("button",{type:"button",class:"btn primary",style:"margin-top:8px;"},"Позначити як перевірено"),f=e("div",{class:"muted",style:"margin-top:6px;"});u.addEventListener("click",()=>{f.textContent="Готово! Перевір список і за бажанням відправ наставнику."}),r.appendChild(u),r.appendChild(f)}function me(r,t){r.appendChild(e("h3",{},t.prompt||"Audio task"));const d=[],u=a=>{if(!a)return;if(Array.isArray(a)){a.forEach(u);return}const y=String(a).trim();y&&d.push(y)};u(t.audioSrc),u(t.audioUrl),u(t.audio),u(t.source),u(t.sources);const f=Array.from(new Set(d));if(f.length){const a=e("div",{style:"margin-top:8px;padding:12px;border:1px solid #cbd5e1;border-radius:10px;background:#f1f5f9;"}),y=e("audio",{controls:!0,style:"width:100%;display:block;"});f.forEach(b=>{y.appendChild(e("source",{src:h(b)}))}),y.appendChild(document.createTextNode("Ваш браузер не підтримує відтворення аудіо.")),a.appendChild(y),r.appendChild(a)}const i=Array.isArray(t.dialogs)?t.dialogs:[],n=[];if(i.forEach(a=>{if(a){if(typeof a=="string"){const y=a.trim();y&&n.push({text:y});return}if(typeof a=="object"){const y="text"in a?String(a.text||"").trim():"";if(!y)return;const b={text:y};a.voice&&(b.voice=a.voice),a.voiceName&&(b.voiceName=a.voiceName),a.gender&&(b.gender=a.gender),a.lang&&(b.lang=a.lang),a.rate!=null&&(b.rate=a.rate),a.pitch!=null&&(b.pitch=a.pitch),a.volume!=null&&(b.volume=a.volume),a.ttsOptions&&typeof a.ttsOptions=="object"&&(b.ttsOptions={...a.ttsOptions}),n.push(b)}}}),!n.length){if(Array.isArray(t.text))t.text.map(a=>String(a||"").trim()).filter(Boolean).forEach(a=>n.push({text:a}));else if(typeof t.text=="string"){const a=String(t.text||"").trim();a&&n.push({text:a})}}const o=typeof window<"u"&&"speechSynthesis"in window?window.speechSynthesis:null,x={};if(t.lang&&(x.lang=t.lang),t.voiceName&&(x.voiceName=t.voiceName),t.voice&&(x.voice=t.voice),t.gender&&(x.gender=t.gender),typeof t.ttsOptions=="object"&&t.ttsOptions&&Object.assign(x,t.ttsOptions),typeof t.voiceOptions=="object"&&t.voiceOptions&&Object.assign(x,t.voiceOptions),typeof t.speechOptions=="object"&&t.speechOptions&&Object.assign(x,t.speechOptions),n.length&&o){const a=e("div",{style:"margin-top:8px;display:flex;align-items:center;gap:10px;flex-wrap:wrap;"}),y=e("button",{type:"button",class:"btn primary",style:"padding:8px 14px;border-radius:8px;border:1px solid #0284c7;background:#0ea5e9;color:#fff;cursor:pointer;display:inline-flex;align-items:center;gap:6px;"},"▶ Play");y.setAttribute("aria-pressed","false");let b=!1,g=0,C=null;const A=()=>{b=!1,g=0,C&&(C.onend=null,C.onerror=null,C=null),y.textContent="▶ Play",y.setAttribute("aria-pressed","false")},m=async()=>{if(!b||g>=n.length){A();return}const v=n[g],E={...x};v.lang&&(E.lang=v.lang),v.voiceName&&(E.voiceName=v.voiceName),v.voice&&(E.voice=v.voice),v.gender&&(E.gender=v.gender),v.rate!=null&&(E.rate=v.rate),v.pitch!=null&&(E.pitch=v.pitch),v.volume!=null&&(E.volume=v.volume),v.ttsOptions&&typeof v.ttsOptions=="object"&&v.ttsOptions&&Object.assign(E,v.ttsOptions);try{const _=await re(v.text,E);if(!_){g+=1,m();return}C=_,_.onend=()=>{b&&(C=null,g+=1,m())},_.onerror=A}catch{A()}};y.addEventListener("click",()=>{if(b)o&&o.cancel(),A();else{if(!n.length)return;b=!0,g=0,y.textContent="⏹ Stop",y.setAttribute("aria-pressed","true"),m()}}),a.appendChild(y),f.length||a.appendChild(e("span",{class:"muted",style:"font-size:14px;"},"Прослухайте діалог за допомогою синтезу мовлення.")),r.appendChild(a)}else!f.length&&n.length&&r.appendChild(e("p",{class:"muted",style:"margin-top:8px;"},"Ваш браузер не підтримує синтез мовлення."));const s=Array.isArray(t.questions)?t.questions.filter(Boolean):[];if(!s.length)return;const p=e("div",{style:"margin-top:16px;"}),c=[];if(s.forEach((a,y)=>{const b=typeof a=="string"?{prompt:a}:a&&typeof a=="object"?a:{prompt:String(a)},g=b.prompt||b.q||`Question ${y+1}`,C=e("div",{style:"margin-bottom:12px;padding:12px;border:1px solid #e5e7eb;border-radius:10px;background:#fff;"},e("div",{style:"font-weight:600;margin-bottom:8px;"},g));if(b.hint&&C.appendChild(B(b.hint)),Array.isArray(b.choices)&&b.choices.length){const m=(Array.isArray(b.answer)?b.answer:b.answer!=null?[b.answer]:[]).map(P=>String(P)),v=m.length>1,E=m.every(P=>/^\d+$/.test(P)),_=L(`${t.id||"audio"}-${y}`);b.choices.forEach((P,F)=>{const M=L(`${_}-${F}`);C.appendChild(e("label",{for:M,style:"display:flex;align-items:center;gap:8px;margin:4px 0;"},e("input",{type:v?"checkbox":"radio",name:_,id:M,value:String(F)}),e("span",{},P)))}),m.length&&c.push({type:"choices",block:C,getPicked:()=>{const F=Array.from(C.querySelectorAll(`input[name='${_}']`)).filter(M=>M.checked).map(M=>M.value);return E?F:F.map(M=>S(b.choices[Number(M)]||""))},expected:E?m.slice():m.map(P=>S(P))})}else{const A=e("textarea",{rows:b.rows||2,style:"width:100%;max-width:640px;padding:6px 8px;border:1px solid #cbd5e1;border-radius:6px;"});C.appendChild(A);const v=(Array.isArray(b.answer)?b.answer:b.answer!=null?[b.answer]:Array.isArray(b.answers)?b.answers:[]).map(E=>S(E)).filter(Boolean);v.length&&c.push({type:"text",block:C,input:A,expected:v})}p.appendChild(C)}),c.length){const a=e("div",{style:"margin-top:8px;font-weight:600;"}),y=e("button",{type:"button",class:"btn primary",style:"margin-top:8px;"},"Перевірити");y.addEventListener("click",()=>{let b=0;c.forEach(g=>{if(g.type==="choices"){const C=g.getPicked().sort(),A=g.expected.slice().sort(),m=C.length===A.length&&C.every((v,E)=>v===A[E]);g.block.style.borderColor=m?"#10b981":"#ef4444",m&&b++}else if(g.type==="text"){const C=S(g.input.value),A=g.expected.includes(C);g.block.style.borderColor=A?"#10b981":"#ef4444",A&&b++}}),a.textContent=`Результат: ${b}/${c.length}`}),p.appendChild(y),p.appendChild(a)}else p.appendChild(e("p",{class:"muted",style:"margin-top:4px;"},"Запишіть відповіді — викладач перевірить їх пізніше."));r.appendChild(p)}function ee(){let r=document.getElementById("practice");if(!r&&/\/grammar\//.test(location.pathname)){const t=e("div",{class:"container"});t.appendChild(e("hr",{class:"sep"})),r=e("section",{id:"practice"}),t.appendChild(r),document.body.appendChild(t)}return r}function Ce(){const r=ee();if(!r)return;let t=r.querySelector("#practice-body");if(t||(t=e("div",{id:"practice-body"}),r.appendChild(t)),(window.lessonContext||{}).isCustomLesson){const u=r.querySelector("[data-practice-placeholder]");u&&(u.textContent="Практика для кожної теми розміщена одразу після теорії. Тут можете згенерувати додаткові завдання."),t&&(t.innerHTML='<p class="muted">Згенеруйте додаткові вправи або додайте власні завдання.</p>'),document.dispatchEvent(new CustomEvent("practice:dataLoaded",{detail:null})),document.dispatchEvent(new CustomEvent("practice:rendered",{detail:{ok:!1,reason:"custom-lesson"}}));return}ie().then(u=>{if(!u){document.dispatchEvent(new CustomEvent("practice:dataLoaded",{detail:null})),t.innerHTML='<p class="muted">Практика поки відсутня.</p>',document.dispatchEvent(new CustomEvent("practice:rendered",{detail:{ok:!1}}));return}t.innerHTML="";const f=e("div",{},e("h2",{},"Practice ",e("span",{class:"badge"},u.level||"B1")),u.title?e("p",{class:"muted"},u.title):null);t.appendChild(f);const i=(u.tasks||[]).map((n,o)=>({key:n&&n.id?String(n.id):`base-${o}`,task:n}));document.dispatchEvent(new CustomEvent("practice:dataLoaded",{detail:{title:u.title,level:u.level,entries:i}})),i.forEach(({task:n,key:o})=>H(t,n,o)),document.dispatchEvent(new CustomEvent("practice:rendered",{detail:{ok:!0}}))})}return(typeof window<"u"&&window.practiceConfig||{}).disableAutoInit||document.addEventListener("DOMContentLoaded",Ce),window.practice=window.practice||{},Object.assign(window.practice,{appendTask:O,renderTaskList:q,createTaskElement:U}),{appendTask:O,renderTaskList:q,createTaskElement:U}}(),Qe=oe.createTaskElement,Ke=oe.renderTaskList;document.addEventListener("click",l=>{const h=l.target.closest(".text-block");if(h){const w=h.innerHTML;navigator.clipboard.writeText(`<div class="text-block">${w}</div>`),console.log("Скопійовано")}});export{Ge as a,Ue as b,Qe as c,ze as d,Ae as e,W as f,Se as g,Je as h,Me as i,Ve as j,Ke as r,Oe as s};
//# sourceMappingURL=practice-CGigKf5_.js.map
