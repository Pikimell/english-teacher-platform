import{s as L,l as i,b as I,a as x}from"./custom-lessons-store-BKMVZjuV.js";import{a as h,r as c,c as v}from"./custom-lesson-presets-B4NuEc3i.js";h.subscribe(({isSignedIn:e,user:t})=>{if(!c.headerActions.createBtn||!c.headerActions.createBtn)return;if(!e){c.headerActions.createBtn.hidden=!0,c.headerActions.homework.hidden=!0;return}h.isAdmin(t)?(c.headerActions.createBtn.hidden=!1,c.headerActions.homework.hidden=!0):(c.headerActions.createBtn.hidden=!0,c.headerActions.homework.hidden=!1)});const o={search:"",category:"all",level:"all"},C=document.querySelector('[data-filter="search"]'),A=document.querySelector('[data-filter="level"]'),S=Array.from(document.querySelectorAll("[data-category]")),f=document.querySelector("[data-lessons-section]"),p=document.querySelector("[data-lessons-grid]"),g=document.querySelector("[data-lessons-empty]"),l={total:document.querySelector("[data-stat-total]"),grammar:document.querySelector("[data-stat-grammar]"),lexical:document.querySelector("[data-stat-lexical]")};h.init();function y(e){return e.trim().toLowerCase()}function m(e){return String(e??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function _(){S.forEach(e=>{const t=e.dataset.category===o.category,a=e.dataset.category==="all"?o.category==="all":t;e.classList.toggle("chip--filled",a),e.setAttribute("aria-pressed",String(a))})}function k(e){var r;const t=((r=I[e.category])==null?void 0:r.label)??e.category,s=`lesson.html?topic=${encodeURIComponent(e.id)}&category=${encodeURIComponent(e.category)}&level=${encodeURIComponent(e.level)}&title=${encodeURIComponent(e.title)}&file=${encodeURIComponent(e.htmlPath)}`,a=Array.isArray(e.tags)?e.tags:[];return`
    <article class="lesson-card" data-lesson-id="${e.id}" data-category="${e.category}" data-level="${e.level}">
      <a class="lesson-card__link" href="${s}">
        <div class="lesson-card__meta">
          <span class="lesson-card__category">${t}</span>
          <span class="lesson-card__level" aria-label="Рівень">${e.level}</span>
        </div>
        <h3 class="lesson-card__title">${e.title}</h3>
        <p class="lesson-card__description">${e.description}</p>
        ${a.length?`<ul class="lesson-card__tags">${a.map(n=>`<li>${n}</li>`).join("")}</ul>`:""}
        <span class="lesson-card__cta">Перейти до матеріалу</span>
      </a>
    </article>
  `}function $(e){const t=(e.topicIds||[]).map(n=>i.find(u=>u.id===n)).filter(Boolean),s=Array.from(new Set(t.map(n=>n.level))).sort(),a=t.filter(n=>n.category==="grammar").length,r=t.filter(n=>n.category==="lexical").length;return{topics:t,levels:s,grammarCount:a,lexicalCount:r}}function b(e,t=$(e)){const s=e.description||t.topics.map(n=>n.title).slice(0,3).join(", "),a=e.level||(t.levels.length?t.levels.join(", "):"мікси рівнів"),r=[];return a&&r.push(`Рівні: ${m(a)}`),t.grammarCount&&r.push(`Граматика: ${t.grammarCount}`),t.lexicalCount&&r.push(`Лексика: ${t.lexicalCount}`),`
    <article class="lesson-card lesson-card--custom" data-custom-lesson-id="${e.id}" data-custom-source="${e.source||"local"}">
      <a class="lesson-card__link" href="lesson.html?custom=${encodeURIComponent(e.id)}">
        
       <h3 class="lesson-card__title">${m(e.title)}</h3>
        ${r.length?`<p class="lesson-card__meta">${r.join(" · ")}</p>`:""}
        <p class="lesson-card__description">${m(s||"Урок містить кілька тем.")}</p>
        
        <span class="lesson-card__cta">Відкрити комбінований урок</span>
      </a>
    </article>
  `}function q(){return Array.isArray(v)?v.filter(e=>e&&typeof e=="object"&&e.id).map((e,t)=>({...e,topicIds:Array.isArray(e.topicIds)?[...e.topicIds]:[],source:"preset",sortIndex:t})):[]}function B(){return x().filter(e=>e&&typeof e=="object"&&e.id).map((e,t)=>({...e,topicIds:Array.isArray(e.topicIds)?[...e.topicIds]:[],source:"local",sortIndex:1e3+t}))}function T(){const e=new Map;return q().forEach(t=>{e.has(t.id)||e.set(t.id,t)}),B().forEach(t=>{e.set(t.id,t)}),Array.from(e.values())}function E(){const e=r=>{const n=r?new Date(r).getTime():0;return Number.isFinite(n)?n:0},s=T().slice().sort((r,n)=>{const u=e(n.createdAt)-e(r.createdAt);return u!==0?u:(r.sortIndex||0)-(n.sortIndex||0)}).map(r=>{const n=$(r);return{type:"custom",lesson:r,meta:n}}),a=i.map(r=>({type:"catalog",lesson:r}));return[...s,...a]}function w(e){return o.category==="all"?!0:e.type==="catalog"?e.lesson.category===o.category:!1}function R(e){var a;if(o.level==="all")return!0;if(e.type==="catalog")return e.lesson.level===o.level;const t=e.lesson.level;return t?t===o.level:(((a=e.meta)==null?void 0:a.levels)??[]).includes(o.level)}function j(e,t){const a=((t==null?void 0:t.topics)??[]).flatMap(r=>[r.title,r.description,...r.tags||[]].filter(Boolean));return[e.title,e.description,...e.tags||[],e.level,...a].filter(Boolean).map(r=>y(String(r)))}function M(e,t){return t?e.type==="catalog"?[e.lesson.title,e.lesson.description,...e.lesson.tags??[]].filter(Boolean).map(r=>y(String(r))).some(r=>r.includes(t)):j(e.lesson,e.meta).some(a=>a.includes(t)):!0}function U(){const e=E(),t=y(o.search);return e.filter(s=>!w(s)||!R(s)?!1:M(s,t))}function d(){if(!p||!g)return;const e=U();if(!e.length){p.innerHTML="",g.hidden=!1,f&&(f.dataset.hasResults="false");return}const t=e.map(s=>s.type==="custom"?b(s.lesson,s.meta):k(s.lesson)).join("");p.innerHTML=t,g.hidden=!0,f&&(f.dataset.hasResults="true")}function P(){l.total&&(l.total.textContent=String(i.length)),l.grammar&&(l.grammar.textContent=String(i.filter(e=>e.category==="grammar").length)),l.lexical&&(l.lexical.textContent=String(i.filter(e=>e.category==="lexical").length))}function D(e){o.search=e.target.value,d()}function H(e){o.level=e.target.value,d()}function Y(e){const t=e.currentTarget.dataset.category;t&&(o.category=t,_(),d())}function F(){const e=document.querySelector('[data-component="copyright-year"]');e&&(e.textContent=String(new Date().getFullYear()))}function G(){P(),_(),d(),F(),C&&C.addEventListener("input",D),A&&A.addEventListener("change",H),S.forEach(e=>{e.addEventListener("click",Y)}),L(()=>{d()})}G();
//# sourceMappingURL=catalog-CtanK4uG.js.map
