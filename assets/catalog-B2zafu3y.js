import{s as L,l as i,b as I,a as k}from"./custom-lessons-store-BKMVZjuV.js";import{a as h,c as v}from"./custom-lesson-presets-CTCipuxz.js";const c={headerActions:{createBtn:document.querySelector(".js-create-lesson-btn"),homework:document.querySelector(".js-homework-btn")},homework:{container:document.querySelector(".js-homework-content")}};h.subscribe(({isSignedIn:e,user:t})=>{if(!c.headerActions.createBtn||!c.headerActions.createBtn)return;if(!e){c.headerActions.createBtn.hidden=!0,c.headerActions.homework.hidden=!0;return}h.isAdmin(t)?(c.headerActions.createBtn.hidden=!1,c.headerActions.homework.hidden=!0):(c.headerActions.createBtn.hidden=!0,c.headerActions.homework.hidden=!1)});const o={search:"",category:"all",level:"all"},C=document.querySelector('[data-filter="search"]'),A=document.querySelector('[data-filter="level"]'),S=Array.from(document.querySelectorAll("[data-category]")),f=document.querySelector("[data-lessons-section]"),p=document.querySelector("[data-lessons-grid]"),g=document.querySelector("[data-lessons-empty]"),l={total:document.querySelector("[data-stat-total]"),grammar:document.querySelector("[data-stat-grammar]"),lexical:document.querySelector("[data-stat-lexical]")};h.init();function y(e){return e.trim().toLowerCase()}function m(e){return String(e??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function _(){S.forEach(e=>{const t=e.dataset.category===o.category,n=e.dataset.category==="all"?o.category==="all":t;e.classList.toggle("chip--filled",n),e.setAttribute("aria-pressed",String(n))})}function x(e){var r;const t=((r=I[e.category])==null?void 0:r.label)??e.category,s=`lesson.html?topic=${encodeURIComponent(e.id)}&category=${encodeURIComponent(e.category)}&level=${encodeURIComponent(e.level)}&title=${encodeURIComponent(e.title)}&file=${encodeURIComponent(e.htmlPath)}`,n=Array.isArray(e.tags)?e.tags:[];return`
    <article class="lesson-card" data-lesson-id="${e.id}" data-category="${e.category}" data-level="${e.level}">
      <a class="lesson-card__link" href="${s}">
        <div class="lesson-card__meta">
          <span class="lesson-card__category">${t}</span>
          <span class="lesson-card__level" aria-label="Рівень">${e.level}</span>
        </div>
        <h3 class="lesson-card__title">${e.title}</h3>
        <p class="lesson-card__description">${e.description}</p>
        ${n.length?`<ul class="lesson-card__tags">${n.map(a=>`<li>${a}</li>`).join("")}</ul>`:""}
        <span class="lesson-card__cta">Перейти до матеріалу</span>
      </a>
    </article>
  `}function $(e){const t=(e.topicIds||[]).map(a=>i.find(d=>d.id===a)).filter(Boolean),s=Array.from(new Set(t.map(a=>a.level))).sort(),n=t.filter(a=>a.category==="grammar").length,r=t.filter(a=>a.category==="lexical").length;return{topics:t,levels:s,grammarCount:n,lexicalCount:r}}function b(e,t=$(e)){const s=e.description||t.topics.map(a=>a.title).slice(0,3).join(", "),n=e.level||(t.levels.length?t.levels.join(", "):"мікси рівнів"),r=[];return n&&r.push(`Рівні: ${m(n)}`),t.grammarCount&&r.push(`Граматика: ${t.grammarCount}`),t.lexicalCount&&r.push(`Лексика: ${t.lexicalCount}`),`
    <article class="lesson-card lesson-card--custom" data-custom-lesson-id="${e.id}" data-custom-source="${e.source||"local"}">
      <a class="lesson-card__link" href="lesson.html?custom=${encodeURIComponent(e.id)}">
        
       <h3 class="lesson-card__title">${m(e.title)}</h3>
        ${r.length?`<p class="lesson-card__meta">${r.join(" · ")}</p>`:""}
        <p class="lesson-card__description">${m(s||"Урок містить кілька тем.")}</p>
        
        <span class="lesson-card__cta">Відкрити комбінований урок</span>
      </a>
    </article>
  `}function q(){return Array.isArray(v)?v.filter(e=>e&&typeof e=="object"&&e.id).map((e,t)=>({...e,topicIds:Array.isArray(e.topicIds)?[...e.topicIds]:[],source:"preset",sortIndex:t})):[]}function w(){return k().filter(e=>e&&typeof e=="object"&&e.id).map((e,t)=>({...e,topicIds:Array.isArray(e.topicIds)?[...e.topicIds]:[],source:"local",sortIndex:1e3+t}))}function B(){const e=new Map;return q().forEach(t=>{e.has(t.id)||e.set(t.id,t)}),w().forEach(t=>{e.set(t.id,t)}),Array.from(e.values())}function T(){const e=r=>{const a=r?new Date(r).getTime():0;return Number.isFinite(a)?a:0},s=B().slice().sort((r,a)=>{const d=e(a.createdAt)-e(r.createdAt);return d!==0?d:(r.sortIndex||0)-(a.sortIndex||0)}).map(r=>{const a=$(r);return{type:"custom",lesson:r,meta:a}}),n=i.map(r=>({type:"catalog",lesson:r}));return[...s,...n]}function j(e){return o.category==="all"?!0:e.type==="catalog"?e.lesson.category===o.category:!1}function E(e){var n;if(o.level==="all")return!0;if(e.type==="catalog")return e.lesson.level===o.level;const t=e.lesson.level;return t?t===o.level:(((n=e.meta)==null?void 0:n.levels)??[]).includes(o.level)}function R(e,t){const n=((t==null?void 0:t.topics)??[]).flatMap(r=>[r.title,r.description,...r.tags||[]].filter(Boolean));return[e.title,e.description,...e.tags||[],e.level,...n].filter(Boolean).map(r=>y(String(r)))}function M(e,t){return t?e.type==="catalog"?[e.lesson.title,e.lesson.description,...e.lesson.tags??[]].filter(Boolean).map(r=>y(String(r))).some(r=>r.includes(t)):R(e.lesson,e.meta).some(n=>n.includes(t)):!0}function U(){const e=T(),t=y(o.search);return e.filter(s=>!j(s)||!E(s)?!1:M(s,t))}function u(){if(!p||!g)return;const e=U();if(!e.length){p.innerHTML="",g.hidden=!1,f&&(f.dataset.hasResults="false");return}const t=e.map(s=>s.type==="custom"?b(s.lesson,s.meta):x(s.lesson)).join("");p.innerHTML=t,g.hidden=!0,f&&(f.dataset.hasResults="true")}function P(){l.total&&(l.total.textContent=String(i.length)),l.grammar&&(l.grammar.textContent=String(i.filter(e=>e.category==="grammar").length)),l.lexical&&(l.lexical.textContent=String(i.filter(e=>e.category==="lexical").length))}function D(e){o.search=e.target.value,u()}function H(e){o.level=e.target.value,u()}function Y(e){const t=e.currentTarget.dataset.category;t&&(o.category=t,_(),u())}function F(){const e=document.querySelector('[data-component="copyright-year"]');e&&(e.textContent=String(new Date().getFullYear()))}function G(){P(),_(),u(),F(),C&&C.addEventListener("input",D),A&&A.addEventListener("change",H),S.forEach(e=>{e.addEventListener("click",Y)}),L(()=>{u()})}G();
//# sourceMappingURL=catalog-B2zafu3y.js.map
