import{a as D}from"./vendor-CWxt7QI6.js";const J=D.create({baseURL:"https://8m3289exx6.execute-api.us-east-2.amazonaws.com"}),j=async({name:e,givenName:t,familyName:n,email:a,picture:o})=>{const r={name:e,givenName:t,familyName:n,email:a,picture:o};return(await J.post("/user",r)).data},C=["volodkaposhta@gmail.com","nreznik451@gmail.com"],m="english-teacher.google-user",I="english-teacher.google-auth-state";document.querySelector("[data-auth-root]");const x=document.querySelector("[data-auth-signin]"),v=document.querySelector("[data-auth-profile]"),u=document.querySelector("[data-user-name]"),d=document.querySelector("[data-user-email]"),i=document.querySelector("[data-user-avatar]"),c=document.querySelector("[data-auth-signout]");let s=null,y=!1;const S=new Set;let E=!1,N=!1;function R(e){try{if(!e||typeof e!="string")return null;const t=e.split(".");if(!t[1])return null;const n=t[1].replace(/-/g,"+").replace(/_/g,"/"),a=n.padEnd(n.length+(4-n.length%4)%4,"="),o=atob(a).split("").map(r=>`%${`00${r.charCodeAt(0).toString(16)}`.slice(-2)}`).join("");return JSON.parse(decodeURIComponent(o))}catch(t){return console.warn("[auth] Unable to decode Google credential payload",t),null}}function w(e){return{name:e.name||"",givenName:e.givenName||"",familyName:e.familyName||"",email:e.email||"",picture:e.picture||"",credential:e.credential||"",expiresAt:e.expiresAt??null}}function T(){try{const e=window.localStorage.getItem(m);return e?JSON.parse(e):null}catch(e){return console.warn("[auth] Unable to access localStorage",e),null}}function O(e,t){const n=JSON.stringify(t);window.localStorage.getItem(e)!==n&&window.localStorage.setItem(e,n)}function F(e){try{const t=w(e);O(m,t)}catch(t){console.warn("[auth] Unable to persist user in localStorage",t)}}function L(){try{window.localStorage.removeItem(m)}catch(e){console.warn("[auth] Unable to remove user from localStorage",e)}}function f(e){try{O(I,e)}catch(t){console.warn("[auth] Unable to persist auth state",t)}}function H(e){if(!e||typeof e!="object")return!1;const t=!!e.email||!!e.name||!!e.givenName,n=typeof e.credential=="string"&&e.credential.length>0;return t&&n}function b(e){return e?{...e}:null}function V(e,t){if(e===t)return!0;if(!e||!t)return!1;const n=Object.keys(e),a=Object.keys(t);return n.length!==a.length?!1:n.every(o=>e[o]===t[o])}function A(){return{isSignedIn:!!s,user:b(s)}}function $(e){const t=A();S.forEach(n=>{try{n(t,e)}catch(a){console.warn("[auth] Subscriber error",a)}})}function g(e,t){const n=b(e);V(s,n)||(s=n,$(t))}function q(){N||typeof window>"u"||!window.addEventListener||(window.addEventListener("storage",K),N=!0)}function l(){E||typeof window>"u"||(E=!0,q(),h({persist:!1,applyUi:!1,reason:"hydrated"}))}function B(e){v&&(v.hidden=!e),x&&(x.hidden=e),c&&(c.hidden=!e)}function G(e,t={}){const{persist:n=!0,reason:a="signed-in"}=t,o=w(e);if(B(!0),u&&(u.textContent=o.name||o.givenName||""),d&&(d.textContent=o.email||""),i)if(o.picture){i.src=o.picture,i.hidden=!1;const r=o.name||o.givenName||"Користувач Google";i.alt=`${r} — аватар профілю`}else i.removeAttribute("src"),i.hidden=!0,i.alt="Google profile avatar";g(o,a),n&&f({status:"signed-in",user:o,updatedAt:Date.now()})}function _(e={}){const{persist:t=!0,reason:n="signed-out"}=e;B(!1),u&&(u.textContent=""),d&&(d.textContent=""),i&&(i.removeAttribute("src"),i.hidden=!0,i.alt="Google profile avatar"),g(null,n),t&&f({status:"signed-out",updatedAt:Date.now()})}function z(e){const t=e==null?void 0:e.credential,n=R(t);if(!n)return;const a={name:n.name||n.given_name||"",givenName:n.given_name||"",familyName:n.family_name||"",email:n.email||"",picture:n.picture||"",credential:t,expiresAt:n.exp?n.exp*1e3:null};j(a),F(a),G(a)}function k(e="signed-out"){var t,n,a;L(),_({reason:e});try{(a=(n=(t=window.google)==null?void 0:t.accounts)==null?void 0:n.id)==null||a.disableAutoSelect()}catch(o){console.warn("[auth] Unable to disable Google auto-select",o)}}function h(e={}){const{persist:t=!1,applyUi:n=!0,reason:a="synced"}=e,o=T(),r=H(o)?o:null,p=r!=null&&r.expiresAt?r.expiresAt<=Date.now():!1;if(r&&!p)if(n)G(r,{persist:t,reason:a});else{const U=w(r);g(U,a),t&&f({status:"signed-in",user:U,updatedAt:Date.now()})}else(p||o)&&L(),n?_({persist:t,reason:a}):(g(null,a),t&&f({status:"signed-out",updatedAt:Date.now()}))}function K(e){e.storageArea===window.localStorage&&(e.key===m||e.key===I||e.key===null)&&h({persist:!1})}function P(){y||(y=!0,l(),window.handleGoogleCredential=z,c&&!c.dataset.authInitialised&&(c.addEventListener("click",()=>k()),c.dataset.authInitialised="true"),h({persist:!1}),q())}function Y(e){return typeof e!="function"?()=>{}:(l(),S.add(e),e(A(),s?"signed-in":"signed-out"),()=>{S.delete(e)})}function M(){h({persist:!1})}const Q={init:P,isInitialised:()=>y,isSignedIn:()=>(l(),!!s),getUser:()=>(l(),b(s)),getCredential:()=>(l(),(s==null?void 0:s.credential)??null),signOut:()=>k(),subscribe:Y,refresh:M,getSnapshot:()=>(l(),A()),isAdmin:e=>{e||l();const t=e||s;return C.includes(t==null?void 0:t.email)}};Q.subscribe(({isSignedIn:e,user:t})=>{e?C.includes(t.email)?document.body.classList.add("is-admin"):document.body.classList.add("is-user"):document.body.classList.add("is-anonym")});export{Q as a,J as i};
//# sourceMappingURL=auth-CUcfS-ao.js.map
