import"./assets/main-DXzobtgI.js";import{s as H,l as d,b as V,a as F}from"./assets/custom-lessons-store-BKMVZjuV.js";import{c as $}from"./assets/custom-lesson-presets-BlE7b2P4.js";const y="english-teacher.google-user",k="english-teacher.google-auth-state";document.querySelector("[data-auth-root]");const L=document.querySelector("[data-auth-signin]"),E=document.querySelector("[data-auth-profile]"),m=document.querySelector("[data-user-name]"),h=document.querySelector("[data-user-email]"),c=document.querySelector("[data-user-avatar]"),u=document.querySelector("[data-auth-signout]");let l=null,A=!1;const w=new Set;function K(e){try{if(!e||typeof e!="string")return null;const t=e.split(".");if(!t[1])return null;const n=t[1].replace(/-/g,"+").replace(/_/g,"/"),r=n.padEnd(n.length+(4-n.length%4)%4,"="),a=atob(r).split("").map(o=>`%${`00${o.charCodeAt(0).toString(16)}`.slice(-2)}`).join("");return JSON.parse(decodeURIComponent(a))}catch(t){return console.warn("[auth] Unable to decode Google credential payload",t),null}}function N(e){return{name:e.name||"",givenName:e.givenName||"",familyName:e.familyName||"",email:e.email||"",picture:e.picture||"",credential:e.credential||"",expiresAt:e.expiresAt??null}}function z(){try{const e=window.localStorage.getItem(y);return e?JSON.parse(e):null}catch(e){return console.warn("[auth] Unable to access localStorage",e),null}}function T(e,t){const n=JSON.stringify(t);window.localStorage.getItem(e)!==n&&window.localStorage.setItem(e,n)}function Q(e){try{const t=N(e);T(y,t)}catch(t){console.warn("[auth] Unable to persist user in localStorage",t)}}function B(){try{window.localStorage.removeItem(y)}catch(e){console.warn("[auth] Unable to remove user from localStorage",e)}}function j(e){try{T(k,e)}catch(t){console.warn("[auth] Unable to persist auth state",t)}}function W(e){if(!e||typeof e!="object")return!1;const t=!!e.email||!!e.name||!!e.givenName,n=typeof e.credential=="string"&&e.credential.length>0;return t&&n}function I(e){return e?{...e}:null}function X(e,t){if(e===t)return!0;if(!e||!t)return!1;const n=Object.keys(e),r=Object.keys(t);return n.length!==r.length?!1:n.every(a=>e[a]===t[a])}function _(){return{isSignedIn:!!l,user:I(l)}}function Z(e){const t=_();w.forEach(n=>{try{n(t,e)}catch(r){console.warn("[auth] Subscriber error",r)}})}function R(e,t){const n=I(e);X(l,n)||(l=n,Z(t))}function O(e){E&&(E.hidden=!e),L&&(L.hidden=e),u&&(u.hidden=!e)}function G(e,t={}){const{persist:n=!0,reason:r="signed-in"}=t,a=N(e);if(O(!0),m&&(m.textContent=a.name||a.givenName||""),h&&(h.textContent=a.email||""),c)if(a.picture){c.src=a.picture,c.hidden=!1;const o=a.name||a.givenName||"Користувач Google";c.alt=`${o} — аватар профілю`}else c.removeAttribute("src"),c.hidden=!0,c.alt="Google profile avatar";R(a,r),n&&j({status:"signed-in",user:a,updatedAt:Date.now()})}function M(e={}){const{persist:t=!0,reason:n="signed-out"}=e;O(!1),m&&(m.textContent=""),h&&(h.textContent=""),c&&(c.removeAttribute("src"),c.hidden=!0,c.alt="Google profile avatar"),R(null,n),t&&j({status:"signed-out",updatedAt:Date.now()})}function ee(e){const t=e==null?void 0:e.credential,n=K(t);if(!n)return;const r={name:n.name||n.given_name||"",givenName:n.given_name||"",familyName:n.family_name||"",email:n.email||"",picture:n.picture||"",credential:t,expiresAt:n.exp?n.exp*1e3:null};Q(r),G(r)}function D(e="signed-out"){var t,n,r;B(),M({reason:e});try{(r=(n=(t=window.google)==null?void 0:t.accounts)==null?void 0:n.id)==null||r.disableAutoSelect()}catch(a){console.warn("[auth] Unable to disable Google auto-select",a)}}function x(e={}){const{persist:t=!1}=e,n=z(),r=W(n)?n:null,a=r!=null&&r.expiresAt?r.expiresAt<=Date.now():!1;r&&!a?G(r,{persist:t,reason:"synced"}):((a||n)&&B(),M({persist:t,reason:"synced"}))}function te(e){e.storageArea===window.localStorage&&(e.key===y||e.key===k||e.key===null)&&x({persist:!1})}function ne(){A||(A=!0,window.handleGoogleCredential=ee,u&&!u.dataset.authInitialised&&(u.addEventListener("click",()=>D()),u.dataset.authInitialised="true"),x({persist:!1}),window.addEventListener("storage",te))}function ae(e){return typeof e!="function"?()=>{}:(w.add(e),e(_(),l?"signed-in":"signed-out"),()=>{w.delete(e)})}function re(){x({persist:!1})}const oe={init:ne,isInitialised:()=>A,isSignedIn:()=>!!l,getUser:()=>I(l),getCredential:()=>(l==null?void 0:l.credential)??null,signOut:()=>D(),subscribe:ae,refresh:re,getSnapshot:_},s={search:"",category:"all",level:"all"},U=document.querySelector('[data-filter="search"]'),q=document.querySelector('[data-filter="level"]'),P=Array.from(document.querySelectorAll("[data-category]")),p=document.querySelector("[data-lessons-section]"),S=document.querySelector("[data-lessons-grid]"),v=document.querySelector("[data-lessons-empty]"),i={total:document.querySelector("[data-stat-total]"),grammar:document.querySelector("[data-stat-grammar]"),lexical:document.querySelector("[data-stat-lexical]")};oe.init();function b(e){return e.trim().toLowerCase()}function C(e){return String(e??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function J(){P.forEach(e=>{const t=e.dataset.category===s.category,r=e.dataset.category==="all"?s.category==="all":t;e.classList.toggle("chip--filled",r),e.setAttribute("aria-pressed",String(r))})}function se(e){var a;const t=((a=V[e.category])==null?void 0:a.label)??e.category,n=`lesson.html?topic=${encodeURIComponent(e.id)}&category=${encodeURIComponent(e.category)}&level=${encodeURIComponent(e.level)}&title=${encodeURIComponent(e.title)}&file=${encodeURIComponent(e.htmlPath)}`,r=Array.isArray(e.tags)?e.tags:[];return`
    <article class="lesson-card" data-lesson-id="${e.id}" data-category="${e.category}" data-level="${e.level}">
      <a class="lesson-card__link" href="${n}">
        <div class="lesson-card__meta">
          <span class="lesson-card__category">${t}</span>
          <span class="lesson-card__level" aria-label="Рівень">${e.level}</span>
        </div>
        <h3 class="lesson-card__title">${e.title}</h3>
        <p class="lesson-card__description">${e.description}</p>
        ${r.length?`<ul class="lesson-card__tags">${r.map(o=>`<li>${o}</li>`).join("")}</ul>`:""}
        <span class="lesson-card__cta">Перейти до матеріалу</span>
      </a>
    </article>
  `}function Y(e){const t=(e.topicIds||[]).map(o=>d.find(g=>g.id===o)).filter(Boolean),n=Array.from(new Set(t.map(o=>o.level))).sort(),r=t.filter(o=>o.category==="grammar").length,a=t.filter(o=>o.category==="lexical").length;return{topics:t,levels:n,grammarCount:r,lexicalCount:a}}function ce(e,t=Y(e)){const n=e.description||t.topics.map(o=>o.title).slice(0,3).join(", "),r=e.level||(t.levels.length?t.levels.join(", "):"мікси рівнів"),a=[];return r&&a.push(`Рівні: ${C(r)}`),t.grammarCount&&a.push(`Граматика: ${t.grammarCount}`),t.lexicalCount&&a.push(`Лексика: ${t.lexicalCount}`),`
    <article class="lesson-card lesson-card--custom" data-custom-lesson-id="${e.id}" data-custom-source="${e.source||"local"}">
      <a class="lesson-card__link" href="lesson.html?custom=${encodeURIComponent(e.id)}">
        
       <h3 class="lesson-card__title">${C(e.title)}</h3>
        ${a.length?`<p class="lesson-card__meta">${a.join(" · ")}</p>`:""}
        <p class="lesson-card__description">${C(n||"Урок містить кілька тем.")}</p>
        
        <span class="lesson-card__cta">Відкрити комбінований урок</span>
      </a>
    </article>
  `}function le(){return Array.isArray($)?$.filter(e=>e&&typeof e=="object"&&e.id).map((e,t)=>({...e,topicIds:Array.isArray(e.topicIds)?[...e.topicIds]:[],source:"preset",sortIndex:t})):[]}function ie(){return F().filter(e=>e&&typeof e=="object"&&e.id).map((e,t)=>({...e,topicIds:Array.isArray(e.topicIds)?[...e.topicIds]:[],source:"local",sortIndex:1e3+t}))}function ue(){const e=new Map;return le().forEach(t=>{e.has(t.id)||e.set(t.id,t)}),ie().forEach(t=>{e.set(t.id,t)}),Array.from(e.values())}function de(){const e=a=>{const o=a?new Date(a).getTime():0;return Number.isFinite(o)?o:0},n=ue().slice().sort((a,o)=>{const g=e(o.createdAt)-e(a.createdAt);return g!==0?g:(a.sortIndex||0)-(o.sortIndex||0)}).map(a=>{const o=Y(a);return{type:"custom",lesson:a,meta:o}}),r=d.map(a=>({type:"catalog",lesson:a}));return[...n,...r]}function fe(e){return s.category==="all"?!0:e.type==="catalog"?e.lesson.category===s.category:!1}function ge(e){var r;if(s.level==="all")return!0;if(e.type==="catalog")return e.lesson.level===s.level;const t=e.lesson.level;return t?t===s.level:(((r=e.meta)==null?void 0:r.levels)??[]).includes(s.level)}function pe(e,t){const r=((t==null?void 0:t.topics)??[]).flatMap(a=>[a.title,a.description,...a.tags||[]].filter(Boolean));return[e.title,e.description,...e.tags||[],e.level,...r].filter(Boolean).map(a=>b(String(a)))}function me(e,t){return t?e.type==="catalog"?[e.lesson.title,e.lesson.description,...e.lesson.tags??[]].filter(Boolean).map(a=>b(String(a))).some(a=>a.includes(t)):pe(e.lesson,e.meta).some(r=>r.includes(t)):!0}function he(){const e=de(),t=b(s.search);return e.filter(n=>!fe(n)||!ge(n)?!1:me(n,t))}function f(){if(!S||!v)return;const e=he();if(!e.length){S.innerHTML="",v.hidden=!1,p&&(p.dataset.hasResults="false");return}const t=e.map(n=>n.type==="custom"?ce(n.lesson,n.meta):se(n.lesson)).join("");S.innerHTML=t,v.hidden=!0,p&&(p.dataset.hasResults="true")}function ye(){i.total&&(i.total.textContent=String(d.length)),i.grammar&&(i.grammar.textContent=String(d.filter(e=>e.category==="grammar").length)),i.lexical&&(i.lexical.textContent=String(d.filter(e=>e.category==="lexical").length))}function Se(e){s.search=e.target.value,f()}function ve(e){s.level=e.target.value,f()}function Ce(e){const t=e.currentTarget.dataset.category;t&&(s.category=t,J(),f())}function Ae(){const e=document.querySelector('[data-component="copyright-year"]');e&&(e.textContent=String(new Date().getFullYear()))}function we(){ye(),J(),f(),Ae(),U&&U.addEventListener("input",Se),q&&q.addEventListener("change",ve),P.forEach(e=>{e.addEventListener("click",Ce)}),H(()=>{f()})}we();
//# sourceMappingURL=index.js.map
