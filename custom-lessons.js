import"./assets/main-Dnzr3yj7.js";import{l as v,a as y,s as _,c as L,d as k}from"./assets/custom-lessons-store-DyP-EnS8.js";const s=document.querySelector("[data-builder-form]"),u=document.querySelector("[data-builder-status]"),d=document.querySelector("[data-saved-list]"),b=document.querySelector("[data-saved-empty]"),S=Array.from(document.querySelectorAll("[data-builder-group]"));let m=[];function x(){const t=document.querySelector('[data-component="copyright-year"]');t&&(t.textContent=String(new Date().getFullYear()))}function E(t){return String(t||"").toLowerCase().replace(/\s+/g," ").trim()}function q(t){const n=`${t.title} ${t.description||""} ${(t.tags||[]).join(" ")}`,e=document.createElement("label");return e.className="checkbox builder-option",e.dataset.topicId=t.id,e.dataset.searchTokens=E(n),e.innerHTML=`
    <input type="checkbox" name="topics" value="${t.id}" data-category="${t.category}" />
    <span class="builder-option__content">
      <span class="builder-option__title">${t.title}</span>
      <span class="builder-option__meta">Рівень: ${t.level}${t.description?` · ${t.description}`:""}</span>
    </span>
  `,e}function T(){S.forEach(t=>{const n=t.dataset.builderGroup,e=t.querySelector("[data-group-list]");if(!n||!e)return;const o=v.filter(a=>a.category===n),c=document.createDocumentFragment();o.sort((a,i)=>a.title.localeCompare(i.title,"uk")).forEach(a=>c.appendChild(q(a))),e.appendChild(c)})}function $(t,n){const e=E(n),o=Array.from(t.querySelectorAll(".builder-option"));if(!e){o.forEach(a=>{a.hidden=!1}),t.dataset.matches=String(o.length);return}let c=0;o.forEach(a=>{const r=(a.dataset.searchTokens||"").includes(e);a.hidden=!r,r&&(c+=1)}),t.dataset.matches=String(c)}function D(t){const n=t.target,e=n==null?void 0:n.closest("[data-builder-group]");e&&$(e,n.value)}function N(t){const n=t.closest("[data-builder-group]");if(!n)return;const e=n.querySelector("[data-group-body]");if(!e)return;const o=e.hidden;e.hidden=!o,t.textContent=e.hidden?"Розгорнути":"Згорнути"}function A(){return s?Array.from(s.querySelectorAll('input[name="topics"]:checked')).map(t=>({id:t.value,category:t.dataset.category})):[]}function h(t,n="idle"){u&&(u.textContent=t,u.dataset.state=n)}function I(t){const n=E(t).replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"").slice(0,32),e=Date.now().toString(36);return`custom-${n||"lesson"}-${e}`}function w(t){t.preventDefault(),h("Зберігаємо…","saving");const n=new FormData(s),e=String(n.get("title")||"").trim();if(!e){h("Вкажіть назву уроку.","error");return}const o=A();if(!o.length){h("Оберіть принаймні одну тему.","error");return}const c=I(e),a=o.map(r=>r.id),i=L({id:c,title:e,topicIds:a});if(m=y(),g(),s.reset(),S.forEach(r=>{$(r,"")}),h(`Урок «${i.title}» збережено.`,"success"),u){const r=document.createElement("a");r.href=`lesson.html?custom=${encodeURIComponent(i.id)}`,r.textContent=" Відкрити",r.className="builder-status__link",u.appendChild(r)}}function F(t){const n=t.map(a=>v.find(i=>i.id===a)).filter(Boolean),e=n.filter(a=>a.category==="grammar").length,o=n.filter(a=>a.category==="communication").length,c=n.map(a=>a.title);return{grammarCount:e,communicationCount:o,titles:c}}function g(){if(!d||!b)return;const t=m.slice().sort((e,o)=>new Date(o.createdAt).getTime()-new Date(e.createdAt).getTime());if(d.innerHTML="",!t.length){b.hidden=!1;return}b.hidden=!0;const n=document.createDocumentFragment();t.forEach(e=>{const o=F(e.topicIds||[]),c=document.createElement("article");c.className="builder-card";const a=document.createElement("h3");a.className="builder-card__title",a.textContent=e.title;const i=document.createElement("p");i.className="builder-card__meta";const r=[];o.grammarCount&&r.push(`Граматика: ${o.grammarCount}`),o.communicationCount&&r.push(`Communication: ${o.communicationCount}`),i.textContent=r.join(" · ");const C=document.createElement("p");C.className="builder-card__topics",C.textContent=o.titles.join(", ");const p=document.createElement("div");p.className="builder-card__actions";const f=document.createElement("a");f.className="button button--ghost",f.href=`lesson.html?custom=${encodeURIComponent(e.id)}`,f.textContent="Відкрити";const l=document.createElement("button");l.className="button button--danger",l.type="button",l.dataset.deleteId=e.id,l.textContent="Видалити",p.appendChild(f),p.appendChild(l),c.appendChild(a),r.length&&c.appendChild(i),o.titles.length&&c.appendChild(C),c.appendChild(p),n.appendChild(c)}),d.appendChild(n)}function G(t){const n=t.target.closest("button[data-delete-id]");if(!n)return;const{deleteId:e}=n.dataset;if(!e)return;k(e)&&(m=y(),g())}function j(){m=y(),g()}function H(){S.forEach(t=>{const n=t.querySelector("[data-group-search]"),e=t.querySelector("[data-group-toggle]");n==null||n.addEventListener("input",D),e==null||e.addEventListener("click",o=>{N(o.currentTarget)})}),s==null||s.addEventListener("submit",w),d==null||d.addEventListener("click",G),_(t=>{m=t,g()})}function M(){x(),T(),j(),H()}M();
//# sourceMappingURL=custom-lessons.js.map
