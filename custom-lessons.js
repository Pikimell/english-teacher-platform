import"./assets/main-Cs3pyMuT.js";import{l as v,a as y,s as L,c as $,d as _}from"./assets/custom-lessons-store-BKMVZjuV.js";const i=document.querySelector("[data-builder-form]"),p=document.querySelector("[data-builder-status]"),d=document.querySelector("[data-saved-list]"),C=document.querySelector("[data-saved-empty]"),S=Array.from(document.querySelectorAll("[data-builder-group]"));let f=[];function q(){const t=document.querySelector('[data-component="copyright-year"]');t&&(t.textContent=String(new Date().getFullYear()))}function x(t){const n=String(t??"");return(typeof n.normalize=="function"?n.normalize("NFKD"):n).toLowerCase().replace(/[\u2019\u2018\u02bc'`]/g,"").replace(/[^a-z0-9\u0400-\u04FF]+/g," ").replace(/\s+/g," ").trim()}function D(t){const n=`${t.title} ${t.description||""} ${(t.tags||[]).join(" ")}`,e=document.createElement("label");return e.className="checkbox builder-option",e.dataset.topicId=t.id,e.dataset.searchSource=n,e.innerHTML=`
    <input type="checkbox" name="topics" value="${t.id}" data-category="${t.category}" />
    <span class="builder-option__content">
      <span class="builder-option__title">${t.title}</span>
      <span class="builder-option__meta">Рівень: ${t.level}${t.description?` · ${t.description}`:""}</span>
    </span>
  `,e}function N(){S.forEach(t=>{const n=t.dataset.builderGroup,e=t.querySelector("[data-group-list]");if(!n||!e)return;const o=v.filter(a=>a.category===n),r=document.createDocumentFragment();o.sort((a,s)=>a.title.localeCompare(s.title,"uk")).forEach(a=>r.appendChild(D(a))),e.innerHTML="",e.appendChild(r)})}function T(t){return x(t).split(" ").filter(Boolean)}function A(t){if(!t)return[];if(!t.dataset.searchTokensCache){const n=t.dataset.searchSource||t.textContent||"",e=T(n);t.dataset.searchTokensCache=e.join("|")}return t.dataset.searchTokensCache.split("|").filter(Boolean)}function E(t,n){t.hidden=!n,t.classList.toggle("is-hidden",!n)}function k(t,n){const e=Array.from(t.querySelectorAll(".builder-option")),o=T(n);if(o.length===0){e.forEach(a=>E(a,!0)),t.dataset.matches=String(e.length),t.removeAttribute("data-group-empty");return}let r=0;e.forEach(a=>{const s=A(a),c=o.every(u=>s.some(l=>l.includes(u)));E(a,c),c&&(r+=1)}),t.dataset.matches=String(r),r===0?t.dataset.groupEmpty="true":delete t.dataset.groupEmpty}function F(t){const n=t.target,e=n==null?void 0:n.closest("[data-builder-group]");e&&k(e,n.value)}function I(t){const n=t.closest("[data-builder-group]");if(!n)return;const e=n.querySelector("[data-group-body]");if(!e)return;const o=e.hidden;e.hidden=!o,t.textContent=e.hidden?"Розгорнути":"Згорнути"}function z(){return i?Array.from(i.querySelectorAll('input[name="topics"]:checked')).map(t=>({id:t.value,category:t.dataset.category})):[]}function h(t,n="idle"){p&&(p.textContent=t,p.dataset.state=n)}function w(t){const n=x(t).replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"").slice(0,32),e=Date.now().toString(36);return`custom-${n||"lesson"}-${e}`}function V(t){t.preventDefault(),h("Зберігаємо…","saving");const n=new FormData(i),e=String(n.get("title")||"").trim();if(!e){h("Вкажіть назву уроку.","error");return}const o=z();if(!o.length){h("Оберіть принаймні одну тему.","error");return}const r=w(e),a=o.map(c=>c.id),s=$({id:r,title:e,topicIds:a});if(f=y(),b(),i.reset(),S.forEach(c=>{k(c,"")}),h(`Урок «${s.title}» збережено.`,"success"),p){const c=document.createElement("a");c.href=`lesson.html?custom=${encodeURIComponent(s.id)}`,c.textContent=" Відкрити",c.className="builder-status__link",p.appendChild(c)}}function j(t){const n=t.map(a=>v.find(s=>s.id===a)).filter(Boolean),e=n.filter(a=>a.category==="grammar").length,o=n.filter(a=>a.category==="lexical").length,r=n.map(a=>a.title);return{grammarCount:e,lexicalCount:o,titles:r}}function b(){if(!d||!C)return;const t=f.slice().sort((e,o)=>new Date(o.createdAt).getTime()-new Date(e.createdAt).getTime());if(d.innerHTML="",!t.length){C.hidden=!1;return}C.hidden=!0;const n=document.createDocumentFragment();t.forEach(e=>{const o=j(e.topicIds||[]),r=document.createElement("article");r.className="builder-card";const a=document.createElement("h3");a.className="builder-card__title",a.textContent=e.title;const s=document.createElement("p");s.className="builder-card__meta";const c=[];o.grammarCount&&c.push(`Граматика: ${o.grammarCount}`),o.lexicalCount&&c.push(`Лексика: ${o.lexicalCount}`),s.textContent=c.join(" · ");const u=document.createElement("p");u.className="builder-card__topics",u.textContent=o.titles.join(", ");const l=document.createElement("div");l.className="builder-card__actions";const g=document.createElement("a");g.className="button button--ghost",g.href=`lesson.html?custom=${encodeURIComponent(e.id)}`,g.textContent="Відкрити";const m=document.createElement("button");m.className="button button--danger",m.type="button",m.dataset.deleteId=e.id,m.textContent="Видалити",l.appendChild(g),l.appendChild(m),r.appendChild(a),c.length&&r.appendChild(s),o.titles.length&&r.appendChild(u),r.appendChild(l),n.appendChild(r)}),d.appendChild(n)}function G(t){const n=t.target.closest("button[data-delete-id]");if(!n)return;const{deleteId:e}=n.dataset;if(!e)return;_(e)&&(f=y(),b())}function H(){f=y(),b()}function M(){S.forEach(t=>{const n=t.querySelector("[data-group-search]"),e=t.querySelector("[data-group-toggle]");n==null||n.addEventListener("input",F),e==null||e.addEventListener("click",o=>{I(o.currentTarget)})}),i==null||i.addEventListener("submit",V),d==null||d.addEventListener("click",G),L(t=>{f=t,b()})}function B(){q(),N(),H(),M()}B();
//# sourceMappingURL=custom-lessons.js.map
