import"./assets/main-Dnzr3yj7.js";import{l as $,a as b,s as x,c as _,d as L}from"./assets/custom-lessons-store-BSttwj8q.js";const s=document.querySelector("[data-builder-form]"),u=document.querySelector("[data-builder-status]"),d=document.querySelector("[data-saved-list]"),y=document.querySelector("[data-saved-empty]"),S=Array.from(document.querySelectorAll("[data-builder-group]"));let m=[];function k(){const t=document.querySelector('[data-component="copyright-year"]');t&&(t.textContent=String(new Date().getFullYear()))}function E(t){return String(t||"").toLowerCase().replace(/\s+/g," ").trim()}function q(t){const n=`${t.title} ${t.description||""} ${(t.tags||[]).join(" ")}`,e=document.createElement("label");return e.className="checkbox builder-option",e.dataset.topicId=t.id,e.dataset.searchTokens=E(n),e.innerHTML=`
    <input type="checkbox" name="topics" value="${t.id}" data-category="${t.category}" />
    <span class="builder-option__content">
      <span class="builder-option__title">${t.title}</span>
      <span class="builder-option__meta">Рівень: ${t.level}${t.description?` · ${t.description}`:""}</span>
    </span>
  `,e}function T(){S.forEach(t=>{const n=t.dataset.builderGroup,e=t.querySelector("[data-group-list]");if(!n||!e)return;const o=$.filter(r=>r.category===n),i=document.createDocumentFragment();o.sort((r,a)=>r.title.localeCompare(a.title,"uk")).forEach(r=>i.appendChild(q(r))),e.appendChild(i)})}function v(t,n){const e=E(n),o=Array.from(t.querySelectorAll(".builder-option"));if(!e){o.forEach(r=>{r.hidden=!1}),t.dataset.matches=String(o.length);return}let i=0;o.forEach(r=>{const c=(r.dataset.searchTokens||"").includes(e);r.hidden=!c,c&&(i+=1)}),t.dataset.matches=String(i)}function D(t){const n=t.target,e=n==null?void 0:n.closest("[data-builder-group]");e&&v(e,n.value)}function N(t){const n=t.closest("[data-builder-group]");if(!n)return;const e=n.querySelector("[data-group-body]");if(!e)return;const o=e.hidden;e.hidden=!o,t.textContent=e.hidden?"Розгорнути":"Згорнути"}function A(){return s?Array.from(s.querySelectorAll('input[name="topics"]:checked')).map(t=>({id:t.value,category:t.dataset.category})):[]}function h(t,n="idle"){u&&(u.textContent=t,u.dataset.state=n)}function I(t){const n=E(t).replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"").slice(0,32),e=Date.now().toString(36);return`custom-${n||"lesson"}-${e}`}function w(t){t.preventDefault(),h("Зберігаємо…","saving");const n=new FormData(s),e=String(n.get("title")||"").trim();if(!e){h("Вкажіть назву уроку.","error");return}const o=A();if(!o.length){h("Оберіть принаймні одну тему.","error");return}const i=I(e),r=o.map(c=>c.id),a=_({id:i,title:e,topicIds:r});if(m=b(),g(),s.reset(),S.forEach(c=>{v(c,"")}),h(`Урок «${a.title}» збережено.`,"success"),u){const c=document.createElement("a");c.href=`lesson.html?custom=${encodeURIComponent(a.id)}`,c.textContent=" Відкрити",c.className="builder-status__link",u.appendChild(c)}}function F(t){const n=t.map(a=>$.find(c=>c.id===a)).filter(Boolean),e=n.filter(a=>a.category==="grammar").length,o=n.filter(a=>a.category==="communication").length,i=n.filter(a=>a.category==="lexical").length,r=n.map(a=>a.title);return{grammarCount:e,communicationCount:o,lexicalCount:i,titles:r}}function g(){if(!d||!y)return;const t=m.slice().sort((e,o)=>new Date(o.createdAt).getTime()-new Date(e.createdAt).getTime());if(d.innerHTML="",!t.length){y.hidden=!1;return}y.hidden=!0;const n=document.createDocumentFragment();t.forEach(e=>{const o=F(e.topicIds||[]),i=document.createElement("article");i.className="builder-card";const r=document.createElement("h3");r.className="builder-card__title",r.textContent=e.title;const a=document.createElement("p");a.className="builder-card__meta";const c=[];o.grammarCount&&c.push(`Граматика: ${o.grammarCount}`),o.communicationCount&&c.push(`Комунікація: ${o.communicationCount}`),o.lexicalCount&&c.push(`Лексика: ${o.lexicalCount}`),a.textContent=c.join(" · ");const C=document.createElement("p");C.className="builder-card__topics",C.textContent=o.titles.join(", ");const p=document.createElement("div");p.className="builder-card__actions";const f=document.createElement("a");f.className="button button--ghost",f.href=`lesson.html?custom=${encodeURIComponent(e.id)}`,f.textContent="Відкрити";const l=document.createElement("button");l.className="button button--danger",l.type="button",l.dataset.deleteId=e.id,l.textContent="Видалити",p.appendChild(f),p.appendChild(l),i.appendChild(r),c.length&&i.appendChild(a),o.titles.length&&i.appendChild(C),i.appendChild(p),n.appendChild(i)}),d.appendChild(n)}function G(t){const n=t.target.closest("button[data-delete-id]");if(!n)return;const{deleteId:e}=n.dataset;if(!e)return;L(e)&&(m=b(),g())}function j(){m=b(),g()}function H(){S.forEach(t=>{const n=t.querySelector("[data-group-search]"),e=t.querySelector("[data-group-toggle]");n==null||n.addEventListener("input",D),e==null||e.addEventListener("click",o=>{N(o.currentTarget)})}),s==null||s.addEventListener("submit",w),d==null||d.addEventListener("click",G),x(t=>{m=t,g()})}function M(){k(),T(),j(),H()}M();
//# sourceMappingURL=custom-lessons.js.map
