{"version":3,"file":"lesson.js","sources":["../src/api/user.js","../src/features/practice/practice.js","../src/data/communication-words.js","../src/data/wordwall.js","../src/features/lesson/lesson.js","../src/api/chatGpt.js","../src/features/lesson/practice-generator.js"],"sourcesContent":["import axios from './axiosInstance.js';\n\nexport const getUsers = async (page = 1, limit = 1000) => {\n  const res = await axios.get('/user');\n  return res.data;\n  /* \n  items - це масив з студентами. У кожного студента є властивість email\n  */\n};\n","// Lightweight practice renderer for topic pages\n\nimport { addHomework } from '@api/homework.js';\nimport { getUsers } from '@api/user.js';\n\n// Convention: for page /X/indexN.html → fetch /X/practice/indexN.json\n(function () {\n  const basePath =\n    (typeof import.meta !== 'undefined' &&\n      import.meta.env &&\n      import.meta.env.BASE_URL) ||\n    '/';\n\n  function resolveAssetPath(path) {\n    const normalizedBase = basePath.endsWith('/') ? basePath : `${basePath}/`;\n    const rawPath = String(path || '');\n    if (/^[a-z]+:/i.test(rawPath)) return rawPath;\n    if (rawPath.startsWith(normalizedBase)) return rawPath;\n    return `${normalizedBase}${rawPath.replace(/^\\/+/, '')}`;\n  }\n  function derivePracticePath() {\n    try {\n      const url = new URL(window.location.href);\n      const parts = url.pathname.split('/');\n      let file = parts.pop();\n      if (!file || !/\\.html?$/i.test(file)) file = 'index.html';\n      const json = file.replace(/\\.html?$/i, '.json');\n      parts.push('practice', json);\n      return parts.join('/');\n    } catch (e) {\n      return null;\n    }\n  }\n\n  function el(tag, attrs = {}, ...children) {\n    const node = document.createElement(tag);\n    for (const [k, v] of Object.entries(attrs || {})) {\n      if (k === 'class') node.className = v;\n      else if (k === 'html') node.innerHTML = v;\n      else if (k.startsWith('on') && typeof v === 'function')\n        node.addEventListener(k.slice(2), v);\n      else node.setAttribute(k, v);\n    }\n    for (const ch of children) {\n      if (ch == null) continue;\n      node.appendChild(\n        typeof ch === 'string' ? document.createTextNode(ch) : ch\n      );\n    }\n    return node;\n  }\n\n  function shuffle(arr) {\n    const a = arr.slice();\n    for (let i = a.length - 1; i > 0; i--) {\n      const j = Math.floor(Math.random() * (i + 1));\n      [a[i], a[j]] = [a[j], a[i]];\n    }\n    return a;\n  }\n\n  function normalize(s) {\n    return String(s || '')\n      .trim()\n      .toLowerCase()\n      .replace(/\\s+/g, ' ');\n  }\n\n  const shareState = {\n    users: null,\n    request: null,\n    active: null,\n  };\n\n  function fetchStudents() {\n    if (shareState.users) return Promise.resolve(shareState.users);\n    if (shareState.request) return shareState.request;\n\n    shareState.request = getUsers()\n      .then(data => {\n        const items = Array.isArray(data?.items) ? data.items : [];\n        shareState.users = items;\n        return items;\n      })\n      .catch(error => {\n        console.error('Не вдалося завантажити список студентів', error);\n        throw error;\n      })\n      .finally(() => {\n        shareState.request = null;\n      });\n    return shareState.request;\n  }\n\n  function formatStudentName(student) {\n    if (!student || typeof student !== 'object') return 'Невідомий студент';\n    const possibleFirst =\n      student.firstName || student.firstname || student.nameFirst || '';\n    const possibleLast =\n      student.lastName || student.lastname || student.nameLast || '';\n    const full = [possibleFirst, possibleLast]\n      .map(part => String(part || '').trim())\n      .filter(Boolean)\n      .join(' ');\n    const display =\n      full ||\n      student.displayName ||\n      student.fullName ||\n      student.username ||\n      student.email ||\n      (student.id ? `ID ${student.id}` : '');\n    return display || 'Без імені';\n  }\n\n  function closeActiveSharePanel() {\n    if (!shareState.active) return;\n    const { panel, button } = shareState.active;\n    panel.style.display = 'none';\n    panel.dataset.open = 'false';\n    button.setAttribute('aria-expanded', 'false');\n    shareState.active = null;\n  }\n\n  function handleOutsideShareClick(event) {\n    if (!shareState.active) return;\n    const { panel, button } = shareState.active;\n    const target = event.target;\n    if (panel.contains(target) || button.contains(target)) return;\n    closeActiveSharePanel();\n  }\n\n  function handleShareKeydown(event) {\n    if (event.key === 'Escape') {\n      closeActiveSharePanel();\n    }\n  }\n\n  function renderStudentOptions(panel, students, task) {\n    panel.innerHTML = '';\n    if (!students.length) {\n      panel.appendChild(\n        el(\n          'div',\n          {\n            class: 'muted',\n            style: 'font-size:13px;text-align:center;padding:12px 8px;',\n          },\n          'Список студентів порожній'\n        )\n      );\n      return;\n    }\n    const list = el('ul', {\n      style:\n        'list-style:none;margin:0;padding:0;max-height:220px;overflow:auto;',\n    });\n    students.forEach(student => {\n      const button = el(\n        'button',\n        {\n          type: 'button',\n          style:\n            'width:100%;background:transparent;border:none;text-align:left;padding:8px 10px;border-radius:8px;cursor:pointer;display:flex;flex-direction:column;gap:2px;',\n          onmouseenter: () => {\n            button.style.backgroundColor = '#f1f5f9';\n          },\n          onmouseleave: () => {\n            button.style.backgroundColor = 'transparent';\n          },\n          onclick: () => {\n            const lessonId = window.location.search.slice(8);\n            const lessonName = document.querySelector('h1').textContent;\n\n            console.log(lessonId);\n\n            const homework = {\n              lessonId,\n              userEmail: student.email,\n              lessonName,\n              homeworkType: 'task',\n              homeworkData: JSON.stringify(task),\n            };\n\n            addHomework(homework);\n\n            closeActiveSharePanel();\n          },\n        },\n        el(\n          'span',\n          { style: 'font-size:14px;font-weight:600;color:#0f172a;' },\n          formatStudentName(student)\n        ),\n        student.email\n          ? el(\n              'span',\n              { class: 'muted', style: 'font-size:12px;color:#475569;' },\n              student.email\n            )\n          : null\n      );\n      const item = el('li', { style: 'margin:0;padding:0;' }, button);\n      list.appendChild(item);\n    });\n    panel.appendChild(list);\n  }\n\n  function createSharePanel() {\n    return el('div', {\n      class: 'practice-share-panel',\n      role: 'dialog',\n      'aria-label': 'Надсилання завдання студенту',\n      style:\n        'position:absolute;top:38px;right:0;min-width:240px;max-width:280px;border:1px solid #e2e8f0;border-radius:12px;background:#fff;box-shadow:0 18px 40px rgba(15,23,42,0.18);padding:8px;z-index:30;display:none;',\n      'data-open': 'false',\n    });\n  }\n\n  function toggleSharePanel(button, panel, task) {\n    const isOpen = panel.dataset.open === 'true';\n    if (isOpen) {\n      closeActiveSharePanel();\n      return;\n    }\n    if (shareState.active && shareState.active.panel !== panel) {\n      closeActiveSharePanel();\n    }\n    panel.dataset.open = 'true';\n    panel.style.display = 'block';\n    button.setAttribute('aria-expanded', 'true');\n    panel.innerHTML = '';\n    panel.appendChild(\n      el(\n        'div',\n        {\n          class: 'muted',\n          style: 'font-size:13px;padding:12px 8px;text-align:center;',\n        },\n        'Завантаження…'\n      )\n    );\n    shareState.active = { panel, button };\n    fetchStudents()\n      .then(students => {\n        renderStudentOptions(panel, students, task);\n      })\n      .catch(() => {\n        panel.innerHTML = '';\n        panel.appendChild(\n          el(\n            'div',\n            {\n              style:\n                'color:#ef4444;font-size:13px;text-align:center;padding:12px 8px;',\n            },\n            'Не вдалося завантажити студентів. Спробуйте ще раз.'\n          )\n        );\n      });\n  }\n\n  function createShareButton(task) {\n    const panel = createSharePanel();\n    const button = el(\n      'button',\n      {\n        type: 'button',\n        class: 'practice-share-trigger',\n        title: 'Надіслати студенту',\n        'aria-haspopup': 'dialog',\n        'aria-expanded': 'false',\n        style:\n          'border:none;background:#2563eb;color:#fff;padding:4px 10px;border-radius:999px;font-size:12px;line-height:1;cursor:pointer;box-shadow:0 4px 12px rgba(37,99,235,0.24);',\n        onclick: event => {\n          event.preventDefault();\n          toggleSharePanel(button, panel, task);\n        },\n      },\n      'Надіслати'\n    );\n    return { button, panel };\n  }\n\n  document.addEventListener('click', handleOutsideShareClick);\n  document.addEventListener('keydown', handleShareKeydown);\n\n  // Subtle hint toggle: hidden by default, shown on small button click\n  function makeHint(hintText) {\n    const wrap = el('div', { class: 'hint-wrap', style: 'margin-top:6px;' });\n    const btn = el(\n      'button',\n      {\n        type: 'button',\n        class: 'hint-toggle',\n        'aria-label': 'Показати підказку',\n        title: 'Підказка',\n        style:\n          'border:none;background:transparent;color:#94a3b8;cursor:pointer;padding:0;font-size:14px;line-height:1;',\n      },\n      '?'\n    );\n    const box = el(\n      'div',\n      {\n        class: 'hint-box muted',\n        style: 'display:none;margin-top:6px;color:#475569;',\n      },\n      `Підказка: ${hintText}`\n    );\n    btn.addEventListener('click', () => {\n      const isHidden = box.style.display === 'none';\n      box.style.display = isHidden ? 'block' : 'none';\n      btn.setAttribute('aria-expanded', isHidden ? 'true' : 'false');\n    });\n    wrap.appendChild(btn);\n    wrap.appendChild(box);\n    return wrap;\n  }\n\n  function renderMCQ(container, task) {\n    container.appendChild(\n      el('h3', {}, task.prompt || 'Choose the correct option')\n    );\n    const blocks = [];\n    (task.items || []).forEach((item, idx) => {\n      const name = `${task.id || 'mcq'}-${idx}`;\n      const allowMulti = Array.isArray(item.answer) && item.answer.length > 1;\n      const block = el(\n        'div',\n        {\n          class: 'mcq-item',\n          style:\n            'margin-bottom:10px;padding:10px;border:1px solid #e5e7eb;border-radius:10px;background:#fff;',\n        },\n        el(\n          'div',\n          { class: 'q', style: 'margin-bottom:8px;font-weight:600;' },\n          item.q\n        )\n      );\n      (item.choices || []).forEach((choice, cIdx) => {\n        const id = `${name}-${cIdx}`;\n        const lbl = el(\n          'label',\n          {\n            for: id,\n            style: 'display:flex;align-items:center;gap:8px;margin:4px 0;',\n          },\n          el('input', {\n            type: allowMulti ? 'checkbox' : 'radio',\n            name,\n            id,\n            value: String(cIdx),\n          }),\n          el('span', {}, choice)\n        );\n        block.appendChild(lbl);\n      });\n      if (item.explanation) {\n        block.appendChild(\n          el(\n            'div',\n            {\n              class: 'exp muted',\n              style: 'display:none;margin-top:6px;color:#475569;',\n            },\n            item.explanation\n          )\n        );\n      }\n      blocks.push({ block, item, name });\n      container.appendChild(block);\n    });\n    const result = el('div', {\n      class: 'result',\n      style: 'margin-top:8px;font-weight:600;',\n    });\n    const btn = el(\n      'button',\n      { type: 'button', class: 'btn primary', style: 'margin-top:8px;' },\n      'Перевірити'\n    );\n    btn.addEventListener('click', () => {\n      let correct = 0;\n      blocks.forEach(({ block, item, name }) => {\n        const answers = Array.isArray(item.answer)\n          ? item.answer.map(String)\n          : [String(item.answer)];\n        const inputs = Array.from(\n          block.querySelectorAll(`input[name='${name}']`)\n        );\n        const picked = inputs\n          .filter(i => i.checked)\n          .map(i => i.value)\n          .sort();\n        const expected = answers.slice().sort();\n        const ok =\n          picked.length === expected.length &&\n          picked.every((v, i) => v === expected[i]);\n        block.style.borderColor = ok ? '#10b981' : '#ef4444';\n        const exp = block.querySelector('.exp');\n        if (exp) exp.style.display = ok ? 'none' : 'block';\n        if (ok) correct++;\n      });\n      result.textContent = `Результат: ${correct}/${blocks.length}`;\n    });\n    container.appendChild(btn);\n    container.appendChild(result);\n  }\n\n  function renderGap(container, task) {\n    container.appendChild(el('h3', {}, task.prompt || 'Fill the gaps'));\n    const items = [];\n    (task.items || []).forEach((it, idx) => {\n      const row = el('div', {\n        style:\n          'margin-bottom:10px;padding:10px;border:1px solid #e5e7eb;border-radius:10px;background:#fff;',\n      });\n      const parts = String(it.q || '').split(/___/);\n      const input = el('input', {\n        type: 'text',\n        style: 'padding:6px 8px;border:1px solid #cbd5e1;border-radius:6px;',\n      });\n      if (parts.length > 1) {\n        row.appendChild(el('span', {}, parts[0]));\n        row.appendChild(input);\n        row.appendChild(el('span', {}, parts.slice(1).join('___')));\n      } else {\n        row.appendChild(\n          el('div', { style: 'margin-bottom:6px;font-weight:600;' }, it.q)\n        );\n        row.appendChild(input);\n      }\n      if (it.hint) row.appendChild(makeHint(it.hint));\n      items.push({\n        row,\n        input,\n        answers: (it.answer || []).map(a => normalize(a)),\n      });\n      container.appendChild(row);\n    });\n    const result = el('div', { style: 'margin-top:8px;font-weight:600;' });\n    const btn = el(\n      'button',\n      { type: 'button', class: 'btn primary', style: 'margin-top:8px;' },\n      'Перевірити'\n    );\n    btn.addEventListener('click', () => {\n      let correct = 0;\n      items.forEach(({ row, input, answers }) => {\n        const val = normalize(input.value);\n        const ok = answers.includes(val);\n        row.style.borderColor = ok ? '#10b981' : '#ef4444';\n        if (ok) correct++;\n      });\n      result.textContent = `Результат: ${correct}/${items.length}`;\n    });\n    container.appendChild(btn);\n    container.appendChild(result);\n  }\n\n  function renderMatch(container, task) {\n    container.appendChild(el('h3', {}, task.prompt || 'Match pairs'));\n    const pairs = task.pairs || [];\n    const rights = shuffle(pairs.map(p => p.right));\n    const rows = [];\n    pairs.forEach(p => {\n      const select = el(\n        'select',\n        {\n          style: 'padding:6px 8px;border:1px solid #cbd5e1;border-radius:6px;',\n        },\n        el('option', { value: '' }, '— обери —'),\n        ...rights.map(r => el('option', { value: r }, r))\n      );\n      const row = el(\n        'div',\n        {\n          style:\n            'display:flex;align-items:center;gap:10px;margin:8px 0;padding:10px;border:1px solid #e5e7eb;border-radius:10px;background:#fff;',\n        },\n        el('div', { style: 'min-width:160px;font-weight:600;' }, p.left),\n        select\n      );\n      rows.push({ row, select, right: p.right });\n      container.appendChild(row);\n    });\n    const result = el('div', { style: 'margin-top:8px;font-weight:600;' });\n    const btn = el(\n      'button',\n      { type: 'button', class: 'btn primary', style: 'margin-top:8px;' },\n      'Перевірити'\n    );\n    btn.addEventListener('click', () => {\n      let correct = 0;\n      rows.forEach(({ row, select, right }) => {\n        const ok = select.value === right;\n        row.style.borderColor = ok ? '#10b981' : '#ef4444';\n        if (ok) correct++;\n      });\n      result.textContent = `Результат: ${correct}/${rows.length}`;\n    });\n    container.appendChild(btn);\n    container.appendChild(result);\n  }\n\n  function renderContext(container, task) {\n    container.appendChild(\n      el('h3', {}, task.prompt || 'Прочитайте текст та дайте відповіді')\n    );\n\n    const context = task.context || {};\n    const format = String(context.format || 'narrative').toLowerCase();\n    const body = Array.isArray(context.body) ? context.body : [];\n    const textWrap = el('div', {\n      style:\n        'margin:12px 0;padding:14px;border:1px solid #cbd5e1;border-radius:10px;background:#f8fafc;',\n    });\n\n    if (context.title) {\n      textWrap.appendChild(\n        el('h4', { style: 'margin:0 0 8px;font-size:18px;' }, context.title)\n      );\n    }\n\n    if (format === 'dialog') {\n      body.forEach(turn => {\n        if (!turn) return;\n        const speaker =\n          typeof turn === 'object' && turn.speaker ? `${turn.speaker}:` : '';\n        const line =\n          typeof turn === 'object' && 'line' in turn\n            ? turn.line\n            : typeof turn === 'string'\n            ? turn\n            : '';\n        textWrap.appendChild(\n          el(\n            'p',\n            {\n              style:\n                'margin:4px 0;display:flex;gap:6px;align-items:flex-start;line-height:1.5;',\n            },\n            speaker ? el('strong', {}, speaker) : null,\n            el('span', {}, line)\n          )\n        );\n      });\n    } else {\n      body.forEach((paragraph, index) => {\n        const text =\n          typeof paragraph === 'string'\n            ? paragraph\n            : paragraph && paragraph.text\n            ? paragraph.text\n            : '';\n        if (!text) return;\n        textWrap.appendChild(\n          el('p', { style: index ? 'margin:8px 0 0;' : 'margin:0;' }, text)\n        );\n      });\n    }\n\n    container.appendChild(textWrap);\n\n    const questions = Array.isArray(task.questions) ? task.questions : [];\n    if (!questions.length) return;\n\n    const blocks = [];\n    questions.forEach((question, idx) => {\n      const block = el(\n        'div',\n        {\n          style:\n            'margin-bottom:12px;padding:12px;border:1px solid #e5e7eb;border-radius:10px;background:#fff;',\n        },\n        el(\n          'div',\n          { style: 'margin-bottom:8px;font-weight:600;' },\n          question.q || `Питання ${idx + 1}`\n        )\n      );\n\n      const answers = Array.isArray(question.answer)\n        ? question.answer.map(String)\n        : question.answer != null\n        ? [String(question.answer)]\n        : [];\n\n      if (Array.isArray(question.choices) && question.choices.length) {\n        const name = `${task.id || 'context'}-${idx}`;\n        const allowMulti = answers.length > 1;\n        const expectedIsIndex = answers.every(value => /^\\d+$/.test(value));\n        question.choices.forEach((choice, cIdx) => {\n          const id = `${name}-${cIdx}`;\n          block.appendChild(\n            el(\n              'label',\n              {\n                for: id,\n                style: 'display:flex;align-items:center;gap:8px;margin:4px 0;',\n              },\n              el('input', {\n                type: allowMulti ? 'checkbox' : 'radio',\n                name,\n                id,\n                value: String(cIdx),\n              }),\n              el('span', {}, choice)\n            )\n          );\n        });\n        blocks.push({\n          block,\n          type: 'choices',\n          allowMulti,\n          getPicked: () => {\n            const inputs = Array.from(\n              block.querySelectorAll(`input[name='${name}']`)\n            );\n            const picked = inputs\n              .filter(input => input.checked)\n              .map(input => input.value);\n            if (!expectedIsIndex) {\n              return picked.map(index =>\n                normalize(question.choices[Number(index)] || '')\n              );\n            }\n            return picked;\n          },\n          expected: expectedIsIndex\n            ? answers\n            : answers.map(answer => normalize(answer)),\n        });\n      } else {\n        const input = el('textarea', {\n          rows: 2,\n          style:\n            'width:100%;max-width:640px;padding:6px 8px;border:1px solid #cbd5e1;border-radius:6px;',\n        });\n        block.appendChild(input);\n        blocks.push({\n          block,\n          type: 'text',\n          input,\n          expected: answers.map(answer => normalize(answer)),\n        });\n      }\n\n      if (question.explanation) {\n        block.appendChild(\n          el(\n            'div',\n            {\n              class: 'muted',\n              style: 'display:none;margin-top:6px;color:#475569;',\n            },\n            question.explanation\n          )\n        );\n      }\n\n      container.appendChild(block);\n    });\n\n    const result = el('div', {\n      style: 'margin-top:8px;font-weight:600;',\n    });\n    const button = el(\n      'button',\n      { type: 'button', class: 'btn primary', style: 'margin-top:8px;' },\n      'Перевірити'\n    );\n\n    button.addEventListener('click', () => {\n      let correct = 0;\n      blocks.forEach(entry => {\n        let ok = false;\n        if (entry.type === 'choices') {\n          const picked = entry.getPicked().sort();\n          const expected = entry.expected.slice().sort();\n          ok =\n            picked.length === expected.length &&\n            picked.every((value, index) => value === expected[index]);\n        } else {\n          const value = normalize(entry.input.value);\n          ok = entry.expected.length\n            ? entry.expected.includes(value)\n            : Boolean(value);\n        }\n        entry.block.style.borderColor = ok ? '#10b981' : '#ef4444';\n        const explanation = entry.block.querySelector('.muted');\n        if (explanation) explanation.style.display = ok ? 'none' : 'block';\n        if (ok) correct++;\n      });\n      result.textContent = `Результат: ${correct}/${blocks.length}`;\n    });\n\n    container.appendChild(button);\n    container.appendChild(result);\n  }\n\n  function renderTask(container, task, taskKey, options = {}) {\n    const { showRemove = true } = options;\n    const keyBase =\n      taskKey ||\n      (task && task.id\n        ? String(task.id)\n        : `task-${Math.random().toString(16).slice(2, 8)}`);\n    const box = el('section', {\n      style: 'position:relative;margin:18px 0 26px;',\n      'data-task-id': task && task.id ? String(task.id) : '',\n      'data-task-key': keyBase,\n    });\n    const controls = el('div', {\n      style:\n        'position:absolute;top:6px;right:6px;display:flex;gap:6px;align-items:center;z-index:5;',\n    });\n    const { button: shareBtn, panel: sharePanel } = createShareButton(task);\n    controls.appendChild(shareBtn);\n    // Subtle remove button (top-right), hidden until hover/focus\n    if (showRemove) {\n      const removeBtn = el(\n        'button',\n        {\n          type: 'button',\n          title: 'Видалити завдання',\n          'aria-label': 'Видалити завдання',\n          style:\n            'border:none;background:transparent;color:#94a3b8;cursor:pointer;padding:2px;line-height:1;font-size:14px;opacity:0.6;',\n          onmouseenter: () => (removeBtn.style.opacity = '1'),\n          onmouseleave: () => (removeBtn.style.opacity = '0.6'),\n          onclick: () => {\n            if (shareState.active && shareState.active.panel === sharePanel) {\n              closeActiveSharePanel();\n            }\n            document.dispatchEvent(\n              new CustomEvent('practice:taskRemoved', {\n                detail: { key: keyBase, task },\n              })\n            );\n            box.remove();\n          },\n        },\n        '✕'\n      );\n      controls.appendChild(removeBtn);\n    }\n    box.appendChild(controls);\n    box.appendChild(sharePanel);\n    if (task.title) box.appendChild(el('h3', {}, task.title));\n    const rawType = task && task.type;\n    const normalizedType = String(rawType || '')\n      .trim()\n      .toLowerCase();\n    switch (normalizedType) {\n      case 'mcq':\n        renderMCQ(box, task);\n        break;\n      case 'gap':\n        renderGap(box, task);\n        break;\n      case 'match':\n        renderMatch(box, task);\n        break;\n      case 'context':\n        renderContext(box, task);\n        break;\n      case 'transform':\n        renderTransform(box, task);\n        break;\n      case 'error':\n        renderError(box, task);\n        break;\n      case 'order':\n        renderOrder(box, task);\n        break;\n      case 'short':\n        renderShort(box, task);\n        break;\n      case 'roleplay':\n        renderRoleplay(box, task);\n        break;\n      case 'dialogue-gap':\n        renderDialogueGap(box, task);\n        break;\n      case 'dialogue-order':\n        renderDialogueOrder(box, task);\n        break;\n      case 'truefalse':\n        renderTrueFalse(box, task);\n        break;\n      case 'definition-match': {\n        const matchTask = {\n          ...task,\n          prompt: task.prompt || 'Поєднай слово з визначенням',\n        };\n        renderMatch(box, matchTask);\n        break;\n      }\n      case 'synonym-clue':\n        renderSynonymClue(box, task);\n        break;\n      case 'scramble':\n        renderScramble(box, task);\n        break;\n      case 'wordpairs': {\n        const pairsTask = {\n          ...task,\n          prompt: task.prompt || 'Поєднай форму в однині та множині',\n        };\n        renderMatch(box, pairsTask);\n        break;\n      }\n      case 'odd-one-out':\n        renderOddOneOut(box, task);\n        break;\n      case 'open':\n        renderOpen(box, task);\n        break;\n      case 'writing':\n        renderWriting(box, task);\n        break;\n      default:\n        box.appendChild(\n          el('div', { class: 'muted' }, `Невідомий тип завдання: ${rawType}`)\n        );\n    }\n    container.appendChild(box);\n  }\n\n  // Expose minimal public API for dynamic appends\n  window.practice = window.practice || {};\n  window.practice.appendTask = function (task, meta = {}) {\n    const root = ensurePracticeContainer();\n    if (!root || !task) return;\n    const body = root.querySelector('#practice-body') || root;\n    const allowRemove = meta.showRemove !== false;\n    renderTask(body, task, meta.key, { showRemove: allowRemove });\n  };\n\n  window.practice.renderTaskList = function (target, tasks, options = {}) {\n    if (!target) return null;\n    const entries = Array.isArray(tasks) ? tasks.filter(Boolean) : [];\n    const {\n      title,\n      level,\n      description,\n      keyPrefix = 'inline',\n      showEmptyNote = false,\n      showRemove = false,\n    } = options;\n\n    if (!entries.length) {\n      if (showEmptyNote) {\n        const note = el(\n          'p',\n          { class: 'muted practice-inline__empty' },\n          'Практика для цієї теми поки відсутня.'\n        );\n        target.appendChild(note);\n      }\n      return null;\n    }\n\n    const wrapper = el('section', { class: 'practice-inline' });\n\n    if (title || level || description) {\n      const header = el('header', { class: 'practice-inline__header' });\n      if (title) {\n        header.appendChild(\n          el('h3', { class: 'practice-inline__title' }, title)\n        );\n      }\n      if (level) {\n        header.appendChild(\n          el('span', { class: 'practice-inline__badge' }, level)\n        );\n      }\n      if (description) {\n        header.appendChild(\n          el('p', { class: 'practice-inline__description muted' }, description)\n        );\n      }\n      wrapper.appendChild(header);\n    }\n\n    entries.forEach((task, index) => {\n      const key = `${keyPrefix}-${index}`;\n      renderTask(wrapper, task, key, { showRemove });\n    });\n\n    target.appendChild(wrapper);\n    document.dispatchEvent(\n      new CustomEvent('practice:inlineRendered', {\n        detail: {\n          tasks: entries,\n          container: target,\n          options,\n        },\n      })\n    );\n    return wrapper;\n  };\n\n  async function fetchPracticeCandidate(path) {\n    if (!path) return null;\n    const resolvedPath = resolveAssetPath(path);\n    try {\n      const res = await fetch(resolvedPath, { cache: 'no-store' });\n      if (!res.ok) return null;\n      return await res.json();\n    } catch (error) {\n      return null;\n    }\n  }\n\n  async function loadData() {\n    const inline = document.getElementById('practice-data');\n    if (inline) {\n      try {\n        return JSON.parse(inline.textContent);\n      } catch (error) {\n        return null;\n      }\n    }\n\n    const context = window.lessonContext || {};\n    const candidates = new Set();\n\n    if (context.id) {\n      candidates.add(`data/practice/${context.id}.json`);\n    }\n\n    if (context.htmlPath) {\n      const normalized = String(context.htmlPath)\n        .replace(/^\\.\\/?/, '')\n        .replace(/\\.html?$/i, '');\n      if (normalized) {\n        candidates.add(`data/practice/${normalized}.json`);\n        const segments = normalized.split('/');\n        const last = segments[segments.length - 1];\n        if (last) {\n          candidates.add(`data/practice/${last}.json`);\n        }\n      }\n    }\n\n    for (const candidate of candidates) {\n      const data = await fetchPracticeCandidate(candidate);\n      if (data) return data;\n    }\n\n    const fallbackPath = derivePracticePath();\n    if (!fallbackPath) return null;\n    return await fetchPracticeCandidate(fallbackPath);\n  }\n\n  // ============ Extra renderers (moved inside closure) ============\n  function renderTransform(container, task) {\n    container.appendChild(\n      el('h3', {}, task.prompt || 'Transform the sentence')\n    );\n    const items = [];\n    (task.items || []).forEach(it => {\n      const row = el('div', {\n        style:\n          'margin-bottom:10px;padding:10px;border:1px solid #e5e7eb;border-radius:10px;background:#fff;',\n      });\n      row.appendChild(\n        el('div', { style: 'margin-bottom:6px;font-weight:600;' }, it.q)\n      );\n      const input = el('input', {\n        type: 'text',\n        style:\n          'width:100%;max-width:640px;padding:6px 8px;border:1px solid #cbd5e1;border-radius:6px;',\n      });\n      row.appendChild(input);\n      if (it.hint) row.appendChild(makeHint(it.hint));\n      items.push({\n        row,\n        input,\n        answers: (it.answer || []).map(a => normalize(a)),\n      });\n      container.appendChild(row);\n    });\n    const result = el('div', { style: 'margin-top:8px;font-weight:600;' });\n    const btn = el(\n      'button',\n      { type: 'button', class: 'btn primary', style: 'margin-top:8px;' },\n      'Перевірити'\n    );\n    btn.addEventListener('click', () => {\n      let correct = 0;\n      items.forEach(({ row, input, answers }) => {\n        const ok = answers.includes(normalize(input.value));\n        row.style.borderColor = ok ? '#10b981' : '#ef4444';\n        if (ok) correct++;\n      });\n      result.textContent = `Результат: ${correct}/${items.length}`;\n    });\n    container.appendChild(btn);\n    container.appendChild(result);\n  }\n\n  function renderError(container, task) {\n    container.appendChild(\n      el('h3', {}, task.prompt || 'Find and correct the error')\n    );\n    const items = [];\n    (task.items || []).forEach(it => {\n      const row = el('div', {\n        style:\n          'margin-bottom:10px;padding:10px;border:1px solid #e5e7eb;border-radius:10px;background:#fff;',\n      });\n      row.appendChild(\n        el('div', { style: 'margin-bottom:6px;font-weight:600;' }, it.q)\n      );\n      const input = el('input', {\n        type: 'text',\n        style:\n          'width:100%;max-width:640px;padding:6px 8px;border:1px solid #cbd5e1;border-radius:6px;',\n      });\n      row.appendChild(input);\n      if (it.hint) row.appendChild(makeHint(it.hint));\n      items.push({\n        row,\n        input,\n        answers: (it.answer || []).map(a => normalize(a)),\n      });\n      container.appendChild(row);\n    });\n    const result = el('div', { style: 'margin-top:8px;font-weight:600;' });\n    const btn = el(\n      'button',\n      { type: 'button', class: 'btn primary', style: 'margin-top:8px;' },\n      'Перевірити'\n    );\n    btn.addEventListener('click', () => {\n      let correct = 0;\n      items.forEach(({ row, input, answers }) => {\n        const ok = answers.includes(normalize(input.value));\n        row.style.borderColor = ok ? '#10b981' : '#ef4444';\n        if (ok) correct++;\n      });\n      result.textContent = `Результат: ${correct}/${items.length}`;\n    });\n    container.appendChild(btn);\n    container.appendChild(result);\n  }\n\n  function renderOrder(container, task) {\n    container.appendChild(\n      el('h3', {}, task.prompt || 'Put the words in order')\n    );\n    const blocks = [];\n    (task.items || []).forEach((it, idx) => {\n      const correctStr = normalize(\n        Array.isArray(it.answer) ? it.answer.join(' ') : it.answer\n      );\n      const pool = shuffle((it.tokens || []).slice());\n      const row = el('div', {\n        style:\n          'margin:10px 0;padding:10px;border:1px solid #e5e7eb;border-radius:10px;background:#fff;',\n      });\n      const poolWrap = el('div', {\n        style: 'display:flex;flex-wrap:wrap;gap:6px;margin-bottom:6px;',\n      });\n      const outWrap = el('div', {\n        style:\n          'display:flex;flex-wrap:wrap;gap:6px;min-height:36px;padding:6px;border:1px dashed #cbd5e1;border-radius:8px;background:#f8fafc;',\n      });\n      const used = new Set();\n      function makeBtn(word, i) {\n        const b = el(\n          'button',\n          {\n            type: 'button',\n            style:\n              'padding:4px 8px;border:1px solid #cbd5e1;border-radius:6px;background:#fff;cursor:pointer;',\n          },\n          word\n        );\n        b.addEventListener('click', () => {\n          if (used.has(i)) return;\n          used.add(i);\n          b.style.opacity = 0.5;\n          outWrap.appendChild(\n            el(\n              'span',\n              {\n                class: 'chip',\n                style:\n                  'padding:4px 8px;border:1px solid #cbd5e1;border-radius:6px;background:#fff;',\n              },\n              word\n            )\n          );\n        });\n        return b;\n      }\n      pool.forEach((w, i) => poolWrap.appendChild(makeBtn(w, `${idx}-${i}`)));\n      const actions = el('div', {\n        style: 'margin-top:6px;display:flex;gap:8px;',\n      });\n      const reset = el('button', { type: 'button', class: 'btn' }, 'Скинути');\n      reset.addEventListener('click', () => {\n        used.clear();\n        outWrap.innerHTML = '';\n        Array.from(poolWrap.children).forEach(ch => (ch.style.opacity = 1));\n        row.style.borderColor = '#e5e7eb';\n      });\n      actions.appendChild(reset);\n      row.appendChild(\n        el('div', { style: 'margin-bottom:6px;font-weight:600;' }, it.q || '')\n      );\n      row.appendChild(poolWrap);\n      row.appendChild(outWrap);\n      row.appendChild(actions);\n      blocks.push({ row, outWrap, correctStr });\n      container.appendChild(row);\n    });\n    const result = el('div', { style: 'margin-top:8px;font-weight:600;' });\n    const btn = el(\n      'button',\n      { type: 'button', class: 'btn primary', style: 'margin-top:8px;' },\n      'Перевірити'\n    );\n    btn.addEventListener('click', () => {\n      let correct = 0;\n      blocks.forEach(({ row, outWrap, correctStr }) => {\n        const built = normalize(\n          Array.from(outWrap.querySelectorAll('.chip'))\n            .map(n => n.textContent)\n            .join(' ')\n        );\n        const ok = built === correctStr;\n        row.style.borderColor = ok ? '#10b981' : '#ef4444';\n        if (ok) correct++;\n      });\n      result.textContent = `Результат: ${correct}/${blocks.length}`;\n    });\n    container.appendChild(btn);\n    container.appendChild(result);\n  }\n\n  function renderShort(container, task) {\n    container.appendChild(el('h3', {}, task.prompt || 'Short answer'));\n    const items = [];\n    (task.items || []).forEach(it => {\n      const row = el('div', {\n        style:\n          'margin-bottom:10px;padding:10px;border:1px solid #e5e7eb;border-radius:10px;background:#fff;',\n      });\n      row.appendChild(\n        el('div', { style: 'margin-bottom:6px;font-weight:600;' }, it.q)\n      );\n      const input = el('textarea', {\n        rows: 3,\n        style:\n          'width:100%;max-width:720px;padding:6px 8px;border:1px solid #cbd5e1;border-radius:6px;',\n      });\n      row.appendChild(input);\n      items.push({\n        row,\n        input,\n        keywords: (it.keywords || []).map(k => normalize(k)),\n      });\n      container.appendChild(row);\n    });\n    const result = el('div', { style: 'margin-top:8px;font-weight:600;' });\n    const btn = el(\n      'button',\n      { type: 'button', class: 'btn primary', style: 'margin-top:8px;' },\n      'Перевірити'\n    );\n    btn.addEventListener('click', () => {\n      let sum = 0,\n        total = 0;\n      items.forEach(({ row, input, keywords }) => {\n        const text = normalize(input.value);\n        const matched = keywords.filter(k => text.includes(k)).length;\n        sum += matched;\n        total += keywords.length;\n        row.style.borderColor =\n          matched === keywords.length\n            ? '#10b981'\n            : matched > 0\n            ? '#f59e0b'\n            : '#ef4444';\n        const info =\n          row.querySelector('.short-info') ||\n          el('div', {\n            class: 'short-info',\n            style: 'margin-top:6px;color:#475569;',\n          });\n        info.textContent = `Збіги ключових слів: ${matched}/${keywords.length}`;\n        if (!row.contains(info)) row.appendChild(info);\n      });\n      result.textContent = `Загальний збіг ключових слів: ${sum}/${total}`;\n    });\n    container.appendChild(btn);\n    container.appendChild(result);\n  }\n\n  function renderOpen(container, task) {\n    container.appendChild(\n      el('h3', {}, task.prompt || 'Відповіді у вільній формі')\n    );\n\n    const items = Array.isArray(task && task.items)\n      ? task.items.filter(Boolean)\n      : [];\n    if (items.length) {\n      const list = el('div', {\n        style: 'display:flex;flex-direction:column;gap:12px;margin-top:12px;',\n      });\n      items.forEach((item, index) => {\n        const entry = el('div', {\n          style:\n            'padding:12px;border:1px solid #e5e7eb;border-radius:10px;background:#fff;',\n        });\n        const situation =\n          (item && (item.situation || item.prompt || item.q)) ||\n          `Ситуація ${index + 1}`;\n        entry.appendChild(\n          el(\n            'div',\n            { style: 'margin:0 0 6px;font-weight:600;color:#0f172a;' },\n            situation\n          )\n        );\n\n        const examples =\n          item && Array.isArray(item.example_answers)\n            ? item.example_answers.filter(Boolean)\n            : [];\n        if (examples.length) {\n          entry.appendChild(\n            el(\n              'div',\n              { class: 'muted', style: 'margin:0 0 6px;color:#64748b;' },\n              'Приклад відповіді:'\n            )\n          );\n          const chips = el('div', {\n            style: 'display:flex;flex-wrap:wrap;gap:8px;',\n          });\n          examples.forEach(answer => {\n            chips.appendChild(\n              el(\n                'span',\n                {\n                  style:\n                    'display:inline-flex;align-items:center;padding:4px 10px;border-radius:9999px;background:#e2e8f0;color:#0f172a;font-size:14px;',\n                },\n                answer\n              )\n            );\n          });\n          entry.appendChild(chips);\n        }\n        list.appendChild(entry);\n      });\n      container.appendChild(list);\n    }\n\n    const criteria =\n      task && task.scoring && Array.isArray(task.scoring.criteria)\n        ? task.scoring.criteria.filter(Boolean)\n        : [];\n    if (criteria.length) {\n      const scoringBox = el('div', {\n        style:\n          'margin-top:16px;padding:14px;border:1px dashed #cbd5e1;border-radius:10px;background:#f8fafc;',\n      });\n      scoringBox.appendChild(\n        el(\n          'h4',\n          {\n            style:\n              'margin:0 0 8px;font-size:16px;font-weight:600;color:#0f172a;',\n          },\n          'Критерії оцінювання'\n        )\n      );\n      const list = el('ul', {\n        style: 'margin:0;padding-left:18px;color:#475569;',\n      });\n      criteria.forEach(criterion => {\n        list.appendChild(el('li', { style: 'margin:4px 0;' }, criterion));\n      });\n      scoringBox.appendChild(list);\n      container.appendChild(scoringBox);\n    }\n  }\n\n  function renderRoleplay(container, task) {\n    container.appendChild(el('h3', {}, task.prompt || 'Role-play scenario'));\n\n    const scenario =\n      task && typeof task.scenario === 'object' ? task.scenario : {};\n    const infoBox = el('div', {\n      style:\n        'margin:12px 0;padding:14px;border:1px solid #cbd5e1;border-radius:10px;background:#f8fafc;',\n    });\n    let infoAdded = false;\n\n    if (scenario.setting) {\n      infoBox.appendChild(\n        el(\n          'p',\n          { style: 'margin:0 0 6px;font-weight:600;' },\n          `Локація: ${scenario.setting}`\n        )\n      );\n      infoAdded = true;\n    }\n\n    if (scenario.summary) {\n      infoBox.appendChild(\n        el('p', { style: 'margin:0;color:#334155;' }, scenario.summary)\n      );\n      infoAdded = true;\n    }\n\n    if (infoAdded) {\n      container.appendChild(infoBox);\n    }\n\n    const roles = Array.isArray(scenario.roles) ? scenario.roles : [];\n    if (roles.length) {\n      const rolesWrap = el('div', {\n        style:\n          'display:grid;gap:12px;margin-top:12px;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));',\n      });\n      roles.forEach((role, index) => {\n        const name = (role && role.name) || `Student ${index + 1}`;\n        const roleBox = el(\n          'div',\n          {\n            style:\n              'padding:14px;border:1px solid #e5e7eb;border-radius:10px;background:#fff;box-shadow:0 1px 0 rgba(148, 163, 184, 0.2);',\n          },\n          el('div', { style: 'font-weight:600;margin-bottom:6px;' }, name)\n        );\n\n        if (role && role.goal) {\n          roleBox.appendChild(\n            el(\n              'p',\n              { style: 'margin:0 0 6px;color:#0f172a;' },\n              `Мета: ${role.goal}`\n            )\n          );\n        }\n\n        const rawDetails =\n          role && Array.isArray(role.details)\n            ? role.details\n            : typeof role?.details === 'string'\n            ? role.details.split(/[;,\\n]/)\n            : [];\n        const details = rawDetails\n          .map(item => String(item || '').trim())\n          .filter(Boolean);\n        if (details.length === 1) {\n          roleBox.appendChild(\n            el('p', { style: 'margin:0;color:#475569;' }, details[0])\n          );\n        } else if (details.length > 1) {\n          const list = el('ul', {\n            style: 'margin:0;padding-left:18px;color:#475569;',\n          });\n          details.forEach(detail => {\n            list.appendChild(el('li', { style: 'margin:2px 0;' }, detail));\n          });\n          roleBox.appendChild(list);\n        }\n\n        rolesWrap.appendChild(roleBox);\n      });\n      container.appendChild(rolesWrap);\n    }\n\n    const steps = Array.isArray(scenario.steps) ? scenario.steps : [];\n    if (steps.length) {\n      const stepsWrap = el('div', {\n        style:\n          'margin-top:16px;padding:14px;border:1px solid #e5e7eb;border-radius:10px;background:#fff;',\n      });\n      stepsWrap.appendChild(\n        el(\n          'h4',\n          {\n            style:\n              'margin:0 0 6px;font-size:16px;font-weight:600;color:#0f172a;',\n          },\n          'Покроковий план діалогу'\n        )\n      );\n      const list = el('ol', {\n        style: 'margin:0 0 0 18px;padding:0;color:#475569;',\n      });\n      steps.forEach(step => {\n        if (!step) return;\n        list.appendChild(el('li', { style: 'margin:4px 0;' }, step));\n      });\n      stepsWrap.appendChild(list);\n      container.appendChild(stepsWrap);\n    }\n\n    const phrases = Array.isArray(task && task.phrases) ? task.phrases : [];\n    if (phrases.length) {\n      container.appendChild(\n        el(\n          'h4',\n          {\n            style:\n              'margin:18px 0 8px;font-size:16px;font-weight:600;color:#0f172a;',\n          },\n          'Корисні фрази для діалогу'\n        )\n      );\n      const list = el('div', {\n        style: 'display:flex;flex-direction:column;gap:8px;',\n      });\n      phrases.forEach(item => {\n        const phraseText =\n          typeof item === 'string'\n            ? item\n            : item && (item.phrase || item.text || item.value || '');\n        const translation =\n          item && typeof item === 'object'\n            ? item.translation || item.note || item.ua || item.uk || ''\n            : '';\n        if (!phraseText) return;\n        const id = `phrase-${Math.random().toString(36).slice(2, 8)}`;\n        list.appendChild(\n          el(\n            'label',\n            {\n              for: id,\n              style:\n                'display:flex;gap:10px;align-items:flex-start;padding:10px 12px;border:1px solid #e5e7eb;border-radius:10px;background:#fff;',\n            },\n            el('input', { id, type: 'checkbox', style: 'margin-top:4px;' }),\n            el(\n              'div',\n              {},\n              el(\n                'span',\n                { style: 'font-weight:600;color:#0f172a;' },\n                phraseText\n              ),\n              translation\n                ? el(\n                    'span',\n                    {\n                      class: 'muted',\n                      style: 'display:block;margin-top:4px;color:#475569;',\n                    },\n                    translation\n                  )\n                : null\n            )\n          )\n        );\n      });\n      container.appendChild(list);\n    }\n  }\n\n  function renderDialogueGap(container, task) {\n    container.appendChild(\n      el('h3', {}, task.prompt || 'Заповніть пропуски у діалозі')\n    );\n\n    const answers = Array.isArray(task?.answers)\n      ? task.answers.map(item => normalize(item))\n      : [];\n    const blanks = [];\n    let activeBlank = null;\n\n    function setActive(blank) {\n      if (activeBlank && activeBlank !== blank) {\n        activeBlank.style.boxShadow = 'none';\n      }\n      if (blank && activeBlank !== blank) {\n        blank.style.boxShadow = '0 0 0 2px rgba(37, 99, 235, 0.35)';\n        activeBlank = blank;\n      } else {\n        if (blank) blank.style.boxShadow = 'none';\n        activeBlank = null;\n      }\n    }\n\n    function clearBlank(blank) {\n      if (!blank) return;\n      blank.dataset.value = '';\n      blank.textContent = '___';\n      blank.style.borderColor = '#cbd5e1';\n      blank.style.background = '#fff';\n      blank.style.boxShadow = 'none';\n    }\n\n    const bank = el('div', {\n      style:\n        'display:flex;flex-wrap:wrap;gap:8px;margin:12px 0;padding:10px;border:1px solid #e2e8f0;border-radius:10px;background:#f8fafc;',\n    });\n    const words = Array.isArray(task?.words) ? task.words : [];\n    const seenWords = new Set();\n    const uniqueWords = [];\n    words.forEach(word => {\n      const value = String(word || '').trim();\n      if (!value) return;\n      const signature = normalize(value);\n      if (seenWords.has(signature)) return;\n      seenWords.add(signature);\n      uniqueWords.push(value);\n    });\n\n    uniqueWords.forEach(value => {\n      const btn = el(\n        'button',\n        {\n          type: 'button',\n          class: 'btn',\n          style:\n            'padding:6px 10px;border:1px solid #94a3b8;border-radius:999px;background:#fff;color:#0f172a;cursor:pointer;font-size:14px;line-height:1;',\n          onclick: () => {\n            const target =\n              activeBlank || blanks.find(blank => !blank.dataset.value);\n            if (!target) return;\n\n            target.dataset.value = value;\n            target.textContent = value;\n            target.style.borderColor = '#2563eb';\n            target.style.background = '#eef2ff';\n            setActive(null);\n          },\n        },\n        value\n      );\n      btn.dataset.word = value;\n      bank.appendChild(btn);\n    });\n    if (bank.children.length) {\n      container.appendChild(bank);\n    }\n\n    const dialogueWrap = el('div', {\n      style: 'display:flex;flex-direction:column;gap:10px;',\n    });\n    const dialogue = Array.isArray(task?.dialogue) ? task.dialogue : [];\n    let blankIndex = 0;\n    dialogue.forEach(turn => {\n      if (!turn) return;\n      const speaker = turn.speaker || turn.role || '';\n      const line = turn.line || turn.text || '';\n      const row = el(\n        'div',\n        {\n          style:\n            'padding:12px;border:1px solid #e5e7eb;border-radius:10px;background:#fff;display:flex;gap:10px;align-items:flex-start;',\n        },\n        speaker\n          ? el('strong', { style: 'min-width:90px;' }, `${speaker}:`)\n          : null\n      );\n      const textWrap = el('div', {\n        style: 'display:flex;flex-wrap:wrap;gap:6px;align-items:center;',\n      });\n      const parts = String(line || '').split(/___/);\n      parts.forEach((part, idx) => {\n        if (part) {\n          textWrap.appendChild(el('span', {}, part));\n        }\n        if (idx < parts.length - 1) {\n          const expected = answers[blankIndex] || '';\n          const blank = el(\n            'button',\n            {\n              type: 'button',\n              style:\n                'min-width:52px;padding:4px 10px;border:1px solid #cbd5e1;border-radius:8px;background:#fff;color:#0f172a;cursor:pointer;',\n              onclick: () => {\n                if (blank.dataset.value) {\n                  clearBlank(blank);\n                  setActive(blank);\n                  return;\n                }\n                if (activeBlank === blank) {\n                  setActive(null);\n                } else {\n                  setActive(blank);\n                }\n              },\n              ondblclick: () => {\n                clearBlank(blank);\n                setActive(null);\n              },\n            },\n            '___'\n          );\n          blank.dataset.expected = expected;\n          blank.dataset.index = String(blankIndex);\n          blanks.push(blank);\n          blankIndex += 1;\n          textWrap.appendChild(blank);\n        }\n      });\n      row.appendChild(textWrap);\n      dialogueWrap.appendChild(row);\n    });\n\n    container.appendChild(dialogueWrap);\n\n    const actions = el('div', {\n      style:\n        'margin-top:14px;display:flex;gap:10px;flex-wrap:wrap;align-items:center;',\n    });\n    const checkBtn = el(\n      'button',\n      { type: 'button', class: 'btn primary' },\n      'Перевірити'\n    );\n    const resetBtn = el('button', { type: 'button', class: 'btn' }, 'Скинути');\n    const result = el('div', {\n      style: 'font-weight:600;color:#0f172a;',\n    });\n\n    checkBtn.addEventListener('click', () => {\n      let correct = 0;\n      blanks.forEach(blank => {\n        const expected = blank.dataset.expected || '';\n        const value = normalize(blank.dataset.value || blank.textContent || '');\n        const ok = expected ? value === expected : Boolean(value);\n        blank.style.borderColor = ok ? '#10b981' : '#ef4444';\n        blank.style.background = ok ? '#ecfdf5' : '#fee2e2';\n        if (ok) correct += 1;\n      });\n      if (blanks.length) {\n        result.textContent = `Результат: ${correct}/${blanks.length}`;\n      } else {\n        result.textContent = '';\n      }\n    });\n\n    resetBtn.addEventListener('click', () => {\n      blanks.forEach(blank => clearBlank(blank));\n      result.textContent = '';\n      setActive(null);\n    });\n\n    actions.appendChild(checkBtn);\n    actions.appendChild(resetBtn);\n    actions.appendChild(result);\n    container.appendChild(actions);\n  }\n\n  function renderDialogueOrder(container, task) {\n    container.appendChild(el('h3', {}, task.prompt || 'Упорядкуйте діалог'));\n\n    const lines = Array.isArray(task?.lines)\n      ? task.lines.map(line => ({\n          speaker: line?.speaker || line?.role || '',\n          text: line?.line || line?.text || '',\n        }))\n      : [];\n    const solution = Array.isArray(task?.solution)\n      ? task.solution.map(value => Number.parseInt(value, 10))\n      : lines.map((_, index) => index);\n\n    const poolWrap = el('div', {\n      style:\n        'display:flex;flex-direction:column;gap:8px;margin-top:10px;padding:10px;border:1px solid #e2e8f0;border-radius:10px;background:#f8fafc;',\n    });\n    const outWrap = el('div', {\n      style:\n        'margin-top:14px;padding:12px;border:1px dashed #cbd5e1;border-radius:10px;min-height:80px;display:flex;flex-direction:column;gap:8px;',\n    });\n    const used = new Set();\n\n    function makeLabel({ speaker, text }) {\n      const content = speaker ? `${speaker}: ${text}` : text;\n      return content.trim();\n    }\n\n    function removeChip(chip) {\n      if (!chip) return;\n      const index = Number.parseInt(chip.dataset.index || '-1', 10);\n      const sourceId = chip.dataset.buttonId;\n      if (sourceId) {\n        const btn = poolWrap.querySelector(`[data-id=\"${sourceId}\"]`);\n        if (btn) {\n          btn.disabled = false;\n          btn.style.opacity = '1';\n        }\n      }\n      used.delete(index);\n      chip.remove();\n    }\n\n    function appendChip(index, label, sourceId) {\n      const chip = el(\n        'div',\n        {\n          class: 'dialogue-chip',\n          style:\n            'padding:10px;border:1px solid #94a3b8;border-radius:10px;background:#fff;display:flex;justify-content:space-between;align-items:center;gap:12px;cursor:pointer;',\n          onclick: event => {\n            event.stopPropagation();\n            removeChip(chip);\n          },\n        },\n        el('span', {}, label),\n        el('span', { style: 'color:#94a3b8;font-size:12px;' }, '×')\n      );\n      chip.dataset.index = String(index);\n      chip.dataset.buttonId = sourceId;\n      outWrap.appendChild(chip);\n    }\n\n    const shuffledIndices = shuffle(lines.map((_, index) => index));\n    shuffledIndices.forEach(index => {\n      const line = lines[index];\n      const label = makeLabel(line);\n      const buttonId = `line-${index}-${Math.random()\n        .toString(36)\n        .slice(2, 6)}`;\n      const btn = el(\n        'button',\n        {\n          type: 'button',\n          class: 'btn',\n          style:\n            'text-align:left;padding:10px;border:1px solid #cbd5e1;border-radius:10px;background:#fff;color:#0f172a;cursor:pointer;',\n          onclick: () => {\n            if (used.has(index)) return;\n            used.add(index);\n            btn.disabled = true;\n            btn.style.opacity = '0.5';\n            appendChip(index, label, buttonId);\n          },\n          'data-id': buttonId,\n        },\n        label\n      );\n      poolWrap.appendChild(btn);\n    });\n\n    container.appendChild(poolWrap);\n    container.appendChild(outWrap);\n\n    const actions = el('div', {\n      style:\n        'margin-top:14px;display:flex;gap:10px;flex-wrap:wrap;align-items:center;',\n    });\n    const checkBtn = el(\n      'button',\n      { type: 'button', class: 'btn primary' },\n      'Перевірити'\n    );\n    const resetBtn = el('button', { type: 'button', class: 'btn' }, 'Скинути');\n    const result = el('div', { style: 'font-weight:600;color:#0f172a;' });\n\n    checkBtn.addEventListener('click', () => {\n      const built = Array.from(outWrap.children).map(chip =>\n        Number.parseInt(chip.dataset.index || '-1', 10)\n      );\n      const expected = solution.slice();\n      const ok =\n        built.length === expected.length &&\n        built.every((value, idx) => value === expected[idx]);\n      outWrap.style.borderColor = ok ? '#10b981' : '#ef4444';\n      result.textContent = ok\n        ? 'Діалог впорядковано правильно!'\n        : `Поточний порядок: ${built.length}/${expected.length} реплік. Перевірте послідовність.`;\n    });\n\n    resetBtn.addEventListener('click', () => {\n      Array.from(outWrap.children).forEach(chip => removeChip(chip));\n      const buttons = poolWrap.querySelectorAll('button');\n      buttons.forEach(btn => {\n        btn.disabled = false;\n        btn.style.opacity = '1';\n      });\n      used.clear();\n      outWrap.style.borderColor = '#cbd5e1';\n      result.textContent = '';\n    });\n\n    actions.appendChild(checkBtn);\n    actions.appendChild(resetBtn);\n    actions.appendChild(result);\n    container.appendChild(actions);\n  }\n\n  function renderTrueFalse(container, task) {\n    container.appendChild(el('h3', {}, task.prompt || 'Обери True або False'));\n\n    const rows = [];\n    const items = Array.isArray(task?.items) ? task.items : [];\n    items.forEach((item, index) => {\n      if (!item || !item.statement) return;\n      const row = el(\n        'div',\n        {\n          style:\n            'margin:8px 0;padding:12px;border:1px solid #e5e7eb;border-radius:10px;background:#fff;',\n        },\n        el('p', { style: 'margin:0 0 8px;font-weight:600;' }, item.statement)\n      );\n      const name = `${task.id || 'tf'}-${index}`;\n      const expected = Boolean(item.answer);\n      const trueLabel = el(\n        'label',\n        {\n          style:\n            'display:inline-flex;align-items:center;gap:6px;margin-right:16px;',\n        },\n        el('input', { type: 'radio', name, value: 'true' }),\n        'True'\n      );\n      const falseLabel = el(\n        'label',\n        { style: 'display:inline-flex;align-items:center;gap:6px;' },\n        el('input', { type: 'radio', name, value: 'false' }),\n        'False'\n      );\n      const options = el('div', { style: 'display:flex;align-items:center;' });\n      options.appendChild(trueLabel);\n      options.appendChild(falseLabel);\n      row.appendChild(options);\n      rows.push({ row, name, expected });\n      container.appendChild(row);\n    });\n\n    if (!rows.length) return;\n\n    const actions = el('div', {\n      style:\n        'margin-top:14px;display:flex;gap:10px;align-items:center;flex-wrap:wrap;',\n    });\n    const btn = el(\n      'button',\n      { type: 'button', class: 'btn primary' },\n      'Перевірити'\n    );\n    const result = el('div', { style: 'font-weight:600;color:#0f172a;' });\n    btn.addEventListener('click', () => {\n      let correct = 0;\n      rows.forEach(({ row, name, expected }) => {\n        const picked = row.querySelector(`input[name=\"${name}\"]:checked`);\n        const ok = picked ? picked.value === String(expected) : false;\n        row.style.borderColor = ok ? '#10b981' : '#ef4444';\n        if (ok) correct += 1;\n      });\n      result.textContent = `Результат: ${correct}/${rows.length}`;\n    });\n    actions.appendChild(btn);\n    actions.appendChild(result);\n    container.appendChild(actions);\n  }\n\n  function renderSynonymClue(container, task) {\n    container.appendChild(\n      el('h3', {}, task.prompt || 'Доберіть слово за описом')\n    );\n\n    const wordBank = Array.isArray(task?.wordBank) ? task.wordBank : [];\n    if (wordBank.length) {\n      const bank = el('div', {\n        style:\n          'margin:8px 0 12px;padding:10px;border:1px solid #e2e8f0;border-radius:10px;background:#f8fafc;display:flex;flex-wrap:wrap;gap:8px;',\n      });\n      wordBank.forEach(word => {\n        const value = String(word || '').trim();\n        if (!value) return;\n        bank.appendChild(\n          el(\n            'span',\n            {\n              style:\n                'padding:6px 10px;border:1px solid #94a3b8;border-radius:999px;background:#fff;font-size:14px;',\n            },\n            value\n          )\n        );\n      });\n      container.appendChild(bank);\n    }\n\n    const rows = [];\n    const items = Array.isArray(task?.items) ? task.items : [];\n    items.forEach(item => {\n      if (!item || !item.clue) return;\n      const row = el('div', {\n        style:\n          'margin-bottom:10px;padding:12px;border:1px solid #e5e7eb;border-radius:10px;background:#fff;',\n      });\n      row.appendChild(\n        el('p', { style: 'margin:0 0 6px;font-weight:600;' }, item.clue)\n      );\n      const input = el('input', {\n        type: 'text',\n        style:\n          'width:100%;max-width:320px;padding:6px 8px;border:1px solid #cbd5e1;border-radius:6px;',\n      });\n      row.appendChild(input);\n      const answers = Array.isArray(item?.answers)\n        ? item.answers.map(answer => normalize(answer))\n        : Array.isArray(item?.answer)\n        ? item.answer.map(answer => normalize(answer))\n        : item?.answer\n        ? [normalize(item.answer)]\n        : [];\n      rows.push({ row, input, answers });\n      container.appendChild(row);\n    });\n\n    if (!rows.length) return;\n\n    const result = el('div', { style: 'font-weight:600;color:#0f172a;' });\n    const btn = el(\n      'button',\n      { type: 'button', class: 'btn primary' },\n      'Перевірити'\n    );\n    btn.addEventListener('click', () => {\n      let correct = 0;\n      rows.forEach(({ row, input, answers }) => {\n        const value = normalize(input.value);\n        const ok = answers.length ? answers.includes(value) : Boolean(value);\n        row.style.borderColor = ok ? '#10b981' : '#ef4444';\n        if (ok) correct += 1;\n      });\n      result.textContent = `Результат: ${correct}/${rows.length}`;\n    });\n    container.appendChild(btn);\n    container.appendChild(result);\n  }\n\n  function renderScramble(container, task) {\n    container.appendChild(el('h3', {}, task.prompt || 'Розшифруйте слова'));\n\n    const rows = [];\n    const items = Array.isArray(task?.items) ? task.items : [];\n    items.forEach(item => {\n      if (!item || !item.scrambled) return;\n      const row = el('div', {\n        style:\n          'margin-bottom:10px;padding:12px;border:1px solid #e5e7eb;border-radius:10px;background:#fff;',\n      });\n      row.appendChild(\n        el(\n          'div',\n          { style: 'margin-bottom:6px;font-weight:600;' },\n          item.scrambled\n        )\n      );\n      const input = el('input', {\n        type: 'text',\n        style:\n          'width:100%;max-width:260px;padding:6px 8px;border:1px solid #cbd5e1;border-radius:6px;',\n      });\n      row.appendChild(input);\n      const answers = Array.isArray(item?.answers)\n        ? item.answers.map(value => normalize(value))\n        : Array.isArray(item?.answer)\n        ? item.answer.map(value => normalize(value))\n        : item?.answer\n        ? [normalize(item.answer)]\n        : [];\n      rows.push({ row, input, answers });\n      container.appendChild(row);\n    });\n\n    if (!rows.length) return;\n\n    const btn = el(\n      'button',\n      { type: 'button', class: 'btn primary' },\n      'Перевірити'\n    );\n    const result = el('div', {\n      style: 'margin-top:6px;font-weight:600;color:#0f172a;',\n    });\n    btn.addEventListener('click', () => {\n      let correct = 0;\n      rows.forEach(({ row, input, answers }) => {\n        const value = normalize(input.value);\n        const ok = answers.length ? answers.includes(value) : Boolean(value);\n        row.style.borderColor = ok ? '#10b981' : '#ef4444';\n        if (ok) correct += 1;\n      });\n      result.textContent = `Результат: ${correct}/${rows.length}`;\n    });\n    container.appendChild(btn);\n    container.appendChild(result);\n  }\n\n  function renderOddOneOut(container, task) {\n    container.appendChild(el('h3', {}, task.prompt || 'Знайди зайве слово'));\n\n    const blocks = [];\n    const items = Array.isArray(task?.items) ? task.items : [];\n    items.forEach((item, index) => {\n      const options = Array.isArray(item?.options) ? item.options : [];\n      if (!options.length) return;\n      const row = el('div', {\n        style:\n          'margin-bottom:10px;padding:12px;border:1px solid #e5e7eb;border-radius:10px;background:#fff;',\n      });\n      row.appendChild(\n        el(\n          'div',\n          { style: 'margin-bottom:6px;font-weight:600;' },\n          `Набір ${index + 1}`\n        )\n      );\n      const groupName = `${task.id || 'odd'}-${index}`;\n      options.forEach((option, optionIndex) => {\n        const id = `${groupName}-${optionIndex}`;\n        row.appendChild(\n          el(\n            'label',\n            {\n              for: id,\n              style: 'display:flex;align-items:center;gap:6px;margin:4px 0;',\n            },\n            el('input', {\n              type: 'radio',\n              name: groupName,\n              value: String(optionIndex),\n              id,\n            }),\n            option\n          )\n        );\n      });\n      const explanation = String(item?.explanation || '').trim();\n      if (explanation) {\n        const note = el('div', {\n          class: 'muted',\n          style: 'display:none;margin-top:6px;color:#475569;',\n        });\n        note.textContent = `Пояснення: ${explanation}`;\n        row.appendChild(note);\n      }\n      const answerIndex = normalize(item?.answer || '');\n      blocks.push({ row, groupName, answerIndex });\n      container.appendChild(row);\n    });\n\n    if (!blocks.length) return;\n\n    const btn = el(\n      'button',\n      { type: 'button', class: 'btn primary' },\n      'Перевірити'\n    );\n    const result = el('div', {\n      style: 'margin-top:6px;font-weight:600;color:#0f172a;',\n    });\n    btn.addEventListener('click', () => {\n      let correct = 0;\n      blocks.forEach(({ row, groupName, answerIndex }) => {\n        const picked = row.querySelector(`input[name=\"${groupName}\"]:checked`);\n        const value = normalize(picked ? picked.value : '');\n        const ok = answerIndex ? value === answerIndex : Boolean(value);\n        row.style.borderColor = ok ? '#10b981' : '#ef4444';\n        const note = row.querySelector('.muted');\n        if (note) note.style.display = ok ? 'none' : 'block';\n        if (ok) correct += 1;\n      });\n      result.textContent = `Результат: ${correct}/${blocks.length}`;\n    });\n    container.appendChild(btn);\n    container.appendChild(result);\n  }\n\n  function renderWriting(container, task) {\n    container.appendChild(\n      el('h3', {}, task.prompt || 'Writing/Speaking prompt')\n    );\n    if (task.description)\n      container.appendChild(el('p', { class: 'muted' }, task.description));\n    const list = el('div', { style: 'margin-top:8px;' });\n    (task.checklist || []).forEach(ch => {\n      const id = Math.random().toString(36).slice(2);\n      const row = el(\n        'label',\n        {\n          for: id,\n          style: 'display:flex;align-items:center;gap:8px;margin:6px 0;',\n        },\n        el('input', { id, type: 'checkbox' }),\n        el('span', {}, ch)\n      );\n      list.appendChild(row);\n    });\n    container.appendChild(list);\n    const btn = el(\n      'button',\n      { type: 'button', class: 'btn primary', style: 'margin-top:8px;' },\n      'Позначити як перевірено'\n    );\n    const note = el('div', { class: 'muted', style: 'margin-top:6px;' });\n    btn.addEventListener('click', () => {\n      note.textContent =\n        'Готово! Перевір список і за бажанням відправ наставнику.';\n    });\n    container.appendChild(btn);\n    container.appendChild(note);\n  }\n\n  function ensurePracticeContainer() {\n    let root = document.getElementById('practice');\n    if (!root && /\\/grammar\\//.test(location.pathname)) {\n      const wrap = el('div', { class: 'container' });\n      wrap.appendChild(el('hr', { class: 'sep' }));\n      root = el('section', { id: 'practice' });\n      wrap.appendChild(root);\n      document.body.appendChild(wrap);\n    }\n    return root;\n  }\n\n  function init() {\n    const root = ensurePracticeContainer();\n    if (!root) return;\n    // Ensure stable inner container so external toolbars are not wiped\n    let body = root.querySelector('#practice-body');\n    if (!body) {\n      body = el('div', { id: 'practice-body' });\n      root.appendChild(body);\n    }\n    const context = window.lessonContext || {};\n    if (context.isCustomLesson) {\n      const placeholder = root.querySelector('[data-practice-placeholder]');\n      if (placeholder) {\n        placeholder.textContent =\n          'Практика для кожної теми розміщена одразу після теорії. Тут можете згенерувати додаткові завдання.';\n      }\n      if (body) {\n        body.innerHTML =\n          '<p class=\"muted\">Згенеруйте додаткові вправи або додайте власні завдання.</p>';\n      }\n      document.dispatchEvent(\n        new CustomEvent('practice:dataLoaded', { detail: null })\n      );\n      document.dispatchEvent(\n        new CustomEvent('practice:rendered', {\n          detail: { ok: false, reason: 'custom-lesson' },\n        })\n      );\n      return;\n    }\n\n    loadData().then(data => {\n      if (!data) {\n        document.dispatchEvent(\n          new CustomEvent('practice:dataLoaded', { detail: null })\n        );\n        body.innerHTML = '<p class=\"muted\">Практика поки відсутня.</p>';\n        document.dispatchEvent(\n          new CustomEvent('practice:rendered', { detail: { ok: false } })\n        );\n        return;\n      }\n      body.innerHTML = '';\n      const header = el(\n        'div',\n        {},\n        el(\n          'h2',\n          {},\n          'Practice ',\n          el('span', { class: 'badge' }, data.level || 'B1')\n        ),\n        data.title ? el('p', { class: 'muted' }, data.title) : null\n      );\n      body.appendChild(header);\n\n      const entries = (data.tasks || []).map((task, index) => ({\n        key: task && task.id ? String(task.id) : `base-${index}`,\n        task,\n      }));\n\n      document.dispatchEvent(\n        new CustomEvent('practice:dataLoaded', {\n          detail: {\n            title: data.title,\n            level: data.level,\n            entries,\n          },\n        })\n      );\n\n      entries.forEach(({ task, key }) => renderTask(body, task, key));\n      document.dispatchEvent(\n        new CustomEvent('practice:rendered', { detail: { ok: true } })\n      );\n    });\n  }\n\n  document.addEventListener('DOMContentLoaded', init);\n})();\n\ndocument.addEventListener('click', e => {\n  const div = e.target.closest('.text-block');\n  if (div) {\n    const html = div.innerHTML;\n    navigator.clipboard.writeText(`<div class=\"text-block\">${html}</div>`);\n    console.log('Скопійовано');\n  }\n});\n","export const communicationWords = {\n  'greetings-farewells': [\n    {\n      word: 'Hello',\n      translation: 'Привіт',\n      example: 'Hello, nice to meet you!',\n    },\n    {\n      word: 'Hi',\n      translation: 'Привіт (неформально)',\n      example: 'Hi, are you ready for class?',\n    },\n    {\n      word: 'Good morning',\n      translation: 'Доброго ранку',\n      example: 'Good morning, Mrs Smith.',\n    },\n    {\n      word: 'Good afternoon',\n      translation: 'Доброго дня',\n      example: 'Good afternoon, everyone.',\n    },\n    {\n      word: 'Good evening',\n      translation: 'Доброго вечора',\n      example: 'Good evening, how was your day?',\n    },\n    {\n      word: 'Nice to meet you',\n      translation: 'Приємно познайомитися',\n      example: \"Nice to meet you, I'm Tom.\",\n    },\n    {\n      word: 'How are you?',\n      translation: 'Як справи?',\n      example: 'Hi, Anna! How are you?',\n    },\n    {\n      word: \"I'm fine, thanks\",\n      translation: 'У мене все добре, дякую',\n      example: \"I'm fine, thanks. And you?\",\n    },\n    {\n      word: 'See you later',\n      translation: 'Побачимось пізніше',\n      example: 'I have to go now. See you later!',\n    },\n    {\n      word: 'See you soon',\n      translation: 'До скорої зустрічі',\n      example: 'Thanks for your help. See you soon.',\n    },\n    {\n      word: 'Goodbye',\n      translation: 'До побачення',\n      example: 'Goodbye, have a nice evening!',\n    },\n    {\n      word: 'Bye',\n      translation: 'Бувай',\n      example: 'Bye, talk to you tomorrow!',\n    },\n    {\n      word: 'Take care',\n      translation: 'Бережи себе',\n      example: \"I'm heading home now. Take care!\",\n    },\n    {\n      word: 'Have a nice day',\n      translation: 'Гарного дня',\n      example: 'Thanks for coming. Have a nice day!',\n    },\n    {\n      word: 'Good night',\n      translation: 'Надобраніч',\n      example: \"It's late. Good night!\",\n    },\n  ],\n  'personal-info-basics': [\n    {\n      word: 'first name',\n      translation: \"ім'я\",\n      example: 'My first name is Olha.',\n    },\n    {\n      word: 'last name',\n      translation: 'прізвище',\n      example: 'Her last name is Petrenko.',\n    },\n    {\n      word: 'full name',\n      translation: \"повне ім'я\",\n      example: 'Please write your full name here.',\n    },\n    {\n      word: 'nickname',\n      translation: 'прізвисько / нікнейм',\n      example: \"His friends call him Max; it's his nickname.\",\n    },\n    {\n      word: 'age',\n      translation: 'вік',\n      example: 'My age is twenty.',\n    },\n    {\n      word: 'I am ... years old',\n      translation: 'мені ... років',\n      example: 'I am twenty years old.',\n    },\n    {\n      word: 'years old',\n      translation: 'років (вік)',\n      example: \"I'm eleven years old.\",\n    },\n    {\n      word: 'country',\n      translation: 'країна',\n      example: 'My country is Ukraine.',\n    },\n    {\n      word: 'city',\n      translation: 'місто',\n      example: 'I live in the city of Lviv.',\n    },\n    {\n      word: 'hometown',\n      translation: 'рідне місто',\n      example: 'My hometown is Poltava.',\n    },\n    {\n      word: 'place of birth',\n      translation: 'місце народження',\n      example: 'My place of birth is Kharkiv.',\n    },\n    {\n      word: 'address',\n      translation: 'адреса',\n      example: 'My address is 12 Green Street.',\n    },\n    {\n      word: 'nationality',\n      translation: 'національність',\n      example: 'She is Italian by nationality.',\n    },\n    {\n      word: 'native language',\n      translation: 'рідна мова',\n      example: 'Ukrainian is my native language.',\n    },\n    {\n      word: 'foreign language',\n      translation: 'іноземна мова',\n      example: 'English is my first foreign language.',\n    },\n    {\n      word: 'from',\n      translation: 'з / родом із',\n      example: 'I am from Ukraine.',\n    },\n    {\n      word: 'live in',\n      translation: 'жити в',\n      example: 'I live in Kyiv.',\n    },\n    {\n      word: 'live with',\n      translation: 'жити з',\n      example: 'I live with my parents.',\n    },\n    {\n      word: 'date of birth',\n      translation: 'дата народження',\n      example: 'My date of birth is May 12, 2005.',\n    },\n    {\n      word: 'job / occupation',\n      translation: 'робота / професія',\n      example: 'My job is a student.',\n    },\n    {\n      word: 'student',\n      translation: 'студент / учень',\n      example: \"I'm a student at the local school.\",\n    },\n    {\n      word: 'teacher',\n      translation: 'вчитель / викладач',\n      example: 'My teacher is from Canada.',\n    },\n    {\n      word: 'grade',\n      translation: 'клас (у школі)',\n      example: \"I'm in Grade 6.\",\n    },\n    {\n      word: 'single',\n      translation: 'неодружений / неодружена',\n      example: 'He is single at the moment.',\n    },\n    {\n      word: 'married',\n      translation: 'одружений / заміжня',\n      example: 'My parents are married.',\n    },\n    {\n      word: 'male',\n      translation: 'чоловіча стать',\n      example: 'He is male.',\n    },\n    {\n      word: 'female',\n      translation: 'жіноча стать',\n      example: 'She is female.',\n    },\n    {\n      word: 'speak',\n      translation: 'говорити (мовою)',\n      example: 'I speak Ukrainian and English.',\n    },\n    {\n      word: 'introduce yourself',\n      translation: 'представитись',\n      example: 'Let me introduce myself.',\n    },\n  ],\n};\n","const DEFAULT_THEME_ID = 55;\nconst DEFAULT_TEMPLATE_ID = 5;\nconst DEFAULT_FONT_STACK_ID = 0;\n\nexport const lessonWordwalls = {\n  'custom-no1-mggxs7zo': [\n    {\n      id: 'db94624e1c8042ce98760f467377e1ae',\n      themeId: '42',\n      templateId: '70',\n      fontStackId: DEFAULT_FONT_STACK_ID,\n      title: 'Wordwall вправа для особових займенників',\n    },\n  ],\n  'custom-no2-4db25661': [\n    {\n      id: '110f5ab8bba8415eadefd09fb52c4e87',\n      themeId: '65',\n      templateId: '30',\n      fontStackId: '12',\n      title: 'Wordwall вправа для особових займенників',\n      url: 'https://wordwall.net/embed/110f5ab8bba8415eadefd09fb52c4e87?themeId=65&templateId=30&fontStackId=12',\n    },\n  ],\n  'custom-no3-b9fd7e6c': [\n    {\n      id: '110f5ab8bba8415eadefd09fb52c4e87',\n      themeId: '65',\n      templateId: '30',\n      fontStackId: '12',\n      title: 'Wordwall вправа для особових займенників',\n      url: 'https://wordwall.net/embed/110f5ab8bba8415eadefd09fb52c4e87?themeId=65&templateId=30&fontStackId=12',\n    },\n  ],\n};\n\nfunction buildBaseUrl(config) {\n  if (!config) return null;\n  if (config.url) return String(config.url);\n  if (config.id) {\n    return `https://wordwall.net/embed/${String(config.id).trim()}`;\n  }\n  return null;\n}\n\nexport function buildWordwallUrl(config) {\n  const baseUrl = buildBaseUrl(config);\n  if (!baseUrl) return null;\n  const params = new URLSearchParams();\n  const themeId = config.themeId ?? DEFAULT_THEME_ID;\n  const templateId = config.templateId ?? DEFAULT_TEMPLATE_ID;\n  const fontStackId = config.fontStackId ?? DEFAULT_FONT_STACK_ID;\n\n  if (themeId != null) params.set('themeId', String(themeId));\n  if (templateId != null) params.set('templateId', String(templateId));\n  if (fontStackId != null) params.set('fontStackId', String(fontStackId));\n\n  const query = params.toString();\n  return query ? `${baseUrl}?${query}` : baseUrl;\n}\n\nexport function createWordwallIframe(config) {\n  const src = buildWordwallUrl(config);\n  if (!src) return null;\n\n  const iframe = document.createElement('iframe');\n  iframe.className = 'lesson-wordwall__iframe';\n  iframe.src = src;\n  iframe.width = String(config.width ?? 1000);\n  iframe.height = String(config.height ?? 760);\n  iframe.setAttribute('frameborder', '0');\n  iframe.setAttribute('allowfullscreen', 'true');\n  iframe.setAttribute('loading', 'lazy');\n  iframe.setAttribute('referrerpolicy', 'strict-origin-when-cross-origin');\n  if (config.title) {\n    iframe.setAttribute('title', config.title);\n  }\n\n  return iframe;\n}\n\nexport function getWordwallConfigsForLesson(lessonId) {\n  if (!lessonId) return [];\n  const entries = lessonWordwalls[lessonId];\n  if (!Array.isArray(entries)) return [];\n  return entries\n    .map(entry => ({ ...entry }))\n    .filter(entry => Boolean(buildWordwallUrl(entry)));\n}\n","import { lessons, lessonCategories } from '@data/lessons.js';\nimport { customLessonPresets } from '@data/custom-lesson-presets.js';\nimport { loadCustomLessons } from '@features/custom-lessons/custom-lessons-store.js';\nimport { communicationWords } from '@data/communication-words.js';\nimport {\n  createWordwallIframe,\n  getWordwallConfigsForLesson,\n} from '@data/wordwall.js';\n\nconst basePath = (typeof import.meta !== 'undefined' && import.meta.env && import.meta.env.BASE_URL) || '/';\n\nfunction resolveAssetPath(path) {\n  const normalizedBase = basePath.endsWith('/') ? basePath : `${basePath}/`;\n  const rawPath = String(path || '');\n  if (rawPath.startsWith(normalizedBase)) return rawPath;\n  return `${normalizedBase}${rawPath.replace(/^\\/+/, '')}`;\n}\n\nconst params = new URLSearchParams(window.location.search);\nconst normaliseCategoryParam = (value) => value;\nconst topicId = params.get('topic');\nconst customLessonId = params.get('custom');\nconst fallbackTitle = params.get('title');\nconst fallbackCategory = normaliseCategoryParam(params.get('category'));\nconst fallbackLevel = params.get('level');\nconst fallbackFile = params.get('file');\n\nconst lesson = topicId ? lessons.find((item) => item.id === topicId) : undefined;\nconst customLesson = (() => {\n  if (!customLessonId) return null;\n  const candidates = [];\n  if (Array.isArray(customLessonPresets)) {\n    customLessonPresets.forEach((preset) => {\n      if (!preset || typeof preset !== 'object') return;\n      const topicIds = Array.isArray(preset.topicIds) ? [...preset.topicIds] : [];\n      if (!preset.id || !topicIds.length) return;\n      candidates.push({\n        ...preset,\n        topicIds,\n        source: 'preset',\n      });\n    });\n  }\n  loadCustomLessons()\n    .filter((item) => item && typeof item === 'object')\n    .forEach((item) => {\n      const topicIds = Array.isArray(item.topicIds) ? [...item.topicIds] : [];\n      if (!item.id || !topicIds.length) return;\n      candidates.push({\n        ...item,\n        topicIds,\n        source: 'local',\n      });\n    });\n  return candidates.find((item) => item.id === customLessonId) ?? null;\n})();\n\nconst isCustomLesson = Boolean(customLesson);\n\nconst resolvedTitle = (() => {\n  if (isCustomLesson) return customLesson.title;\n  if (lesson?.title) return lesson.title;\n  return fallbackTitle ? decodeURIComponent(fallbackTitle) : 'Матеріал уроку';\n})();\n\nconst resolvedCategory = (() => {\n  if (isCustomLesson) return 'custom';\n  if (lesson?.category) return lesson.category;\n  return fallbackCategory ? decodeURIComponent(fallbackCategory) : '';\n})();\n\nconst resolvedLevel = (() => {\n  if (isCustomLesson) {\n    if (customLesson.level) return customLesson.level;\n    const topics = (customLesson.topicIds || [])\n      .map((id) => lessons.find((item) => item.id === id))\n      .filter(Boolean);\n    const uniqueLevels = Array.from(new Set(topics.map((item) => item.level))).sort();\n    return uniqueLevels.join(', ');\n  }\n  if (lesson?.level) return lesson.level;\n  return fallbackLevel ? decodeURIComponent(fallbackLevel) : '';\n})();\n\nconst resolvedFile = (() => {\n  if (isCustomLesson) return null;\n  const candidate = lesson?.htmlPath ?? (fallbackFile ? decodeURIComponent(fallbackFile) : null);\n  if (!candidate) return null;\n  return candidate.startsWith('lessons/') ? candidate : null;\n})();\n\nwindow.lessonContext = {\n  id: isCustomLesson ? customLesson.id : lesson?.id ?? topicId ?? null,\n  title: resolvedTitle,\n  category: resolvedCategory,\n  level: resolvedLevel,\n  htmlPath: resolvedFile,\n  source: isCustomLesson ? customLesson.source || 'custom' : 'catalog',\n  topicIds: isCustomLesson\n    ? [...(customLesson.topicIds || [])]\n    : lesson?.id\n      ? [lesson.id]\n      : topicId\n        ? [topicId]\n        : [],\n  isCustomLesson,\n};\n\nconst titleElement = document.querySelector('[data-lesson-title]');\nconst categoryElement = document.querySelector('[data-lesson-category]');\nconst levelElement = document.querySelector('[data-lesson-level]');\nconst statusElement = document.querySelector('[data-lesson-status]');\nconst contentElement = document.getElementById('lesson-content');\n\nfunction setCurrentYear() {\n  const yearEl = document.querySelector('[data-component=\"copyright-year\"]');\n  if (!yearEl) return;\n  yearEl.textContent = String(new Date().getFullYear());\n}\n\nfunction renderMeta() {\n  if (titleElement) titleElement.textContent = resolvedTitle;\n  const categoryLabel = (() => {\n    if (isCustomLesson) return 'Комбінований урок';\n    return lessonCategories[resolvedCategory]?.label ?? '';\n  })();\n  const categoryText = categoryLabel || resolvedCategory;\n  if (categoryElement) {\n    categoryElement.textContent = categoryText || '';\n  }\n  if (levelElement) {\n    levelElement.textContent = resolvedLevel ? `Рівень: ${resolvedLevel}` : '';\n  }\n  const practiceTitleElement = document.getElementById('practice-title');\n  if (practiceTitleElement) {\n    practiceTitleElement.textContent = resolvedTitle;\n  }\n  document.title = `${resolvedTitle} | English Teacher Platform`;\n}\n\nfunction makeTopicAnchorId(rawId) {\n  const sanitized = String(rawId || '')\n    .trim()\n    .toLowerCase()\n    .replace(/[^a-z0-9_-]+/g, '-')\n    .replace(/^-+|-+$/g, '') || 'topic';\n  return `lesson-topic-${sanitized}`;\n}\n\nfunction createSummaryList(topics) {\n  if (!topics.length) return null;\n  const wrapper = document.createElement('section');\n  wrapper.className = 'lesson-custom-summary';\n\n  const heading = document.createElement('h2');\n  heading.textContent = 'Склад уроку';\n  wrapper.appendChild(heading);\n\n  const list = document.createElement('ol');\n  list.className = 'lesson-custom-summary__list';\n\n  topics.forEach((topic, index) => {\n    const item = document.createElement('li');\n    item.className = 'lesson-custom-summary__item';\n    const categoryLabel = lessonCategories[topic.category]?.label ?? topic.category;\n    const anchorId = makeTopicAnchorId(topic.id);\n    const link = document.createElement('a');\n    link.className = 'lesson-custom-summary__link';\n    link.href = `#${anchorId}`;\n    link.dataset.topicAnchor = anchorId;\n\n    const title = document.createElement('strong');\n    title.textContent = `${index + 1}. ${topic.title}`;\n    const meta = document.createElement('span');\n    meta.textContent = `${categoryLabel} · ${topic.level}`;\n\n    link.appendChild(title);\n    link.appendChild(meta);\n    link.addEventListener('click', (event) => {\n      const target = document.getElementById(anchorId);\n      if (!target) return;\n      event.preventDefault();\n      target.scrollIntoView({ behavior: 'smooth', block: 'start' });\n      requestAnimationFrame(() => {\n        try {\n          target.focus({ preventScroll: true });\n        } catch (error) {\n          target.focus();\n        }\n      });\n    });\n\n    item.appendChild(link);\n    list.appendChild(item);\n  });\n\n  wrapper.appendChild(list);\n  return wrapper;\n}\n\nasync function fetchPracticeDataForTopic(topic) {\n  if (!topic) return null;\n  const candidates = new Set();\n  if (topic.id) {\n    candidates.add(`data/practice/${topic.id}.json`);\n  }\n\n  if (topic.htmlPath) {\n    const normalized = String(topic.htmlPath)\n      .replace(/^\\.?\\/?/, '')\n      .replace(/\\.html?$/i, '');\n    if (normalized) {\n      candidates.add(`data/practice/${normalized}.json`);\n      const segments = normalized.split('/');\n      const last = segments[segments.length - 1];\n      if (last) {\n        candidates.add(`data/practice/${last}.json`);\n      }\n    }\n  }\n\n  for (const path of candidates) {\n    try {\n      const response = await fetch(resolveAssetPath(path), { cache: 'no-store' });\n      if (!response.ok) continue;\n      const payload = await response.json();\n      if (payload && Array.isArray(payload.tasks) && payload.tasks.length) {\n        return payload;\n      }\n    } catch (error) {\n      console.warn(`Не вдалося завантажити практику за шляхом ${path}`, error);\n    }\n  }\n\n  return null;\n}\n\nfunction renderEmptyPracticeState(container) {\n  if (!container) return;\n  const note = document.createElement('p');\n  note.className = 'practice-inline__empty muted';\n  note.textContent = 'Практика для цієї теми поки відсутня.';\n  container.appendChild(note);\n}\n\nfunction createWordwallSection(lessonId) {\n  const configs = getWordwallConfigsForLesson(lessonId);\n  if (!configs.length) return null;\n\n  const section = document.createElement('section');\n  section.className = 'lesson-wordwall';\n\n  const heading = document.createElement('h2');\n  heading.className = 'lesson-wordwall__title';\n  heading.textContent = 'Wordwall';\n  section.appendChild(heading);\n\n  const itemsWrapper = document.createElement('div');\n  itemsWrapper.className = 'lesson-wordwall__items';\n  section.appendChild(itemsWrapper);\n\n  let hasEmbeds = false;\n\n  configs.forEach((config, index) => {\n    const iframe = createWordwallIframe({\n      ...config,\n      title: config.title || `Wordwall вправа ${index + 1}`,\n    });\n    if (!iframe) return;\n    hasEmbeds = true;\n    itemsWrapper.appendChild(iframe);\n  });\n\n  if (!hasEmbeds) return null;\n\n  return section;\n}\n\nasync function renderCustomLesson() {\n  if (!contentElement) return;\n\n  const topics = (customLesson?.topicIds || [])\n    .map((id) => lessons.find((item) => item.id === id))\n    .filter(Boolean);\n\n  if (!topics.length) {\n    if (statusElement) {\n      statusElement.textContent = 'Не вдалося знайти вибрані теми. Створіть урок заново.';\n    }\n    return;\n  }\n\n  contentElement.innerHTML = '';\n\n  if (customLesson?.description) {\n    const intro = document.createElement('p');\n    intro.className = 'lesson-custom-description';\n    intro.textContent = customLesson.description;\n    contentElement.appendChild(intro);\n  }\n\n  const categoryOrder = {\n    grammar: 0,\n    lexical: 1,\n  };\n\n  const orderedTopics = topics.slice().sort((a, b) => {\n    const orderA = categoryOrder[a.category] ?? 99;\n    const orderB = categoryOrder[b.category] ?? 99;\n    if (orderA !== orderB) return orderA - orderB;\n    return 0;\n  });\n\n  const summary = createSummaryList(orderedTopics);\n  if (summary) {\n    contentElement.appendChild(summary);\n  }\n\n  const wordwallSection = createWordwallSection(customLesson?.id ?? null);\n  if (wordwallSection) {\n    contentElement.appendChild(wordwallSection);\n  }\n\n  for (const topic of orderedTopics) {\n    const section = document.createElement('section');\n    section.className = 'lesson-topic';\n    section.dataset.topicId = topic.id;\n    const sectionAnchorId = makeTopicAnchorId(topic.id);\n    section.id = sectionAnchorId;\n    section.setAttribute('tabindex', '-1');\n\n    const header = document.createElement('header');\n    header.className = 'lesson-topic__header';\n\n    const title = document.createElement('h3');\n    title.className = 'lesson-topic__title';\n    title.textContent = topic.title;\n    header.appendChild(title);\n\n    const meta = document.createElement('p');\n    meta.className = 'lesson-topic__meta';\n    const categoryLabel = lessonCategories[topic.category]?.label ?? topic.category;\n    meta.textContent = `${categoryLabel} · Рівень ${topic.level}`;\n    header.appendChild(meta);\n\n    section.appendChild(header);\n\n    const body = document.createElement('div');\n    body.className = 'lesson-topic__body';\n    section.appendChild(body);\n\n    contentElement.appendChild(section);\n\n    try {\n      const response = await fetch(resolveAssetPath(topic.htmlPath));\n      if (!response.ok) {\n        throw new Error(`Не вдалося завантажити файл: ${response.status}`);\n      }\n      const markup = await response.text();\n      body.innerHTML = markup;\n    } catch (error) {\n      body.innerHTML = '<p class=\"lesson-topic__error\">Не вдалося завантажити матеріал цієї теми.</p>';\n      console.error(error);\n    }\n\n    const practiceWrapper = document.createElement('div');\n    practiceWrapper.className = 'lesson-topic__practice';\n    section.appendChild(practiceWrapper);\n\n    try {\n      const practiceData = await fetchPracticeDataForTopic(topic);\n      if (practiceData && Array.isArray(practiceData.tasks) && practiceData.tasks.length) {\n        const practiceApi = window.practice || {};\n        const heading = practiceData.title ? `Практика: ${practiceData.title}` : `Практика: ${topic.title}`;\n        const level = practiceData.level || topic.level || '';\n        if (typeof practiceApi.renderTaskList === 'function') {\n          practiceApi.renderTaskList(practiceWrapper, practiceData.tasks, {\n            title: heading,\n            level,\n            description: practiceData.description,\n            keyPrefix: `${topic.id}-practice`,\n          });\n        } else {\n          renderEmptyPracticeState(practiceWrapper);\n        }\n      } else {\n        renderEmptyPracticeState(practiceWrapper);\n      }\n    } catch (error) {\n      console.error('Помилка під час завантаження практики', error);\n      renderEmptyPracticeState(practiceWrapper);\n    }\n  }\n\n  if (statusElement) {\n    statusElement.remove();\n  }\n\n  await hydrateCommunicationWords(contentElement);\n}\n\nasync function loadLesson() {\n  if (!contentElement) return;\n\n  if (isCustomLesson) {\n    await renderCustomLesson();\n    return;\n  }\n\n  if (!resolvedFile) {\n    if (statusElement) {\n      statusElement.textContent = 'Не вдалося визначити файл з матеріалом. Перейдіть назад та оберіть тему зі списку.';\n    }\n    return;\n  }\n\n  try {\n    const response = await fetch(resolveAssetPath(resolvedFile));\n    if (!response.ok) {\n      throw new Error(`Не вдалося завантажити файл: ${response.status}`);\n    }\n    const markup = await response.text();\n    contentElement.innerHTML = '';\n\n    const wordwallSection = createWordwallSection(lesson?.id ?? null);\n    if (wordwallSection) {\n      contentElement.appendChild(wordwallSection);\n    }\n\n    const template = document.createElement('template');\n    template.innerHTML = markup;\n    contentElement.appendChild(template.content);\n    await hydrateCommunicationWords(contentElement);\n  } catch (error) {\n    if (statusElement) {\n      statusElement.textContent = 'Сталася помилка під час завантаження матеріалу. Спробуйте пізніше або поверніться до каталогу.';\n    }\n    console.error(error);\n  }\n}\n\nfunction renderCommunicationTable(container, entries) {\n  if (!container) return;\n  const words = Array.isArray(entries) ? entries : [];\n  if (!words.length) return;\n\n  container.classList.add('communication__table');\n\n  const table = document.createElement('table');\n\n  const thead = document.createElement('thead');\n  const headRow = document.createElement('tr');\n  ['Слово', 'Переклад', 'Приклад'].forEach((label) => {\n    const th = document.createElement('th');\n    th.textContent = label;\n    headRow.appendChild(th);\n  });\n  thead.appendChild(headRow);\n\n  const tbody = document.createElement('tbody');\n  words.forEach((item) => {\n    if (!item) return;\n    const row = document.createElement('tr');\n\n    const wordCell = document.createElement('td');\n    wordCell.textContent = item.word || item.term || '';\n\n    const translationCell = document.createElement('td');\n    translationCell.textContent = item.translation || item.meaning || '';\n\n    const exampleCell = document.createElement('td');\n    exampleCell.textContent = item.example || item.sentence || '';\n\n    row.appendChild(wordCell);\n    row.appendChild(translationCell);\n    row.appendChild(exampleCell);\n    tbody.appendChild(row);\n  });\n\n  table.appendChild(thead);\n  table.appendChild(tbody);\n\n  container.innerHTML = '';\n  container.appendChild(table);\n}\n\nfunction resolveCommunicationTopic(container) {\n  if (!container) return null;\n  if (container.dataset.communicationTopic) return container.dataset.communicationTopic;\n  if (container.dataset.topic) return container.dataset.topic;\n  const ancestor = container.closest('[data-communication-topic]');\n  if (ancestor?.dataset.communicationTopic) return ancestor.dataset.communicationTopic;\n  const contextId = window.lessonContext?.id;\n  if (contextId && communicationWords[contextId]) return contextId;\n  return null;\n}\n\nasync function hydrateCommunicationWords(root) {\n  if (!root) return;\n  const containers = Array.from(root.querySelectorAll('[data-communication-words]'));\n  if (!containers.length) return;\n\n  containers.forEach((container) => {\n    const topicKey = resolveCommunicationTopic(container);\n    if (!topicKey) return;\n    const entries = communicationWords[topicKey] || [];\n    if (!entries.length) return;\n    renderCommunicationTable(container, entries);\n  });\n}\n\nfunction init() {\n  setCurrentYear();\n  renderMeta();\n  loadLesson();\n}\n\ninit();\n","// tasksGenerator.js\n\n// ---- HTTP wrapper -----------------------------------------------------------\nexport const getAnswer = async body => {\n  const BASE_URL = 'https://vq1wtq2d2l.execute-api.us-east-2.amazonaws.com/dev';\n  // const BASE_URL = \"http://localhost:3000/dev\";\n  const url = BASE_URL + '/openai';\n\n  const response = await fetch(url, {\n    method: 'POST',\n    body: JSON.stringify(body),\n    headers: { 'Content-Type': 'application/json' },\n  }).then(res => res.json());\n\n  return response; // your endpoint returns a JSON string -> we'll JSON.parse later\n};\n\n// ---- Public API -------------------------------------------------------------\n/**\n * Генерує один блок завдання під конкретний typeQuestion (mcq/gap/...)\n * @param {string} topic - наприклад: \"Present Simple\"\n * @param {string} typeQuestion - один з: mcq, gap, transform, match, error, order, short, open, writing, roleplay, context, dialogue-gap, dialogue-order, truefalse, definition-match, synonym-clue, scramble, wordpairs, odd-one-out\n * @param {object} opts - { language: 'en', items: 10, seedId: 'ps' } etc.\n * @param {Array<object>} vocabulary - опційний масив слів для фокусування ({ word, translation, example })\n * @returns {Promise<object>} JSON блоку завдання\n */\nexport const generateTask = async (topic, typeQuestion, opts = {}, vocabulary = []) => {\n  const promptBody = buildBody(topic, typeQuestion, opts, vocabulary);\n  const raw = await getAnswer(promptBody);\n\n  // API зазвичай повертає строку JSON -> парсимо.\n  // Якщо вже об'єкт — просто повернемо як є.\n  try {\n    if (typeof raw === 'string') return JSON.parse(raw);\n    return raw;\n  } catch (e) {\n    // На випадок якщо модель вивела щось зайве — спроба витягнути JSON через regex\n    const jsonMatch =\n      typeof raw === 'string' ? raw.match(/\\{[\\s\\S]*\\}$/) : null;\n    if (jsonMatch) return JSON.parse(jsonMatch[0]);\n    throw new Error('Не вдалося розпарсити JSON відповіді моделі');\n  }\n};\n\n/**\n * Генерує HTML-розмітку теоретичного матеріалу (таблиці з правилами та прикладами)\n * @param {string} topic - назва теми (наприклад: \"Present Simple\")\n * @param {object} opts - { language: 'uk' | 'en' }\n * @returns {Promise<string>} HTML-фрагмент з <table> блоками\n */\nexport const generateTheory = async (topic, opts = {}) => {\n  const body = buildTheoryBody(topic, opts);\n  const raw = await getAnswer(body);\n  // Очікуємо чистий HTML-фрагмент (рядок). Якщо об'єкт — дістанемо content\n  if (typeof raw === 'string') return raw;\n  if (raw && typeof raw.content === 'string') return raw.content;\n  // Спроба видобути HTML між першими <table ...> ... (на випадок зайвого тексту)\n  const m = String(raw || '').match(/<table[\\s\\S]*<\\/table>/i);\n  if (m) return m[0];\n  throw new Error('Відповідь не містить HTML');\n};\n\n// ---- Prompt builder ---------------------------------------------------------\nfunction buildBody(topic, typeQuestion, opts = {}, vocabulary = []) {\n  const token = localStorage.getItem('gptToken');\n  if (!token || token?.length < 10) {\n    console.warn('⚠️ gptToken відсутній у localStorage');\n    const token = prompt('Enter Your GPT Token');\n    localStorage.setItem('gptToken', token);\n  }\n\n  const model = 'gpt-4o-mini';\n  const normalizedType = String(typeQuestion || '')\n    .trim()\n    .toLowerCase();\n\n  const { system, user } = makeMessages(topic, normalizedType, opts);\n  const userWithVocabulary = appendVocabularyToPrompt(user, vocabulary);\n\n  return {\n    token,\n    model,\n    messages: [\n      { role: 'system', content: system },\n      { role: 'user', content: userWithVocabulary },\n    ],\n    temperature: 0.3,\n    max_tokens: 4000,\n  };\n}\n\nfunction buildTheoryBody(topic, opts = {}) {\n  let token = localStorage.getItem('gptToken');\n  if (!token || token?.length < 10) {\n    console.warn('⚠️ gptToken відсутній у localStorage');\n    token = prompt('Enter Your GPT Token');\n    if (token) localStorage.setItem('gptToken', token);\n  }\n  const model = 'gpt-4o-mini';\n  const lang = (opts.language || 'uk').toLowerCase();\n\n  const system = `You are an ESL (English as a Second Language) content generator.  \nCreate a **detailed study guide in HTML tables** for the following grammar/vocabulary topic:\n\nTOPIC: ${topic}\nLEVEL: A1-C2\nLANGUAGE OF EXPLANATION: English\nACCENT_COLOR: #00837f\n\nREQUIREMENTS:\n1. Output only valid HTML <table> structures (border=\"1\" cellpadding=\"1\" cellspacing=\"1\" style=\"width:100%\").  \n2. Use clear headers inside tables with <span style=\"color: #00837f\"><strong>…</strong></span>.  \n3. Highlight key grammar points in <strong>bold</strong>.  \n4. Use examples in simple everyday vocabulary, 1–2 per point.  \n5. You may generate ANY number of tables depending on how much detail the topic requires.  \n6. Tables should cover different aspects such as:\n   - Forms (affirmative, negative, questions)  \n   - Usage (rules, functions, signal words, time markers)  \n   - Common mistakes (\"Use it right!\")  \n   - Exceptions/irregularities/special cases  \n   - Practical examples or mini-dialogues  \n   - Vocabulary lists (if relevant to the topic)  \n   - Comparison with similar grammar points (if relevant)  \n7. Make the content structured like a mini-textbook chapter:  \n   - Start with a table that introduces the main concept and its basic forms.  \n   - Add extra tables for usage, examples, pitfalls, exceptions, etc.  \n   - End with a summary/revision table.  \n8. Keep everything inside tables, do NOT output free text outside tables.  \n\nGOAL:\nProduce a **ready-to-use study guide** in HTML tables, so that learners can read it as a digital textbook.  \nBe as detailed as possible, but keep the language simple and level-appropriate.  `;\n\n  const user = `Generate the full HTML tables for topic: ${topic}.`;\n\n  return {\n    token,\n    model,\n    messages: [\n      { role: 'system', content: system },\n      { role: 'user', content: user },\n    ],\n    temperature: 0.4,\n    max_tokens: 16384,\n  };\n}\n\n// ---- Templates: system + user by task type ---------------------------------\n\n/**\n * Кожен тип завдання має:\n * - коротку інструкцію (що генеруємо, які поля)\n * - приклад (few-shot) у system\n * - суворі вимоги: лише JSON, українська, без крапок у відповідях де потрібно тощо\n */\nfunction makeMessages(topic, type, opts) {\n  const lang = opts.language || 'en';\n  const itemsCount = Number.isInteger(opts.items)\n    ? opts.items\n    : defaultItemsByType[type] || 10;\n  const seedId = opts.seedId || shortSeed(topic);\n\n  const commonRules = `\nYOU ARE an ESL task generator.\nGOAL: create ONE task block of type \"${type}\" on the topic \"${topic}\".\nOUTPUT ONLY VALID JSON. Keep the language level around A1–A2.\nAll prompts, questions, answers, hints, and labels must be written in ENGLISH.\nEncoding — UTF-8. No explanations, no prefixes, no code fences.\nEnsure internal consistency so answers match the task logic.\n`;\n\n  const templates = {\n    mcq: {\n      system: `\n${commonRules}\nOUTPUT SCHEMA:\n{\n  \"id\": \"mcq-${seedId}-1\",\n  \"type\": \"mcq\",\n  \"prompt\": \"Choose the correct option.\",\n  \"items\": [\n    {\n      \"q\": \"<short question with one missing form>\",\n      \"choices\": [\"<option0>\", \"<option1>\", \"<option2>\"],\n      \"answer\": [\"<index_of_correct_choice_as_string>\"]\n    },\n    ...\n  ]\n}\n\nREQUIREMENTS:\n- ${itemsCount} items.\n- Follow the schema exactly.\n- Provide exactly 3 answer choices per question with a single correct one.\n- \"answer\" must be the index of the correct option as a string: \"0\" | \"1\" | \"2\".\n- Keep questions natural, concise, and on the topic \"${topic}\".\n- Return JSON only, no additional commentary.\n\nEXAMPLE (FORMAT ONLY; DO NOT COPY CONTENT):\n{\n  \"id\": \"mcq-ps-1\",\n  \"type\": \"mcq\",\n  \"prompt\": \"Choose the correct Present Simple form.\",\n  \"items\": [\n    { \"q\": \"He usually ___ the bus to work.\", \"choices\": [\"take\", \"takes\", \"is taking\"], \"answer\": [\"1\"] },\n    { \"q\": \"They ___ coffee in the morning.\", \"choices\": [\"have\", \"haves\", \"are having\"], \"answer\": [\"0\"] }\n  ]\n}\n      `.trim(),\n      user: `\nTopic: ${topic}\nGenerate a task block of type \"mcq\" strictly following the OUTPUT SCHEMA.\nNumber of items: ${itemsCount}.\n      `.trim(),\n    },\n\n    gap: {\n      system: `\n${commonRules}\nOUTPUT SCHEMA:\n{\n  \"id\": \"gap-${seedId}-1\",\n  \"type\": \"gap\",\n  \"prompt\": \"Fill the gaps with the correct word.\",\n  \"items\": [\n    { \"q\": \"They ___ (work) on Sundays.\", \"answer\": [\"correct_form\", \"alternative_if_any\"] },\n    ...\n  ]\n}\nREQUIREMENTS:\n- ${itemsCount} sentences.\n- \"q\" must be a clean English sentence. Do NOT wrap it in angle brackets, quotes, or markdown — use only plain text with a single blank shown as ___ (three underscores).\n- \"answer\" must be an array with at least one valid solution in lowercase (no angle brackets).\n- Keep sentences short, level A1–A2, and connected to \"${topic}\".\n      `.trim(),\n      user: oneLineUser(topic, 'gap', itemsCount),\n    },\n\n    transform: {\n      system: `\n${commonRules}\nOUTPUT SCHEMA:\n{\n  \"id\": \"transform-${seedId}-1\",\n  \"type\": \"transform\",\n  \"prompt\": \"Rewrite each sentence in the negative form (no final period).\",\n  \"items\": [\n    {\n      \"q\": \"She likes coffee.\",\n      \"hint\": \"use doesn't + base verb; no period\",\n      \"answer\": [\"she doesn't like coffee\", \"she does not like coffee\"]\n    }\n  ]\n}\nREQUIREMENTS:\n- ${itemsCount} items.\n- Answers must follow the prompt instructions (for example, omit the final period).\n- Provide a helpful English hint for each item.\n      `.trim(),\n      user: oneLineUser(topic, 'transform', itemsCount),\n    },\n\n    match: {\n      system: `\n${commonRules}\nOUTPUT SCHEMA:\n{\n  \"id\": \"match-${seedId}-1\",\n  \"type\": \"match\",\n  \"prompt\": \"Match the base verb with the third person singular form (he/she/it).\",\n  \"pairs\": [\n    { \"left\": \"go\", \"right\": \"goes\" },\n    ...\n  ]\n}\nREQUIREMENTS:\n- ${Math.max(6, Math.min(12, itemsCount))} unique pairs.\n- Provide one clear correct match for each pair without duplicates.\n- Use vocabulary related to \"${topic}\".\n      `.trim(),\n      user: oneLineUser(topic, 'match', itemsCount),\n    },\n\n    error: {\n      system: `\n${commonRules}\nOUTPUT SCHEMA:\n{\n  \"id\": \"error-${seedId}-1\",\n  \"type\": \"error\",\n  \"prompt\": \"Find and correct the mistake (Present Simple, no final period).\",\n  \"items\": [\n    { \"q\": \"She don't like tea.\", \"hint\": \"use doesn't + base verb\", \"answer\": [\"she doesn't like tea\", \"she does not like tea\"] }\n  ]\n}\nREQUIREMENTS:\n- ${itemsCount} sentences containing a typical error connected to \"${topic}\".\n- Provide clear English hints.\n- Match the formatting requested in the prompt (for example, omit the period).\n      `.trim(),\n      user: oneLineUser(topic, 'error', itemsCount),\n    },\n\n    order: {\n      system: `\n${commonRules}\nOUTPUT SCHEMA:\n{\n  \"id\": \"order-${seedId}-1\",\n  \"type\": \"order\",\n  \"prompt\": \"Put the words in the correct order.\",\n  \"items\": [\n    { \"q\": \"Arrange the sentence\", \"tokens\": [\"she\", \"often\", \"reads\", \"books\"], \"answer\": \"she often reads books\" }\n  ]\n}\nREQUIREMENTS:\n- ${itemsCount} items.\n- Provide tokens that form exactly the correct answer (lowercase, no period unless required by the topic).\n- Use sentences relevant to \"${topic}\".\n      `.trim(),\n      user: oneLineUser(topic, 'order', itemsCount),\n    },\n\n    short: {\n      system: `\n${commonRules}\nOUTPUT SCHEMA:\n{\n  \"id\": \"short-${seedId}-1\",\n  \"type\": \"short\",\n  \"prompt\": \"Write short answers about ${topic}.\",\n  \"items\": [\n    { \"q\": \"Write 2–3 sentences about your daily routine.\", \"keywords\": [\"i\", \"usually\", \"every\"] }\n  ]\n}\nREQUIREMENTS:\n- ${Math.min(\n        6,\n        Math.max(3, Math.floor(itemsCount / 2))\n      )} tasks that invite short written responses.\n- \"keywords\" act as guidance, not strict scoring rubrics, and must be lowercase English words.\n      `.trim(),\n      user: oneLineUser(topic, 'short', itemsCount),\n    },\n\n    open: {\n      system: `\n${commonRules}\nOUTPUT SCHEMA:\n{\n  \"id\": \"open-${seedId}-1\",\n  \"type\": \"open\",\n  \"prompt\": \"<brief classroom instruction in English>\",\n  \"items\": [\n    { \"situation\": \"<open-ended question or scenario related to the topic>\" }\n  ],\n  \"scoring\": {\n    \"criteria\": [\n      \"<criterion 1>\",\n      \"<criterion 2>\",\n      \"<criterion 3>\"\n    ]\n  }\n}\nREQUIREMENTS:\n- ${Math.max(3, Math.min(10, itemsCount))} unique items that require free-form answers.\n- Keep each \"situation\" within 8–14 words, focused on real-life communication linked to \"${topic}\".\n- Maintain an A1–A2 learner level and avoid simple yes/no prompts.\n- Provide exactly 3 concise scoring criteria phrased for teachers (e.g., \"Use two past time expressions\").\n- Optionally add \"example_answers\" arrays (1–3 short samples) to model good responses.\n- Output JSON only with no surrounding commentary.\n      `.trim(),\n      user: oneLineUser(topic, 'open', itemsCount),\n    },\n\n    writing: {\n      system: `\n${commonRules}\nOUTPUT SCHEMA:\n{\n  \"id\": \"writing-${seedId}-1\",\n  \"type\": \"writing\",\n  \"prompt\": \"Short writing task about ${topic}.\",\n  \"description\": \"<1–2 sentences describing the assignment>\",\n  \"checklist\": [\n    \"<criterion 1>\",\n    \"<criterion 2>\",\n    \"<criterion 3>\"\n  ]\n}\nREQUIREMENTS:\n- Provide a clear English description of the task.\n- Include 4–6 checklist items with concrete evaluation criteria.\n      `.trim(),\n      user: oneLineUser(topic, 'writing', itemsCount),\n    },\n    roleplay: {\n      system: `\n${commonRules}\nOUTPUT SCHEMA:\n{\n  \"id\": \"roleplay-${seedId}-1\",\n  \"type\": \"roleplay\",\n  \"prompt\": \"<short instruction in English>\",\n  \"scenario\": {\n    \"setting\": \"<where the situation takes place>\",\n    \"summary\": \"<1–2 sentences describing the task>\",\n    \"roles\": [\n      {\n        \"name\": \"Student 1\",\n        \"goal\": \"<goal to achieve>\",\n        \"details\": \"<two facts or prompts>\"\n      },\n      {\n        \"name\": \"Student 2\",\n        \"goal\": \"<goal to achieve>\",\n        \"details\": \"<two facts or prompts>\"\n      }\n    ],\n    \"steps\": [\n      \"<step 1>\",\n      \"<step 2>\",\n      \"<step 3>\",\n      \"<step 4>\"\n    ]\n  },\n  \"phrases\": [\n    { \"phrase\": \"<useful English phrase>\", \"translation\": \"<short explanation or translation in English>\" }\n  ]\n}\nREQUIREMENTS:\n- The situation must clearly connect to the topic \"${topic}\".\n- Exactly two roles: Student 1 and Student 2.\n- Provide 3–5 steps describing how the dialogue should develop.\n- Include ${Math.max(6, Math.min(10, itemsCount))} useful English phrases with brief English explanations or synonyms.\n- Do not add bullet symbols inside the strings.\n      `.trim(),\n      user: oneLineUser(topic, 'roleplay', itemsCount),\n    },\n    'dialogue-gap': {\n      system: `\n${commonRules}\nOUTPUT SCHEMA:\n{\n  \"id\": \"dialogue-gap-${seedId}-1\",\n  \"type\": \"dialogue-gap\",\n  \"prompt\": \"Fill the blanks in the dialogue using the word bank.\",\n  \"words\": [\"<word1>\", \"<word2>\", \"<word3>\"],\n  \"dialogue\": [\n    { \"speaker\": \"Student 1\", \"line\": \"<Line with one or two ___ blanks>\" }\n  ],\n  \"answers\": [\"<correct word 1>\", \"<correct word 2>\"]\n}\nREQUIREMENTS:\n- ${Math.max(4, Math.min(8, itemsCount))} turns in the dialogue.\n- Use exactly ${Math.max(4, Math.min(8, itemsCount))} blanks \"___\" across the dialogue.\n- \"words\" must list one entry per blank (repeat words when a blank uses the same word) and contain no unused distractors.\n- \"answers\" must be the same length as \"words\", list the correct words in blank order, and use only lowercase English words present in \"words\".\n- Keep each line short (maximum 12 words) and on the topic \"${topic}\".\n- Do not add extra fields beyond the schema.\n      `.trim(),\n      user: oneLineUser(topic, 'dialogue-gap', itemsCount),\n    },\n    'dialogue-order': {\n      system: `\n${commonRules}\nOUTPUT SCHEMA:\n{\n  \"id\": \"dialogue-order-${seedId}-1\",\n  \"type\": \"dialogue-order\",\n  \"prompt\": \"Arrange the dialogue lines in the correct order.\",\n  \"lines\": [\n    { \"speaker\": \"Student 1\", \"line\": \"<Line>\" },\n    { \"speaker\": \"Student 2\", \"line\": \"<Line>\" }\n  ],\n  \"solution\": [1, 0]\n}\nREQUIREMENTS:\n- ${Math.max(4, Math.min(8, itemsCount))} total lines.\n- Each line must contain 6–12 words, sound natural, and stay on the topic \"${topic}\".\n- \"solution\" is an array of zero-based indices describing the correct order of the lines.\n- Do not add extra fields beyond the schema.\n      `.trim(),\n      user: oneLineUser(topic, 'dialogue-order', itemsCount),\n    },\n    truefalse: {\n      system: `\n${commonRules}\nOUTPUT SCHEMA:\n{\n  \"id\": \"truefalse-${seedId}-1\",\n  \"type\": \"truefalse\",\n  \"prompt\": \"Decide if each statement is true or false.\",\n  \"items\": [\n    { \"statement\": \"<short statement>\", \"answer\": true }\n  ]\n}\nREQUIREMENTS:\n- ${Math.max(6, Math.min(12, itemsCount))} statements.\n- \"answer\" must be strictly true or false.\n- Use simple A1–A2 level sentences in English related to \"${topic}\".\n      `.trim(),\n      user: oneLineUser(topic, 'truefalse', itemsCount),\n    },\n    'definition-match': {\n      system: `\n${commonRules}\nOUTPUT SCHEMA:\n{\n  \"id\": \"definition-match-${seedId}-1\",\n  \"type\": \"definition-match\",\n  \"prompt\": \"Match the word with its definition.\",\n  \"pairs\": [\n    { \"left\": \"<word>\", \"right\": \"<short definition>\" }\n  ]\n}\nREQUIREMENTS:\n- ${Math.max(6, Math.min(10, itemsCount))} pairs.\n- \"left\" must be a single lowercase word without articles.\n- \"right\" must be one sentence of up to 14 words.\n- Use vocabulary connected to the topic \"${topic}\".\n      `.trim(),\n      user: oneLineUser(topic, 'definition-match', itemsCount),\n    },\n    'synonym-clue': {\n      system: `\n${commonRules}\nOUTPUT SCHEMA:\n{\n  \"id\": \"synonym-clue-${seedId}-1\",\n  \"type\": \"synonym-clue\",\n  \"prompt\": \"Choose the correct word based on the clue.\",\n  \"wordBank\": [\"<word1>\", \"<word2>\", \"<word3>\"],\n  \"items\": [\n    { \"clue\": \"<clue>\", \"answers\": [\"<correct word>\"] }\n  ]\n}\nREQUIREMENTS:\n- ${Math.max(6, Math.min(10, itemsCount))} items.\n- Provide a word bank of 6–8 lowercase English words that includes all correct answers.\n- \"answers\" may contain 1–2 acceptable synonyms, all in lowercase English.\n- Write concise clues; omit the final period if the clue is a fragment.\n      `.trim(),\n      user: oneLineUser(topic, 'synonym-clue', itemsCount),\n    },\n    scramble: {\n      system: `\n${commonRules}\nOUTPUT SCHEMA:\n{\n  \"id\": \"scramble-${seedId}-1\",\n  \"type\": \"scramble\",\n  \"prompt\": \"Unscramble the word.\",\n  \"items\": [\n    { \"scrambled\": \"<jumbled letters>\", \"answers\": [\"<correct word>\"] }\n  ]\n}\nREQUIREMENTS:\n- ${Math.max(6, Math.min(10, itemsCount))} items.\n- \"scrambled\" must be a shuffled version of an English word from \"${topic}\".\n- \"answers\" may list 1–2 valid spellings in lowercase English.\n      `.trim(),\n      user: oneLineUser(topic, 'scramble', itemsCount),\n    },\n    wordpairs: {\n      system: `\n${commonRules}\nOUTPUT SCHEMA:\n{\n  \"id\": \"wordpairs-${seedId}-1\",\n  \"type\": \"wordpairs\",\n  \"prompt\": \"Match the singular form to the plural form.\",\n  \"pairs\": [\n    { \"left\": \"<singular>\", \"right\": \"<plural>\" }\n  ]\n}\nREQUIREMENTS:\n- ${Math.max(6, Math.min(10, itemsCount))} pairs.\n- Use accurate singular/plural pairs relevant to \"${topic}\".\n- Do not add extra keys beyond the schema.\n      `.trim(),\n      user: oneLineUser(topic, 'wordpairs', itemsCount),\n    },\n    'odd-one-out': {\n      system: `\n${commonRules}\nOUTPUT SCHEMA:\n{\n  \"id\": \"odd-one-out-${seedId}-1\",\n  \"type\": \"odd-one-out\",\n  \"prompt\": \"Find the odd one out.\",\n  \"items\": [\n    { \"options\": [\"<word1>\", \"<word2>\", \"<word3>\", \"<word4>\"], \"answer\": \"2\", \"explanation\": \"<reason>\" }\n  ]\n}\nREQUIREMENTS:\n- ${Math.max(6, Math.min(10, itemsCount))} items.\n- Provide exactly 4 options per item.\n- \"answer\" must be the index of the odd item as a string (\"0\"–\"3\").\n- Include a brief English explanation (up to 10 words) for why the option is odd.\n- Only one option may be different; the rest must relate to \"${topic}\".\n      `.trim(),\n      user: oneLineUser(topic, 'odd-one-out', itemsCount),\n    },\n    context: {\n      system: `\n${commonRules}\nOUTPUT SCHEMA:\n{\n  \"id\": \"context-${seedId}-1\",\n  \"type\": \"context\",\n  \"prompt\": \"<instruction in English>\",\n  \"context\": {\n    \"title\": \"<2–4 words>\",\n    \"format\": \"dialog\" | \"narrative\",\n    \"body\": []\n  },\n  \"questions\": [\n    {\n      \"q\": \"<question>\",\n      \"choices\": [\"<option0>\", \"<option1>\", \"<option2>\"],\n      \"answer\": [\"<index_of_correct_choice_as_string>\"]\n    },\n    ...\n  ]\n}\n\nREQUIREMENTS:\n- Provide ${itemsCount} comprehension questions for the passage.\n- Keep the text within 200 words using simple A1 English connected to \"${topic}\".\n- If \"format\" is \"dialog\", use objects {\"speaker\": \"...\", \"line\": \"...\"}.\n- If \"format\" is \"narrative\", use an array of short paragraph strings.\n- Each question must offer exactly 3 choices and a single correct answer.\n- Return the index of the correct choice as a string (\"0\" | \"1\" | \"2\").\n- Output only JSON, no extra commentary.\n\nEXAMPLE (FORMAT ONLY; DO NOT COPY CONTENT):\n{\n  \"id\": \"context-ps-1\",\n  \"type\": \"context\",\n  \"prompt\": \"Read the dialogue and choose the correct answer.\",\n  \"context\": {\n    \"title\": \"Morning Chat\",\n    \"format\": \"dialog\",\n    \"body\": [\n      { \"speaker\": \"Emma\", \"line\": \"Hi, Leo! Are you ready for school?\" },\n      { \"speaker\": \"Leo\", \"line\": \"Yes, but I can't find my maths book.\" },\n      { \"speaker\": \"Emma\", \"line\": \"Check your bag again.\" }\n    ]\n  },\n  \"questions\": [\n    {\n      \"q\": \"What did Leo lose?\",\n      \"choices\": [\"Pencil case\", \"Math textbook\", \"English notebook\"],\n      \"answer\": [\"1\"]\n    }\n  ]\n}`.trim(),\n      user: oneLineUser(topic, 'context', itemsCount),\n    },\n  };\n\n  const baseTemplate = templates[type] || templates.mcq;\n  const extraInstructions =\n    (opts.additionalInstructions || opts.extraInstructions || '').trim();\n\n  if (!extraInstructions) {\n    return baseTemplate;\n  }\n\n  return {\n    system: baseTemplate.system,\n    user: `${baseTemplate.user}\\n\\nAdditional teacher instructions:\\n${extraInstructions}`,\n  };\n}\n\n// ---- Helpers ----------------------------------------------------------------\nconst defaultItemsByType = {\n  mcq: 10,\n  gap: 10,\n  transform: 10,\n  match: 8,\n  error: 10,\n  order: 10,\n  short: 3,\n  open: 4,\n  writing: 1,\n  roleplay: 8,\n  'dialogue-gap': 6,\n  'dialogue-order': 6,\n  truefalse: 8,\n  'definition-match': 8,\n  'synonym-clue': 8,\n  scramble: 8,\n  wordpairs: 8,\n  'odd-one-out': 8,\n  context: 4,\n};\n\nfunction oneLineUser(topic, type, itemsCount) {\n  return `Topic: ${topic}\\nGenerate a task block of type \"${type}\" with ${itemsCount} items. Return JSON only that follows the described schema.`;\n}\n\nfunction shortSeed(s) {\n  return (\n    String(s || 'task')\n      .toLowerCase()\n      .replace(/[^a-z0-9]+/g, '-')\n      .replace(/^-+|-+$/g, '')\n      .slice(0, 6) || 'task'\n  );\n}\n\nfunction appendVocabularyToPrompt(userContent, vocabulary) {\n  const trimmed = String(userContent || '').trim();\n  const formattedList = formatVocabularyList(vocabulary);\n  if (!formattedList) return trimmed || userContent || '';\n  const base = trimmed || 'Generate the task block.';\n  return `${base}\n\nSTRICT VOCABULARY REQUIREMENTS (communication lesson):\n1. Treat the target expressions below as the ONLY lexical focus for the task. Every generated item and every correct answer must contain at least one of these expressions verbatim (you may adapt grammar but keep the core phrase).\n2. Do not introduce alternative key phrases or synonyms outside this list; supporting words like articles or pronouns are fine, but the highlighted expression must come from the list.\n3. When offering distractors or incorrect options, keep them realistic yet stay close to the topic; never invent brand-new key phrases outside the set.\n4. The Ukrainian translations are reference only – the final task must remain fully in English.\n\nTarget vocabulary:\\n${formattedList}`;\n}\n\nfunction formatVocabularyList(list) {\n  if (!Array.isArray(list) || !list.length) return '';\n  const extractEnglishExample = (value) => {\n    if (!value) return '';\n    const dashIdx = value.indexOf(' — ');\n    const enDashIdx = value.indexOf(' – ');\n    const hyphenIdx = value.indexOf(' - ');\n    const candidates = [dashIdx, enDashIdx, hyphenIdx].filter((idx) => idx >= 0);\n    const cutIndex = candidates.length ? Math.min(...candidates) : -1;\n    const result = cutIndex >= 0 ? value.slice(0, cutIndex) : value;\n    return result.trim();\n  };\n  const lines = list\n    .map((entry, index) => {\n      if (!entry) return '';\n      const word = entry.word || entry.term || entry.phrase || entry.text || `Item ${index + 1}`;\n      const translation = entry.translation || entry.meaning || entry.ua || entry.uk || '';\n      const rawExample = entry.example || entry.sentence || entry.usage || entry.sample || '';\n      const example = extractEnglishExample(rawExample);\n      let line = `${index + 1}. ${word}`;\n      if (translation) line += ` — ${translation}`;\n      if (example) line += ` (Example: ${example})`;\n      return line;\n    })\n    .filter(Boolean);\n  if (!lines.length) return '';\n  return lines.join('\\n');\n}\n","import { generateTask } from '@api/chatGpt.js';\n\nconst adminWrapper = document.querySelector('.js-practice-section');\nconst form = document.querySelector('[data-practice-generator]');\nconst statusElement = form?.querySelector('[data-practice-status]');\nconst outputWrapper = document.querySelector('[data-generator-output]');\nconst jsonElement = document.querySelector('[data-generator-json]');\nconst copyButton = document.querySelector('[data-generator-copy]');\nconst downloadButton = document.querySelector('[data-generator-download]');\nconst typesContainer = form?.querySelector('[data-types]');\nconst typesTrigger = form?.querySelector('[data-types-trigger]');\nconst typesPanel = form?.querySelector('[data-types-panel]');\nconst placeholder = document.querySelector('[data-practice-placeholder]');\n\nconst defaultContext = window.lessonContext || {};\n\nlet baseTitle = defaultContext.title || 'Generated Practice';\nlet baseLevel = defaultContext.level || 'custom';\nconst baseTasks = [];\nconst generatedTasks = [];\n\nfunction hideElement(element) {\n  if (!element) return;\n  element.classList.add('hidden');\n}\n\nfunction showElement(element) {\n  if (!element) return;\n  element.classList.remove('hidden');\n}\n\nfunction isElementHidden(element) {\n  return !element || element.classList.contains('hidden');\n}\n\nfunction isGeneratorHidden() {\n  return localStorage.getItem('hideGenerateSection') === 'true';\n}\n\nfunction applyGeneratorVisibility() {\n  if (isGeneratorHidden()) {\n    hideElement(adminWrapper);\n    hideElement(typesPanel);\n    hideElement(outputWrapper);\n    closeTypesPanel();\n  } else {\n    showElement(adminWrapper);\n    updateTypesTriggerLabel();\n    updateJsonPreview();\n  }\n}\n\nfunction createTaskKey(task) {\n  const base =\n    task && typeof task === 'object' && task.id\n      ? String(task.id)\n      : String(task?.type || 'task');\n  return `${base}-${Date.now()}-${Math.random().toString(16).slice(2, 8)}`;\n}\n\nfunction buildAggregatePayload() {\n  return {\n    title: baseTitle || defaultContext.title || 'Generated Practice',\n    level: baseLevel || defaultContext.level || 'custom',\n    tasks: [...baseTasks, ...generatedTasks].map(item => item.data),\n  };\n}\n\nfunction updateJsonPreview() {\n  if (!jsonElement) return;\n\n  if (isGeneratorHidden()) {\n    hideElement(outputWrapper);\n    return;\n  }\n\n  if (!baseTasks.length && !generatedTasks.length) {\n    jsonElement.textContent = '';\n    hideElement(outputWrapper);\n    if (copyButton) copyButton.disabled = true;\n    if (downloadButton) downloadButton.disabled = true;\n    return;\n  }\n\n  jsonElement.textContent = JSON.stringify(buildAggregatePayload(), null, 2);\n  showElement(outputWrapper);\n  if (copyButton) copyButton.disabled = false;\n  if (downloadButton) downloadButton.disabled = false;\n}\n\nfunction addGeneratedTask(task) {\n  const key = createTaskKey(task);\n  generatedTasks.push({ key, data: task });\n  updateJsonPreview();\n  return key;\n}\n\nfunction removeTask(key, task) {\n  const removeFrom = list => {\n    const index = list.findIndex(\n      item => (key && item.key === key) || item.data === task\n    );\n    if (index !== -1) {\n      list.splice(index, 1);\n      return true;\n    }\n    return false;\n  };\n\n  const removed = removeFrom(generatedTasks) || removeFrom(baseTasks);\n  if (removed) {\n    updateJsonPreview();\n  }\n}\n\nfunction setInitialTopic() {\n  if (!form) return;\n  const topicInput = form.querySelector('[name=\"topic\"]');\n  if (topicInput && !topicInput.value) {\n    const initialTopic = defaultContext.title || 'Lesson topic';\n    topicInput.value = initialTopic;\n  }\n}\n\nfunction setStatus(message, state = 'idle') {\n  if (!statusElement) return;\n  statusElement.textContent = message;\n  statusElement.dataset.state = state;\n}\n\nfunction slugify(value) {\n  return String(value || '')\n    .toLowerCase()\n    .replace(/[^a-z0-9]+/g, '-')\n    .replace(/^-+|-+$/g, '')\n    .slice(0, 8);\n}\n\nfunction toFileSlug(value) {\n  return String(value || '')\n    .toLowerCase()\n    .replace(/[^a-z0-9]+/g, '-')\n    .replace(/^-+|-+$/g, '');\n}\n\nfunction getTypeInputs() {\n  return Array.from(form.querySelectorAll('input[name=\"types\"]'));\n}\n\nfunction formatTypesLabel(inputs) {\n  const selected = inputs\n    .filter(input => input.checked)\n    .map(input => input.nextElementSibling?.textContent?.trim())\n    .filter(Boolean);\n\n  if (!selected.length) return 'Оберіть типи';\n  if (selected.length <= 2) return selected.join(', ');\n  return `${selected.slice(0, 2).join(', ')} +${selected.length - 2}`;\n}\n\nfunction updateTypesTriggerLabel() {\n  if (!typesTrigger) return;\n  const inputs = getTypeInputs();\n  typesTrigger.textContent = formatTypesLabel(inputs);\n}\n\nfunction closeTypesPanel() {\n  if (!typesPanel || !typesTrigger) return;\n  if (!isElementHidden(typesPanel)) {\n    hideElement(typesPanel);\n    typesTrigger.setAttribute('aria-expanded', 'false');\n  }\n}\n\nfunction toggleTypesPanel() {\n  if (!typesPanel || !typesTrigger) return;\n  const willOpen = isElementHidden(typesPanel);\n  if (willOpen) {\n    showElement(typesPanel);\n    typesTrigger.setAttribute('aria-expanded', 'true');\n    const firstInput = typesPanel.querySelector('input[name=\"types\"]');\n    firstInput?.focus({ preventScroll: true });\n  } else {\n    closeTypesPanel();\n  }\n}\n\nfunction toggleGeneratorVisibility() {\n  const shouldHide = !isGeneratorHidden();\n  localStorage.setItem('hideGenerateSection', String(shouldHide));\n  applyGeneratorVisibility();\n  updateJsonPreview();\n}\n\nfunction clearPracticeEmptyState() {\n  const practiceRoot = document.getElementById('practice');\n  const body = practiceRoot?.querySelector('#practice-body');\n  if (placeholder) {\n    placeholder.remove();\n  }\n  if (body && body.children.length === 1) {\n    const first = body.firstElementChild;\n    if (first && /практика поки відсутня/i.test(first.textContent || '')) {\n      first.remove();\n    }\n  }\n}\n\nfunction ensurePracticeHeader() {\n  const practiceRoot = document.getElementById('practice');\n  if (!practiceRoot) return;\n  const body = practiceRoot.querySelector('#practice-body');\n  if (body && !body.querySelector('.practice-dynamic-title')) {\n    const header = document.createElement('div');\n    header.className = 'practice-dynamic-title';\n    header.innerHTML = `\n      <h2>Згенеровані завдання</h2>\n      ${\n        defaultContext.level\n          ? `<p class=\"muted\">Рівень: ${defaultContext.level}</p>`\n          : ''\n      }\n    `;\n    body.prepend(header);\n  }\n}\n\nasync function handleSubmit(event) {\n  event.preventDefault();\n  if (!form) return;\n\n  const submitButton = form.querySelector('button[type=\"submit\"]');\n  const topicInput = form.querySelector('[name=\"topic\"]');\n  const countInput = form.querySelector('[name=\"count\"]');\n  const instructionsInput = form.querySelector('[name=\"instructions\"]');\n  const typeInputs = getTypeInputs();\n\n  const topic = topicInput?.value?.trim();\n  const count = Number.parseInt(countInput?.value || '10', 10) || 10;\n  const additionalInstructions = instructionsInput?.value?.trim() || '';\n  const selectedTypes = typeInputs\n    .filter(input => input.checked)\n    .map(input => input.value);\n\n  if (!topic) {\n    setStatus('Укажіть тему для генерації завдання.', 'error');\n    topicInput?.focus();\n    return;\n  }\n\n  if (!selectedTypes.length && typeof closeTypesPanel === 'function') {\n    setStatus('Оберіть принаймні один тип завдання.', 'error');\n    return;\n  }\n\n  const seedBase = slugify(topic) || 'task';\n  setStatus(`Генеруємо ${selectedTypes.length} тип(и) завдань…`, 'loading');\n  if (submitButton) {\n    submitButton.disabled = true;\n    submitButton.dataset.originalText =\n      submitButton.dataset.originalText || submitButton.textContent;\n    submitButton.textContent = 'Генерація…';\n  }\n\n  const category = String(defaultContext.category || '').toLowerCase();\n  const vocabulary = undefined;\n\n  try {\n    const generationPromises = selectedTypes.map(type =>\n      generateTask(\n        topic,\n        type,\n        {\n          items: count,\n          language: 'en',\n          seedId: `${seedBase}-${type}`,\n          ...(additionalInstructions\n            ? { additionalInstructions }\n            : {}),\n        },\n        vocabulary,\n      ).then(task => ({ type, task }))\n    );\n\n    const settled = await Promise.allSettled(generationPromises);\n    const successful = settled\n      .map((result, index) =>\n        result.status === 'fulfilled'\n          ? { type: selectedTypes[index], task: result.value.task }\n          : null\n      )\n      .filter(Boolean);\n    const failed = settled\n      .map((result, index) =>\n        result.status === 'rejected' ? selectedTypes[index] : null\n      )\n      .filter(Boolean);\n\n    if (!successful.length) {\n      throw new Error('Не вдалося згенерувати жодного типу завдань');\n    }\n\n    const appended = [];\n    successful.forEach(({ type, task }) => {\n      const normalizedTask = { ...task };\n      if (!normalizedTask.id) {\n        normalizedTask.id = `${type}-${seedBase}-${Date.now().toString(\n          36\n        )}${Math.random().toString(36).slice(2, 6)}`;\n      }\n      const key = addGeneratedTask(normalizedTask);\n      appended.push({ task: normalizedTask, key });\n    });\n\n    clearPracticeEmptyState();\n    if (window.practice && typeof window.practice.appendTask === 'function') {\n      ensurePracticeHeader();\n      appended.forEach(({ task: generatedTask, key }) => {\n        window.practice.appendTask(generatedTask, { key });\n      });\n    }\n\n    closeTypesPanel();\n\n    const successTypes = successful.map(({ type }) => type).join(', ');\n    if (failed.length) {\n      setStatus(\n        `Згенеровано: ${successTypes}. Помилки: ${failed.join(', ')}`,\n        'success'\n      );\n    } else {\n      setStatus(\n        `Готово! Додано ${successful.length} блок(и): ${successTypes}.`,\n        'success'\n      );\n    }\n  } catch (error) {\n    console.error(error);\n    const message =\n      error instanceof Error && error.message\n        ? `Помилка: ${error.message}`\n        : 'Не вдалося згенерувати завдання. Перевірте токен або спробуйте ще раз.';\n    setStatus(message, 'error');\n  } finally {\n    if (submitButton) {\n      const original =\n        submitButton.dataset.originalText || 'Згенерувати завдання';\n      submitButton.disabled = false;\n      submitButton.textContent = original;\n    }\n  }\n}\n\nasync function handleCopy() {\n  if (!jsonElement) return;\n  const content = jsonElement.textContent;\n  if (!content) return;\n  try {\n    await navigator.clipboard.writeText(content);\n    setStatus('JSON скопійовано у буфер.', 'success');\n  } catch (error) {\n    console.error(error);\n    setStatus('Не вдалося скопіювати JSON. Спробуйте вручну.', 'error');\n  }\n}\n\nfunction getDownloadFilename(payload) {\n  const base =\n    toFileSlug(defaultContext.id) ||\n    toFileSlug(payload.title) ||\n    toFileSlug(defaultContext.title) ||\n    'practice';\n  return `${base || 'practice'}.json`;\n}\n\nasync function handleDownload() {\n  const payload = buildAggregatePayload();\n  const content = JSON.stringify(payload, null, 2);\n  if (!content || content === '{}' || content === '[]') {\n    setStatus('Немає даних для завантаження.', 'error');\n    return;\n  }\n\n  try {\n    const blob = new Blob([content], { type: 'application/json' });\n    const url = URL.createObjectURL(blob);\n    const anchor = document.createElement('a');\n    anchor.href = url;\n    anchor.download = getDownloadFilename(payload);\n    document.body.appendChild(anchor);\n    anchor.click();\n    document.body.removeChild(anchor);\n    URL.revokeObjectURL(url);\n    setStatus('Файл завантажено.', 'success');\n  } catch (error) {\n    console.error(error);\n    setStatus('Не вдалося завантажити файл.', 'error');\n  }\n}\n\nfunction init() {\n  if (!form) return;\n  setInitialTopic();\n  form.addEventListener('submit', handleSubmit);\n  if (copyButton) {\n    copyButton.addEventListener('click', handleCopy);\n    copyButton.disabled = true;\n  }\n  if (downloadButton) {\n    downloadButton.addEventListener('click', handleDownload);\n    downloadButton.disabled = true;\n  }\n\n  if (typesTrigger && typesPanel && typesContainer) {\n    typesTrigger.setAttribute('aria-haspopup', 'true');\n    typesTrigger.setAttribute('aria-expanded', 'false');\n    typesTrigger.addEventListener('click', () => {\n      toggleTypesPanel();\n    });\n\n    const handlePointerDown = event => {\n      if (!typesContainer.contains(event.target)) {\n        closeTypesPanel();\n      }\n    };\n\n    document.addEventListener('pointerdown', handlePointerDown);\n\n    const handleFocusOut = event => {\n      const next = event.relatedTarget;\n      if (!next || !typesContainer.contains(next)) {\n        closeTypesPanel();\n      }\n    };\n\n    typesContainer.addEventListener('focusout', handleFocusOut);\n\n    document.addEventListener('keydown', event => {\n      if (event.key === 'Escape') {\n        closeTypesPanel();\n        typesTrigger.focus();\n      }\n    });\n\n    getTypeInputs().forEach(input => {\n      input.addEventListener('change', () => {\n        updateTypesTriggerLabel();\n      });\n    });\n    updateTypesTriggerLabel();\n\n    form.addEventListener('submit', () => {\n      closeTypesPanel();\n    });\n  }\n\n  document.addEventListener('practice:taskRemoved', event => {\n    const detail = event.detail || {};\n    removeTask(detail.key, detail.task);\n  });\n\n  document.addEventListener('practice:dataLoaded', event => {\n    const detail = event.detail;\n    baseTasks.length = 0;\n    if (detail && Array.isArray(detail.entries)) {\n      baseTitle = detail.title ?? baseTitle;\n      baseLevel = detail.level ?? baseLevel;\n      detail.entries.forEach(({ task, key }) => {\n        const entryKey = key || createTaskKey(task);\n        baseTasks.push({ key: entryKey, data: task });\n      });\n    } else if (detail && Array.isArray(detail.tasks)) {\n      baseTitle = detail.title ?? baseTitle;\n      baseLevel = detail.level ?? baseLevel;\n      detail.tasks.forEach(task => {\n        const entryKey =\n          task && task.id ? String(task.id) : createTaskKey(task);\n        baseTasks.push({ key: entryKey, data: task });\n      });\n    } else {\n      if (!detail) {\n        baseTitle = defaultContext.title || baseTitle;\n        baseLevel = defaultContext.level || baseLevel;\n      } else {\n        baseTitle = detail.title ?? baseTitle;\n        baseLevel = detail.level ?? baseLevel;\n      }\n    }\n    updateJsonPreview();\n    applyGeneratorVisibility();\n  });\n\n  applyGeneratorVisibility();\n  updateJsonPreview();\n\n  document.addEventListener('keydown', event => {\n    if (\n      event.code &&\n      event.code === 'KeyH' &&\n      event.ctrlKey &&\n      event.shiftKey\n    ) {\n      event.preventDefault();\n      toggleGeneratorVisibility();\n    }\n  });\n}\n\ninit();\n"],"names":["getUsers","page","limit","axios","basePath","__vite_import_meta_env__","resolveAssetPath","path","normalizedBase","rawPath","derivePracticePath","parts","file","json","el","tag","attrs","children","node","k","v","ch","shuffle","arr","a","i","j","normalize","s","shareState","fetchStudents","data","items","error","formatStudentName","student","possibleFirst","possibleLast","part","closeActiveSharePanel","panel","button","handleOutsideShareClick","event","target","handleShareKeydown","renderStudentOptions","students","task","list","lessonId","lessonName","homework","addHomework","item","createSharePanel","toggleSharePanel","createShareButton","makeHint","hintText","wrap","btn","box","isHidden","renderMCQ","container","blocks","idx","name","allowMulti","block","choice","cIdx","id","lbl","result","correct","answers","picked","expected","ok","exp","renderGap","it","row","input","val","renderMatch","pairs","rights","p","rows","select","r","right","renderContext","context","format","body","textWrap","turn","speaker","line","paragraph","index","text","questions","question","expectedIsIndex","value","answer","entry","explanation","renderTask","taskKey","options","showRemove","keyBase","controls","shareBtn","sharePanel","removeBtn","rawType","renderTransform","renderError","renderOrder","renderShort","renderRoleplay","renderDialogueGap","renderDialogueOrder","renderTrueFalse","matchTask","renderSynonymClue","renderScramble","pairsTask","renderOddOneOut","renderOpen","renderWriting","meta","root","ensurePracticeContainer","allowRemove","tasks","entries","title","level","description","keyPrefix","showEmptyNote","note","wrapper","header","key","fetchPracticeCandidate","resolvedPath","res","loadData","inline","candidates","normalized","segments","last","candidate","fallbackPath","correctStr","pool","poolWrap","outWrap","used","makeBtn","word","b","w","actions","reset","n","sum","total","keywords","matched","info","situation","examples","chips","criteria","scoringBox","criterion","scenario","infoBox","infoAdded","roles","rolesWrap","role","roleBox","details","detail","steps","stepsWrap","step","phrases","phraseText","translation","blanks","activeBlank","setActive","blank","clearBlank","bank","words","seenWords","uniqueWords","signature","dialogueWrap","dialogue","blankIndex","checkBtn","resetBtn","lines","solution","_","makeLabel","removeChip","chip","sourceId","appendChip","label","buttonId","built","trueLabel","falseLabel","wordBank","groupName","option","optionIndex","answerIndex","init","placeholder","e","div","html","communicationWords","DEFAULT_THEME_ID","DEFAULT_TEMPLATE_ID","DEFAULT_FONT_STACK_ID","lessonWordwalls","buildBaseUrl","config","buildWordwallUrl","baseUrl","params","themeId","templateId","fontStackId","query","createWordwallIframe","src","iframe","getWordwallConfigsForLesson","normaliseCategoryParam","topicId","customLessonId","fallbackTitle","fallbackCategory","fallbackLevel","fallbackFile","lesson","lessons","customLesson","customLessonPresets","preset","topicIds","loadCustomLessons","isCustomLesson","resolvedTitle","resolvedCategory","resolvedLevel","topics","resolvedFile","titleElement","categoryElement","levelElement","statusElement","contentElement","setCurrentYear","yearEl","renderMeta","categoryText","_a","lessonCategories","practiceTitleElement","makeTopicAnchorId","rawId","createSummaryList","heading","topic","categoryLabel","anchorId","link","fetchPracticeDataForTopic","response","payload","renderEmptyPracticeState","createWordwallSection","configs","section","itemsWrapper","hasEmbeds","renderCustomLesson","intro","categoryOrder","orderedTopics","orderA","orderB","summary","wordwallSection","sectionAnchorId","markup","practiceWrapper","practiceData","practiceApi","hydrateCommunicationWords","loadLesson","template","renderCommunicationTable","table","thead","headRow","th","tbody","wordCell","translationCell","exampleCell","resolveCommunicationTopic","ancestor","contextId","containers","topicKey","getAnswer","url","generateTask","typeQuestion","opts","vocabulary","promptBody","buildBody","raw","jsonMatch","token","model","normalizedType","system","user","makeMessages","userWithVocabulary","appendVocabularyToPrompt","type","itemsCount","defaultItemsByType","seedId","shortSeed","commonRules","templates","oneLineUser","baseTemplate","extraInstructions","userContent","trimmed","formattedList","formatVocabularyList","extractEnglishExample","dashIdx","enDashIdx","hyphenIdx","cutIndex","rawExample","example","adminWrapper","form","outputWrapper","jsonElement","copyButton","downloadButton","typesContainer","typesTrigger","typesPanel","defaultContext","baseTitle","baseLevel","baseTasks","generatedTasks","hideElement","element","showElement","isElementHidden","isGeneratorHidden","applyGeneratorVisibility","closeTypesPanel","updateTypesTriggerLabel","updateJsonPreview","createTaskKey","buildAggregatePayload","addGeneratedTask","removeTask","removeFrom","setInitialTopic","topicInput","initialTopic","setStatus","message","state","slugify","toFileSlug","getTypeInputs","formatTypesLabel","inputs","selected","_b","toggleTypesPanel","firstInput","toggleGeneratorVisibility","shouldHide","clearPracticeEmptyState","practiceRoot","first","ensurePracticeHeader","handleSubmit","submitButton","countInput","instructionsInput","typeInputs","count","additionalInstructions","selectedTypes","seedBase","generationPromises","settled","successful","failed","appended","normalizedTask","generatedTask","successTypes","original","handleCopy","content","getDownloadFilename","handleDownload","blob","anchor","handlePointerDown","handleFocusOut","next","entryKey"],"mappings":"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iCACV,EACD,CACE,KAAM,mBACN,YAAa,wBACb,QAAS,4BACV,EACD,CACE,KAAM,eACN,YAAa,aACb,QAAS,wBACV,EACD,CACE,KAAM,mBACN,YAAa,0BACb,QAAS,4BACV,EACD,CACE,KAAM,gBACN,YAAa,qBACb,QAAS,kCACV,EACD,CACE,KAAM,eACN,YAAa,qBACb,QAAS,qCACV,EACD,CACE,KAAM,UACN,YAAa,eACb,QAAS,+BACV,EACD,CACE,KAAM,MACN,YAAa,QACb,QAAS,4BACV,EACD,CACE,KAAM,YACN,YAAa,cACb,QAAS,kCACV,EACD,CACE,KAAM,kBACN,YAAa,cACb,QAAS,qCACV,EACD,CACE,KAAM,aACN,YAAa,aACb,QAAS,wBACV,CACF,EACD,uBAAwB,CACtB,CACE,KAAM,aACN,YAAa,OACb,QAAS,wBACV,EACD,CACE,KAAM,YACN,YAAa,WACb,QAAS,4BACV,EACD,CACE,KAAM,YACN,YAAa,aACb,QAAS,mCACV,EACD,CACE,KAAM,WACN,YAAa,uBACb,QAAS,8CACV,EACD,CACE,KAAM,MACN,YAAa,MACb,QAAS,mBACV,EACD,CACE,KAAM,qBACN,YAAa,iBACb,QAAS,wBACV,EACD,CACE,KAAM,YACN,YAAa,cACb,QAAS,uBACV,EACD,CACE,KAAM,UACN,YAAa,SACb,QAAS,wBACV,EACD,CACE,KAAM,OACN,YAAa,QACb,QAAS,6BACV,EACD,CACE,KAAM,WACN,YAAa,cACb,QAAS,yBACV,EACD,CACE,KAAM,iBACN,YAAa,mBACb,QAAS,+BACV,EACD,CACE,KAAM,UACN,YAAa,SACb,QAAS,gCACV,EACD,CACE,KAAM,cACN,YAAa,iBACb,QAAS,gCACV,EACD,CACE,KAAM,kBACN,YAAa,aACb,QAAS,kCACV,EACD,CACE,KAAM,mBACN,YAAa,gBACb,QAAS,uCACV,EACD,CACE,KAAM,OACN,YAAa,eACb,QAAS,oBACV,EACD,CACE,KAAM,UACN,YAAa,SACb,QAAS,iBACV,EACD,CACE,KAAM,YACN,YAAa,SACb,QAAS,yBACV,EACD,CACE,K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"}