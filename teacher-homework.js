import"./assets/main-qawqI_5G.js";import"./assets/catalog-B3s8-Oce.js";import{a as L}from"./assets/auth-Y9Je3ray.js";import{g as _,a as x,b as R,c as U}from"./assets/practice-604QvU9W.js";import{u as M}from"./assets/homework-updates-DEG1e_hS.js";import"./assets/custom-lessons-store-ClPKfKWc.js";import"./assets/vendor-CWxt7QI6.js";const m=document.querySelector("[data-student-select]"),s=document.querySelector("[data-homework-status]"),v=document.querySelector("[data-student-hint]"),C=document.querySelector("[data-homework-list]"),p=document.querySelector(".js-homework-content");if(m&&s&&C&&p){let o=function(e){s&&(s.textContent=e||"",s.hidden=!e)},u=function(e){v&&(v.hidden=!e)},h=function(){C.innerHTML=""},y=function(){p.innerHTML=""},g=function(e){n.activeLessonCard&&n.activeLessonCard!==e&&n.activeLessonCard.classList.remove("homework-card--active"),n.activeLessonCard=e,e&&e.classList.add("homework-card--active")},k=function(e){if(!e||typeof e!="object")return"Без імені";const r=e.firstName||e.firstname||e.nameFirst||e.givenName||"",t=e.lastName||e.lastname||e.nameLast||e.familyName||"",a=[r,t].map(c=>String(c||"").trim()).filter(Boolean).join(" "),i=e.displayName||e.fullName||e.username||e.name||e.email||(e.id?`ID ${e.id}`:"");return a||i||"Без імені"},f=function(e,{disabled:r=!0}={}){m.innerHTML="";const t=document.createElement("option");t.value="",t.textContent=e,t.disabled=!0,t.selected=!0,m.appendChild(t),m.disabled=r},E=function(e){if(n.students=e,n.studentByEmail.clear(),e.forEach(t=>{t!=null&&t.email&&n.studentByEmail.set(t.email,t)}),!e.length){f("Список студентів порожній",{disabled:!0}),u(!1);return}m.innerHTML="";const r=document.createElement("option");r.value="",r.textContent="Оберіть студента",r.disabled=!0,r.selected=!0,m.appendChild(r),e.slice().sort((t,a)=>{const i=k(t).toLowerCase(),c=k(a).toLowerCase();return i.localeCompare(c,"uk")}).forEach(t=>{if(!(t!=null&&t.email))return;const a=k(t),i=String(t.email||"").trim(),c=document.createElement("option");c.value=i,c.textContent=i&&i!==a?`${a} — ${i}`:a,m.appendChild(c)}),m.disabled=!1,u(!0)},S=function(e){if(!e||typeof e!="object")return null;if(typeof e.url=="string"&&e.url)return e.url;if(typeof e.link=="string"&&e.link)return e.link;const r=new URLSearchParams,t=e.lessonId||e.topicId||e.id||null,a=e.htmlPath||e.lessonPath||null,i=e.category||e.lessonCategory||null,c=e.level||e.lessonLevel||null,l=e.title||e.lessonTitle||e.name||null;return t&&r.set("topic",t),i&&r.set("category",i),c&&r.set("level",c),l&&r.set("title",l),a&&r.set("file",a),r.has("topic")?`lesson.html?${r.toString()}`:null},I=function(e){const r=(e==null?void 0:e.dueDate)||(e==null?void 0:e.deadline)||(e==null?void 0:e.due_at)||(e==null?void 0:e.dueAt)||null;if(!r)return null;const t=new Date(r);if(Number.isNaN(t.getTime()))return null;try{return new Intl.DateTimeFormat("uk-UA",{dateStyle:"medium"}).format(t)}catch{return t.toLocaleDateString("uk-UA")}},A=function(e,r){const t=document.createElement("article");t.className="homework-card",t.setAttribute("role","listitem"),e!=null&&e.lessonId&&(t.dataset.id=e.lessonId);const a=document.createElement("h3");a.className="homework-card__title",a.textContent=(e==null?void 0:e.lessonName)||(e==null?void 0:e.title)||"Без назви",t.appendChild(a);const i=I(e);if(i){const d=document.createElement("p");d.className="homework-card__meta",d.textContent=`Строк: ${i}`,t.appendChild(d)}const c=(e==null?void 0:e.description)||(e==null?void 0:e.lessonDescription)||(e==null?void 0:e.summary)||"";if(c){const d=document.createElement("p");d.className="homework-card__description",d.textContent=c,t.appendChild(d)}if(S(e)){const d=document.createElement("button");d.className="homework-card__link",d.type="button",d.textContent="відкрити",t.appendChild(d)}return t.addEventListener("click",()=>{!(e!=null&&e.lessonId)||!r||(g(t),D(e.lessonId,r))}),t},N=function(e,r){if(h(),!Array.isArray(e)||!e.length){o("У цього студента поки немає призначених уроків.");return}const t=document.createDocumentFragment();e.forEach(a=>{t.appendChild(A(a,r))}),C.appendChild(t),o("Оберіть урок, щоб переглянути практичні завдання.")},T=function(e){if(y(),!Array.isArray(e)||!e.length){const t=document.createElement("p");t.className="muted",t.textContent="Для цього уроку поки немає практичних завдань.",p.appendChild(t);return}const r=document.createElement("div");for(const t of e)if(t.homeworkType==="task")try{const a=JSON.parse(t.homeworkData),i=U(a);i.id=t._id,M(i,t.answers),r.appendChild(i)}catch(a){console.error("Не вдалося відрендерити завдання",a)}else if(t.homeworkType==="theory"){const a=t.homeworkData;typeof a=="string"&&r.insertAdjacentHTML("afterbegin",a)}p.append(...r.children)},H=function(e){const r=e.target.value;!r||r===n.selectedEmail||(n.selectedEmail=r,u(!1),q(r))},w=function(e){if(!e){n.selectedEmail=null,n.studentsLoaded=!1,h(),y(),f("Доступно лише для адміністраторів",{disabled:!0}),u(!1);return}b()};L.init();const n={students:[],studentByEmail:new Map,selectedEmail:null,lessonsRequestId:0,homeworkRequestId:0,activeLessonCard:null,activeLessonId:null,studentsLoaded:!1};async function b(){if(!n.studentsLoaded){n.studentsLoaded=!0,f("Завантаження списку студентів…",{disabled:!0}),o("Завантаження списку студентів…");try{const e=await _(),t=(Array.isArray(e==null?void 0:e.items)?e.items:[]).filter(a=>a&&typeof a=="object"&&a.email);E(t),t.length?o("Оберіть студента, щоб переглянути уроки."):o("Не знайдено студентів для перегляду.")}catch(e){console.error("Не вдалося завантажити список студентів",e),f("Не вдалося завантажити студентів",{disabled:!0}),u(!1),o("Не вдалося завантажити список студентів. Спробуйте пізніше."),n.studentsLoaded=!1}}}async function q(e){const r=++n.lessonsRequestId;if(n.activeLessonId=null,g(null),h(),y(),!e){o("Оберіть студента, щоб переглянути уроки.");return}o("Завантаження уроків…");try{const t=await x(e);if(r!==n.lessonsRequestId||n.selectedEmail!==e)return;N(t,e)}catch(t){if(r!==n.lessonsRequestId)return;console.error(`Не вдалося завантажити уроки для ${e}`,t),o("Не вдалося завантажити уроки. Спробуйте пізніше.")}}async function D(e,r){if(!e||!r)return;const t=++n.homeworkRequestId;n.activeLessonId=e,o("Завантаження завдань…");try{const a=await R({userEmail:r,lessonId:e,limit:1e3});if(t!==n.homeworkRequestId||n.selectedEmail!==r||n.activeLessonId!==e)return;const i=Array.isArray(a==null?void 0:a.items)?[...a.items]:[];i.sort((c,l)=>c.homeworkType===l.homeworkType?0:c.homeworkType==="task"?-1:l.homeworkType==="task"?1:0),T(i),i.length?o(""):o("Для цього уроку поки немає практичних завдань.")}catch(a){if(t!==n.homeworkRequestId)return;console.error(`Не вдалося завантажити завдання для уроку ${e}`,a),o("Не вдалося завантажити завдання. Спробуйте пізніше.")}}m.addEventListener("change",H),L.subscribe(e=>{if(!e.isSignedIn){o("Увійдіть у свій адміністративний акаунт, щоб переглядати домашні роботи студентів."),w(!1);return}if(!L.isAdmin(e.user)){o("Ця сторінка доступна лише адміністраторам."),w(!1);return}w(!0),n.selectedEmail||o("Оберіть студента, щоб переглянути уроки.")})}
//# sourceMappingURL=teacher-homework.js.map
